import"./wallet-5154a2ff.js";class e{constructor(){this.walletConnection=window.walletConnection,this.currentStep=1,this.init()}async init(){this.setupEventListeners(),await this.checkWalletConnection(),this.loadFeaturedArtists(),this.walletConnection&&this.walletConnection.updateUI()}setupEventListeners(){document.addEventListener("click",e=>{"connectWallet"===e.target.id&&this.handleWalletConnection()});const e=document.getElementById("mobileMenuToggle"),t=document.getElementById("mobileMenu");e&&t&&(e.addEventListener("click",()=>{t.classList.toggle("active")}),document.addEventListener("click",n=>{e.contains(n.target)||t.contains(n.target)||t.classList.remove("active")}));const n=document.getElementById("registerConnectBtn"),o=document.getElementById("payRegistrationBtn"),a=document.getElementById("artistProfileForm");n&&n.addEventListener("click",()=>{this.handleStep1WalletConnection()}),o&&o.addEventListener("click",()=>{this.handleStep2Payment()}),a&&a.addEventListener("submit",e=>{e.preventDefault(),this.handleStep3ProfileSetup()})}async checkWalletConnection(){console.log("Artist Register: checkWalletConnection called"),window.walletState&&window.walletState.isConnected?this.goToStep(2):this.goToStep(1),window.walletConnection&&window.walletConnection.updateUI&&window.walletConnection.updateUI()}async handleWalletConnection(){if(console.log("Artist Register: handleWalletConnection called"),window.walletState&&window.walletState.isConnected)window.disconnectWalletDirect&&window.disconnectWalletDirect(),this.goToStep(1);else if(window.connectWalletDirect)try{await window.connectWalletDirect(),window.walletState&&window.walletState.isConnected&&this.goToStep(2)}catch(e){console.error("Artist Register: Wallet connection failed",e)}else console.error("Artist Register: Direct wallet connection not available")}async handleStep1WalletConnection(){if(console.log("Artist Register: handleStep1WalletConnection called"),window.connectWalletDirect)try{await window.connectWalletDirect();window.walletState&&window.walletState.isConnected?this.goToStep(2):(console.error("Artist Register: Connection failed"),window.walletConnection&&window.walletConnection.showMessage&&window.walletConnection.showMessage("Failed to connect wallet. Please try again.","error"))}catch(e){console.error("Artist Register: Wallet connection error",e),window.walletConnection&&window.walletConnection.showMessage&&window.walletConnection.showMessage("Failed to connect wallet. Please try again.","error")}else console.error("Artist Register: Direct wallet connection not available")}async handleStep2Payment(){const e=document.getElementById("payRegistrationBtn");e&&(e.textContent="Processing Payment...",e.disabled=!0);try{const e=window.blockchainService;if(!e)throw new Error("Blockchain service not available");if("0xaa36a7"!==e.getCurrentNetwork().chainId){if(!(await e.switchToSepolia()))throw new Error("Please switch to Sepolia testnet")}const t=this.walletConnection.getWalletAddress();if(!t)throw new Error("Wallet not connected");const n=await e.getBalance(t);if(parseFloat(n)<.01)throw new Error(`Insufficient balance. Required: 0.01 ETH, Available: ${parseFloat(n).toFixed(4)} ETH`);const o=await e.payRegistrationFee(t);if(!o.success)throw new Error(o.error||"Payment failed");this.walletConnection.showMessage(`Registration fee paid successfully! Transaction: ${o.transactionHash}`,"success"),sessionStorage.setItem("registration_tx_hash",o.transactionHash),this.goToStep(3)}catch(t){console.error("Payment error:",t),this.walletConnection.showMessage(`Payment failed: ${t.message}`,"error")}finally{e&&(e.textContent="Pay Registration Fee",e.disabled=!1)}}async handleStep3ProfileSetup(){var e,t,n,o;const a=this.walletConnection.getWalletAddress(),i=null==(e=document.getElementById("artistName"))?void 0:e.value,l=null==(t=document.getElementById("artistBio"))?void 0:t.value,s=null==(n=document.getElementById("artistSocial"))?void 0:n.value,r=null==(o=document.getElementById("artistAvatar"))?void 0:o.files[0];if(!i||!l)return void this.walletConnection.showMessage("Please fill in all required fields.","error");const c=document.querySelector('#artistProfileForm button[type="submit"]');c&&(c.textContent="Processing Registration...",c.disabled=!0);let d=null;if(r)try{d=await this.handleAvatarUpload(r)}catch(w){console.error("Avatar upload failed:",w)}setTimeout(()=>{try{const e={name:i,bio:l,social:s,avatar:d};window.userStore.registerArtist(a,e),this.goToStep(4)}catch(w){this.walletConnection.showMessage("Registration failed. Please try again.","error"),c&&(c.textContent="Complete Registration ðŸŽ‰",c.disabled=!1)}},2e3)}async handleAvatarUpload(e){return window.imageHandler?await window.imageHandler.handleImageUpload(e):new Promise(t=>{const n=new FileReader;n.onload=e=>t(e.target.result),n.readAsDataURL(e)})}goToStep(e){this.currentStep=e;const t=["walletConnectStep","paymentStep","profileStep","successStep"];t.forEach(e=>{const t=document.getElementById(e);t&&(t.style.display="none")});const n=document.getElementById(t[e-1]);n&&(n.style.display="block"),this.updateStepIndicators()}updateStepIndicators(){for(let e=1;e<=3;e++){const t=document.getElementById(`step${e}`);t&&(t.classList.remove("active","completed"),e<this.currentStep?t.classList.add("completed"):e===this.currentStep&&t.classList.add("active"))}}loadFeaturedArtists(){try{const e=window.userStore.getArtists().filter(e=>e.totalSales>0).sort((e,t)=>(t.totalSales||0)-(e.totalSales||0)).slice(0,4),t=document.getElementById("featuredArtistsGrid");t&&e.length>0&&(t.innerHTML=e.map(e=>`\n                        <div class="artist-card" style="cursor: pointer;" onclick="window.location.href='member-artists.html'">\n                            <div class="artist-avatar">${e.avatar?`<img src="${e.avatar}" alt="${e.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`:e.name.substring(0,2).toUpperCase()}</div>\n                            <div class="artist-name">@${e.name}</div>\n                            <div class="artist-sales">${e.totalSales||0} NFTs sold</div>\n                        </div>\n                    `).join(""))}catch(e){console.error("Error loading featured artists:",e)}}}document.addEventListener("DOMContentLoaded",()=>{new e});
