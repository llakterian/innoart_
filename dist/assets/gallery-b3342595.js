import"./multi-wallet-connector-0c891252.js";import"./blockchain-service-b14c66c5.js";import"./user-store-6f34e326.js";import"./image-handler-91d970e9.js";window.currencyConverter=new class{constructor(){this.rates={},this.lastUpdate=null,this.UPDATE_INTERVAL=3e5,this.init()}async init(){await this.fetchRates(),this.startAutoUpdate()}async fetchRates(){try{const e=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=kes,usd,eur,gbp,jpy,cad,aud,chf,cny,inr"),n=await e.json();n.ethereum&&(this.rates=n.ethereum,this.lastUpdate=new Date,this.updateUI())}catch(e){console.error("Failed to fetch exchange rates:",e),this.rates={kes:45e4,usd:3400,eur:3100,gbp:2600,jpy:52e4,cad:4700,aud:5200,chf:3050,cny:24e3,inr:29e4}}}startAutoUpdate(){setInterval(()=>{this.fetchRates()},this.UPDATE_INTERVAL)}convertETH(e,n="kes"){const t=this.rates[n.toLowerCase()];return t?(parseFloat(e)*t).toFixed(2):(console.warn(`Currency ${n} not supported`),null)}formatCurrency(e,n="kes"){return`${{kes:"KES",usd:"$",eur:"â‚¬",gbp:"Â£",jpy:"Â¥",cad:"C$",aud:"A$",chf:"CHF",cny:"Â¥",inr:"â‚¹"}[n.toLowerCase()]||n.toUpperCase()} ${parseFloat(e).toLocaleString()}`}updateUI(){document.querySelectorAll(".price-converter").forEach(e=>{const n=e.dataset.ethAmount,t=e.dataset.currency||"kes";if(n&&this.rates[t.toLowerCase()]){const a=this.convertETH(n,t),r=this.formatCurrency(a,t);e.innerHTML=`\n                    <span class="eth-price">${n} ETH</span>\n                    <span class="fiat-price">(${r})</span>\n                `}});document.querySelectorAll(".rates-update-time").forEach(e=>{e.textContent=`Last updated: ${this.lastUpdate.toLocaleTimeString()}`})}getSupportedCurrencies(){return Object.keys(this.rates)}getRate(e){return this.rates[e.toLowerCase()]}};const e=document.createElement("style");e.textContent="\n    .price-converter {\n        display: flex;\n        flex-direction: column;\n        gap: 0.25rem;\n    }\n    \n    .eth-price {\n        font-weight: 600;\n        color: var(--primary-color);\n        font-size: 1.2rem;\n    }\n    \n    .fiat-price {\n        font-size: 0.9rem;\n        color: var(--text-dark);\n    }\n    \n    .rates-update-time {\n        font-size: 0.8rem;\n        color: var(--text-dark);\n        text-align: center;\n        margin-top: 0.5rem;\n    }\n",document.head.appendChild(e);class n{constructor(){this.nfts=[],this.filteredNFTs=[],this.currentFilter="all",this.init()}async init(){console.log("Initializing Gallery App..."),this.setupEventListeners(),await this.loadNFTs(),console.log("Gallery App initialized")}setupEventListeners(){const e=document.getElementById("mobileMenuToggle"),n=document.getElementById("mobileMenu");e&&n&&(e.addEventListener("click",()=>{n.classList.toggle("active")}),document.addEventListener("click",t=>{e.contains(t.target)||n.contains(t.target)||n.classList.remove("active")})),document.querySelectorAll(".filter-btn").forEach(e=>{e.addEventListener("click",e=>{this.setFilter(e.target.getAttribute("data-filter"))})});const t=document.getElementById("searchInput");t&&t.addEventListener("input",e=>{this.searchNFTs(e.target.value)}),window.addEventListener("walletConnected",()=>{console.log("Wallet connected in gallery")}),window.addEventListener("walletDisconnected",()=>{console.log("Wallet disconnected in gallery")})}async loadNFTs(){const e=document.getElementById("nftGallery");if(e)try{e.innerHTML='\n                <div class="loading">\n                    <div class="loading-spinner"></div>\n                    <p>Loading amazing NFTs...</p>\n                </div>\n            ',this.nfts=await this.generateSampleNFTs(),this.filteredNFTs=[...this.nfts],this.renderNFTs()}catch(n){console.error("Error loading NFTs:",n),e.innerHTML='\n                <div class="empty-state">\n                    <h3>Failed to load NFTs</h3>\n                    <p>Please try again later</p>\n                </div>\n            '}}async generateSampleNFTs(){const e=window.userStore.getNFTs().filter(e=>e.forSale&&!e.sold);if(0===e.length){const e=["art","digital","abstract","photography"],n=[];for(let t=1;t<=8;t++){const a=e[Math.floor(Math.random()*e.length)],r=[["#FF6B6B","#4ECDC4"],["#45B7D1","#96CEB4"],["#FFEAA7","#DDA0DD"],["#74B9FF","#A29BFE"],["#FD79A8","#6C5CE7"],["#00B894","#00CEC9"],["#E17055","#FDCB6E"],["#6C5CE7","#A29BFE"]],s=r[t%r.length];n.push({id:`sample_${t}`,name:`Sample NFT #${t}`,creator:`0x${Math.random().toString(16).substr(2,8)}...${Math.random().toString(16).substr(2,4)}`,price:(5*Math.random()+.1).toFixed(2),image:this.generateNFTImage(t,`NFT #${t}`,s[0],s[1]),category:a,forSale:!0,sold:!1})}return n}return e.map(e=>({...e,title:e.name,artist:this.formatAddress(e.creator),image:this.getNFTImage(e)}))}generateNFTImage(e,n,t,a){const r=document.createElement("canvas");r.width=400,r.height=400;const s=r.getContext("2d"),i=s.createLinearGradient(0,0,400,400);return i.addColorStop(0,t),i.addColorStop(1,a),s.fillStyle=i,s.fillRect(0,0,400,400),s.globalAlpha=.3,s.fillStyle="white",s.beginPath(),s.arc(100,100,60,0,2*Math.PI),s.fill(),s.beginPath(),s.arc(300,300,80,0,2*Math.PI),s.fill(),s.globalAlpha=1,s.fillStyle="white",s.font="32px Arial",s.textAlign="center",s.fillText("ðŸŽ¨",200,180),s.font="16px Arial",s.fillText(n,200,220),s.font="12px Arial",s.fillText(`ID: ${e}`,200,240),r.toDataURL()}setFilter(e){this.currentFilter=e,document.querySelectorAll(".filter-btn").forEach(e=>{e.classList.remove("active")}),document.querySelector(`[data-filter="${e}"]`).classList.add("active"),this.filteredNFTs="all"===e?[...this.nfts]:this.nfts.filter(n=>n.category===e),this.renderNFTs()}searchNFTs(e){const n=e.toLowerCase();this.filteredNFTs=this.nfts.filter(e=>e.title.toLowerCase().includes(n)||e.artist.toLowerCase().includes(n)),this.renderNFTs()}renderNFTs(){const e=document.getElementById("nftGallery");e&&(0!==this.filteredNFTs.length?(e.innerHTML=this.filteredNFTs.map(e=>`\n            <div class="nft-card">\n                <img src="${this.getNFTImage(e)}" alt="${e.title||e.name}" class="nft-image" loading="lazy">\n                <div class="nft-info">\n                    <h3 class="nft-title">${e.title||e.name}</h3>\n                    <p class="nft-artist">by ${e.artist||this.formatAddress(e.creator)}</p>\n                    <div class="nft-price">\n                        <div>\n                            <div class="price-converter" data-eth-amount="${e.price}" data-currency="kes">\n                                ${e.price} ETH\n                            </div>\n                            <div class="price-label">Price</div>\n                        </div>\n                    </div>\n                    <div class="nft-actions">\n                        <button class="btn btn-primary btn-small" onclick="gallery.viewNFT('${e.id}')">View Details</button>\n                        <button class="btn btn-secondary btn-small" onclick="gallery.buyNFT('${e.id}')">Buy Now</button>\n                    </div>\n                </div>\n            </div>\n        `).join(""),window.currencyConverter&&window.currencyConverter.updateUI()):e.innerHTML='\n                <div class="empty-state">\n                    <h3>No NFTs Found</h3>\n                    <p>Try adjusting your search or filter criteria</p>\n                </div>\n            ')}viewNFT(e){let n=this.nfts.find(n=>n.id===e);n||(n=window.userStore.getNFT(e)),n?this.showNFTDetails(n):window.walletConnection.showMessage("NFT not found.","error")}showNFTDetails(e){const n=window.userStore.getArtist(e.creator),t=n?n.name:this.formatAddress(e.creator),a=document.createElement("div");a.className="nft-details-modal-overlay",a.innerHTML=`\n            <div class="nft-details-modal">\n                <div class="modal-header">\n                    <h2>NFT Details</h2>\n                    <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">&times;</button>\n                </div>\n                <div class="modal-content">\n                    <div class="nft-details-layout">\n                        <div class="nft-image-section">\n                            <img src="${this.getNFTImage(e)}" alt="${e.name}" class="nft-detail-image">\n                            <div class="nft-status">\n                                <span class="status-badge ${e.forSale?"for-sale":"not-for-sale"}">\n                                    ${e.sold?"SOLD":e.forSale?"FOR SALE":"NOT FOR SALE"}\n                                </span>\n                            </div>\n                        </div>\n                        <div class="nft-info-section">\n                            <div class="nft-title-section">\n                                <h3>${e.name}</h3>\n                                <p class="nft-description">${e.description||"No description provided"}</p>\n                            </div>\n                            \n                            <div class="nft-details-grid">\n                                <div class="detail-item">\n                                    <span class="detail-label">Creator:</span>\n                                    <span class="detail-value">${t}</span>\n                                </div>\n                                <div class="detail-item">\n                                    <span class="detail-label">Contract Address:</span>\n                                    <span class="detail-value">${this.formatAddress(e.creator)}</span>\n                                </div>\n                                <div class="detail-item">\n                                    <span class="detail-label">Token ID:</span>\n                                    <span class="detail-value">${e.id}</span>\n                                </div>\n                                <div class="detail-item">\n                                    <span class="detail-label">Price:</span>\n                                    <span class="detail-value">\n                                        <span class="price-converter" data-eth-amount="${e.price}" data-currency="kes">\n                                            ${e.price} ETH\n                                        </span>\n                                    </span>\n                                </div>\n                                <div class="detail-item">\n                                    <span class="detail-label">Category:</span>\n                                    <span class="detail-value">${e.category||"Art"}</span>\n                                </div>\n                                <div class="detail-item">\n                                    <span class="detail-label">Created:</span>\n                                    <span class="detail-value">${e.createdAt?new Date(e.createdAt).toLocaleDateString():"Unknown"}</span>\n                                </div>\n                                ${e.sold?`\n                                    <div class="detail-item">\n                                        <span class="detail-label">Sold On:</span>\n                                        <span class="detail-value">${new Date(e.soldAt).toLocaleDateString()}</span>\n                                    </div>\n                                    <div class="detail-item">\n                                        <span class="detail-label">Owner:</span>\n                                        <span class="detail-value">${this.formatAddress(e.owner)}</span>\n                                    </div>\n                                `:""}\n                            </div>\n                            \n                            <div class="price-breakdown">\n                                <h4>Price Breakdown</h4>\n                                <div class="breakdown-item">\n                                    <span>NFT Price:</span>\n                                    <span class="price-converter" data-eth-amount="${e.price}" data-currency="kes">${e.price} ETH</span>\n                                </div>\n                                <div class="breakdown-item">\n                                    <span>Artist receives (80%):</span>\n                                    <span class="price-converter" data-eth-amount="${(.8*parseFloat(e.price)).toFixed(4)}" data-currency="kes">${(.8*parseFloat(e.price)).toFixed(4)} ETH</span>\n                                </div>\n                                <div class="breakdown-item">\n                                    <span>Platform fee (20%):</span>\n                                    <span class="price-converter" data-eth-amount="${(.2*parseFloat(e.price)).toFixed(4)}" data-currency="kes">${(.2*parseFloat(e.price)).toFixed(4)} ETH</span>\n                                </div>\n                            </div>\n                            \n                            <div class="nft-actions">\n                                ${e.forSale&&!e.sold?`\n                                    <button class="btn btn-primary" onclick="gallery.buyNFT('${e.id}'); this.parentElement.parentElement.parentElement.parentElement.remove();">\n                                        Buy Now - ${e.price} ETH\n                                    </button>\n                                `:""}\n                                ${e.sold?'\n                                    <button class="btn btn-secondary" disabled>\n                                        Sold\n                                    </button>\n                                ':""}\n                                <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.parentElement.remove();">\n                                    Close\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,document.body.appendChild(a),window.currencyConverter&&window.currencyConverter.updateUI(),this.addNFTDetailsModalStyles()}buyNFT(e){if(!window.walletConnection.getConnectionStatus())return void window.walletConnection.showMessage("Please connect your wallet first to buy NFTs.","error");const n=window.walletConnection.getWalletAddress();let t=this.nfts.find(n=>n.id===e);if(t||(t=window.userStore.getNFT(e)),!t)return window.walletConnection.showMessage("NFT not found. Please refresh the page.","error"),console.error("NFT not found with ID:",e),void console.log("Available NFTs:",this.nfts.map(e=>e.id));t.creator!==n?t.sold?window.walletConnection.showMessage("This NFT has already been sold.","error"):t.forSale?this.showPurchaseConfirmation(t,n):window.walletConnection.showMessage("This NFT is not currently for sale.","error"):window.walletConnection.showMessage("You cannot buy your own NFT.","error")}showPurchaseConfirmation(e,n){const t=document.createElement("div");t.className="purchase-modal-overlay",t.innerHTML=`\n            <div class="purchase-modal">\n                <div class="purchase-modal-header">\n                    <h3>ðŸ›’ Purchase NFT</h3>\n                    <button class="close-btn" onclick="this.parentElement.parentElement.parentElement.remove()">&times;</button>\n                </div>\n                <div class="purchase-modal-content">\n                    <div class="nft-preview">\n                        <img src="${this.getNFTImage(e)}" alt="${e.title||e.name}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;">\n                        <div class="nft-details">\n                            <h4>${e.title||e.name}</h4>\n                            <p>by ${this.formatAddress(e.creator)}</p>\n                        </div>\n                    </div>\n                    <div class="purchase-breakdown">\n                        <div class="breakdown-item">\n                            <span>NFT Price:</span>\n                            <span class="price-converter" data-eth-amount="${e.price}" data-currency="kes">${e.price} ETH</span>\n                        </div>\n                        <div class="breakdown-item">\n                            <span>Artist receives (80%):</span>\n                            <span class="price-converter" data-eth-amount="${(.8*parseFloat(e.price)).toFixed(4)}" data-currency="kes">${(.8*parseFloat(e.price)).toFixed(4)} ETH</span>\n                        </div>\n                        <div class="breakdown-item">\n                            <span>Platform fee (20%):</span>\n                            <span class="price-converter" data-eth-amount="${(.2*parseFloat(e.price)).toFixed(4)}" data-currency="kes">${(.2*parseFloat(e.price)).toFixed(4)} ETH</span>\n                        </div>\n                        <hr>\n                        <div class="breakdown-item total">\n                            <span>Total:</span>\n                            <span class="price-converter" data-eth-amount="${e.price}" data-currency="kes">${e.price} ETH</span>\n                        </div>\n                    </div>\n                    <div class="purchase-actions">\n                        <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove()">Cancel</button>\n                        <button class="btn btn-primary" onclick="gallery.confirmPurchase('${e.id}', '${n}')">Confirm Purchase</button>\n                    </div>\n                </div>\n            </div>\n        `,document.body.appendChild(t),window.currencyConverter&&window.currencyConverter.updateUI()}async confirmPurchase(e,n){const t=document.querySelector(".purchase-modal-overlay");t&&t.remove(),window.walletConnection.showMessage("Processing purchase...","info");try{const t=window.userStore.getNFT(e);if(!t)throw new Error("NFT not found");const a=window.blockchainService;if(!a)throw new Error("Blockchain service not available");if("0xaa36a7"!==a.getCurrentNetwork().chainId){if(!(await a.switchToSepolia()))throw new Error("Please switch to Sepolia testnet")}const r=await a.getBalance(n);if(parseFloat(r)<parseFloat(t.price))throw new Error(`Insufficient balance. Required: ${t.price} ETH, Available: ${parseFloat(r).toFixed(4)} ETH`);const s=await a.purchaseNFT(n,t.price,t.creator);if(!s.success)throw new Error(s.error||"Blockchain transaction failed");{const t=window.userStore.purchaseNFT(e,n);t.success?(window.walletConnection.showMessage(`NFT purchased successfully! Artist: ${s.artistTransaction}, Platform: ${s.developerTransaction}`,"success"),sessionStorage.setItem(`purchase_${e}_artist_tx`,s.artistTransaction),sessionStorage.setItem(`purchase_${e}_platform_tx`,s.developerTransaction),this.loadNFTs()):window.walletConnection.showMessage(t.message,"error")}}catch(a){console.error("Purchase error:",a),window.walletConnection.showMessage(`Purchase failed: ${a.message}`,"error")}}formatAddress(e){return e?`${e.substring(0,6)}...${e.substring(e.length-4)}`:""}getNFTImage(e){if(e.image){const n=window.imageHandler.getImage(e.image);if(n)return n.data}return this.generateNFTImage(e.id,e.name,"#6366f1","#ec4899")}addNFTDetailsModalStyles(){if(document.getElementById("nft-details-modal-styles"))return;const e=document.createElement("style");e.id="nft-details-modal-styles",e.textContent="\n            .nft-details-modal-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.8);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 1000;\n                padding: 2rem;\n            }\n            \n            .nft-details-modal {\n                background: var(--card-background);\n                border-radius: 16px;\n                max-width: 900px;\n                width: 100%;\n                max-height: 90vh;\n                overflow-y: auto;\n                border: 1px solid var(--border-color);\n                box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);\n            }\n            \n            .modal-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 2rem 2rem 1rem;\n                border-bottom: 1px solid var(--border-color);\n            }\n            \n            .modal-header h2 {\n                margin: 0;\n                color: var(--text-light);\n                font-size: 1.5rem;\n            }\n            \n            .close-btn {\n                background: none;\n                border: none;\n                font-size: 2rem;\n                cursor: pointer;\n                color: var(--text-dark);\n                padding: 0;\n                width: 40px;\n                height: 40px;\n                border-radius: 50%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.3s ease;\n            }\n            \n            .close-btn:hover {\n                background: var(--border-color);\n                color: var(--text-light);\n            }\n            \n            .modal-content {\n                padding: 2rem;\n            }\n            \n            .nft-details-layout {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                gap: 2rem;\n            }\n            \n            .nft-image-section {\n                position: relative;\n            }\n            \n            .nft-detail-image {\n                width: 100%;\n                height: 400px;\n                object-fit: cover;\n                border-radius: 12px;\n                border: 1px solid var(--border-color);\n            }\n            \n            .nft-status {\n                position: absolute;\n                top: 1rem;\n                right: 1rem;\n            }\n            \n            .status-badge {\n                padding: 0.5rem 1rem;\n                border-radius: 20px;\n                font-size: 0.8rem;\n                font-weight: 600;\n                text-transform: uppercase;\n                letter-spacing: 0.5px;\n            }\n            \n            .status-badge.for-sale {\n                background: var(--success-color);\n                color: white;\n            }\n            \n            .status-badge.not-for-sale {\n                background: var(--error-color);\n                color: white;\n            }\n            \n            .nft-info-section {\n                display: flex;\n                flex-direction: column;\n                gap: 1.5rem;\n            }\n            \n            .nft-title-section h3 {\n                font-size: 1.5rem;\n                margin: 0 0 0.5rem 0;\n                color: var(--text-light);\n            }\n            \n            .nft-description {\n                color: var(--text-dark);\n                line-height: 1.6;\n                margin: 0;\n            }\n            \n            .nft-details-grid {\n                display: grid;\n                gap: 1rem;\n            }\n            \n            .detail-item {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 0.75rem 0;\n                border-bottom: 1px solid var(--border-color);\n            }\n            \n            .detail-label {\n                font-weight: 600;\n                color: var(--text-dark);\n            }\n            \n            .detail-value {\n                color: var(--text-light);\n                font-family: 'Courier New', monospace;\n                font-size: 0.9rem;\n            }\n            \n            .price-breakdown {\n                background: var(--background-light);\n                padding: 1rem;\n                border-radius: 8px;\n                border: 1px solid var(--border-color);\n            }\n            \n            .price-breakdown h4 {\n                margin: 0 0 1rem 0;\n                color: var(--text-light);\n                font-size: 1rem;\n            }\n            \n            .breakdown-item {\n                display: flex;\n                justify-content: space-between;\n                margin-bottom: 0.5rem;\n            }\n            \n            .breakdown-item span:first-child {\n                color: var(--text-dark);\n            }\n            \n            .breakdown-item span:last-child {\n                color: var(--text-light);\n                font-weight: 600;\n            }\n            \n            .nft-actions {\n                display: flex;\n                gap: 1rem;\n                margin-top: 1rem;\n            }\n            \n            .nft-actions .btn {\n                flex: 1;\n                padding: 0.75rem 1rem;\n                border-radius: 8px;\n                border: none;\n                font-weight: 600;\n                cursor: pointer;\n                transition: all 0.3s ease;\n            }\n            \n            .nft-actions .btn-primary {\n                background: var(--primary-color);\n                color: white;\n            }\n            \n            .nft-actions .btn-primary:hover {\n                background: var(--primary-hover);\n                transform: translateY(-2px);\n            }\n            \n            .nft-actions .btn-secondary {\n                background: var(--border-color);\n                color: var(--text-light);\n            }\n            \n            .nft-actions .btn-secondary:hover {\n                background: var(--text-dark);\n                color: white;\n            }\n            \n            .nft-actions .btn:disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n            }\n            \n            .nft-actions .btn:disabled:hover {\n                transform: none;\n            }\n            \n            @media (max-width: 768px) {\n                .nft-details-modal-overlay {\n                    padding: 1rem;\n                }\n                \n                .nft-details-layout {\n                    grid-template-columns: 1fr;\n                }\n                \n                .nft-detail-image {\n                    height: 300px;\n                }\n                \n                .modal-header, .modal-content {\n                    padding: 1rem;\n                }\n                \n                .nft-actions {\n                    flex-direction: column;\n                }\n            }\n        ",document.head.appendChild(e)}}document.addEventListener("DOMContentLoaded",()=>{window.gallery=new n});
