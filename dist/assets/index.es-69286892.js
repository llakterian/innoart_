import{g as e,_ as t,a as i,c as r}from"./main-555f3dea.js";import{e as s,N as n}from"./events-8de2f827.js";var o=globalThis&&globalThis.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var r,s=0,n=t.length;s<n;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))},a=function(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"},c=function(e){this.version=e,this.type="node",this.name="node",this.os=process.platform},h=function(e,t,i,r){this.name=e,this.version=t,this.os=i,this.bot=r,this.type="bot-device"},l=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},u=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},d=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,f=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],p=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function g(e){return e?y(e):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new u:"undefined"!=typeof navigator?y(navigator.userAgent):"undefined"!=typeof process&&process.version?new c(process.version.slice(1)):null}function y(e){var t=function(e){return""!==e&&f.reduce(function(t,i){var r=i[0],s=i[1];if(t)return t;var n=s.exec(e);return!!n&&[r,n]},!1)}(e);if(!t)return null;var i=t[0],r=t[1];if("searchbot"===i)return new l;var s=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);s?s.length<3&&(s=o(o([],s,!0),function(e){for(var t=[],i=0;i<e;i++)t.push("0");return t}(3-s.length),!0)):s=[];var n=s.join("."),c=function(e){for(var t=0,i=p.length;t<i;t++){var r=p[t],s=r[0];if(r[1].exec(e))return s}return null}(e),u=d.exec(e);return u&&u[1]?new h(i,n,c,u[1]):new a(i,n,c)}var w={},m=function(e,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var b=function(){return b=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},b.apply(this,arguments)};function v(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function E(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,s,n=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(a){s={error:a}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(s)throw s.error}}return o}function I(e){return this instanceof I?(this.v=e,this):new I(e)}const x=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return b},__asyncDelegator:function(e){var t,i;return t={},r("next"),r("throw",function(e){throw e}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,s){t[r]=e[r]?function(t){return(i=!i)?{value:I(e[r](t)),done:"return"===r}:s?s(t):t}:s}},__asyncGenerator:function(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,s=i.apply(e,t||[]),n=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){s[e]&&(r[e]=function(t){return new Promise(function(i,r){n.push([e,t,i,r])>1||a(e,t)})})}function a(e,t){try{(i=s[e](t)).value instanceof I?Promise.resolve(i.value.v).then(c,h):l(n[0][2],i)}catch(dh){l(n[0][3],dh)}var i}function c(e){a("next",e)}function h(e){a("throw",e)}function l(e,t){e(t),n.shift(),n.length&&a(n[0][0],n[0][1])}},__asyncValues:function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e=v(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=e[i]&&function(t){return new Promise(function(r,s){(function(e,t,i,r){Promise.resolve(r).then(function(t){e({value:t,done:i})},t)})(r,s,(t=e[i](t)).done,t.value)})}}},__await:I,__awaiter:function(e,t,i,r){return new(i||(i=Promise))(function(s,n){function o(e){try{c(r.next(e))}catch(dh){n(dh)}}function a(e){try{c(r.throw(e))}catch(dh){n(dh)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(o,a)}c((r=r.apply(e,t||[])).next())})},__classPrivateFieldGet:function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},__classPrivateFieldSet:function(e,t,i){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,i),i},__createBinding:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]},__decorate:function(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o},__exportStar:function(e,t){for(var i in e)"default"===i||t.hasOwnProperty(i)||(t[i]=e[i])},__extends:function(e,t){function i(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},__generator:function(e,t){var i,r,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(s=2&n[0]?r.return:n[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,r=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(dh){n=[6,dh],r=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},__importDefault:function(e){return e&&e.__esModule?e:{default:e}},__importStar:function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t},__makeTemplateObject:function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__metadata:function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param:function(e,t){return function(i,r){t(i,r,e)}},__read:E,__rest:function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]])}return i},__spread:function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(E(arguments[t]));return e},__spreadArrays:function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var r=Array(e),s=0;for(t=0;t<i;t++)for(var n=arguments[t],o=0,a=n.length;o<a;o++,s++)r[s]=n[o];return r},__values:v},Symbol.toStringTag,{value:"Module"})),S=e(x);var P,O={},_={};var A,T={},C={},N={};var U,R,B,k,j={};function D(){return R||(R=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=S;t.__exportStar((A||(A=1,Object.defineProperty(N,"__esModule",{value:!0}),N.ONE_THOUSAND=N.ONE_HUNDRED=void 0,N.ONE_HUNDRED=100,N.ONE_THOUSAND=1e3),N),e),t.__exportStar(function(){return U||(U=1,e=j,Object.defineProperty(e,"__esModule",{value:!0}),e.ONE_YEAR=e.FOUR_WEEKS=e.THREE_WEEKS=e.TWO_WEEKS=e.ONE_WEEK=e.THIRTY_DAYS=e.SEVEN_DAYS=e.FIVE_DAYS=e.THREE_DAYS=e.ONE_DAY=e.TWENTY_FOUR_HOURS=e.TWELVE_HOURS=e.SIX_HOURS=e.THREE_HOURS=e.ONE_HOUR=e.SIXTY_MINUTES=e.THIRTY_MINUTES=e.TEN_MINUTES=e.FIVE_MINUTES=e.ONE_MINUTE=e.SIXTY_SECONDS=e.THIRTY_SECONDS=e.TEN_SECONDS=e.FIVE_SECONDS=e.ONE_SECOND=void 0,e.ONE_SECOND=1,e.FIVE_SECONDS=5,e.TEN_SECONDS=10,e.THIRTY_SECONDS=30,e.SIXTY_SECONDS=60,e.ONE_MINUTE=e.SIXTY_SECONDS,e.FIVE_MINUTES=5*e.ONE_MINUTE,e.TEN_MINUTES=10*e.ONE_MINUTE,e.THIRTY_MINUTES=30*e.ONE_MINUTE,e.SIXTY_MINUTES=60*e.ONE_MINUTE,e.ONE_HOUR=e.SIXTY_MINUTES,e.THREE_HOURS=3*e.ONE_HOUR,e.SIX_HOURS=6*e.ONE_HOUR,e.TWELVE_HOURS=12*e.ONE_HOUR,e.TWENTY_FOUR_HOURS=24*e.ONE_HOUR,e.ONE_DAY=e.TWENTY_FOUR_HOURS,e.THREE_DAYS=3*e.ONE_DAY,e.FIVE_DAYS=5*e.ONE_DAY,e.SEVEN_DAYS=7*e.ONE_DAY,e.THIRTY_DAYS=30*e.ONE_DAY,e.ONE_WEEK=e.SEVEN_DAYS,e.TWO_WEEKS=2*e.ONE_WEEK,e.THREE_WEEKS=3*e.ONE_WEEK,e.FOUR_WEEKS=4*e.ONE_WEEK,e.ONE_YEAR=365*e.ONE_DAY),j;var e}(),e)}(C)),C}function L(){return k||(k=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=S;t.__exportStar((P||(P=1,Object.defineProperty(_,"__esModule",{value:!0}),_.delay=void 0,_.delay=function(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}),_),e),t.__exportStar(function(){if(B)return T;B=1,Object.defineProperty(T,"__esModule",{value:!0}),T.fromMiliseconds=T.toMiliseconds=void 0;const e=D();return T.toMiliseconds=function(t){return t*e.ONE_THOUSAND},T.fromMiliseconds=function(t){return Math.floor(t/e.ONE_THOUSAND)},T}(),e)}(O)),O}var $,M={};var q,z,H={},F={};function V(){return z||(z=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});S.__exportStar((q||(q=1,Object.defineProperty(F,"__esModule",{value:!0}),F.IWatch=void 0,F.IWatch=class{}),F),e)}(H)),H}!function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=S;t.__exportStar(L(),e),t.__exportStar(function(){if($)return M;$=1,Object.defineProperty(M,"__esModule",{value:!0}),M.Watch=void 0;class e{constructor(){this.timestamps=new Map}start(e){if(this.timestamps.has(e))throw new Error(`Watch already started for label: ${e}`);this.timestamps.set(e,{started:Date.now()})}stop(e){const t=this.get(e);if(void 0!==t.elapsed)throw new Error(`Watch already stopped for label: ${e}`);const i=Date.now()-t.started;this.timestamps.set(e,{started:t.started,elapsed:i})}get(e){const t=this.timestamps.get(e);if(void 0===t)throw new Error(`No timestamp found for label: ${e}`);return t}elapsed(e){const t=this.get(e);return t.elapsed||Date.now()-t.started}}return M.Watch=e,M.default=e,M}(),e),t.__exportStar(V(),e),t.__exportStar(D(),e)}(w);var K={};function W(e){let t;return"undefined"!=typeof window&&void 0!==window[e]&&(t=window[e]),t}function G(e){const t=W(e);if(!t)throw new Error(`${e} is not defined in Window`);return t}Object.defineProperty(K,"__esModule",{value:!0}),K.getLocalStorage=K.getLocalStorageOrThrow=K.getCrypto=K.getCryptoOrThrow=Z=K.getLocation=K.getLocationOrThrow=J=K.getNavigator=K.getNavigatorOrThrow=Y=K.getDocument=K.getDocumentOrThrow=K.getFromWindowOrThrow=K.getFromWindow=void 0,K.getFromWindow=W,K.getFromWindowOrThrow=G,K.getDocumentOrThrow=function(){return G("document")};var Y=K.getDocument=function(){return W("document")};K.getNavigatorOrThrow=function(){return G("navigator")};var J=K.getNavigator=function(){return W("navigator")};K.getLocationOrThrow=function(){return G("location")};var Z=K.getLocation=function(){return W("location")};K.getCryptoOrThrow=function(){return G("crypto")},K.getCrypto=function(){return W("crypto")},K.getLocalStorageOrThrow=function(){return G("localStorage")},K.getLocalStorage=function(){return W("localStorage")};var Q={};Object.defineProperty(Q,"__esModule",{value:!0});var X=Q.getWindowMetadata=void 0;const ee=K;function te(e,{strict:t=!0}={}){return!!e&&("string"==typeof e&&(t?/^0x[0-9a-fA-F]*$/.test(e):e.startsWith("0x")))}function ie(e){return te(e,{strict:!1})?Math.ceil((e.length-2)/2):e.length}X=Q.getWindowMetadata=function(){let e,t;try{e=ee.getDocumentOrThrow(),t=ee.getLocationOrThrow()}catch(dh){return null}function i(...t){const i=e.getElementsByTagName("meta");for(let e=0;e<i.length;e++){const r=i[e],s=["itemprop","property","name"].map(e=>r.getAttribute(e)).filter(e=>!!e&&t.includes(e));if(s.length&&s){const e=r.getAttribute("content");if(e)return e}}return""}const r=function(){let t=i("name","og:site_name","og:title","twitter:title");return t||(t=e.title),t}();return{description:i("description","og:description","twitter:description","keywords"),url:t.origin,icons:function(){const i=e.getElementsByTagName("link"),r=[];for(let e=0;e<i.length;e++){const s=i[e],n=s.getAttribute("rel");if(n&&n.toLowerCase().indexOf("icon")>-1){const e=s.getAttribute("href");if(e)if(-1===e.toLowerCase().indexOf("https:")&&-1===e.toLowerCase().indexOf("http:")&&0!==e.indexOf("//")){let i=t.protocol+"//"+t.host;if(0===e.indexOf("/"))i+=e;else{const r=t.pathname.split("/");r.pop();i+=r.join("/")+"/"+e}r.push(i)}else if(0===e.indexOf("//")){const i=t.protocol+e;r.push(i)}else r.push(e)}}return r}(),name:r}};const re="2.31.0";let se={getDocsUrl:({docsBaseUrl:e,docsPath:t="",docsSlug:i})=>t?`${e??"https://viem.sh"}${t}${i?`#${i}`:""}`:void 0,version:`viem@${re}`};class ne extends Error{constructor(e,t={}){var i;const r=t.cause instanceof ne?t.cause.details:(null==(s=t.cause)?void 0:s.message)?t.cause.message:t.details;var s;const n=t.cause instanceof ne&&t.cause.docsPath||t.docsPath,o=null==(i=se.getDocsUrl)?void 0:i.call(se,{...t,docsPath:n});super([e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...o?[`Docs: ${o}`]:[],...r?[`Details: ${r}`]:[],...se.version?[`Version: ${se.version}`]:[]].join("\n"),t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=n,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version=re}walk(e){return oe(this,e)}}function oe(e,t){return(null==t?void 0:t(e))?e:e&&"object"==typeof e&&"cause"in e&&void 0!==e.cause?oe(e.cause,t):t?null:e}class ae extends ne{constructor({size:e,targetSize:t,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function ce(e,{dir:t,size:i=32}={}){return"string"==typeof e?function(e,{dir:t,size:i=32}={}){if(null===i)return e;const r=e.replace("0x","");if(r.length>2*i)throw new ae({size:Math.ceil(r.length/2),targetSize:i,type:"hex"});return`0x${r["right"===t?"padEnd":"padStart"](2*i,"0")}`}(e,{dir:t,size:i}):function(e,{dir:t,size:i=32}={}){if(null===i)return e;if(e.length>i)throw new ae({size:e.length,targetSize:i,type:"bytes"});const r=new Uint8Array(i);for(let s=0;s<i;s++){const n="right"===t;r[n?s:i-s-1]=e[n?s:e.length-s-1]}return r}(e,{dir:t,size:i})}class he extends ne{constructor({max:e,min:t,signed:i,size:r,value:s}){super(`Number "${s}" is not in safe ${r?`${8*r}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class le extends ne{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function ue(e,{size:t}){if(ie(e)>t)throw new le({givenSize:ie(e),maxSize:t})}function de(e,t={}){const{signed:i}=t;t.size&&ue(e,{size:t.size});const r=BigInt(e);if(!i)return r;const s=(e.length-2)/2;return r<=(1n<<8n*BigInt(s)-1n)-1n?r:r-BigInt(`0x${"f".padStart(2*s,"f")}`)-1n}const fe=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function pe(e,t={}){return"number"==typeof e||"bigint"==typeof e?ye(e,t):"string"==typeof e?function(e,t={}){const i=we.encode(e);return ge(i,t)}(e,t):"boolean"==typeof e?function(e,t={}){const i=`0x${Number(e)}`;if("number"==typeof t.size)return ue(i,{size:t.size}),ce(i,{size:t.size});return i}(e,t):ge(e,t)}function ge(e,t={}){let i="";for(let s=0;s<e.length;s++)i+=fe[e[s]];const r=`0x${i}`;return"number"==typeof t.size?(ue(r,{size:t.size}),ce(r,{dir:"right",size:t.size})):r}function ye(e,t={}){const{signed:i,size:r}=t,s=BigInt(e);let n;r?n=i?(1n<<8n*BigInt(r)-1n)-1n:2n**(8n*BigInt(r))-1n:"number"==typeof e&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o="bigint"==typeof n&&i?-n-1n:0;if(n&&s>n||s<o){const t="bigint"==typeof e?"n":"";throw new he({max:n?`${n}${t}`:void 0,min:`${o}${t}`,signed:i,size:r,value:`${e}${t}`})}const a=`0x${(i&&s<0?(1n<<BigInt(8*r))+BigInt(s):s).toString(16)}`;return r?ce(a,{size:r}):a}const we=new TextEncoder;const me=new TextEncoder;function be(e,t={}){return"number"==typeof e||"bigint"==typeof e?function(e,t){const i=ye(e,t);return Ie(i)}(e,t):"boolean"==typeof e?function(e,t={}){const i=new Uint8Array(1);if(i[0]=Number(e),"number"==typeof t.size)return ue(i,{size:t.size}),ce(i,{size:t.size});return i}(e,t):te(e)?Ie(e,t):xe(e,t)}const ve={zero:48,nine:57,A:65,F:70,a:97,f:102};function Ee(e){return e>=ve.zero&&e<=ve.nine?e-ve.zero:e>=ve.A&&e<=ve.F?e-(ve.A-10):e>=ve.a&&e<=ve.f?e-(ve.a-10):void 0}function Ie(e,t={}){let i=e;t.size&&(ue(i,{size:t.size}),i=ce(i,{dir:"right",size:t.size}));let r=i.slice(2);r.length%2&&(r=`0${r}`);const s=r.length/2,n=new Uint8Array(s);for(let o=0,a=0;o<s;o++){const e=Ee(r.charCodeAt(a++)),t=Ee(r.charCodeAt(a++));if(void 0===e||void 0===t)throw new ne(`Invalid byte sequence ("${r[a-2]}${r[a-1]}" in "${r}").`);n[o]=16*e+t}return n}function xe(e,t={}){const i=me.encode(e);return"number"==typeof t.size?(ue(i,{size:t.size}),ce(i,{dir:"right",size:t.size})):i}const Se=BigInt(2**32-1),Pe=BigInt(32);function Oe(e,t=!1){return t?{h:Number(e&Se),l:Number(e>>Pe&Se)}:{h:0|Number(e>>Pe&Se),l:0|Number(e&Se)}}const _e="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function Ae(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Te(e,...t){if(!((i=e)instanceof Uint8Array||ArrayBuffer.isView(i)&&"Uint8Array"===i.constructor.name))throw new Error("Uint8Array expected");
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
var i;if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Ce(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.createHasher");Ae(e.outputLen),Ae(e.blockLen)}function Ne(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ue(e,t){Te(e);const i=t.outputLen;if(e.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}function Re(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Be(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function ke(e,t){return e<<32-t|e>>>t}function je(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}const De=(()=>68===new Uint8Array(new Uint32Array([287454020]).buffer)[0])()?e=>e:function(e){for(let t=0;t<e.length;t++)e[t]=je(e[t]);return e};function Le(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}(e)),Te(e),e}function $e(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];Te(i),t+=i.length}const i=new Uint8Array(t);for(let r=0,s=0;r<e.length;r++){const t=e[r];i.set(t,s),s+=t.length}return i}class Me{}function qe(e){const t=t=>e().update(Le(t)).digest(),i=e();return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=()=>e(),t}function ze(e=32){if(_e&&"function"==typeof _e.getRandomValues)return _e.getRandomValues(new Uint8Array(e));if(_e&&"function"==typeof _e.randomBytes)return Uint8Array.from(_e.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}const He=BigInt(0),Fe=BigInt(1),Ve=BigInt(2),Ke=BigInt(7),We=BigInt(256),Ge=BigInt(113),Ye=[],Je=[],Ze=[];for(let rP=0,sP=Fe,nP=1,oP=0;rP<24;rP++){[nP,oP]=[oP,(2*nP+3*oP)%5],Ye.push(2*(5*oP+nP)),Je.push((rP+1)*(rP+2)/2%64);let e=He;for(let t=0;t<7;t++)sP=(sP<<Fe^(sP>>Ke)*Ge)%We,sP&Ve&&(e^=Fe<<(Fe<<BigInt(t))-Fe);Ze.push(e)}const Qe=function(e,t=!1){const i=e.length;let r=new Uint32Array(i),s=new Uint32Array(i);for(let n=0;n<i;n++){const{h:i,l:o}=Oe(e[n],t);[r[n],s[n]]=[i,o]}return[r,s]}(Ze,!0),Xe=Qe[0],et=Qe[1],tt=(e,t,i)=>i>32?((e,t,i)=>t<<i-32|e>>>64-i)(e,t,i):((e,t,i)=>e<<i|t>>>32-i)(e,t,i),it=(e,t,i)=>i>32?((e,t,i)=>e<<i-32|t>>>64-i)(e,t,i):((e,t,i)=>t<<i|e>>>32-i)(e,t,i);class rt extends Me{constructor(e,t,i,r=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=r,this.rounds=s,Ae(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");var n;this.state=new Uint8Array(200),this.state32=(n=this.state,new Uint32Array(n.buffer,n.byteOffset,Math.floor(n.byteLength/4)))}clone(){return this._cloneInto()}keccak(){De(this.state32),function(e,t=24){const i=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let r=0;r<10;r++)i[r]=e[r]^e[r+10]^e[r+20]^e[r+30]^e[r+40];for(let r=0;r<10;r+=2){const t=(r+8)%10,s=(r+2)%10,n=i[s],o=i[s+1],a=tt(n,o,1)^i[t],c=it(n,o,1)^i[t+1];for(let i=0;i<50;i+=10)e[r+i]^=a,e[r+i+1]^=c}let t=e[2],s=e[3];for(let i=0;i<24;i++){const r=Je[i],n=tt(t,s,r),o=it(t,s,r),a=Ye[i];t=e[a],s=e[a+1],e[a]=n,e[a+1]=o}for(let r=0;r<50;r+=10){for(let t=0;t<10;t++)i[t]=e[r+t];for(let t=0;t<10;t++)e[r+t]^=~i[(t+2)%10]&i[(t+4)%10]}e[0]^=Xe[r],e[1]^=et[r]}Re(i)}(this.state32,this.rounds),De(this.state32),this.posOut=0,this.pos=0}update(e){Ne(this),Te(e=Le(e));const{blockLen:t,state:i}=this,r=e.length;for(let s=0;s<r;){const n=Math.min(t-this.pos,r-s);for(let t=0;t<n;t++)i[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:r}=this;e[i]^=t,128&t&&i===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){Ne(this,!1),Te(e),this.finish();const t=this.state,{blockLen:i}=this;for(let r=0,s=e.length;r<s;){this.posOut>=i&&this.keccak();const n=Math.min(i-this.posOut,s-r);e.set(t.subarray(this.posOut,this.posOut+n),r),this.posOut+=n,r+=n}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ae(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ue(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Re(this.state)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:r,rounds:s,enableXOF:n}=this;return e||(e=new rt(t,i,r,n,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=r,e.enableXOF=n,e.destroyed=this.destroyed,e}}const st=(()=>{return e=1,t=136,i=32,qe(()=>new rt(t,e,i));var e,t,i})();function nt(e,t){const i=t||"hex",r=st(te(e,{strict:!1})?be(e):e);return"bytes"===i?r:pe(r)}class ot extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&void 0!==t&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const e=this.keys().next().value;e&&this.delete(e)}return this}}const at=new ot(8192);function ct(e){return function(e,t){if(at.has(`${e}.${t}`))return at.get(`${e}.${t}`);const i=t?`${t}${e.toLowerCase()}`:e.substring(2).toLowerCase(),r=nt(xe(i),"bytes"),s=(t?i.substring(`${t}0x`.length):i).split("");for(let o=0;o<40;o+=2)r[o>>1]>>4>=8&&s[o]&&(s[o]=s[o].toUpperCase()),(15&r[o>>1])>=8&&s[o+1]&&(s[o+1]=s[o+1].toUpperCase());const n=`0x${s.join("")}`;return at.set(`${e}.${t}`,n),n}(`0x${nt(`0x${e.substring(4)}`).substring(26)}`)}async function ht({hash:e,signature:i}){const r=te(e)?e:pe(e),{secp256k1:s}=await t(()=>import("./secp256k1-bbe33fcc.js"),["assets/secp256k1-bbe33fcc.js","assets/main-555f3dea.js","assets/global-38c848b6.css","assets/events-8de2f827.js"]);return`0x${(()=>{if("object"==typeof i&&"r"in i&&"s"in i){const{r:e,s:t,v:r,yParity:n}=i,o=lt(Number(n??r));return new s.Signature(de(e),de(t)).addRecoveryBit(o)}const e=te(i)?i:pe(i);if(65!==ie(e))throw new Error("invalid signature length");const t=lt(function(e,t={}){return Number(de(e,t))}(`0x${e.slice(130)}`));return s.Signature.fromCompact(e.substring(2,130)).addRecoveryBit(t)})().recoverPublicKey(r.substring(2)).toHex(!1)}`}function lt(e){if(0===e||1===e)return e;if(27===e)return 0;if(28===e)return 1;throw new Error("Invalid yParityOrV value")}const ut=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let a=0;a<t.length;a++)t[a]=255;for(let a=0;a<e.length;a++){const i=e.charAt(a),r=i.charCodeAt(0);if(255!==t[r])throw new TypeError(i+" is ambiguous");t[r]=a}const i=e.length,r=e.charAt(0),s=Math.log(i)/Math.log(256),n=Math.log(256)/Math.log(i);function o(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;let n=0,o=0,a=0;for(;e[n]===r;)o++,n++;const c=(e.length-n)*s+1>>>0,h=new Uint8Array(c);for(;n<e.length;){const r=e.charCodeAt(n);if(r>255)return;let s=t[r];if(255===s)return;let o=0;for(let e=c-1;(0!==s||o<a)&&-1!==e;e--,o++)s+=i*h[e]>>>0,h[e]=s%256>>>0,s=s/256>>>0;if(0!==s)throw new Error("Non-zero carry");a=o,n++}let l=c-a;for(;l!==c&&0===h[l];)l++;const u=new Uint8Array(o+(c-l));let d=o;for(;l!==c;)u[d++]=h[l++];return u}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";let s=0,o=0,a=0;const c=t.length;for(;a!==c&&0===t[a];)a++,s++;const h=(c-a)*n+1>>>0,l=new Uint8Array(h);for(;a!==c;){let e=t[a],r=0;for(let t=h-1;(0!==e||r<o)&&-1!==t;t--,r++)e+=256*l[t]>>>0,l[t]=e%i>>>0,e=e/i>>>0;if(0!==e)throw new Error("Non-zero carry");o=r,a++}let u=h-o;for(;u!==h&&0===l[u];)u++;let d=r.repeat(s);for(;u<h;++u)d+=e.charAt(l[u]);return d},decodeUnsafe:o,decode:function(e){const t=o(e);if(t)return t;throw new Error("Non-base"+i+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");const dt=new TextEncoder;function ft(e,t,i){e.length>50?function(e,t,i){dt.encodeInto(e,t.subarray(i))}(e,t,i):function(e,t,i){const r=e.length;let s=i,n=0;for(;n<r;){let i=e.charCodeAt(n++);if(4294967168&i){if(4294965248&i){if(i>=55296&&i<=56319&&n<r){const t=e.charCodeAt(n);56320==(64512&t)&&(++n,i=((1023&i)<<10)+(1023&t)+65536)}4294901760&i?(t[s++]=i>>18&7|240,t[s++]=i>>12&63|128,t[s++]=i>>6&63|128):(t[s++]=i>>12&15|224,t[s++]=i>>6&63|128)}else t[s++]=i>>6&31|192;t[s++]=63&i|128}else t[s++]=i}}(e,t,i)}function pt(e,t,i){let r=t;const s=r+i,n=[];let o="";for(;r<s;){const t=e[r++];if(128&t)if(192==(224&t)){const i=63&e[r++];n.push((31&t)<<6|i)}else if(224==(240&t)){const i=63&e[r++],s=63&e[r++];n.push((31&t)<<12|i<<6|s)}else if(240==(248&t)){let i=(7&t)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++];i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i)}else n.push(t);else n.push(t);n.length>=4096&&(o+=String.fromCharCode(...n),n.length=0)}return n.length>0&&(o+=String.fromCharCode(...n)),o}const gt=new TextDecoder;function yt(e,t,i){return i>200?function(e,t,i){const r=e.subarray(t,t+i);return gt.decode(r)}(e,t,i):pt(e,t,i)}class wt{constructor(e,t){this.type=e,this.data=t}}class mt extends Error{constructor(e){super(e);const t=Object.create(mt.prototype);Object.setPrototypeOf(this,t),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:mt.name})}}const bt=4294967295;function vt(e,t,i){const r=Math.floor(i/4294967296),s=i;e.setUint32(t,r),e.setUint32(t+4,s)}function Et(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)}const It={type:-1,encode:function(e){if(e instanceof Date){return function({sec:e,nsec:t}){if(e>=0&&t>=0&&e<=17179869183){if(0===t&&e<=4294967295){const t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e),t}{const i=e/4294967296,r=4294967295&e,s=new Uint8Array(8),n=new DataView(s.buffer);return n.setUint32(0,t<<2|3&i),n.setUint32(4,r),s}}{const i=new Uint8Array(12),r=new DataView(i.buffer);return r.setUint32(0,t),vt(r,4,e),i}}(function(e){const t=e.getTime(),i=Math.floor(t/1e3),r=1e6*(t-1e3*i),s=Math.floor(r/1e9);return{sec:i+s,nsec:r-1e9*s}}(e))}return null},decode:function(e){const t=function(e){const t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:t.getUint32(0),nsec:0};case 8:{const e=t.getUint32(0);return{sec:4294967296*(3&e)+t.getUint32(4),nsec:e>>>2}}case 12:return{sec:Et(t,4),nsec:t.getUint32(0)};default:throw new mt(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${e.length}`)}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}};class xt{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(It)}register({type:e,encode:t,decode:i}){if(e>=0)this.encoders[e]=t,this.decoders[e]=i;else{const r=-1-e;this.builtInEncoders[r]=t,this.builtInDecoders[r]=i}}tryToEncode(e,t){for(let i=0;i<this.builtInEncoders.length;i++){const r=this.builtInEncoders[i];if(null!=r){const s=r(e,t);if(null!=s){return new wt(-1-i,s)}}}for(let i=0;i<this.encoders.length;i++){const r=this.encoders[i];if(null!=r){const s=r(e,t);if(null!=s){return new wt(i,s)}}}return e instanceof wt?e:null}decode(e,t,i){const r=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return r?r(e,t,i):new wt(t,e)}}function St(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):function(e){return e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer}(e)?new Uint8Array(e):Uint8Array.from(e)}xt.defaultCodec=new xt;let Pt=class e{constructor(e){this.entered=!1,this.extensionCodec=(null==e?void 0:e.extensionCodec)??xt.defaultCodec,this.context=null==e?void 0:e.context,this.useBigInt64=(null==e?void 0:e.useBigInt64)??!1,this.maxDepth=(null==e?void 0:e.maxDepth)??100,this.initialBufferSize=(null==e?void 0:e.initialBufferSize)??2048,this.sortKeys=(null==e?void 0:e.sortKeys)??!1,this.forceFloat32=(null==e?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(null==e?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(null==e?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new e({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered){return this.clone().encodeSharedRef(e)}try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered){return this.clone().encode(e)}try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.useBigInt64&&"bigint"==typeof e?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){const t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)}resizeBuffer(e){const t=new ArrayBuffer(e),i=new Uint8Array(t),r=new DataView(t);i.set(this.bytes),this.view=r,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){!1===e?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else{if(!(e<4294967296))throw new Error(`Too long string: ${e} bytes in UTF-8`);this.writeU8(219),this.writeU32(e)}}encodeString(e){const t=function(e){const t=e.length;let i=0,r=0;for(;r<t;){let s=e.charCodeAt(r++);if(4294967168&s)if(4294965248&s){if(s>=55296&&s<=56319&&r<t){const t=e.charCodeAt(r);56320==(64512&t)&&(++r,s=((1023&s)<<10)+(1023&t)+65536)}i+=4294901760&s?4:3}else i+=2;else i++}return i}(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),ft(e,this.bytes,this.pos),this.pos+=t}encodeObject(e,t){const i=this.extensionCodec.tryToEncode(e,this.context);if(null!=i)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else{if("object"!=typeof e)throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`);this.encodeMap(e,t)}}encodeBinary(e){const t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else{if(!(t<4294967296))throw new Error(`Too large binary: ${t}`);this.writeU8(198),this.writeU32(t)}const i=St(e);this.writeU8a(i)}encodeArray(e,t){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else{if(!(i<4294967296))throw new Error(`Too large array: ${i}`);this.writeU8(221),this.writeU32(i)}for(const r of e)this.doEncode(r,t+1)}countWithoutUndefined(e,t){let i=0;for(const r of t)void 0!==e[r]&&i++;return i}encodeMap(e,t){const i=Object.keys(e);this.sortKeys&&i.sort();const r=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else{if(!(r<4294967296))throw new Error(`Too large map object: ${r}`);this.writeU8(223),this.writeU32(r)}for(const s of i){const i=e[s];this.ignoreUndefined&&void 0===i||(this.encodeString(s),this.doEncode(i,t+1))}}encodeExtension(e){if("function"==typeof e.data){const t=e.data(this.pos+6),i=t.length;if(i>=4294967296)throw new Error(`Too large extension object: ${i}`);return this.writeU8(201),this.writeU32(i),this.writeI8(e.type),void this.writeU8a(t)}const t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else{if(!(t<4294967296))throw new Error(`Too large extension object: ${t}`);this.writeU8(201),this.writeU32(t)}this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),function(e,t,i){const r=i/4294967296,s=i;e.setUint32(t,r),e.setUint32(t+4,s)}(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),vt(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function Ot(e){return`${e<0?"-":""}0x${Math.abs(e).toString(16).padStart(2,"0")}`}const _t="array",At="map_key",Tt="map_value",Ct=e=>{if("string"==typeof e||"number"==typeof e)return e;throw new mt("The type of key must be string or number but "+typeof e)};class Nt{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const t=this.getUninitializedStateFromPool();t.type=_t,t.position=0,t.size=e,t.array=new Array(e)}pushMapState(e){const t=this.getUninitializedStateFromPool();t.type=At,t.readCount=0,t.size=e,t.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===_t){const t=e;t.size=0,t.array=void 0,t.position=0,t.type=void 0}if(e.type===At||e.type===Tt){const t=e;t.size=0,t.map=void 0,t.readCount=0,t.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Ut=new DataView(new ArrayBuffer(0)),Rt=new Uint8Array(Ut.buffer);try{Ut.getInt8(0)}catch(dh){if(!(dh instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Bt=new RangeError("Insufficient data"),kt=new class{constructor(e=16,t=16){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,i){const r=this.caches[i-1];e:for(const s of r){const r=s.bytes;for(let s=0;s<i;s++)if(r[s]!==e[t+s])continue e;return s.str}return null}store(e,t){const i=this.caches[e.length-1],r={bytes:e,str:t};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=r:i.push(r)}decode(e,t,i){const r=this.find(e,t,i);if(null!=r)return this.hit++,r;this.miss++;const s=pt(e,t,i),n=Uint8Array.prototype.slice.call(e,t,t+i);return this.store(n,s),s}};let jt=class e{constructor(e){this.totalPos=0,this.pos=0,this.view=Ut,this.bytes=Rt,this.headByte=-1,this.stack=new Nt,this.entered=!1,this.extensionCodec=(null==e?void 0:e.extensionCodec)??xt.defaultCodec,this.context=null==e?void 0:e.context,this.useBigInt64=(null==e?void 0:e.useBigInt64)??!1,this.rawStrings=(null==e?void 0:e.rawStrings)??!1,this.maxStrLength=(null==e?void 0:e.maxStrLength)??bt,this.maxBinLength=(null==e?void 0:e.maxBinLength)??bt,this.maxArrayLength=(null==e?void 0:e.maxArrayLength)??bt,this.maxMapLength=(null==e?void 0:e.maxMapLength)??bt,this.maxExtLength=(null==e?void 0:e.maxExtLength)??bt,this.keyDecoder=void 0!==(null==e?void 0:e.keyDecoder)?e.keyDecoder:kt,this.mapKeyConverter=(null==e?void 0:e.mapKeyConverter)??Ct}clone(){return new e({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.reset()}setBuffer(e){const t=St(e);this.bytes=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.pos=0}appendBuffer(e){if(-1!==this.headByte||this.hasRemaining(1)){const t=this.bytes.subarray(this.pos),i=St(e),r=new Uint8Array(t.length+i.length);r.set(t),r.set(i,t.length),this.setBuffer(r)}else this.setBuffer(e)}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:t,pos:i}=this;return new RangeError(`Extra ${t.byteLength-i} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered){return this.clone().decode(e)}try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){const t=this.clone();return void(yield*t.decodeMulti(e))}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered){return this.clone().decodeAsync(e)}try{this.entered=!0;let t,i=!1;for await(const o of e){if(i)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(o);try{t=this.doDecodeSync(),i=!0}catch(dh){if(!(dh instanceof RangeError))throw dh}this.totalPos+=this.pos}if(i){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return t}const{headByte:r,pos:s,totalPos:n}=this;throw new RangeError(`Insufficient data in parsing ${Ot(r)} at ${n} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,t){if(this.entered){const i=this.clone();return void(yield*i.decodeMultiAsync(e,t))}try{this.entered=!0;let i=t,r=-1;for await(const s of e){if(t&&0===r)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),i&&(r=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),0!==--r;);}catch(dh){if(!(dh instanceof RangeError))throw dh}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let t;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){const i=e-128;if(0!==i){this.pushMapState(i),this.complete();continue e}t={}}else if(e<160){const i=e-144;if(0!==i){this.pushArrayState(i),this.complete();continue e}t=[]}else{const i=e-160;t=this.decodeString(i,0)}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===e){const e=this.lookU8();t=this.decodeString(e,1)}else if(218===e){const e=this.lookU16();t=this.decodeString(e,2)}else if(219===e){const e=this.lookU32();t=this.decodeString(e,4)}else if(220===e){const e=this.readU16();if(0!==e){this.pushArrayState(e),this.complete();continue e}t=[]}else if(221===e){const e=this.readU32();if(0!==e){this.pushArrayState(e),this.complete();continue e}t=[]}else if(222===e){const e=this.readU16();if(0!==e){this.pushMapState(e),this.complete();continue e}t={}}else if(223===e){const e=this.readU32();if(0!==e){this.pushMapState(e),this.complete();continue e}t={}}else if(196===e){const e=this.lookU8();t=this.decodeBinary(e,1)}else if(197===e){const e=this.lookU16();t=this.decodeBinary(e,2)}else if(198===e){const e=this.lookU32();t=this.decodeBinary(e,4)}else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e){const e=this.lookU8();t=this.decodeExtension(e,1)}else if(200===e){const e=this.lookU16();t=this.decodeExtension(e,2)}else{if(201!==e)throw new mt(`Unrecognized type byte: ${Ot(e)}`);{const e=this.lookU32();t=this.decodeExtension(e,4)}}this.complete();const i=this.stack;for(;i.length>0;){const e=i.top();if(e.type===_t){if(e.array[e.position]=t,e.position++,e.position!==e.size)continue e;t=e.array,i.release(e)}else{if(e.type===At){if("__proto__"===t)throw new mt("The key __proto__ is not allowed");e.key=this.mapKeyConverter(t),e.type=Tt;continue e}if(e.map[e.key]=t,e.readCount++,e.readCount!==e.size){e.key=null,e.type=At;continue e}t=e.map,i.release(e)}}return t}}readHeadByte(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new mt(`Unrecognized array type byte: ${Ot(e)}`)}}pushMapState(e){if(e>this.maxMapLength)throw new mt(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new mt(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,t){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,t):this.decodeBinary(e,t)}decodeUtf8String(e,t){var i;if(e>this.maxStrLength)throw new mt(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw Bt;const r=this.pos+t;let s;return s=this.stateIsMapKey()&&(null==(i=this.keyDecoder)?void 0:i.canBeCached(e))?this.keyDecoder.decode(this.bytes,r,e):yt(this.bytes,r,e),this.pos+=t+e,s}stateIsMapKey(){if(this.stack.length>0){return this.stack.top().type===At}return!1}decodeBinary(e,t){if(e>this.maxBinLength)throw new mt(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw Bt;const i=this.pos+t,r=this.bytes.subarray(i,i+e);return this.pos+=t+e,r}decodeExtension(e,t){if(e>this.maxExtLength)throw new mt(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+t),r=this.decodeBinary(e,t+1);return this.extensionCodec.decode(r,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=(t=this.view,i=this.pos,4294967296*t.getUint32(i)+t.getUint32(i+4));var t,i;return this.pos+=8,e}readI64(){const e=Et(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function Dt(e,t){return!!Array.isArray(t)&&(0===t.length||(e?t.every(e=>"string"==typeof e):t.every(e=>Number.isSafeInteger(e))))}function Lt(e,t){if("string"!=typeof t)throw new Error(`${e}: string expected`);return!0}function $t(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function Mt(e){if(!Array.isArray(e))throw new Error("array expected")}function qt(e,t){if(!Dt(!0,t))throw new Error(`${e}: array of strings expected`)}function zt(...e){const t=e=>e,i=(e,t)=>i=>e(t(i));return{encode:e.map(e=>e.encode).reduceRight(i,t),decode:e.map(e=>e.decode).reduce(i,t)}}function Ht(e){const t="string"==typeof e?e.split(""):e,i=t.length;qt("alphabet",t);const r=new Map(t.map((e,t)=>[e,t]));return{encode:r=>(Mt(r),r.map(r=>{if(!Number.isSafeInteger(r)||r<0||r>=i)throw new Error(`alphabet.encode: digit index outside alphabet "${r}". Allowed: ${e}`);return t[r]})),decode:t=>(Mt(t),t.map(t=>{Lt("alphabet.decode",t);const i=r.get(t);if(void 0===i)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return i}))}}function Ft(e=""){return Lt("join",e),{encode:t=>(qt("join.decode",t),t.join(e)),decode:t=>(Lt("join.decode",t),t.split(e))}}function Vt(e,t="="){return $t(e),Lt("padding",t),{encode(i){for(qt("padding.encode",i);i.length*e%8;)i.push(t);return i},decode(i){qt("padding.decode",i);let r=i.length;if(r*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&i[r-1]===t;r--){if((r-1)*e%8==0)throw new Error("padding: invalid, string has too much padding")}return i.slice(0,r)}}}const Kt=(e,t)=>0===t?e:Kt(t,e%t),Wt=(e,t)=>e+(t-Kt(e,t)),Gt=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function Yt(e,t,i,r){if(Mt(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(i<=0||i>32)throw new Error(`convertRadix2: wrong to=${i}`);if(Wt(t,i)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${i} carryBits=${Wt(t,i)}`);let s=0,n=0;const o=Gt[t],a=Gt[i]-1,c=[];for(const h of e){if($t(h),h>=o)throw new Error(`convertRadix2: invalid data word=${h} from=${t}`);if(s=s<<t|h,n+t>32)throw new Error(`convertRadix2: carry overflow pos=${n} from=${t}`);for(n+=t;n>=i;n-=i)c.push((s>>n-i&a)>>>0);const e=Gt[n];if(void 0===e)throw new Error("invalid carry");s&=e-1}if(s=s<<i-n&a,!r&&n>=t)throw new Error("Excess padding");if(!r&&s>0)throw new Error(`Non-zero padding: ${s}`);return r&&n>0&&c.push(s>>>0),c}function Jt(e,t=!1){if($t(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Wt(8,e)>32||Wt(e,8)>32)throw new Error("radix2: carry overflow");return{encode:i=>{if(!((r=i)instanceof Uint8Array||ArrayBuffer.isView(r)&&"Uint8Array"===r.constructor.name))throw new Error("radix2.encode input should be Uint8Array");
/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */
var r;return Yt(Array.from(i),8,e,!t)},decode:i=>(function(e,t){if(!Dt(!1,t))throw new Error(`${e}: array of numbers expected`)}("radix2.decode",i),Uint8Array.from(Yt(i,e,8,t)))}}const Zt=zt(Jt(5),Ht("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Vt(5),Ft(""));function Qt(e){if("string"!=typeof e)throw new Error("Cannot safe json parse value of type "+typeof e);try{return(e=>{const t=e.replace(/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,'$1"$2n"$3');return JSON.parse(t,(e,t)=>"string"==typeof t&&t.match(/^\d+n$/)?BigInt(t.substring(0,t.length-1)):t)})(e)}catch(t){return e}}function Xt(e){return"string"==typeof e?e:(t=e,JSON.stringify(t,(e,t)=>"bigint"==typeof t?t.toString()+"n":t)||"");var t}function ei(e,...t){if(!function(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ti(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}const ii="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,ri=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function si(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),ei(e),e}let ni=class{clone(){return this._cloneInto()}};function oi(e=32){if(ii&&"function"==typeof ii.getRandomValues)return ii.getRandomValues(new Uint8Array(e));if(ii&&"function"==typeof ii.randomBytes)return ii.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}let ai=class extends ni{constructor(e,t,i,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ri(this.buffer)}update(e){ti(this);const{view:t,buffer:i,blockLen:r}=this,s=(e=si(e)).length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);if(o===r){const t=ri(e);for(;r<=s-n;n+=r)this.process(t,n);continue}i.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ti(this),function(e,t){ei(e);const i=t.outputLen;if(e.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:r,isLE:s}=this;let{pos:n}=this;t[n++]=128,this.buffer.subarray(n).fill(0),this.padOffset>r-n&&(this.process(i,0),n=0);for(let l=n;l<r;l++)t[l]=0;(function(e,t,i,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,i,r);const s=BigInt(32),n=BigInt(4294967295),o=Number(i>>s&n),a=Number(i&n),c=r?4:0,h=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+h,a,r)})(i,r-8,BigInt(8*this.length),s),this.process(i,0);const o=ri(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<c;l++)o.setUint32(4*l,h[l],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:r,finished:s,destroyed:n,pos:o}=this;return e.length=r,e.pos=o,e.finished=s,e.destroyed=n,r%t&&e.buffer.set(i),e}};const ci=BigInt(2**32-1),hi=BigInt(32);function li(e,t=!1){return t?{h:Number(e&ci),l:Number(e>>hi&ci)}:{h:0|Number(e>>hi&ci),l:0|Number(e&ci)}}const ui={fromBig:li,split:function(e,t=!1){let i=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let s=0;s<e.length;s++){const{h:n,l:o}=li(e[s],t);[i[s],r[s]]=[n,o]}return[i,r]},toBig:(e,t)=>BigInt(e>>>0)<<hi|BigInt(t>>>0),shrSH:(e,t,i)=>e>>>i,shrSL:(e,t,i)=>e<<32-i|t>>>i,rotrSH:(e,t,i)=>e>>>i|t<<32-i,rotrSL:(e,t,i)=>e<<32-i|t>>>i,rotrBH:(e,t,i)=>e<<64-i|t>>>i-32,rotrBL:(e,t,i)=>e>>>i-32|t<<64-i,rotr32H:(e,t)=>t,rotr32L:(e,t)=>e,rotlSH:(e,t,i)=>e<<i|t>>>32-i,rotlSL:(e,t,i)=>t<<i|e>>>32-i,rotlBH:(e,t,i)=>t<<i-32|e>>>64-i,rotlBL:(e,t,i)=>e<<i-32|t>>>64-i,add:function(e,t,i,r){const s=(t>>>0)+(r>>>0);return{h:e+i+(s/2**32|0)|0,l:0|s}},add3L:(e,t,i)=>(e>>>0)+(t>>>0)+(i>>>0),add3H:(e,t,i,r)=>t+i+r+(e/2**32|0)|0,add4L:(e,t,i,r)=>(e>>>0)+(t>>>0)+(i>>>0)+(r>>>0),add4H:(e,t,i,r,s)=>t+i+r+s+(e/2**32|0)|0,add5H:(e,t,i,r,s,n)=>t+i+r+s+n+(e/2**32|0)|0,add5L:(e,t,i,r,s)=>(e>>>0)+(t>>>0)+(i>>>0)+(r>>>0)+(s>>>0)},[di,fi]=ui.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),pi=new Uint32Array(80),gi=new Uint32Array(80);let yi=class extends ai{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:i,Bl:r,Ch:s,Cl:n,Dh:o,Dl:a,Eh:c,El:h,Fh:l,Fl:u,Gh:d,Gl:f,Hh:p,Hl:g}=this;return[e,t,i,r,s,n,o,a,c,h,l,u,d,f,p,g]}set(e,t,i,r,s,n,o,a,c,h,l,u,d,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|i,this.Bl=0|r,this.Ch=0|s,this.Cl=0|n,this.Dh=0|o,this.Dl=0|a,this.Eh=0|c,this.El=0|h,this.Fh=0|l,this.Fl=0|u,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let m=0;m<16;m++,t+=4)pi[m]=e.getUint32(t),gi[m]=e.getUint32(t+=4);for(let m=16;m<80;m++){const e=0|pi[m-15],t=0|gi[m-15],i=ui.rotrSH(e,t,1)^ui.rotrSH(e,t,8)^ui.shrSH(e,t,7),r=ui.rotrSL(e,t,1)^ui.rotrSL(e,t,8)^ui.shrSL(e,t,7),s=0|pi[m-2],n=0|gi[m-2],o=ui.rotrSH(s,n,19)^ui.rotrBH(s,n,61)^ui.shrSH(s,n,6),a=ui.rotrSL(s,n,19)^ui.rotrBL(s,n,61)^ui.shrSL(s,n,6),c=ui.add4L(r,a,gi[m-7],gi[m-16]),h=ui.add4H(c,i,o,pi[m-7],pi[m-16]);pi[m]=0|h,gi[m]=0|c}let{Ah:i,Al:r,Bh:s,Bl:n,Ch:o,Cl:a,Dh:c,Dl:h,Eh:l,El:u,Fh:d,Fl:f,Gh:p,Gl:g,Hh:y,Hl:w}=this;for(let m=0;m<80;m++){const e=ui.rotrSH(l,u,14)^ui.rotrSH(l,u,18)^ui.rotrBH(l,u,41),t=ui.rotrSL(l,u,14)^ui.rotrSL(l,u,18)^ui.rotrBL(l,u,41),b=l&d^~l&p,v=u&f^~u&g,E=ui.add5L(w,t,v,fi[m],gi[m]),I=ui.add5H(E,y,e,b,di[m],pi[m]),x=0|E,S=ui.rotrSH(i,r,28)^ui.rotrBH(i,r,34)^ui.rotrBH(i,r,39),P=ui.rotrSL(i,r,28)^ui.rotrBL(i,r,34)^ui.rotrBL(i,r,39),O=i&s^i&o^s&o,_=r&n^r&a^n&a;y=0|p,w=0|g,p=0|d,g=0|f,d=0|l,f=0|u,({h:l,l:u}=ui.add(0|c,0|h,0|I,0|x)),c=0|o,h=0|a,o=0|s,a=0|n,s=0|i,n=0|r;const A=ui.add3L(x,P,_);i=ui.add3H(A,I,S,O),r=0|A}({h:i,l:r}=ui.add(0|this.Ah,0|this.Al,0|i,0|r)),({h:s,l:n}=ui.add(0|this.Bh,0|this.Bl,0|s,0|n)),({h:o,l:a}=ui.add(0|this.Ch,0|this.Cl,0|o,0|a)),({h:c,l:h}=ui.add(0|this.Dh,0|this.Dl,0|c,0|h)),({h:l,l:u}=ui.add(0|this.Eh,0|this.El,0|l,0|u)),({h:d,l:f}=ui.add(0|this.Fh,0|this.Fl,0|d,0|f)),({h:p,l:g}=ui.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:y,l:w}=ui.add(0|this.Hh,0|this.Hl,0|y,0|w)),this.set(i,r,s,n,o,a,c,h,l,u,d,f,p,g,y,w)}roundClean(){pi.fill(0),gi.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const wi=function(e){const t=t=>e().update(si(t)).digest(),i=e();return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=()=>e(),t}(()=>new yi),mi=BigInt(0),bi=BigInt(1),vi=BigInt(2);
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ei(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function Ii(e){if(!Ei(e))throw new Error("Uint8Array expected")}function xi(e,t){if("boolean"!=typeof t)throw new Error(e+" boolean expected, got "+t)}const Si=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Pi(e){Ii(e);let t="";for(let i=0;i<e.length;i++)t+=Si[e[i]];return t}function Oi(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?mi:BigInt("0x"+e)}const _i=48,Ai=57,Ti=65,Ci=70,Ni=97,Ui=102;function Ri(e){return e>=_i&&e<=Ai?e-_i:e>=Ti&&e<=Ci?e-(Ti-10):e>=Ni&&e<=Ui?e-(Ni-10):void 0}function Bi(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,i=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(i);for(let s=0,n=0;s<i;s++,n+=2){const t=Ri(e.charCodeAt(n)),i=Ri(e.charCodeAt(n+1));if(void 0===t||void 0===i){const t=e[n]+e[n+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+n)}r[s]=16*t+i}return r}function ki(e){return Ii(e),Oi(Pi(Uint8Array.from(e).reverse()))}function ji(e,t){return Bi(e.toString(16).padStart(2*t,"0"))}function Di(e,t){return ji(e,t).reverse()}function Li(e,t,i){let r;if("string"==typeof t)try{r=Bi(t)}catch(n){throw new Error(e+" must be hex string or Uint8Array, cause: "+n)}else{if(!Ei(t))throw new Error(e+" must be hex string or Uint8Array");r=Uint8Array.from(t)}const s=r.length;if("number"==typeof i&&s!==i)throw new Error(e+" of length "+i+" expected, got "+s);return r}function $i(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];Ii(i),t+=i.length}const i=new Uint8Array(t);for(let r=0,s=0;r<e.length;r++){const t=e[r];i.set(t,s),s+=t.length}return i}const Mi=e=>"bigint"==typeof e&&mi<=e;function qi(e,t,i,r){if(!function(e,t,i){return Mi(e)&&Mi(t)&&Mi(i)&&t<=e&&e<i}(t,i,r))throw new Error("expected valid "+e+": "+i+" <= n < "+r+", got "+t)}const zi=e=>(vi<<BigInt(e-1))-bi,Hi={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||Ei(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function Fi(e,t,i={}){const r=(t,i,r)=>{const s=Hi[i];if("function"!=typeof s)throw new Error("invalid validator function");const n=e[t];if(!(r&&void 0===n||s(n,e)))throw new Error("param "+String(t)+" is invalid. Expected "+i+", got "+n)};for(const[s,n]of Object.entries(t))r(s,n,!1);for(const[s,n]of Object.entries(i))r(s,n,!0);return e}function Vi(e){const t=new WeakMap;return(i,...r)=>{const s=t.get(i);if(void 0!==s)return s;const n=e(i,...r);return t.set(i,n),n}}const Ki=BigInt(0),Wi=BigInt(1),Gi=BigInt(2),Yi=BigInt(3),Ji=BigInt(4),Zi=BigInt(5),Qi=BigInt(8);function Xi(e,t){const i=e%t;return i>=Ki?i:t+i}function er(e,t,i){if(t<Ki)throw new Error("invalid exponent, negatives unsupported");if(i<=Ki)throw new Error("invalid modulus");if(i===Wi)return Ki;let r=Wi;for(;t>Ki;)t&Wi&&(r=r*e%i),e=e*e%i,t>>=Wi;return r}function tr(e,t,i){let r=e;for(;t-- >Ki;)r*=r,r%=i;return r}function ir(e,t){if(e===Ki)throw new Error("invert: expected non-zero number");if(t<=Ki)throw new Error("invert: expected positive modulus, got "+t);let i=Xi(e,t),r=t,s=Ki,n=Wi;for(;i!==Ki;){const e=r%i,t=s-n*(r/i);r=i,i=e,s=n,n=t}if(r!==Wi)throw new Error("invert: does not exist");return Xi(s,t)}function rr(e){if(e%Ji===Yi){const t=(e+Wi)/Ji;return function(e,i){const r=e.pow(i,t);if(!e.eql(e.sqr(r),i))throw new Error("Cannot find square root");return r}}if(e%Qi===Zi){const t=(e-Zi)/Qi;return function(e,i){const r=e.mul(i,Gi),s=e.pow(r,t),n=e.mul(i,s),o=e.mul(e.mul(n,Gi),s),a=e.mul(n,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),i))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-Wi)/Gi;let i,r,s;for(i=e-Wi,r=0;i%Gi===Ki;i/=Gi,r++);for(s=Gi;s<e&&er(s,t,e)!==e-Wi;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(1===r){const t=(e+Wi)/Ji;return function(e,i){const r=e.pow(i,t);if(!e.eql(e.sqr(r),i))throw new Error("Cannot find square root");return r}}const n=(i+Wi)/Gi;return function(e,o){if(e.pow(o,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,s),i),h=e.pow(o,n),l=e.pow(o,i);for(;!e.eql(l,e.ONE);){if(e.eql(l,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(l);t<a&&!e.eql(r,e.ONE);t++)r=e.sqr(r);const i=e.pow(c,Wi<<BigInt(a-t-1));c=e.sqr(i),h=e.mul(h,i),l=e.mul(l,c),a=t}return h}}(e)}const sr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function nr(e,t){const i=void 0!==t?t:e.toString(2).length;return{nBitLength:i,nByteLength:Math.ceil(i/8)}}function or(e,t,i=!1,r={}){if(e<=Ki)throw new Error("invalid field: expected ORDER > 0, got "+e);const{nBitLength:s,nByteLength:n}=nr(e,t);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:e,isLE:i,BITS:s,BYTES:n,MASK:zi(s),ZERO:Ki,ONE:Wi,create:t=>Xi(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("invalid field element: expected bigint, got "+typeof t);return Ki<=t&&t<e},is0:e=>e===Ki,isOdd:e=>(e&Wi)===Wi,neg:t=>Xi(-t,e),eql:(e,t)=>e===t,sqr:t=>Xi(t*t,e),add:(t,i)=>Xi(t+i,e),sub:(t,i)=>Xi(t-i,e),mul:(t,i)=>Xi(t*i,e),pow:(e,t)=>function(e,t,i){if(i<Ki)throw new Error("invalid exponent, negatives unsupported");if(i===Ki)return e.ONE;if(i===Wi)return t;let r=e.ONE,s=t;for(;i>Ki;)i&Wi&&(r=e.mul(r,s)),s=e.sqr(s),i>>=Wi;return r}(a,e,t),div:(t,i)=>Xi(t*ir(i,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>ir(t,e),sqrt:r.sqrt||(t=>(o||(o=rr(e)),o(a,t))),invertBatch:e=>function(e,t){const i=new Array(t.length),r=t.reduce((t,r,s)=>e.is0(r)?t:(i[s]=t,e.mul(t,r)),e.ONE),s=e.inv(r);return t.reduceRight((t,r,s)=>e.is0(r)?t:(i[s]=e.mul(t,i[s]),e.mul(t,r)),s),i}(a,e),cmov:(e,t,i)=>i?t:e,toBytes:e=>i?Di(e,n):ji(e,n),fromBytes:e=>{if(e.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+e.length);return i?ki(e):function(e){return Oi(Pi(e))}(e)}});return Object.freeze(a)}const ar=BigInt(0),cr=BigInt(1);function hr(e,t){const i=t.negate();return e?i:t}function lr(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function ur(e,t){lr(e,t);return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1)}}const dr=new WeakMap,fr=new WeakMap;function pr(e){return fr.get(e)||1}function gr(e,t,i,r){if(function(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((e,i)=>{if(!(e instanceof t))throw new Error("invalid point at index "+i)})}(i,e),function(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((e,i)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+i)})}(r,t),i.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const s=e.ZERO,n=function(e){let t;for(t=0;e>mi;e>>=bi,t+=1);return t}(BigInt(i.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s);let h=s;for(let l=Math.floor((t.BITS-1)/o)*o;l>=0;l-=o){c.fill(s);for(let t=0;t<r.length;t++){const e=r[t],s=Number(e>>BigInt(l)&BigInt(a));c[s]=c[s].add(i[t])}let e=s;for(let t=c.length-1,i=s;t>0;t--)i=i.add(c[t]),e=e.add(i);if(h=h.add(e),0!==l)for(let t=0;t<o;t++)h=h.double()}return h}function yr(e){return function(e){Fi(e,sr.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}(e.Fp),Fi(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nr(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const wr=BigInt(0),mr=BigInt(1),br=BigInt(2),vr=BigInt(8),Er={zip215:!0};function Ir(e){const t=function(e){const t=yr(e);return Fi(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}(e),{Fp:i,n:r,prehash:s,hash:n,randomBytes:o,nByteLength:a,h:c}=t,h=br<<BigInt(8*a)-mr,l=i.create,u=or(t.n,t.nBitLength),d=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:i.sqrt(e*i.inv(t))}}catch{return{isValid:!1,value:wr}}}),f=t.adjustScalarBytes||(e=>e),p=t.domain||((e,t,i)=>{if(xi("phflag",i),t.length||i)throw new Error("Contexts/pre-hash are not supported");return e});function g(e,t){qi("coordinate "+e,t,wr,h)}function y(e){if(!(e instanceof b))throw new Error("ExtendedPoint expected")}const w=Vi((e,t)=>{const{ex:r,ey:s,ez:n}=e,o=e.is0();null==t&&(t=o?vr:i.inv(n));const a=l(r*t),c=l(s*t),h=l(n*t);if(o)return{x:wr,y:mr};if(h!==mr)throw new Error("invZ was invalid");return{x:a,y:c}}),m=Vi(e=>{const{a:i,d:r}=t;if(e.is0())throw new Error("bad point: ZERO");const{ex:s,ey:n,ez:o,et:a}=e,c=l(s*s),h=l(n*n),u=l(o*o),d=l(u*u),f=l(c*i);if(l(u*l(f+h))!==l(d+l(r*l(c*h))))throw new Error("bad point: equation left != right (1)");if(l(s*n)!==l(o*a))throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(e,t,i,r){this.ex=e,this.ey=t,this.ez=i,this.et=r,g("x",e),g("y",t),g("z",i),g("t",r),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof b)throw new Error("extended point not allowed");const{x:t,y:i}=e||{};return g("x",t),g("y",i),new b(t,i,mr,l(t*i))}static normalizeZ(e){const t=i.invertBatch(e.map(e=>e.ez));return e.map((e,i)=>e.toAffine(t[i])).map(b.fromAffine)}static msm(e,t){return gr(b,u,e,t)}_setWindowSize(e){I.setWindowSize(this,e)}assertValidity(){m(this)}equals(e){y(e);const{ex:t,ey:i,ez:r}=this,{ex:s,ey:n,ez:o}=e,a=l(t*o),c=l(s*r),h=l(i*o),u=l(n*r);return a===c&&h===u}is0(){return this.equals(b.ZERO)}negate(){return new b(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:e}=t,{ex:i,ey:r,ez:s}=this,n=l(i*i),o=l(r*r),a=l(br*l(s*s)),c=l(e*n),h=i+r,u=l(l(h*h)-n-o),d=c+o,f=d-a,p=c-o,g=l(u*f),y=l(d*p),w=l(u*p),m=l(f*d);return new b(g,y,m,w)}add(e){y(e);const{a:i,d:r}=t,{ex:s,ey:n,ez:o,et:a}=this,{ex:c,ey:h,ez:u,et:d}=e;if(i===BigInt(-1)){const e=l((n-s)*(h+c)),t=l((n+s)*(h-c)),i=l(t-e);if(i===wr)return this.double();const r=l(o*br*d),f=l(a*br*u),p=f+r,g=t+e,y=f-r,w=l(p*i),m=l(g*y),v=l(p*y),E=l(i*g);return new b(w,m,E,v)}const f=l(s*c),p=l(n*h),g=l(a*r*d),w=l(o*u),m=l((s+n)*(c+h)-f-p),v=w-g,E=w+g,I=l(p-i*f),x=l(m*v),S=l(E*I),P=l(m*I),O=l(v*E);return new b(x,S,O,P)}subtract(e){return this.add(e.negate())}wNAF(e){return I.wNAFCached(this,e,b.normalizeZ)}multiply(e){const t=e;qi("scalar",t,mr,r);const{p:i,f:s}=this.wNAF(t);return b.normalizeZ([i,s])[0]}multiplyUnsafe(e,t=b.ZERO){const i=e;return qi("scalar",i,wr,r),i===wr?E:this.is0()||i===mr?this:I.wNAFCachedUnsafe(this,i,b.normalizeZ,t)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return I.unsafeLadder(this,r).is0()}toAffine(e){return w(this,e)}clearCofactor(){const{h:e}=t;return e===mr?this:this.multiplyUnsafe(e)}static fromHex(e,r=!1){const{d:s,a:n}=t,o=i.BYTES;e=Li("pointHex",e,o),xi("zip215",r);const a=e.slice(),c=e[o-1];a[o-1]=-129&c;const u=ki(a),f=r?h:i.ORDER;qi("pointHex.y",u,wr,f);const p=l(u*u),g=l(p-mr),y=l(s*p-n);let{isValid:w,value:m}=d(g,y);if(!w)throw new Error("Point.fromHex: invalid y coordinate");const v=(m&mr)===mr,E=!!(128&c);if(!r&&m===wr&&E)throw new Error("Point.fromHex: x=0 and x_0=1");return E!==v&&(m=l(-m)),b.fromAffine({x:m,y:u})}static fromPrivateKey(e){return P(e).point}toRawBytes(){const{x:e,y:t}=this.toAffine(),r=Di(t,i.BYTES);return r[r.length-1]|=e&mr?128:0,r}toHex(){return Pi(this.toRawBytes())}}b.BASE=new b(t.Gx,t.Gy,mr,l(t.Gx*t.Gy)),b.ZERO=new b(wr,mr,mr,wr);const{BASE:v,ZERO:E}=b,I=function(e,t){return{constTimeNegate:hr,hasPrecomputes:e=>1!==pr(e),unsafeLadder(t,i,r=e.ZERO){let s=t;for(;i>ar;)i&cr&&(r=r.add(s)),s=s.double(),i>>=cr;return r},precomputeWindow(e,i){const{windows:r,windowSize:s}=ur(i,t),n=[];let o=e,a=o;for(let t=0;t<r;t++){a=o,n.push(a);for(let e=1;e<s;e++)a=a.add(o),n.push(a);o=a.double()}return n},wNAF(i,r,s){const{windows:n,windowSize:o}=ur(i,t);let a=e.ZERO,c=e.BASE;const h=BigInt(2**i-1),l=2**i,u=BigInt(i);for(let e=0;e<n;e++){const t=e*o;let i=Number(s&h);s>>=u,i>o&&(i-=l,s+=cr);const n=t,d=t+Math.abs(i)-1,f=e%2!=0,p=i<0;0===i?c=c.add(hr(f,r[n])):a=a.add(hr(p,r[d]))}return{p:a,f:c}},wNAFUnsafe(i,r,s,n=e.ZERO){const{windows:o,windowSize:a}=ur(i,t),c=BigInt(2**i-1),h=2**i,l=BigInt(i);for(let e=0;e<o;e++){const t=e*a;if(s===ar)break;let i=Number(s&c);if(s>>=l,i>a&&(i-=h,s+=cr),0===i)continue;let o=r[t+Math.abs(i)-1];i<0&&(o=o.negate()),n=n.add(o)}return n},getPrecomputes(e,t,i){let r=dr.get(t);return r||(r=this.precomputeWindow(t,e),1!==e&&dr.set(t,i(r))),r},wNAFCached(e,t,i){const r=pr(e);return this.wNAF(r,this.getPrecomputes(r,e,i),t)},wNAFCachedUnsafe(e,t,i,r){const s=pr(e);return 1===s?this.unsafeLadder(e,t,r):this.wNAFUnsafe(s,this.getPrecomputes(s,e,i),t,r)},setWindowSize(e,i){lr(i,t),fr.set(e,i),dr.delete(e)}}}(b,8*a);function x(e){return Xi(e,r)}function S(e){return x(ki(e))}function P(e){const t=i.BYTES;e=Li("private key",e,t);const r=Li("hashed private key",n(e),2*t),s=f(r.slice(0,t)),o=r.slice(t,2*t),a=S(s),c=v.multiply(a),h=c.toRawBytes();return{head:s,prefix:o,scalar:a,point:c,pointBytes:h}}function O(e=new Uint8Array,...t){const i=$i(...t);return S(n(p(i,Li("context",e),!!s)))}const _=Er;return v._setWindowSize(8),{CURVE:t,getPublicKey:function(e){return P(e).pointBytes},sign:function(e,t,n={}){e=Li("message",e),s&&(e=s(e));const{prefix:o,scalar:a,pointBytes:c}=P(t),h=O(n.context,o,e),l=v.multiply(h).toRawBytes(),u=x(h+O(n.context,l,c,e)*a);return qi("signature.s",u,wr,r),Li("result",$i(l,Di(u,i.BYTES)),2*i.BYTES)},verify:function(e,t,r,n=_){const{context:o,zip215:a}=n,c=i.BYTES;e=Li("signature",e,2*c),t=Li("message",t),r=Li("publicKey",r,c),void 0!==a&&xi("zip215",a),s&&(t=s(t));const h=ki(e.slice(c,2*c));let l,u,d;try{l=b.fromHex(r,a),u=b.fromHex(e.slice(0,c),a),d=v.multiplyUnsafe(h)}catch{return!1}if(!a&&l.isSmallOrder())return!1;const f=O(o,u.toRawBytes(),l.toRawBytes(),t);return u.add(l.multiplyUnsafe(f)).subtract(d).clearCofactor().equals(b.ZERO)},ExtendedPoint:b,utils:{getExtendedPublicKey:P,randomPrivateKey:()=>o(i.BYTES),precompute:(e=8,t=b.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)}}}BigInt(0),BigInt(1);const xr=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Sr=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Pr=BigInt(1),Or=BigInt(2);BigInt(3);const _r=BigInt(5),Ar=BigInt(8);function Tr(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function Cr(e,t){const i=xr,r=Xi(t*t*t,i),s=function(e){const t=BigInt(10),i=BigInt(20),r=BigInt(40),s=BigInt(80),n=xr,o=e*e%n*e%n,a=tr(o,Or,n)*o%n,c=tr(a,Pr,n)*e%n,h=tr(c,_r,n)*c%n,l=tr(h,t,n)*h%n,u=tr(l,i,n)*l%n,d=tr(u,r,n)*u%n,f=tr(d,s,n)*d%n,p=tr(f,s,n)*d%n,g=tr(p,t,n)*h%n;return{pow_p_5_8:tr(g,Or,n)*e%n,b2:o}}(e*Xi(r*r*t,i)).pow_p_5_8;let n=Xi(e*r*s,i);const o=Xi(t*n*n,i),a=n,c=Xi(n*Sr,i),h=o===e,l=o===Xi(-e,i),u=o===Xi(-e*Sr,i);return h&&(n=a),(l||u)&&(n=c),((e,t)=>(Xi(e,t)&Wi)===Wi)(n,i)&&(n=Xi(-n,i)),{isValid:h||l,value:n}}const Nr=or(xr,void 0,!0),Ur=Ir({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Nr,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Ar,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:wi,randomBytes:oi,adjustScalarBytes:Tr,uvRatio:Cr}),Rr=".",Br="base64url",kr="utf8",jr="utf8",Dr="did",Lr="key",$r="base58btc";function Mr(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function qr(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?Mr(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function zr(e,t){t||(t=e.reduce((e,t)=>e+t.length,0));const i=qr(t);let r=0;for(const s of e)i.set(s,r),r+=s.length;return Mr(i)}var Hr=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),r=0;r<i.length;r++)i[r]=255;for(var s=0;s<e.length;s++){var n=e.charAt(s),o=n.charCodeAt(0);if(255!==i[o])throw new TypeError(n+" is ambiguous");i[o]=s}var a=e.length,c=e.charAt(0),h=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,s=0;e[t]===c;)r++,t++;for(var n=(e.length-t)*h+1>>>0,o=new Uint8Array(n);e[t];){var l=i[e.charCodeAt(t)];if(255===l)return;for(var u=0,d=n-1;(0!==l||u<s)&&-1!==d;d--,u++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");s=u,t++}if(" "!==e[t]){for(var f=n-s;f!==n&&0===o[f];)f++;for(var p=new Uint8Array(r+(n-f)),g=r;f!==n;)p[g++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var i=0,r=0,s=0,n=t.length;s!==n&&0===t[s];)s++,i++;for(var o=(n-s)*l+1>>>0,h=new Uint8Array(o);s!==n;){for(var u=t[s],d=0,f=o-1;(0!==u||d<r)&&-1!==f;f--,d++)u+=256*h[f]>>>0,h[f]=u%a>>>0,u=u/a>>>0;if(0!==u)throw new Error("Non-zero carry");r=d,s++}for(var p=o-r;p!==o&&0===h[p];)p++;for(var g=c.repeat(i);p<o;++p)g+=e.charAt(h[p]);return g},decodeUnsafe:u,decode:function(e){var i=u(e);if(i)return i;throw new Error(`Non-${t} character`)}}},Fr=Hr;const Vr=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};let Kr=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Wr=class{constructor(e,t,i){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Yr(this,e)}},Gr=class{constructor(e){this.decoders=e}or(e){return Yr(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Yr=(e,t)=>new Gr({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});let Jr=class{constructor(e,t,i,r){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=r,this.encoder=new Kr(e,t,i),this.decoder=new Wr(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Zr=({name:e,prefix:t,encode:i,decode:r})=>new Jr(e,t,i,r),Qr=({prefix:e,name:t,alphabet:i})=>{const{encode:r,decode:s}=Fr(i,t);return Zr({prefix:e,name:t,encode:r,decode:e=>Vr(s(e))})},Xr=({name:e,prefix:t,bitsPerChar:i,alphabet:r})=>Zr({prefix:t,name:e,encode:e=>((e,t,i)=>{const r="="===t[t.length-1],s=(1<<i)-1;let n="",o=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],o+=8;o>i;)o-=i,n+=t[s&a>>o];if(o&&(n+=t[s&a<<i-o]),r)for(;n.length*i&7;)n+="=";return n})(e,r,i),decode:t=>((e,t,i,r)=>{const s={};for(let l=0;l<t.length;++l)s[t[l]]=l;let n=e.length;for(;"="===e[n-1];)--n;const o=new Uint8Array(n*i/8|0);let a=0,c=0,h=0;for(let l=0;l<n;++l){const t=s[e[l]];if(void 0===t)throw new SyntaxError(`Non-${r} character`);c=c<<i|t,a+=i,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=i||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,r,i,e)}),es=Zr({prefix:"\0",name:"identity",encode:e=>(e=>(new TextDecoder).decode(e))(e),decode:e=>(e=>(new TextEncoder).encode(e))(e)});var ts=Object.freeze({__proto__:null,identity:es});const is=Xr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var rs=Object.freeze({__proto__:null,base2:is});const ss=Xr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var ns=Object.freeze({__proto__:null,base8:ss});const os=Qr({prefix:"9",name:"base10",alphabet:"0123456789"});var as=Object.freeze({__proto__:null,base10:os});const cs=Xr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),hs=Xr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ls=Object.freeze({__proto__:null,base16:cs,base16upper:hs});const us=Xr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ds=Xr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),fs=Xr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ps=Xr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),gs=Xr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ys=Xr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ws=Xr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ms=Xr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),bs=Xr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var vs=Object.freeze({__proto__:null,base32:us,base32upper:ds,base32pad:fs,base32padupper:ps,base32hex:gs,base32hexupper:ys,base32hexpad:ws,base32hexpadupper:ms,base32z:bs});const Es=Qr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Is=Qr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var xs=Object.freeze({__proto__:null,base36:Es,base36upper:Is});const Ss=Qr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ps=Qr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Os=Object.freeze({__proto__:null,base58btc:Ss,base58flickr:Ps});const _s=Xr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),As=Xr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ts=Xr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Cs=Xr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ns=Object.freeze({__proto__:null,base64:_s,base64pad:As,base64url:Ts,base64urlpad:Cs});const Us=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Rs=Us.reduce((e,t,i)=>(e[i]=t,e),[]),Bs=Us.reduce((e,t,i)=>(e[t.codePointAt(0)]=i,e),[]);const ks=Zr({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+=Rs[t],"")},decode:function(e){const t=[];for(const i of e){const e=Bs[i.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${i}`);t.push(e)}return new Uint8Array(t)}});var js=Object.freeze({__proto__:null,base256emoji:ks}),Ds=function e(t,i,r){i=i||[];for(var s=r=r||0;t>=Ms;)i[r++]=255&t|Ls,t/=128;for(;t&$s;)i[r++]=255&t|Ls,t>>>=7;return i[r]=0|t,e.bytes=r-s+1,i},Ls=128,$s=-128,Ms=Math.pow(2,31);var qs=function e(t,i){var r,s=0,n=0,o=i=i||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[o++],s+=n<28?(r&Hs)<<n:(r&Hs)*Math.pow(2,n),n+=7}while(r>=zs);return e.bytes=o-i,s},zs=128,Hs=127;var Fs=Math.pow(2,7),Vs=Math.pow(2,14),Ks=Math.pow(2,21),Ws=Math.pow(2,28),Gs=Math.pow(2,35),Ys=Math.pow(2,42),Js=Math.pow(2,49),Zs=Math.pow(2,56),Qs=Math.pow(2,63),Xs={encode:Ds,decode:qs,encodingLength:function(e){return e<Fs?1:e<Vs?2:e<Ks?3:e<Ws?4:e<Gs?5:e<Ys?6:e<Js?7:e<Zs?8:e<Qs?9:10}},en=Xs;const tn=(e,t,i=0)=>(en.encode(e,t,i),t),rn=e=>en.encodingLength(e),sn=(e,t)=>{const i=t.byteLength,r=rn(e),s=r+rn(i),n=new Uint8Array(s+i);return tn(e,n,0),tn(i,n,r),n.set(t,s),new nn(e,i,t,n)};let nn=class{constructor(e,t,i,r){this.code=e,this.size=t,this.digest=i,this.bytes=r}};const on=({name:e,code:t,encode:i})=>new an(e,t,i);let an=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?sn(this.code,t):t.then(e=>sn(this.code,e))}throw Error("Unknown type, must be binary type")}};const cn=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),hn=on({name:"sha2-256",code:18,encode:cn("SHA-256")}),ln=on({name:"sha2-512",code:19,encode:cn("SHA-512")});Object.freeze({__proto__:null,sha256:hn,sha512:ln});const un=Vr,dn={code:0,name:"identity",encode:un,digest:e=>sn(0,un(e))};Object.freeze({__proto__:null,identity:dn});new TextEncoder,new TextDecoder;const fn={...ts,...rs,...ns,...as,...ls,...vs,...xs,...Os,...Ns,...js};function pn(e,t,i,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:i},decoder:{decode:r}}}const gn=pn("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>(new TextEncoder).encode(e.substring(1))),yn=pn("ascii","a",e=>{let t="a";for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},e=>{const t=qr((e=e.substring(1)).length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}),wn={utf8:gn,"utf-8":gn,hex:fn.base16,latin1:yn,ascii:yn,binary:yn,...fn};function mn(e,t="utf8"){const i=wn[t];if(!i)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?i.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}function bn(e,t="utf8"){const i=wn[t];if(!i)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?i.decoder.decode(`${i.prefix}${e}`):Mr(globalThis.Buffer.from(e,"utf-8"))}function vn(e){return Qt(mn(bn(e,Br),kr))}function En(e){return mn(bn(Xt(e),kr),Br)}function In(e){const t="z"+mn(zr([bn("K36",$r),e]),$r);return[Dr,Lr,t].join(":")}function xn(e){return mn(e,Br)}function Sn(e){const t=e.split(Rr),i=vn(t[0]),r=vn(t[1]),s=function(e){return bn(e,Br)}(t[2]);return{header:i,payload:r,signature:s,data:bn(t.slice(0,2).join(Rr),jr)}}function Pn(e=oi(32)){const t=Ur.getPublicKey(e);return{secretKey:zr([e,t]),publicKey:t}}async function On(e,t,i,r,s=w.fromMiliseconds(Date.now())){const n={alg:"EdDSA",typ:"JWT"},o={iss:In(r.publicKey),sub:e,aud:t,iat:s,exp:s+i},a=function(e){return bn([En(e.header),En(e.payload)].join(Rr),jr)}({header:n,payload:o});return function(e){return[En(e.header),En(e.payload),xn(e.signature)].join(Rr)}({header:n,payload:o,signature:Ur.sign(a,r.secretKey.slice(0,32))})}function _n(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function An(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?_n(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Tn(e,t){t||(t=e.reduce((e,t)=>e+t.length,0));const i=An(t);let r=0;for(const s of e)i.set(s,r),r+=s.length;return _n(i)}var Cn=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),r=0;r<i.length;r++)i[r]=255;for(var s=0;s<e.length;s++){var n=e.charAt(s),o=n.charCodeAt(0);if(255!==i[o])throw new TypeError(n+" is ambiguous");i[o]=s}var a=e.length,c=e.charAt(0),h=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,s=0;e[t]===c;)r++,t++;for(var n=(e.length-t)*h+1>>>0,o=new Uint8Array(n);e[t];){var l=i[e.charCodeAt(t)];if(255===l)return;for(var u=0,d=n-1;(0!==l||u<s)&&-1!==d;d--,u++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");s=u,t++}if(" "!==e[t]){for(var f=n-s;f!==n&&0===o[f];)f++;for(var p=new Uint8Array(r+(n-f)),g=r;f!==n;)p[g++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var i=0,r=0,s=0,n=t.length;s!==n&&0===t[s];)s++,i++;for(var o=(n-s)*l+1>>>0,h=new Uint8Array(o);s!==n;){for(var u=t[s],d=0,f=o-1;(0!==u||d<r)&&-1!==f;f--,d++)u+=256*h[f]>>>0,h[f]=u%a>>>0,u=u/a>>>0;if(0!==u)throw new Error("Non-zero carry");r=d,s++}for(var p=o-r;p!==o&&0===h[p];)p++;for(var g=c.repeat(i);p<o;++p)g+=e.charAt(h[p]);return g},decodeUnsafe:u,decode:function(e){var i=u(e);if(i)return i;throw new Error(`Non-${t} character`)}}};class Nn{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Un{constructor(e,t,i){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Bn(this,e)}}class Rn{constructor(e){this.decoders=e}or(e){return Bn(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Bn=(e,t)=>new Rn({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class kn{constructor(e,t,i,r){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=r,this.encoder=new Nn(e,t,i),this.decoder=new Un(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const jn=({name:e,prefix:t,encode:i,decode:r})=>new kn(e,t,i,r),Dn=({prefix:e,name:t,alphabet:i})=>{const{encode:r,decode:s}=Cn(i,t);return jn({prefix:e,name:t,encode:r,decode:e=>(e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")})(s(e))})},Ln=({name:e,prefix:t,bitsPerChar:i,alphabet:r})=>jn({prefix:t,name:e,encode:e=>((e,t,i)=>{const r="="===t[t.length-1],s=(1<<i)-1;let n="",o=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],o+=8;o>i;)o-=i,n+=t[s&a>>o];if(o&&(n+=t[s&a<<i-o]),r)for(;n.length*i&7;)n+="=";return n})(e,r,i),decode:t=>((e,t,i,r)=>{const s={};for(let l=0;l<t.length;++l)s[t[l]]=l;let n=e.length;for(;"="===e[n-1];)--n;const o=new Uint8Array(n*i/8|0);let a=0,c=0,h=0;for(let l=0;l<n;++l){const t=s[e[l]];if(void 0===t)throw new SyntaxError(`Non-${r} character`);c=c<<i|t,a+=i,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=i||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,r,i,e)}),$n=jn({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),Mn=Object.freeze(Object.defineProperty({__proto__:null,identity:$n},Symbol.toStringTag,{value:"Module"})),qn=Ln({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),zn=Object.freeze(Object.defineProperty({__proto__:null,base2:qn},Symbol.toStringTag,{value:"Module"})),Hn=Ln({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Fn=Object.freeze(Object.defineProperty({__proto__:null,base8:Hn},Symbol.toStringTag,{value:"Module"})),Vn=Dn({prefix:"9",name:"base10",alphabet:"0123456789"}),Kn=Object.freeze(Object.defineProperty({__proto__:null,base10:Vn},Symbol.toStringTag,{value:"Module"})),Wn=Ln({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Gn=Ln({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Yn=Object.freeze(Object.defineProperty({__proto__:null,base16:Wn,base16upper:Gn},Symbol.toStringTag,{value:"Module"})),Jn=Ln({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Zn=Ln({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Qn=Ln({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Xn=Ln({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),eo=Ln({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),to=Ln({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),io=Ln({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ro=Ln({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),so=Ln({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),no=Object.freeze(Object.defineProperty({__proto__:null,base32:Jn,base32hex:eo,base32hexpad:io,base32hexpadupper:ro,base32hexupper:to,base32pad:Qn,base32padupper:Xn,base32upper:Zn,base32z:so},Symbol.toStringTag,{value:"Module"})),oo=Dn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ao=Dn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),co=Object.freeze(Object.defineProperty({__proto__:null,base36:oo,base36upper:ao},Symbol.toStringTag,{value:"Module"})),ho=Dn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),lo=Dn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),uo=Object.freeze(Object.defineProperty({__proto__:null,base58btc:ho,base58flickr:lo},Symbol.toStringTag,{value:"Module"})),fo=Ln({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),po=Ln({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),go=Ln({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),yo=Ln({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),wo=Object.freeze(Object.defineProperty({__proto__:null,base64:fo,base64pad:po,base64url:go,base64urlpad:yo},Symbol.toStringTag,{value:"Module"})),mo=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),bo=mo.reduce((e,t,i)=>(e[i]=t,e),[]),vo=mo.reduce((e,t,i)=>(e[t.codePointAt(0)]=i,e),[]);const Eo=jn({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+=bo[t],"")},decode:function(e){const t=[];for(const i of e){const e=vo[i.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${i}`);t.push(e)}return new Uint8Array(t)}}),Io=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Eo},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;const xo={...Mn,...zn,...Fn,...Kn,...Yn,...no,...co,...uo,...wo,...Io};function So(e,t,i,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:i},decoder:{decode:r}}}const Po=So("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>(new TextEncoder).encode(e.substring(1))),Oo=So("ascii","a",e=>{let t="a";for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},e=>{const t=An((e=e.substring(1)).length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}),_o={utf8:Po,"utf-8":Po,hex:xo.base16,latin1:Oo,ascii:Oo,binary:Oo,...xo};function Ao(e,t="utf8"){const i=_o[t];if(!i)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?i.decoder.decode(`${i.prefix}${e}`):_n(globalThis.Buffer.from(e,"utf-8"))}function To(e,t="utf8"){const i=_o[t];if(!i)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?i.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}const Co={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};function No(e){return(4294967296+e).toString(16).substring(1)}var Uo={normalizeInput:function(e){let t;if(e instanceof Uint8Array)t=e;else{if("string"!=typeof e)throw new Error("Input must be an string, Buffer or Uint8Array");t=(new TextEncoder).encode(e)}return t},toHex:function(e){return Array.prototype.map.call(e,function(e){return(e<16?"0":"")+e.toString(16)}).join("")},debugPrint:function(e,t,i){let r="\n"+e+" = ";for(let s=0;s<t.length;s+=2){if(32===i)r+=No(t[s]).toUpperCase(),r+=" ",r+=No(t[s+1]).toUpperCase();else{if(64!==i)throw new Error("Invalid size "+i);r+=No(t[s+1]).toUpperCase(),r+=No(t[s]).toUpperCase()}s%6==4?r+="\n"+new Array(e.length+4).join(" "):s<t.length-2&&(r+=" ")}console.log(r)},testSpeed:function(e,t,i){let r=(new Date).getTime();const s=new Uint8Array(t);for(let o=0;o<t;o++)s[o]=o%256;const n=(new Date).getTime();console.log("Generated random input in "+(n-r)+"ms"),r=n;for(let o=0;o<i;o++){const i=e(s),n=(new Date).getTime(),o=n-r;r=n,console.log("Hashed in "+o+"ms: "+i.substring(0,20)+"..."),console.log(Math.round(t/(1<<20)/(o/1e3)*100)/100+" MB PER SECOND")}}};const Ro=Uo;function Bo(e,t,i){const r=e[t]+e[i];let s=e[t+1]+e[i+1];r>=4294967296&&s++,e[t]=r,e[t+1]=s}function ko(e,t,i,r){let s=e[t]+i;i<0&&(s+=4294967296);let n=e[t+1]+r;s>=4294967296&&n++,e[t]=s,e[t+1]=n}function jo(e,t){return e[t]^e[t+1]<<8^e[t+2]<<16^e[t+3]<<24}function Do(e,t,i,r,s,n){const o=qo[s],a=qo[s+1],c=qo[n],h=qo[n+1];Bo(Mo,e,t),ko(Mo,e,o,a);let l=Mo[r]^Mo[e],u=Mo[r+1]^Mo[e+1];Mo[r]=u,Mo[r+1]=l,Bo(Mo,i,r),l=Mo[t]^Mo[i],u=Mo[t+1]^Mo[i+1],Mo[t]=l>>>24^u<<8,Mo[t+1]=u>>>24^l<<8,Bo(Mo,e,t),ko(Mo,e,c,h),l=Mo[r]^Mo[e],u=Mo[r+1]^Mo[e+1],Mo[r]=l>>>16^u<<16,Mo[r+1]=u>>>16^l<<16,Bo(Mo,i,r),l=Mo[t]^Mo[i],u=Mo[t+1]^Mo[i+1],Mo[t]=u>>>31^l<<1,Mo[t+1]=l>>>31^u<<1}const Lo=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),$o=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3].map(function(e){return 2*e})),Mo=new Uint32Array(32),qo=new Uint32Array(32);function zo(e,t){let i=0;for(i=0;i<16;i++)Mo[i]=e.h[i],Mo[i+16]=Lo[i];for(Mo[24]=Mo[24]^e.t,Mo[25]=Mo[25]^e.t/4294967296,t&&(Mo[28]=~Mo[28],Mo[29]=~Mo[29]),i=0;i<32;i++)qo[i]=jo(e.b,4*i);for(i=0;i<12;i++)Do(0,8,16,24,$o[16*i+0],$o[16*i+1]),Do(2,10,18,26,$o[16*i+2],$o[16*i+3]),Do(4,12,20,28,$o[16*i+4],$o[16*i+5]),Do(6,14,22,30,$o[16*i+6],$o[16*i+7]),Do(0,10,20,30,$o[16*i+8],$o[16*i+9]),Do(2,12,22,24,$o[16*i+10],$o[16*i+11]),Do(4,14,16,26,$o[16*i+12],$o[16*i+13]),Do(6,8,18,28,$o[16*i+14],$o[16*i+15]);for(i=0;i<16;i++)e.h[i]=e.h[i]^Mo[i]^Mo[i+16]}const Ho=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function Fo(e,t,i,r){if(0===e||e>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(t&&t.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(i&&16!==i.length)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(r&&16!==r.length)throw new Error("Illegal personal, expected Uint8Array with length is 16");const s={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:e};Ho.fill(0),Ho[0]=e,t&&(Ho[1]=t.length),Ho[2]=1,Ho[3]=1,i&&Ho.set(i,32),r&&Ho.set(r,48);for(let n=0;n<16;n++)s.h[n]=Lo[n]^jo(Ho,4*n);return t&&(Vo(s,t),s.c=128),s}function Vo(e,t){for(let i=0;i<t.length;i++)128===e.c&&(e.t+=e.c,zo(e,!1),e.c=0),e.b[e.c++]=t[i]}function Ko(e){for(e.t+=e.c;e.c<128;)e.b[e.c++]=0;zo(e,!0);const t=new Uint8Array(e.outlen);for(let i=0;i<e.outlen;i++)t[i]=e.h[i>>2]>>8*(3&i);return t}function Wo(e,t,i,r,s){i=i||64,e=Ro.normalizeInput(e),r&&(r=Ro.normalizeInput(r)),s&&(s=Ro.normalizeInput(s));const n=Fo(i,t,r,s);return Vo(n,e),Ko(n)}var Go={blake2b:Wo,blake2bHex:function(e,t,i,r,s){const n=Wo(e,t,i,r,s);return Ro.toHex(n)},blake2bInit:Fo,blake2bUpdate:Vo,blake2bFinal:Ko};const Yo=Uo;function Jo(e,t){return e[t]^e[t+1]<<8^e[t+2]<<16^e[t+3]<<24}function Zo(e,t,i,r,s,n){ta[e]=ta[e]+ta[t]+s,ta[r]=Qo(ta[r]^ta[e],16),ta[i]=ta[i]+ta[r],ta[t]=Qo(ta[t]^ta[i],12),ta[e]=ta[e]+ta[t]+n,ta[r]=Qo(ta[r]^ta[e],8),ta[i]=ta[i]+ta[r],ta[t]=Qo(ta[t]^ta[i],7)}function Qo(e,t){return e>>>t^e<<32-t}const Xo=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ea=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),ta=new Uint32Array(16),ia=new Uint32Array(16);function ra(e,t){let i=0;for(i=0;i<8;i++)ta[i]=e.h[i],ta[i+8]=Xo[i];for(ta[12]^=e.t,ta[13]^=e.t/4294967296,t&&(ta[14]=~ta[14]),i=0;i<16;i++)ia[i]=Jo(e.b,4*i);for(i=0;i<10;i++)Zo(0,4,8,12,ia[ea[16*i+0]],ia[ea[16*i+1]]),Zo(1,5,9,13,ia[ea[16*i+2]],ia[ea[16*i+3]]),Zo(2,6,10,14,ia[ea[16*i+4]],ia[ea[16*i+5]]),Zo(3,7,11,15,ia[ea[16*i+6]],ia[ea[16*i+7]]),Zo(0,5,10,15,ia[ea[16*i+8]],ia[ea[16*i+9]]),Zo(1,6,11,12,ia[ea[16*i+10]],ia[ea[16*i+11]]),Zo(2,7,8,13,ia[ea[16*i+12]],ia[ea[16*i+13]]),Zo(3,4,9,14,ia[ea[16*i+14]],ia[ea[16*i+15]]);for(i=0;i<8;i++)e.h[i]^=ta[i]^ta[i+8]}function sa(e,t){if(!(e>0&&e<=32))throw new Error("Incorrect output length, should be in [1, 32]");const i=t?t.length:0;if(t&&!(i>0&&i<=32))throw new Error("Incorrect key length, should be in [1, 32]");const r={h:new Uint32Array(Xo),b:new Uint8Array(64),c:0,t:0,outlen:e};return r.h[0]^=16842752^i<<8^e,i>0&&(na(r,t),r.c=64),r}function na(e,t){for(let i=0;i<t.length;i++)64===e.c&&(e.t+=e.c,ra(e,!1),e.c=0),e.b[e.c++]=t[i]}function oa(e){for(e.t+=e.c;e.c<64;)e.b[e.c++]=0;ra(e,!0);const t=new Uint8Array(e.outlen);for(let i=0;i<e.outlen;i++)t[i]=e.h[i>>2]>>8*(3&i)&255;return t}function aa(e,t,i){i=i||32,e=Yo.normalizeInput(e);const r=sa(i,t);return na(r,e),oa(r)}var ca={blake2s:aa,blake2sHex:function(e,t,i){const r=aa(e,t,i);return Yo.toHex(r)},blake2sInit:sa,blake2sUpdate:na,blake2sFinal:oa};var ha={blake2b:Go.blake2b,blake2bHex:Go.blake2bHex,blake2bInit:Go.blake2bInit,blake2bUpdate:Go.blake2bUpdate,blake2bFinal:Go.blake2bFinal,blake2s:ca.blake2s,blake2sHex:ca.blake2sHex,blake2sInit:ca.blake2sInit,blake2sUpdate:ca.blake2sUpdate,blake2sFinal:ca.blake2sFinal};function la(e){const[t,i]=e.split(":");return{namespace:t,reference:i}}function ua(e,t=[]){const i=[];return Object.keys(e).forEach(r=>{if(t.length&&!t.includes(r))return;const s=e[r];i.push(...s.accounts)}),i}function da(e,t){return e.includes(":")?[e]:t.chains||[]}var fa=Object.defineProperty,pa=Object.defineProperties,ga=Object.getOwnPropertyDescriptors,ya=Object.getOwnPropertySymbols,wa=Object.prototype.hasOwnProperty,ma=Object.prototype.propertyIsEnumerable,ba=(e,t,i)=>t in e?fa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,va=(e,t)=>{for(var i in t||(t={}))wa.call(t,i)&&ba(e,i,t[i]);if(ya)for(var i of ya(t))ma.call(t,i)&&ba(e,i,t[i]);return e},Ea=(e,t,i)=>ba(e,"symbol"!=typeof t?t+"":t,i);const Ia="react-native",xa="node",Sa="browser",Pa="unknown",Oa="js";function _a(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Aa(){return!Y()&&!!J()&&"ReactNative"===navigator.product}function Ta(){return!_a()&&!!J()&&!!Y()}function Ca(){return Aa()?Ia:_a()?xa:Ta()?Sa:Pa}function Na(){var e;try{return Aa()&&typeof global<"u"&&typeof(null==global?void 0:global.Application)<"u"?null==(e=global.Application)?void 0:e.applicationId:void 0}catch{return}}function Ua(e){var t,i;const r=Ra();try{return null!=e&&e.url&&r.url&&new URL(e.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${e.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),e.url=r.url),null!=(t=null==e?void 0:e.icons)&&t.length&&e.icons.length>0&&(e.icons=e.icons.filter(e=>""!==e)),((e,t)=>pa(e,ga(t)))(va(va({},r),e),{url:(null==e?void 0:e.url)||r.url,name:(null==e?void 0:e.name)||r.name,description:(null==e?void 0:e.description)||r.description,icons:null!=(i=null==e?void 0:e.icons)&&i.length&&e.icons.length>0?e.icons:r.icons})}catch(s){return console.warn("Error populating app metadata",s),e||r}}function Ra(){return X()||{name:"",description:"",url:"",icons:[""]}}function Ba(e,t,i){const r=function(){if(Ca()===Ia&&typeof global<"u"&&typeof(null==global?void 0:global.Platform)<"u"){const{OS:e,Version:t}=global.Platform;return[e,t].join("-")}const e=g();if(null===e)return"unknown";const t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return"browser"===e.type?[t,e.name,e.version].join("-"):[t,e.version].join("-")}(),s=function(){var e;const t=Ca();return t===Sa?[t,(null==(e=Z())?void 0:e.host)||"unknown"].join(":"):t}();return[[e,t].join("-"),[Oa,i].join("-"),r,s].join("/")}function ka({protocol:e,version:t,relayUrl:i,sdkVersion:r,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const h=i.split("?"),l={auth:s,ua:Ba(e,t,r),projectId:n,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},u=function(e,t){const i=new URLSearchParams(e);for(const r of Object.keys(t).sort())if(t.hasOwnProperty(r)){const e=t[r];void 0!==e&&i.set(r,e)}return i.toString()}(h[1]||"",l);return h[0]+"?"+u}function ja(e,t){return e.filter(e=>t.includes(e)).length===e.length}function Da(e){return Object.fromEntries(e.entries())}function La(e){return new Map(Object.entries(e))}function $a(e=w.FIVE_MINUTES,t){const i=w.toMiliseconds(e||w.FIVE_MINUTES);let r,s,n,o;return{resolve:e=>{n&&r&&(clearTimeout(n),r(e),o=Promise.resolve(e))},reject:e=>{n&&s&&(clearTimeout(n),s(e))},done:()=>new Promise((e,a)=>{if(o)return e(o);n=setTimeout(()=>{const e=new Error(t);o=Promise.reject(e),a(e)},i),r=e,s=a})}}function Ma(e,t,i){return new Promise(async(r,s)=>{const n=setTimeout(()=>s(new Error(i)),t);try{r(await e)}catch(o){s(o)}clearTimeout(n)})}function qa(e,t){if("string"==typeof t&&t.startsWith(`${e}:`))return t;if("topic"===e.toLowerCase()){if("string"!=typeof t)throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}if("id"===e.toLowerCase()){if("number"!=typeof t)throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${e}`)}function za(e){const[t,i]=e.split(":"),r={id:void 0,topic:void 0};if("topic"===t&&"string"==typeof i)r.topic=i;else{if("id"!==t||!Number.isInteger(Number(i)))throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${i}`);r.id=Number(i)}return r}function Ha(e,t){return w.fromMiliseconds((t||Date.now())+w.toMiliseconds(e))}function Fa(e){return Date.now()>=w.toMiliseconds(e)}function Va(e,t){return`${e}${t?`:${t}`:""}`}function Ka(e=[],t=[]){return[...new Set([...e,...t])]}async function Wa({id:e,topic:t,wcDeepLink:i}){var r;try{if(!i)return;const s="string"==typeof i?JSON.parse(i):i,n=null==s?void 0:s.href;if("string"!=typeof n)return;const o=function(e,t,i){const r=`requestId=${t}&sessionTopic=${i}`;e.endsWith("/")&&(e=e.slice(0,-1));let s=`${e}`;if(e.startsWith("https://t.me")){s=`${s}${e.includes("?")?"&startapp=":"?startapp="}${function(e,t=!1){const i=Buffer.from(e).toString("base64");return t?i.replace(/[=]/g,""):i}(r,!0)}`}else s=`${s}/wc?${r}`;return s}(n,e,t),a=Ca();if(a===Sa){if(null==(r=Y())||!r.hasFocus())return void console.warn("Document does not have focus, skipping deeplink.");!function(e){let t="_self";!function(){try{return window.self!==window.top}catch{return!1}}()?(typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)||e.startsWith("https://")||e.startsWith("http://"))&&(t="_blank"):t="_top",window.open(e,t,"noreferrer noopener")}(o)}else a===Ia&&typeof(null==global?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(s){console.error(s)}}function Ga(e,t){if(!e.includes(t))return null;const i=e.split(/([&,?,=])/),r=i.indexOf(t);return i[r+2]}function Ya(){return typeof crypto<"u"&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function Ja(){return typeof process<"u"&&"true"==={}.IS_VITEST}function Za(e){return Buffer.from(e,"base64").toString("utf-8")}let Qa=class{constructor({limit:e}){Ea(this,"limit"),Ea(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const e=this.set.values().next().value;e&&this.set.delete(e)}this.set.add(e)}}has(e){return this.set.has(e)}};const Xa=BigInt(2**32-1),ec=BigInt(32);function tc(e,t=!1){return t?{h:Number(e&Xa),l:Number(e>>ec&Xa)}:{h:0|Number(e>>ec&Xa),l:0|Number(e&Xa)}}function ic(e,t=!1){const i=e.length;let r=new Uint32Array(i),s=new Uint32Array(i);for(let n=0;n<i;n++){const{h:i,l:o}=tc(e[n],t);[r[n],s[n]]=[i,o]}return[r,s]}const rc=(e,t,i)=>e>>>i,sc=(e,t,i)=>e<<32-i|t>>>i,nc=(e,t,i)=>e>>>i|t<<32-i,oc=(e,t,i)=>e<<32-i|t>>>i,ac=(e,t,i)=>e<<64-i|t>>>i-32,cc=(e,t,i)=>e>>>i-32|t<<64-i,hc=(e,t)=>t,lc=(e,t)=>e;function uc(e,t,i,r){const s=(t>>>0)+(r>>>0);return{h:e+i+(s/2**32|0)|0,l:0|s}}const dc=(e,t,i)=>(e>>>0)+(t>>>0)+(i>>>0),fc=(e,t,i,r)=>t+i+r+(e/2**32|0)|0,pc=(e,t,i,r)=>(e>>>0)+(t>>>0)+(i>>>0)+(r>>>0),gc=(e,t,i,r,s)=>t+i+r+s+(e/2**32|0)|0,yc=(e,t,i,r,s)=>(e>>>0)+(t>>>0)+(i>>>0)+(r>>>0)+(s>>>0),wc=(e,t,i,r,s,n)=>t+i+r+s+n+(e/2**32|0)|0,mc="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function bc(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function vc(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Ec(e,...t){if(!bc(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Ic(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.createHasher");vc(e.outputLen),vc(e.blockLen)}function xc(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Sc(e,t){Ec(e);const i=t.outputLen;if(e.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}function Pc(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Oc(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function _c(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Ac(e,t){return e<<32-t|e>>>t}const Tc=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function Cc(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}const Nc=Tc?e=>e:e=>Cc(e);const Uc=Tc?e=>e:function(e){for(let t=0;t<e.length;t++)e[t]=Cc(e[t]);return e},Rc="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,Bc=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function kc(e){if(Ec(e),Rc)return e.toHex();let t="";for(let i=0;i<e.length;i++)t+=Bc[e[i]];return t}const jc=48,Dc=57,Lc=65,$c=70,Mc=97,qc=102;function zc(e){return e>=jc&&e<=Dc?e-jc:e>=Lc&&e<=$c?e-(Lc-10):e>=Mc&&e<=qc?e-(Mc-10):void 0}function Hc(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);if(Rc)return Uint8Array.fromHex(e);const t=e.length,i=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(i);for(let s=0,n=0;s<i;s++,n+=2){const t=zc(e.charCodeAt(n)),i=zc(e.charCodeAt(n+1));if(void 0===t||void 0===i){const t=e[n]+e[n+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+n)}r[s]=16*t+i}return r}function Fc(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}(e)),Ec(e),e}function Vc(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];Ec(i),t+=i.length}const i=new Uint8Array(t);for(let r=0,s=0;r<e.length;r++){const t=e[r];i.set(t,s),s+=t.length}return i}let Kc=class{};function Wc(e){const t=t=>e().update(Fc(t)).digest(),i=e();return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=()=>e(),t}function Gc(e=32){if(mc&&"function"==typeof mc.getRandomValues)return mc.getRandomValues(new Uint8Array(e));if(mc&&"function"==typeof mc.randomBytes)return Uint8Array.from(mc.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}const Yc=BigInt(0),Jc=BigInt(1),Zc=BigInt(2),Qc=BigInt(7),Xc=BigInt(256),eh=BigInt(113),th=[],ih=[],rh=[];for(let rP=0,sP=Jc,nP=1,oP=0;rP<24;rP++){[nP,oP]=[oP,(2*nP+3*oP)%5],th.push(2*(5*oP+nP)),ih.push((rP+1)*(rP+2)/2%64);let e=Yc;for(let t=0;t<7;t++)sP=(sP<<Jc^(sP>>Qc)*eh)%Xc,sP&Zc&&(e^=Jc<<(Jc<<BigInt(t))-Jc);rh.push(e)}const sh=ic(rh,!0),nh=sh[0],oh=sh[1],ah=(e,t,i)=>i>32?((e,t,i)=>t<<i-32|e>>>64-i)(e,t,i):((e,t,i)=>e<<i|t>>>32-i)(e,t,i),ch=(e,t,i)=>i>32?((e,t,i)=>e<<i-32|t>>>64-i)(e,t,i):((e,t,i)=>t<<i|e>>>32-i)(e,t,i);let hh=class e extends Kc{constructor(e,t,i,r=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=r,this.rounds=s,vc(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Pc(this.state)}clone(){return this._cloneInto()}keccak(){Uc(this.state32),function(e,t=24){const i=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let r=0;r<10;r++)i[r]=e[r]^e[r+10]^e[r+20]^e[r+30]^e[r+40];for(let r=0;r<10;r+=2){const t=(r+8)%10,s=(r+2)%10,n=i[s],o=i[s+1],a=ah(n,o,1)^i[t],c=ch(n,o,1)^i[t+1];for(let i=0;i<50;i+=10)e[r+i]^=a,e[r+i+1]^=c}let t=e[2],s=e[3];for(let i=0;i<24;i++){const r=ih[i],n=ah(t,s,r),o=ch(t,s,r),a=th[i];t=e[a],s=e[a+1],e[a]=n,e[a+1]=o}for(let r=0;r<50;r+=10){for(let t=0;t<10;t++)i[t]=e[r+t];for(let t=0;t<10;t++)e[r+t]^=~i[(t+2)%10]&i[(t+4)%10]}e[0]^=nh[r],e[1]^=oh[r]}Oc(i)}(this.state32,this.rounds),Uc(this.state32),this.posOut=0,this.pos=0}update(e){xc(this),Ec(e=Fc(e));const{blockLen:t,state:i}=this,r=e.length;for(let s=0;s<r;){const n=Math.min(t-this.pos,r-s);for(let t=0;t<n;t++)i[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:r}=this;e[i]^=t,!!(128&t)&&i===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){xc(this,!1),Ec(e),this.finish();const t=this.state,{blockLen:i}=this;for(let r=0,s=e.length;r<s;){this.posOut>=i&&this.keccak();const n=Math.min(i-this.posOut,s-r);e.set(t.subarray(this.posOut,this.posOut+n),r),this.posOut+=n,r+=n}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return vc(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Sc(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Oc(this.state)}_cloneInto(t){const{blockLen:i,suffix:r,outputLen:s,rounds:n,enableXOF:o}=this;return t||(t=new e(i,r,s,o,n)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=n,t.suffix=r,t.outputLen=s,t.enableXOF=o,t.destroyed=this.destroyed,t}};const lh=(uh=1,dh=136,fh=32,Wc(()=>new hh(dh,uh,fh)));var uh,dh,fh;function ph(e,t,i){return e&t^~e&i}function gh(e,t,i){return e&t^e&i^t&i}let yh=class extends Kc{constructor(e,t,i,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=r,this.buffer=new Uint8Array(e),this.view=_c(this.buffer)}update(e){xc(this),Ec(e=Fc(e));const{view:t,buffer:i,blockLen:r}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);if(o===r){const t=_c(e);for(;r<=s-n;n+=r)this.process(t,n);continue}i.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){xc(this),Sc(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:r,isLE:s}=this;let{pos:n}=this;t[n++]=128,Oc(this.buffer.subarray(n)),this.padOffset>r-n&&(this.process(i,0),n=0);for(let l=n;l<r;l++)t[l]=0;(function(e,t,i,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,i,r);const s=BigInt(32),n=BigInt(4294967295),o=Number(i>>s&n),a=Number(i&n),c=r?4:0,h=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+h,a,r)})(i,r-8,BigInt(8*this.length),s),this.process(i,0);const o=_c(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<c;l++)o.setUint32(4*l,h[l],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:r,finished:s,destroyed:n,pos:o}=this;return e.destroyed=n,e.finished=s,e.length=r,e.pos=o,r%t&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const wh=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),mh=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),bh=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),vh=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Eh=new Uint32Array(64);let Ih=class extends yh{constructor(e=32){super(64,e,8,!1),this.A=0|wh[0],this.B=0|wh[1],this.C=0|wh[2],this.D=0|wh[3],this.E=0|wh[4],this.F=0|wh[5],this.G=0|wh[6],this.H=0|wh[7]}get(){const{A:e,B:t,C:i,D:r,E:s,F:n,G:o,H:a}=this;return[e,t,i,r,s,n,o,a]}set(e,t,i,r,s,n,o,a){this.A=0|e,this.B=0|t,this.C=0|i,this.D=0|r,this.E=0|s,this.F=0|n,this.G=0|o,this.H=0|a}process(e,t){for(let l=0;l<16;l++,t+=4)Eh[l]=e.getUint32(t,!1);for(let l=16;l<64;l++){const e=Eh[l-15],t=Eh[l-2],i=Ac(e,7)^Ac(e,18)^e>>>3,r=Ac(t,17)^Ac(t,19)^t>>>10;Eh[l]=r+Eh[l-7]+i+Eh[l-16]|0}let{A:i,B:r,C:s,D:n,E:o,F:a,G:c,H:h}=this;for(let l=0;l<64;l++){const e=h+(Ac(o,6)^Ac(o,11)^Ac(o,25))+ph(o,a,c)+vh[l]+Eh[l]|0,t=(Ac(i,2)^Ac(i,13)^Ac(i,22))+gh(i,r,s)|0;h=c,c=a,a=o,o=n+e|0,n=s,s=r,r=i,i=e+t|0}i=i+this.A|0,r=r+this.B|0,s=s+this.C|0,n=n+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(i,r,s,n,o,a,c,h)}roundClean(){Oc(Eh)}destroy(){this.set(0,0,0,0,0,0,0,0),Oc(this.buffer)}};const xh=ic(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),Sh=xh[0],Ph=xh[1],Oh=new Uint32Array(80),_h=new Uint32Array(80);let Ah=class extends yh{constructor(e=64){super(128,e,16,!1),this.Ah=0|bh[0],this.Al=0|bh[1],this.Bh=0|bh[2],this.Bl=0|bh[3],this.Ch=0|bh[4],this.Cl=0|bh[5],this.Dh=0|bh[6],this.Dl=0|bh[7],this.Eh=0|bh[8],this.El=0|bh[9],this.Fh=0|bh[10],this.Fl=0|bh[11],this.Gh=0|bh[12],this.Gl=0|bh[13],this.Hh=0|bh[14],this.Hl=0|bh[15]}get(){const{Ah:e,Al:t,Bh:i,Bl:r,Ch:s,Cl:n,Dh:o,Dl:a,Eh:c,El:h,Fh:l,Fl:u,Gh:d,Gl:f,Hh:p,Hl:g}=this;return[e,t,i,r,s,n,o,a,c,h,l,u,d,f,p,g]}set(e,t,i,r,s,n,o,a,c,h,l,u,d,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|i,this.Bl=0|r,this.Ch=0|s,this.Cl=0|n,this.Dh=0|o,this.Dl=0|a,this.Eh=0|c,this.El=0|h,this.Fh=0|l,this.Fl=0|u,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let m=0;m<16;m++,t+=4)Oh[m]=e.getUint32(t),_h[m]=e.getUint32(t+=4);for(let m=16;m<80;m++){const e=0|Oh[m-15],t=0|_h[m-15],i=nc(e,t,1)^nc(e,t,8)^rc(e,0,7),r=oc(e,t,1)^oc(e,t,8)^sc(e,t,7),s=0|Oh[m-2],n=0|_h[m-2],o=nc(s,n,19)^ac(s,n,61)^rc(s,0,6),a=oc(s,n,19)^cc(s,n,61)^sc(s,n,6),c=pc(r,a,_h[m-7],_h[m-16]),h=gc(c,i,o,Oh[m-7],Oh[m-16]);Oh[m]=0|h,_h[m]=0|c}let{Ah:i,Al:r,Bh:s,Bl:n,Ch:o,Cl:a,Dh:c,Dl:h,Eh:l,El:u,Fh:d,Fl:f,Gh:p,Gl:g,Hh:y,Hl:w}=this;for(let m=0;m<80;m++){const e=nc(l,u,14)^nc(l,u,18)^ac(l,u,41),t=oc(l,u,14)^oc(l,u,18)^cc(l,u,41),b=l&d^~l&p,v=yc(w,t,u&f^~u&g,Ph[m],_h[m]),E=wc(v,y,e,b,Sh[m],Oh[m]),I=0|v,x=nc(i,r,28)^ac(i,r,34)^ac(i,r,39),S=oc(i,r,28)^cc(i,r,34)^cc(i,r,39),P=i&s^i&o^s&o,O=r&n^r&a^n&a;y=0|p,w=0|g,p=0|d,g=0|f,d=0|l,f=0|u,({h:l,l:u}=uc(0|c,0|h,0|E,0|I)),c=0|o,h=0|a,o=0|s,a=0|n,s=0|i,n=0|r;const _=dc(I,S,O);i=fc(_,E,x,P),r=0|_}({h:i,l:r}=uc(0|this.Ah,0|this.Al,0|i,0|r)),({h:s,l:n}=uc(0|this.Bh,0|this.Bl,0|s,0|n)),({h:o,l:a}=uc(0|this.Ch,0|this.Cl,0|o,0|a)),({h:c,l:h}=uc(0|this.Dh,0|this.Dl,0|c,0|h)),({h:l,l:u}=uc(0|this.Eh,0|this.El,0|l,0|u)),({h:d,l:f}=uc(0|this.Fh,0|this.Fl,0|d,0|f)),({h:p,l:g}=uc(0|this.Gh,0|this.Gl,0|p,0|g)),({h:y,l:w}=uc(0|this.Hh,0|this.Hl,0|y,0|w)),this.set(i,r,s,n,o,a,c,h,l,u,d,f,p,g,y,w)}roundClean(){Oc(Oh,_h)}destroy(){Oc(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Th=class extends Ah{constructor(){super(48),this.Ah=0|mh[0],this.Al=0|mh[1],this.Bh=0|mh[2],this.Bl=0|mh[3],this.Ch=0|mh[4],this.Cl=0|mh[5],this.Dh=0|mh[6],this.Dl=0|mh[7],this.Eh=0|mh[8],this.El=0|mh[9],this.Fh=0|mh[10],this.Fl=0|mh[11],this.Gh=0|mh[12],this.Gl=0|mh[13],this.Hh=0|mh[14],this.Hl=0|mh[15]}};const Ch=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class Nh extends Ah{constructor(){super(32),this.Ah=0|Ch[0],this.Al=0|Ch[1],this.Bh=0|Ch[2],this.Bl=0|Ch[3],this.Ch=0|Ch[4],this.Cl=0|Ch[5],this.Dh=0|Ch[6],this.Dl=0|Ch[7],this.Eh=0|Ch[8],this.El=0|Ch[9],this.Fh=0|Ch[10],this.Fl=0|Ch[11],this.Gh=0|Ch[12],this.Gl=0|Ch[13],this.Hh=0|Ch[14],this.Hl=0|Ch[15]}}const Uh=Wc(()=>new Ih),Rh=Wc(()=>new Ah),Bh=Wc(()=>new Th),kh=Wc(()=>new Nh),jh=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Dh=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Lh=new Uint32Array(32);function $h(e,t,i,r,s,n){const o=s[n],a=s[n+1];let c=Lh[2*e],h=Lh[2*e+1],l=Lh[2*t],u=Lh[2*t+1],d=Lh[2*i],f=Lh[2*i+1],p=Lh[2*r],g=Lh[2*r+1],y=dc(c,l,o);h=fc(y,h,u,a),c=0|y,({Dh:g,Dl:p}={Dh:g^h,Dl:p^c}),({Dh:g,Dl:p}={Dh:hc(0,p),Dl:lc(g)}),({h:f,l:d}=uc(f,d,g,p)),({Bh:u,Bl:l}={Bh:u^f,Bl:l^d}),({Bh:u,Bl:l}={Bh:nc(u,l,24),Bl:oc(u,l,24)}),Lh[2*e]=c,Lh[2*e+1]=h,Lh[2*t]=l,Lh[2*t+1]=u,Lh[2*i]=d,Lh[2*i+1]=f,Lh[2*r]=p,Lh[2*r+1]=g}function Mh(e,t,i,r,s,n){const o=s[n],a=s[n+1];let c=Lh[2*e],h=Lh[2*e+1],l=Lh[2*t],u=Lh[2*t+1],d=Lh[2*i],f=Lh[2*i+1],p=Lh[2*r],g=Lh[2*r+1],y=dc(c,l,o);h=fc(y,h,u,a),c=0|y,({Dh:g,Dl:p}={Dh:g^h,Dl:p^c}),({Dh:g,Dl:p}={Dh:nc(g,p,16),Dl:oc(g,p,16)}),({h:f,l:d}=uc(f,d,g,p)),({Bh:u,Bl:l}={Bh:u^f,Bl:l^d}),({Bh:u,Bl:l}={Bh:ac(u,l,63),Bl:cc(u,l,63)}),Lh[2*e]=c,Lh[2*e+1]=h,Lh[2*t]=l,Lh[2*t+1]=u,Lh[2*i]=d,Lh[2*i+1]=f,Lh[2*r]=p,Lh[2*r+1]=g}class qh extends Kc{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,vc(e),vc(t),this.blockLen=e,this.outputLen=t,this.buffer=new Uint8Array(e),this.buffer32=Pc(this.buffer)}update(e){xc(this),Ec(e=Fc(e));const{blockLen:t,buffer:i,buffer32:r}=this,s=e.length,n=e.byteOffset,o=e.buffer;for(let a=0;a<s;){this.pos===t&&(Uc(r),this.compress(r,0,!1),Uc(r),this.pos=0);const c=Math.min(t-this.pos,s-a),h=n+a;if(c===t&&!(h%4)&&a+c<s){const e=new Uint32Array(o,h,Math.floor((s-a)/4));Uc(e);for(let i=0;a+t<s;i+=r.length,a+=t)this.length+=t,this.compress(e,i,!1);Uc(e);continue}i.set(e.subarray(a,a+c),this.pos),this.pos+=c,this.length+=c,a+=c}return this}digestInto(e){xc(this),Sc(e,this);const{pos:t,buffer32:i}=this;this.finished=!0,Oc(this.buffer.subarray(t)),Uc(i),this.compress(i,0,!0),Uc(i);const r=Pc(e);this.get().forEach((e,t)=>r[t]=Nc(e))}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){const{buffer:t,length:i,finished:r,destroyed:s,outputLen:n,pos:o}=this;return e||(e=new this.constructor({dkLen:n})),e.set(...this.get()),e.buffer.set(t),e.destroyed=s,e.finished=r,e.length=i,e.pos=o,e.outputLen=n,e}clone(){return this._cloneInto()}}class zh extends qh{constructor(e={}){const t=void 0===e.dkLen?64:e.dkLen;super(128,t),this.v0l=0|Dh[0],this.v0h=0|Dh[1],this.v1l=0|Dh[2],this.v1h=0|Dh[3],this.v2l=0|Dh[4],this.v2h=0|Dh[5],this.v3l=0|Dh[6],this.v3h=0|Dh[7],this.v4l=0|Dh[8],this.v4h=0|Dh[9],this.v5l=0|Dh[10],this.v5h=0|Dh[11],this.v6l=0|Dh[12],this.v6h=0|Dh[13],this.v7l=0|Dh[14],this.v7h=0|Dh[15],function(e,t={},i,r,s){if(vc(i),e<0||e>i)throw new Error("outputLen bigger than keyLen");const{key:n,salt:o,personalization:a}=t;if(void 0!==n&&(n.length<1||n.length>i))throw new Error("key length must be undefined or 1.."+i);if(void 0!==o&&o.length!==r)throw new Error("salt must be undefined or "+r);if(void 0!==a&&a.length!==s)throw new Error("personalization must be undefined or "+s)}(t,e,64,16,16);let{key:i,personalization:r,salt:s}=e,n=0;if(void 0!==i&&(i=Fc(i),n=i.length),this.v0l^=this.outputLen|n<<8|65536|1<<24,void 0!==s){s=Fc(s);const e=Pc(s);this.v4l^=Nc(e[0]),this.v4h^=Nc(e[1]),this.v5l^=Nc(e[2]),this.v5h^=Nc(e[3])}if(void 0!==r){r=Fc(r);const e=Pc(r);this.v6l^=Nc(e[0]),this.v6h^=Nc(e[1]),this.v7l^=Nc(e[2]),this.v7h^=Nc(e[3])}if(void 0!==i){const e=new Uint8Array(this.blockLen);e.set(i),this.update(e)}}get(){let{v0l:e,v0h:t,v1l:i,v1h:r,v2l:s,v2h:n,v3l:o,v3h:a,v4l:c,v4h:h,v5l:l,v5h:u,v6l:d,v6h:f,v7l:p,v7h:g}=this;return[e,t,i,r,s,n,o,a,c,h,l,u,d,f,p,g]}set(e,t,i,r,s,n,o,a,c,h,l,u,d,f,p,g){this.v0l=0|e,this.v0h=0|t,this.v1l=0|i,this.v1h=0|r,this.v2l=0|s,this.v2h=0|n,this.v3l=0|o,this.v3h=0|a,this.v4l=0|c,this.v4h=0|h,this.v5l=0|l,this.v5h=0|u,this.v6l=0|d,this.v6h=0|f,this.v7l=0|p,this.v7h=0|g}compress(e,t,i){this.get().forEach((e,t)=>Lh[t]=e),Lh.set(Dh,16);let{h:r,l:s}=tc(BigInt(this.length));Lh[24]=Dh[8]^s,Lh[25]=Dh[9]^r,i&&(Lh[28]=~Lh[28],Lh[29]=~Lh[29]);let n=0;const o=jh;for(let a=0;a<12;a++)$h(0,4,8,12,e,t+2*o[n++]),Mh(0,4,8,12,e,t+2*o[n++]),$h(1,5,9,13,e,t+2*o[n++]),Mh(1,5,9,13,e,t+2*o[n++]),$h(2,6,10,14,e,t+2*o[n++]),Mh(2,6,10,14,e,t+2*o[n++]),$h(3,7,11,15,e,t+2*o[n++]),Mh(3,7,11,15,e,t+2*o[n++]),$h(0,5,10,15,e,t+2*o[n++]),Mh(0,5,10,15,e,t+2*o[n++]),$h(1,6,11,12,e,t+2*o[n++]),Mh(1,6,11,12,e,t+2*o[n++]),$h(2,7,8,13,e,t+2*o[n++]),Mh(2,7,8,13,e,t+2*o[n++]),$h(3,4,9,14,e,t+2*o[n++]),Mh(3,4,9,14,e,t+2*o[n++]);this.v0l^=Lh[0]^Lh[16],this.v0h^=Lh[1]^Lh[17],this.v1l^=Lh[2]^Lh[18],this.v1h^=Lh[3]^Lh[19],this.v2l^=Lh[4]^Lh[20],this.v2h^=Lh[5]^Lh[21],this.v3l^=Lh[6]^Lh[22],this.v3h^=Lh[7]^Lh[23],this.v4l^=Lh[8]^Lh[24],this.v4h^=Lh[9]^Lh[25],this.v5l^=Lh[10]^Lh[26],this.v5h^=Lh[11]^Lh[27],this.v6l^=Lh[12]^Lh[28],this.v6h^=Lh[13]^Lh[29],this.v7l^=Lh[14]^Lh[30],this.v7h^=Lh[15]^Lh[31],Oc(Lh)}destroy(){this.destroyed=!0,Oc(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Hh=function(e){const t=(t,i)=>e(i).update(Fc(t)).digest(),i=e({});return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=t=>e(t),t}(e=>new zh(e)),Fh="https://rpc.walletconnect.org/v1";function Vh(e){const t=`Ethereum Signed Message:\n${e.length}`,i=(new TextEncoder).encode(t+e);return"0x"+Buffer.from(lh(i)).toString("hex")}async function Kh(e,t,i,r,s,n){switch(i.t){case"eip191":return await async function(e,t,i){return(await async function({hash:e,signature:t}){return ct(await ht({hash:e,signature:t}))}({hash:Vh(t),signature:i})).toLowerCase()===e.toLowerCase()}(e,t,i.s);case"eip1271":return await async function(e,t,i,r,s,n){const o=la(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const o="0x1626ba7e",a="0000000000000000000000000000000000000000000000000000000000000040",c=i.substring(2),h=(c.length/2).toString(16).padStart(64,"0"),l=o+(t.startsWith("0x")?t:Vh(t)).substring(2)+a+h+c,u=await fetch(`${n||Fh}/?chainId=${r}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Wh(),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:l},"latest"]})}),{result:d}=await u.json();return!!d&&d.slice(0,o.length).toLowerCase()===o.toLowerCase()}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}(e,t,i.s,r,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${i.t}`)}}function Wh(){return Date.now()+Math.floor(1e3*Math.random())}function Gh(e){const t=new Uint8Array(Buffer.from(e,"base64")),i=Array.from("TransactionData::").map(e=>e.charCodeAt(0)),r=new Uint8Array(i.length+t.length);r.set(i),r.set(t,i.length);const s=Hh(r,{dkLen:32});return ut.encode(s)}function Yh(e){const t=new Uint8Array(Uh(function(e){if(e instanceof Uint8Array)return e;if(Array.isArray(e))return new Uint8Array(e);if("object"==typeof e&&null!=e&&e.data)return new Uint8Array(Object.values(e.data));if("object"==typeof e&&e)return new Uint8Array(Object.values(e));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(e)));return ut.encode(t)}function Jh(e){const t=Buffer.from(e,"base64"),i=(r=t,new jt(s).decode(r)).txn;var r,s;if(!i)throw new Error("Invalid signed transaction: missing 'txn' field");const n=function(e,t){return new Pt(t).encodeSharedRef(e)}(i),o=Buffer.from("TX"),a=Buffer.concat([o,Buffer.from(n)]),c=kh(a);return Zt.encode(c).replace(/=+$/,"")}function Zh(e){const t=[];let i=BigInt(e);for(;i>=BigInt(128);)t.push(Number(i&BigInt(127)|BigInt(128))),i>>=BigInt(7);return t.push(Number(i)),Buffer.from(t)}function Qh(e){const t=Buffer.from(e.signed.bodyBytes,"base64"),i=Buffer.from(e.signed.authInfoBytes,"base64"),r=Buffer.from(e.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(Zh(t.length)),s.push(t),s.push(Buffer.from([18])),s.push(Zh(i.length)),s.push(i),s.push(Buffer.from([26])),s.push(Zh(r.length)),s.push(r);const n=Buffer.concat(s),o=Uh(n);return Buffer.from(o).toString("hex").toUpperCase()}var Xh=Object.defineProperty,el=Object.defineProperties,tl=Object.getOwnPropertyDescriptors,il=Object.getOwnPropertySymbols,rl=Object.prototype.hasOwnProperty,sl=Object.prototype.propertyIsEnumerable,nl=(e,t,i)=>t in e?Xh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;const ol=e=>null==e?void 0:e.split(":"),al=e=>{const t=e&&ol(e);if(t)return t[2]+":"+t[3]},cl=e=>{const t=e&&ol(e);if(t)return t.pop()};async function hl(e){const{cacao:t,projectId:i}=e,{s:r,p:s}=t,n=ll(s,s.iss),o=cl(s.iss);return await Kh(o,n,r,al(s.iss),i)}const ll=(e,t)=>{const i=`${e.domain} wants you to sign in with your Ethereum account:`,r=cl(t);if(!e.aud&&!e.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=e.statement||void 0;const n=`URI: ${e.aud||e.uri}`,o=`Version: ${e.version}`,a=`Chain ID: ${(e=>{const t=e&&ol(e);if(t)return e.includes("did:pkh:")?t[3]:t[1]})(t)}`,c=`Nonce: ${e.nonce}`,h=`Issued At: ${e.iat}`,l=e.exp?`Expiration Time: ${e.exp}`:void 0,u=e.nbf?`Not Before: ${e.nbf}`:void 0,d=e.requestId?`Request ID: ${e.requestId}`:void 0,f=e.resources?`Resources:${e.resources.map(e=>`\n- ${e}`).join("")}`:void 0,p=bl(e.resources);if(p){s=function(e="",t){ul(t);const i="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(i))return e;const r=[];let s=0;Object.keys(t.att).forEach(e=>{const i=Object.keys(t.att[e]).map(e=>({ability:e.split("/")[0],action:e.split("/")[1]}));i.sort((e,t)=>e.action.localeCompare(t.action));const n={};i.forEach(e=>{n[e.ability]||(n[e.ability]=[]),n[e.ability].push(e.action)});const o=Object.keys(n).map(t=>(s++,`(${s}) '${t}': '${n[t].join("', '")}' for '${e}'.`));r.push(o.join(", ").replace(".,","."))});const n=r.join(" "),o=`${i}${n}`;return`${e?e+" ":""}${o}`}(s,pl(p))}return[i,r,"",s,"",n,o,a,c,h,l,u,d,f].filter(e=>null!=e).join("\n")};function ul(e){if(!e)throw new Error("No recap provided, value is undefined");if(!e.att)throw new Error("No `att` property found");const t=Object.keys(e.att);if(null==t||!t.length)throw new Error("No resources found in `att` property");t.forEach(t=>{const i=e.att[t];if(Array.isArray(i))throw new Error(`Resource must be an object: ${t}`);if("object"!=typeof i)throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(i).forEach(e=>{const t=i[e];if(!Array.isArray(t))throw new Error(`Ability limits ${e} must be an array of objects, found: ${t}`);if(!t.length)throw new Error(`Value of ${e} is empty array, must be an array with objects`);t.forEach(t=>{if("object"!=typeof t)throw new Error(`Ability limits (${e}) must be an array of objects, found: ${t}`)})})})}function dl(e,t,i={}){const r=(t=null==t?void 0:t.sort((e,t)=>e.localeCompare(t))).map(t=>({[`${e}/${t}`]:[i]}));return Object.assign({},...r)}function fl(e){return ul(e),`urn:recap:${function(e){return Buffer.from(JSON.stringify(e)).toString("base64")}(e).replace(/=/g,"")}`}function pl(e){const t=function(e){return JSON.parse(Buffer.from(e,"base64").toString("utf-8"))}(e.replace("urn:recap:",""));return ul(t),t}function gl(e,t,i){const r=function(e,t,i,r={}){return null==i||i.sort((e,t)=>e.localeCompare(t)),{att:{[e]:dl(t,i,r)}}}(e,t,i);return fl(r)}function yl(e,t){const i=function(e,t){ul(e),ul(t);const i=Object.keys(e.att).concat(Object.keys(t.att)).sort((e,t)=>e.localeCompare(t)),r={att:{}};return i.forEach(i=>{var s,n;Object.keys((null==(s=e.att)?void 0:s[i])||{}).concat(Object.keys((null==(n=t.att)?void 0:n[i])||{})).sort((e,t)=>e.localeCompare(t)).forEach(s=>{var n,o;r.att[i]=((e,t)=>el(e,tl(t)))(((e,t)=>{for(var i in t||(t={}))rl.call(t,i)&&nl(e,i,t[i]);if(il)for(var i of il(t))sl.call(t,i)&&nl(e,i,t[i]);return e})({},r.att[i]),{[s]:(null==(n=e.att[i])?void 0:n[s])||(null==(o=t.att[i])?void 0:o[s])})})}),r}(pl(e),pl(t));return fl(i)}function wl(e){var t;const i=pl(e);ul(i);const r=null==(t=i.att)?void 0:t.eip155;return r?Object.keys(r).map(e=>e.split("/")[1]):[]}function ml(e){const t=pl(e);ul(t);const i=[];return Object.values(t.att).forEach(e=>{Object.values(e).forEach(e=>{var t;null!=(t=null==e?void 0:e[0])&&t.chains&&i.push(e[0].chains)})}),[...new Set(i.flat())]}function bl(e){if(!e)return;const t=null==e?void 0:e[e.length-1];return function(e){return e&&e.includes("urn:recap:")}(t)?t:void 0}
/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function vl(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function El(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function Il(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function xl(e,...t){if(!vl(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Sl(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Pl(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Ol(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const _l=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function Al(e){if("string"==typeof e)e=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}(e);else{if(!vl(e))throw new Error("Uint8Array expected, got "+typeof e);e=Ul(e)}return e}function Tl(e,t,i=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(i&&!function(e){return e.byteOffset%4==0}(t))throw new Error("invalid output, must be aligned");return t}function Cl(e,t,i,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,i,r);const s=BigInt(32),n=BigInt(4294967295),o=Number(i>>s&n),a=Number(i&n),c=r?4:0,h=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+h,a,r)}function Nl(e,t,i){El(i);const r=new Uint8Array(16),s=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}(r);return Cl(s,0,BigInt(t),i),Cl(s,8,BigInt(e),i),r}function Ul(e){return Uint8Array.from(e)}const Rl=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),Bl=Rl("expand 16-byte k"),kl=Rl("expand 32-byte k"),jl=Pl(Bl),Dl=Pl(kl);function Ll(e,t){return e<<t|e>>>32-t}function $l(e){return e.byteOffset%4==0}const Ml=2**32-1,ql=new Uint32Array;const zl=(e,t)=>255&e[t++]|(255&e[t++])<<8;class Hl{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,xl(e=Al(e),32);const t=zl(e,0),i=zl(e,2),r=zl(e,4),s=zl(e,6),n=zl(e,8),o=zl(e,10),a=zl(e,12),c=zl(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|i<<3),this.r[2]=7939&(i>>>10|r<<6),this.r[3]=8191&(r>>>7|s<<9),this.r[4]=255&(s>>>4|n<<12),this.r[5]=n>>>1&8190,this.r[6]=8191&(n>>>14|o<<2),this.r[7]=8065&(o>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let h=0;h<8;h++)this.pad[h]=zl(e,16+2*h)}process(e,t,i=!1){const r=i?0:2048,{h:s,r:n}=this,o=n[0],a=n[1],c=n[2],h=n[3],l=n[4],u=n[5],d=n[6],f=n[7],p=n[8],g=n[9],y=zl(e,t+0),w=zl(e,t+2),m=zl(e,t+4),b=zl(e,t+6),v=zl(e,t+8),E=zl(e,t+10),I=zl(e,t+12),x=zl(e,t+14);let S=s[0]+(8191&y),P=s[1]+(8191&(y>>>13|w<<3)),O=s[2]+(8191&(w>>>10|m<<6)),_=s[3]+(8191&(m>>>7|b<<9)),A=s[4]+(8191&(b>>>4|v<<12)),T=s[5]+(v>>>1&8191),C=s[6]+(8191&(v>>>14|E<<2)),N=s[7]+(8191&(E>>>11|I<<5)),U=s[8]+(8191&(I>>>8|x<<8)),R=s[9]+(x>>>5|r),B=0,k=B+S*o+P*(5*g)+O*(5*p)+_*(5*f)+A*(5*d);B=k>>>13,k&=8191,k+=T*(5*u)+C*(5*l)+N*(5*h)+U*(5*c)+R*(5*a),B+=k>>>13,k&=8191;let j=B+S*a+P*o+O*(5*g)+_*(5*p)+A*(5*f);B=j>>>13,j&=8191,j+=T*(5*d)+C*(5*u)+N*(5*l)+U*(5*h)+R*(5*c),B+=j>>>13,j&=8191;let D=B+S*c+P*a+O*o+_*(5*g)+A*(5*p);B=D>>>13,D&=8191,D+=T*(5*f)+C*(5*d)+N*(5*u)+U*(5*l)+R*(5*h),B+=D>>>13,D&=8191;let L=B+S*h+P*c+O*a+_*o+A*(5*g);B=L>>>13,L&=8191,L+=T*(5*p)+C*(5*f)+N*(5*d)+U*(5*u)+R*(5*l),B+=L>>>13,L&=8191;let $=B+S*l+P*h+O*c+_*a+A*o;B=$>>>13,$&=8191,$+=T*(5*g)+C*(5*p)+N*(5*f)+U*(5*d)+R*(5*u),B+=$>>>13,$&=8191;let M=B+S*u+P*l+O*h+_*c+A*a;B=M>>>13,M&=8191,M+=T*o+C*(5*g)+N*(5*p)+U*(5*f)+R*(5*d),B+=M>>>13,M&=8191;let q=B+S*d+P*u+O*l+_*h+A*c;B=q>>>13,q&=8191,q+=T*a+C*o+N*(5*g)+U*(5*p)+R*(5*f),B+=q>>>13,q&=8191;let z=B+S*f+P*d+O*u+_*l+A*h;B=z>>>13,z&=8191,z+=T*c+C*a+N*o+U*(5*g)+R*(5*p),B+=z>>>13,z&=8191;let H=B+S*p+P*f+O*d+_*u+A*l;B=H>>>13,H&=8191,H+=T*h+C*c+N*a+U*o+R*(5*g),B+=H>>>13,H&=8191;let F=B+S*g+P*p+O*f+_*d+A*u;B=F>>>13,F&=8191,F+=T*l+C*h+N*c+U*a+R*o,B+=F>>>13,F&=8191,B=(B<<2)+B|0,B=B+k|0,k=8191&B,B>>>=13,j+=B,s[0]=k,s[1]=j,s[2]=D,s[3]=L,s[4]=$,s[5]=M,s[6]=q,s[7]=z,s[8]=H,s[9]=F}finalize(){const{h:e,pad:t}=this,i=new Uint16Array(10);let r=e[1]>>>13;e[1]&=8191;for(let o=2;o<10;o++)e[o]+=r,r=e[o]>>>13,e[o]&=8191;e[0]+=5*r,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,i[0]=e[0]+5,r=i[0]>>>13,i[0]&=8191;for(let o=1;o<10;o++)i[o]=e[o]+r,r=i[o]>>>13,i[o]&=8191;i[9]-=8192;let s=(1^r)-1;for(let o=0;o<10;o++)i[o]&=s;s=~s;for(let o=0;o<10;o++)e[o]=e[o]&s|i[o];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let n=e[0]+t[0];e[0]=65535&n;for(let o=1;o<8;o++)n=(e[o]+t[o]|0)+(n>>>16)|0,e[o]=65535&n;Ol(i)}update(e){Sl(this),xl(e=Al(e));const{buffer:t,blockLen:i}=this,r=e.length;for(let s=0;s<r;){const n=Math.min(i-this.pos,r-s);if(n!==i)t.set(e.subarray(s,s+n),this.pos),this.pos+=n,s+=n,this.pos===i&&(this.process(t,0,!1),this.pos=0);else for(;i<=r-s;s+=i)this.process(e,s)}return this}destroy(){Ol(this.h,this.r,this.buffer,this.pad)}digestInto(e){Sl(this),function(e,t){xl(e);const i=t.outputLen;if(e.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}(e,this),this.finished=!0;const{buffer:t,h:i}=this;let{pos:r}=this;if(r){for(t[r++]=1;r<16;r++)t[r]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let n=0;n<8;n++)e[s++]=i[n]>>>0,e[s++]=i[n]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}}const Fl=function(e){const t=(t,i)=>e(i).update(Al(t)).digest(),i=e(new Uint8Array(32));return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=t=>e(t),t}(e=>new Hl(e));const Vl=function(e,t){const{allowShortKeys:i,extendNonceFn:r,counterLength:s,counterRight:n,rounds:o}=function(e,t){if(null==t||"object"!=typeof t)throw new Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw new Error("core must be a function");return Il(s),Il(o),El(n),El(i),(t,a,c,h,l=0)=>{xl(t),xl(a),xl(c);const u=c.length;if(void 0===h&&(h=new Uint8Array(u)),xl(h),Il(l),l<0||l>=Ml)throw new Error("arx: counter overflow");if(h.length<u)throw new Error(`arx: output (${h.length}) is shorter than data (${u})`);const d=[];let f,p,g=t.length;if(32===g)d.push(f=Ul(t)),p=Dl;else{if(16!==g||!i)throw new Error(`arx: invalid 32-byte key, got length=${g}`);f=new Uint8Array(32),f.set(t),f.set(t,16),p=jl,d.push(f)}$l(a)||d.push(a=Ul(a));const y=Pl(f);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(p,y,Pl(a.subarray(0,16)),y),a=a.subarray(16)}const w=16-s;if(w!==a.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(12!==w){const e=new Uint8Array(12);e.set(a,n?0:12-a.length),a=e,d.push(a)}const m=Pl(a);return function(e,t,i,r,s,n,o,a){const c=s.length,h=new Uint8Array(64),l=Pl(h),u=$l(s)&&$l(n),d=u?Pl(s):ql,f=u?Pl(n):ql;for(let p=0;p<c;o++){if(e(t,i,r,l,o,a),o>=Ml)throw new Error("arx: counter overflow");const g=Math.min(64,c-p);if(u&&64===g){const e=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let t,i=0;i<16;i++)t=e+i,f[t]=d[t]^l[i];p+=64;continue}for(let e,t=0;t<g;t++)e=p+t,n[e]=s[e]^h[t];p+=g}}(e,p,y,m,c,h,l,o),Ol(...d),h}}(function(e,t,i,r,s,n=20){let o=e[0],a=e[1],c=e[2],h=e[3],l=t[0],u=t[1],d=t[2],f=t[3],p=t[4],g=t[5],y=t[6],w=t[7],m=s,b=i[0],v=i[1],E=i[2],I=o,x=a,S=c,P=h,O=l,_=u,A=d,T=f,C=p,N=g,U=y,R=w,B=m,k=b,j=v,D=E;for(let $=0;$<n;$+=2)I=I+O|0,B=Ll(B^I,16),C=C+B|0,O=Ll(O^C,12),I=I+O|0,B=Ll(B^I,8),C=C+B|0,O=Ll(O^C,7),x=x+_|0,k=Ll(k^x,16),N=N+k|0,_=Ll(_^N,12),x=x+_|0,k=Ll(k^x,8),N=N+k|0,_=Ll(_^N,7),S=S+A|0,j=Ll(j^S,16),U=U+j|0,A=Ll(A^U,12),S=S+A|0,j=Ll(j^S,8),U=U+j|0,A=Ll(A^U,7),P=P+T|0,D=Ll(D^P,16),R=R+D|0,T=Ll(T^R,12),P=P+T|0,D=Ll(D^P,8),R=R+D|0,T=Ll(T^R,7),I=I+_|0,D=Ll(D^I,16),U=U+D|0,_=Ll(_^U,12),I=I+_|0,D=Ll(D^I,8),U=U+D|0,_=Ll(_^U,7),x=x+A|0,B=Ll(B^x,16),R=R+B|0,A=Ll(A^R,12),x=x+A|0,B=Ll(B^x,8),R=R+B|0,A=Ll(A^R,7),S=S+T|0,k=Ll(k^S,16),C=C+k|0,T=Ll(T^C,12),S=S+T|0,k=Ll(k^S,8),C=C+k|0,T=Ll(T^C,7),P=P+O|0,j=Ll(j^P,16),N=N+j|0,O=Ll(O^N,12),P=P+O|0,j=Ll(j^P,8),N=N+j|0,O=Ll(O^N,7);let L=0;r[L++]=o+I|0,r[L++]=a+x|0,r[L++]=c+S|0,r[L++]=h+P|0,r[L++]=l+O|0,r[L++]=u+_|0,r[L++]=d+A|0,r[L++]=f+T|0,r[L++]=p+C|0,r[L++]=g+N|0,r[L++]=y+U|0,r[L++]=w+R|0,r[L++]=m+B|0,r[L++]=b+k|0,r[L++]=v+j|0,r[L++]=E+D|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),Kl=new Uint8Array(16),Wl=(e,t)=>{e.update(t);const i=t.length%16;i&&e.update(Kl.subarray(i))},Gl=new Uint8Array(32);function Yl(e,t,i,r,s){const n=e(t,i,Gl),o=Fl.create(n);s&&Wl(o,s),Wl(o,r);const a=Nl(r.length,s?s.length:0,!0);o.update(a);const c=o.digest();return Ol(n,a),c}const Jl=((e,t)=>{function i(i,...r){if(xl(i),!_l)throw new Error("Non little-endian hardware is not yet supported");if(void 0!==e.nonceLength){const t=r[0];if(!t)throw new Error("nonce / iv required");e.varSizeNonce?xl(t):xl(t,e.nonceLength)}const s=e.tagLength;s&&void 0!==r[1]&&xl(r[1]);const n=t(i,...r),o=(e,t)=>{if(void 0!==t){if(2!==e)throw new Error("cipher output not supported");xl(t)}};let a=!1;return{encrypt(e,t){if(a)throw new Error("cannot encrypt() twice with same key + nonce");return a=!0,xl(e),o(n.encrypt.length,t),n.encrypt(e,t)},decrypt(e,t){if(xl(e),s&&e.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return o(n.decrypt.length,t),n.decrypt(e,t)}}}return Object.assign(i,e),i})({blockSize:64,nonceLength:12,tagLength:16},(e=>(t,i,r)=>({encrypt(s,n){const o=s.length;(n=Tl(o+16,n,!1)).set(s);const a=n.subarray(0,-16);e(t,i,a,a,1);const c=Yl(e,t,i,a,r);return n.set(c,o),Ol(c),n},decrypt(s,n){n=Tl(s.length-16,n,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=Yl(e,t,i,o,r);if(!function(e,t){if(e.length!==t.length)return!1;let i=0;for(let r=0;r<e.length;r++)i|=e[r]^t[r];return 0===i}(a,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),e(t,i,n,n,1),Ol(c),n}}))(Vl));let Zl=class extends Kc{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Ic(e);const i=Fc(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(i.length>r?e.create().update(i).digest():i);for(let n=0;n<s.length;n++)s[n]^=54;this.iHash.update(s),this.oHash=e.create();for(let n=0;n<s.length;n++)s[n]^=106;this.oHash.update(s),Oc(s)}update(e){return xc(this),this.iHash.update(e),this}digestInto(e){xc(this),Ec(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:i,finished:r,destroyed:s,blockLen:n,outputLen:o}=this;return e.finished=r,e.destroyed=s,e.blockLen=n,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Ql=(e,t,i)=>new Zl(e,t).update(i).digest();Ql.create=(e,t)=>new Zl(e,t);const Xl=Uint8Array.from([0]),eu=Uint8Array.of();const tu=(e,t,i,r,s)=>function(e,t,i,r=32){Ic(e),vc(r);const s=e.outputLen;if(r>255*s)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(r/s);void 0===i&&(i=eu);const o=new Uint8Array(n*s),a=Ql.create(e,t),c=a._cloneInto(),h=new Uint8Array(a.outputLen);for(let l=0;l<n;l++)Xl[0]=l+1,c.update(0===l?eu:h).update(i).update(Xl).digestInto(h),o.set(h,s*l),a._cloneInto(c);return a.destroy(),c.destroy(),Oc(h,Xl),o.slice(0,r)}(e,function(e,t,i){return Ic(e),void 0===i&&(i=new Uint8Array(e.outputLen)),Ql(e,Fc(i),Fc(t))}(e,t,i),r,s),iu=Uh,ru=BigInt(0),su=BigInt(1);function nu(e,t){if("boolean"!=typeof t)throw new Error(e+" boolean expected, got "+t)}function ou(e){const t=e.toString(16);return 1&t.length?"0"+t:t}function au(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?ru:BigInt("0x"+e)}function cu(e){return au(kc(e))}function hu(e){return Ec(e),au(kc(Uint8Array.from(e).reverse()))}function lu(e,t){return Hc(e.toString(16).padStart(2*t,"0"))}function uu(e,t){return lu(e,t).reverse()}function du(e,t,i){let r;if("string"==typeof t)try{r=Hc(t)}catch(n){throw new Error(e+" must be hex string or Uint8Array, cause: "+n)}else{if(!bc(t))throw new Error(e+" must be hex string or Uint8Array");r=Uint8Array.from(t)}const s=r.length;if("number"==typeof i&&s!==i)throw new Error(e+" of length "+i+" expected, got "+s);return r}const fu=e=>"bigint"==typeof e&&ru<=e;function pu(e,t,i,r){if(!function(e,t,i){return fu(e)&&fu(t)&&fu(i)&&t<=e&&e<i}(t,i,r))throw new Error("expected valid "+e+": "+i+" <= n < "+r+", got "+t)}const gu=e=>(su<<BigInt(e))-su;function yu(e,t,i={}){if(!e||"object"!=typeof e)throw new Error("expected valid options object");function r(t,i,r){const s=e[t];if(r&&void 0===s)return;const n=typeof s;if(n!==i||null===s)throw new Error(`param "${t}" is invalid: expected ${i}, got ${n}`)}Object.entries(t).forEach(([e,t])=>r(e,t,!1)),Object.entries(i).forEach(([e,t])=>r(e,t,!0))}function wu(e){const t=new WeakMap;return(i,...r)=>{const s=t.get(i);if(void 0!==s)return s;const n=e(i,...r);return t.set(i,n),n}}const mu=BigInt(0),bu=BigInt(1),vu=BigInt(2),Eu=BigInt(3),Iu=BigInt(4),xu=BigInt(5),Su=BigInt(8);function Pu(e,t){const i=e%t;return i>=mu?i:t+i}function Ou(e,t,i){let r=e;for(;t-- >mu;)r*=r,r%=i;return r}function _u(e,t){if(e===mu)throw new Error("invert: expected non-zero number");if(t<=mu)throw new Error("invert: expected positive modulus, got "+t);let i=Pu(e,t),r=t,s=mu,n=bu;for(;i!==mu;){const e=r%i,t=s-n*(r/i);r=i,i=e,s=n,n=t}if(r!==bu)throw new Error("invert: does not exist");return Pu(s,t)}function Au(e,t){const i=(e.ORDER+bu)/Iu,r=e.pow(t,i);if(!e.eql(e.sqr(r),t))throw new Error("Cannot find square root");return r}function Tu(e,t){const i=(e.ORDER-xu)/Su,r=e.mul(t,vu),s=e.pow(r,i),n=e.mul(t,s),o=e.mul(e.mul(n,vu),s),a=e.mul(n,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),t))throw new Error("Cannot find square root");return a}function Cu(e){return e%Iu===Eu?Au:e%Su===xu?Tu:function(e){if(e<BigInt(3))throw new Error("sqrt is not defined for small field");let t=e-bu,i=0;for(;t%vu===mu;)t/=vu,i++;let r=vu;const s=Bu(e);for(;1===Ru(s,r);)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(1===i)return Au;let n=s.pow(r,t);const o=(t+bu)/vu;return function(e,r){if(e.is0(r))return r;if(1!==Ru(e,r))throw new Error("Cannot find square root");let s=i,a=e.mul(e.ONE,n),c=e.pow(r,t),h=e.pow(r,o);for(;!e.eql(c,e.ONE);){if(e.is0(c))return e.ZERO;let t=1,i=e.sqr(c);for(;!e.eql(i,e.ONE);)if(t++,i=e.sqr(i),t===s)throw new Error("Cannot find square root");const r=bu<<BigInt(s-t-1),n=e.pow(a,r);s=t,a=e.sqr(n),c=e.mul(c,a),h=e.mul(h,n)}return h}}(e)}const Nu=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Uu(e,t,i=!1){const r=new Array(t.length).fill(i?e.ZERO:void 0),s=t.reduce((t,i,s)=>e.is0(i)?t:(r[s]=t,e.mul(t,i)),e.ONE),n=e.inv(s);return t.reduceRight((t,i,s)=>e.is0(i)?t:(r[s]=e.mul(t,r[s]),e.mul(t,i)),n),r}function Ru(e,t){const i=(e.ORDER-bu)/vu,r=e.pow(t,i),s=e.eql(r,e.ONE),n=e.eql(r,e.ZERO),o=e.eql(r,e.neg(e.ONE));if(!s&&!n&&!o)throw new Error("invalid Legendre symbol result");return s?1:n?0:-1}function Bu(e,t,i=!1,r={}){if(e<=mu)throw new Error("invalid field: expected ORDER > 0, got "+e);let s,n;if("object"==typeof t&&null!=t){if(r.sqrt||i)throw new Error("cannot specify opts in two arguments");const e=t;e.BITS&&(s=e.BITS),e.sqrt&&(n=e.sqrt),"boolean"==typeof e.isLE&&(i=e.isLE)}else"number"==typeof t&&(s=t),r.sqrt&&(n=r.sqrt);const{nBitLength:o,nByteLength:a}=function(e,t){void 0!==t&&vc(t);const i=void 0!==t?t:e.toString(2).length;return{nBitLength:i,nByteLength:Math.ceil(i/8)}}(e,s);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c;const h=Object.freeze({ORDER:e,isLE:i,BITS:o,BYTES:a,MASK:gu(o),ZERO:mu,ONE:bu,create:t=>Pu(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("invalid field element: expected bigint, got "+typeof t);return mu<=t&&t<e},is0:e=>e===mu,isValidNot0:e=>!h.is0(e)&&h.isValid(e),isOdd:e=>(e&bu)===bu,neg:t=>Pu(-t,e),eql:(e,t)=>e===t,sqr:t=>Pu(t*t,e),add:(t,i)=>Pu(t+i,e),sub:(t,i)=>Pu(t-i,e),mul:(t,i)=>Pu(t*i,e),pow:(e,t)=>function(e,t,i){if(i<mu)throw new Error("invalid exponent, negatives unsupported");if(i===mu)return e.ONE;if(i===bu)return t;let r=e.ONE,s=t;for(;i>mu;)i&bu&&(r=e.mul(r,s)),s=e.sqr(s),i>>=bu;return r}(h,e,t),div:(t,i)=>Pu(t*_u(i,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>_u(t,e),sqrt:n||(t=>(c||(c=Cu(e)),c(h,t))),toBytes:e=>i?uu(e,a):lu(e,a),fromBytes:e=>{if(e.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+e.length);return i?hu(e):cu(e)},invertBatch:e=>Uu(h,e),cmov:(e,t,i)=>i?t:e});return Object.freeze(h)}function ku(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function ju(e){const t=ku(e);return t+Math.ceil(t/2)}const Du=BigInt(0),Lu=BigInt(1);function $u(e,t){const i=t.negate();return e?i:t}function Mu(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function qu(e,t){Mu(e,t);const i=2**e;return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1),mask:gu(e),maxNumber:i,shiftBy:BigInt(e)}}function zu(e,t,i){const{windowSize:r,mask:s,maxNumber:n,shiftBy:o}=i;let a=Number(e&s),c=e>>o;a>r&&(a-=n,c+=Lu);const h=t*r;return{nextN:c,offset:h+Math.abs(a)-1,isZero:0===a,isNeg:a<0,isNegF:t%2!=0,offsetF:h}}const Hu=new WeakMap,Fu=new WeakMap;function Vu(e){return Fu.get(e)||1}function Ku(e){if(e!==Du)throw new Error("invalid wNAF")}function Wu(e,t,i,r){(function(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((e,i)=>{if(!(e instanceof t))throw new Error("invalid point at index "+i)})})(i,e),function(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((e,i)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+i)})}(r,t);const s=i.length,n=r.length;if(s!==n)throw new Error("arrays of points and scalars must have equal length");const o=e.ZERO,a=function(e){let t;for(t=0;e>ru;e>>=su,t+=1);return t}(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const h=gu(c),l=new Array(Number(h)+1).fill(o);let u=o;for(let d=Math.floor((t.BITS-1)/c)*c;d>=0;d-=c){l.fill(o);for(let t=0;t<n;t++){const e=r[t],s=Number(e>>BigInt(d)&h);l[s]=l[s].add(i[t])}let e=o;for(let t=l.length-1,i=o;t>0;t--)i=i.add(l[t]),e=e.add(i);if(u=u.add(e),0!==d)for(let t=0;t<c;t++)u=u.double()}return u}function Gu(e,t){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return function(e){yu(e,Nu.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"}))}(t),t}return Bu(e)}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Yu=BigInt(0),Ju=BigInt(1),Zu=BigInt(2);function Qu(e){const t=function(e){return yu(e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...e})}(e),{P:i,type:r,adjustScalarBytes:s,powPminus2:n,randomBytes:o}=t,a="x25519"===r;if(!a&&"x448"!==r)throw new Error("invalid type");const c=o||Gc,h=a?255:448,l=a?32:56,u=BigInt(a?9:5),d=BigInt(a?121665:39081),f=a?Zu**BigInt(254):Zu**BigInt(447),p=a?BigInt(8)*Zu**BigInt(251)-Ju:BigInt(4)*Zu**BigInt(445)-Ju,g=f+p+Ju,y=e=>Pu(e,i),w=m(u);function m(e){return uu(y(e),l)}function b(e,t){const r=function(e,t){pu("u",e,Yu,i),pu("scalar",t,f,g);const r=t,s=e;let o=Ju,a=Yu,c=e,l=Ju,u=Yu;for(let i=BigInt(h-1);i>=Yu;i--){const e=r>>i&Ju;u^=e,({x_2:o,x_3:c}=E(u,o,c)),({x_2:a,x_3:l}=E(u,a,l)),u=e;const t=o+a,n=y(t*t),h=o-a,f=y(h*h),p=n-f,g=c+l,w=y((c-l)*t),m=y(g*h),b=w+m,v=w-m;c=y(b*b),l=y(s*y(v*v)),o=y(n*f),a=y(p*(n+y(d*p)))}({x_2:o,x_3:c}=E(u,o,c)),({x_2:a,x_3:l}=E(u,a,l));const p=n(a);return y(o*p)}(function(e){const t=du("u coordinate",e,l);return a&&(t[31]&=127),y(hu(t))}(t),function(e){return hu(s(du("scalar",e,l)))}(e));if(r===Yu)throw new Error("invalid private or public key received");return m(r)}function v(e){return b(e,w)}function E(e,t,i){const r=y(e*(t-i));return{x_2:t=y(t-r),x_3:i=y(i+r)}}return{scalarMult:b,scalarMultBase:v,getSharedSecret:(e,t)=>b(e,t),getPublicKey:e=>v(e),utils:{randomPrivateKey:()=>c(l)},GuBytes:w.slice()}}BigInt(0);const Xu=BigInt(1),ed=BigInt(2),td=BigInt(3),id=BigInt(5),rd=BigInt(8),sd={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:rd,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function nd(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}const od=(()=>{const e=sd.p;return Qu({P:e,type:"x25519",powPminus2:t=>{const{pow_p_5_8:i,b2:r}=function(e){const t=BigInt(10),i=BigInt(20),r=BigInt(40),s=BigInt(80),n=sd.p,o=e*e%n*e%n,a=Ou(o,ed,n)*o%n,c=Ou(a,Xu,n)*e%n,h=Ou(c,id,n)*c%n,l=Ou(h,t,n)*h%n,u=Ou(l,i,n)*l%n,d=Ou(u,r,n)*u%n,f=Ou(d,s,n)*d%n,p=Ou(f,s,n)*d%n,g=Ou(p,t,n)*h%n;return{pow_p_5_8:Ou(g,ed,n)*e%n,b2:o}}(t);return Pu(Ou(i,td,e)*r,e)},adjustScalarBytes:nd})})();function ad(e){void 0!==e.lowS&&nu("lowS",e.lowS),void 0!==e.prehash&&nu("prehash",e.prehash)}class cd extends Error{constructor(e=""){super(e)}}const hd={Err:cd,_tlv:{encode:(e,t)=>{const{Err:i}=hd;if(e<0||e>256)throw new i("tlv.encode: wrong tag");if(1&t.length)throw new i("tlv.encode: unpadded data");const r=t.length/2,s=ou(r);if(s.length/2&128)throw new i("tlv.encode: long form length too big");const n=r>127?ou(s.length/2|128):"";return ou(e)+n+s+t},decode(e,t){const{Err:i}=hd;let r=0;if(e<0||e>256)throw new i("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new i("tlv.decode: wrong tlv");const s=t[r++];let n=0;if(!!(128&s)){const e=127&s;if(!e)throw new i("tlv.decode(long): indefinite length not supported");if(e>4)throw new i("tlv.decode(long): byte length is too big");const o=t.subarray(r,r+e);if(o.length!==e)throw new i("tlv.decode: length bytes not complete");if(0===o[0])throw new i("tlv.decode(long): zero leftmost byte");for(const t of o)n=n<<8|t;if(r+=e,n<128)throw new i("tlv.decode(long): not minimal encoding")}else n=s;const o=t.subarray(r,r+n);if(o.length!==n)throw new i("tlv.decode: wrong value length");return{v:o,l:t.subarray(r+n)}}},_int:{encode(e){const{Err:t}=hd;if(e<ld)throw new t("integer: negative integers are not allowed");let i=ou(e);if(8&Number.parseInt(i[0],16)&&(i="00"+i),1&i.length)throw new t("unexpected DER parsing assertion: unpadded hex");return i},decode(e){const{Err:t}=hd;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return cu(e)}},toSig(e){const{Err:t,_int:i,_tlv:r}=hd,s=du("signature",e),{v:n,l:o}=r.decode(48,s);if(o.length)throw new t("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,n),{v:h,l:l}=r.decode(2,c);if(l.length)throw new t("invalid signature: left bytes after parsing");return{r:i.decode(a),s:i.decode(h)}},hexFromSig(e){const{_tlv:t,_int:i}=hd,r=t.encode(2,i.encode(e.r))+t.encode(2,i.encode(e.s));return t.encode(48,r)}},ld=BigInt(0),ud=BigInt(1),dd=BigInt(2),fd=BigInt(3),pd=BigInt(4);function gd(e,t,i){const{BYTES:r}=e;return function(s){let n;if("bigint"==typeof s)n=s;else{let i=du("private key",s);if(t){if(!t.includes(2*i.length))throw new Error("invalid private key");const e=new Uint8Array(r);e.set(i,e.length-i.length),i=e}try{n=e.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof s}`)}}if(i&&(n=e.create(n)),!e.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}}function yd(e,t={}){const{Fp:i,Fn:r}=function(e,t,i={}){if(!t||"object"!=typeof t)throw new Error(`expected valid ${e} CURVE object`);for(const o of["p","n","h"]){const e=t[o];if(!("bigint"==typeof e&&e>Du))throw new Error(`CURVE.${o} must be positive bigint`)}const r=Gu(t.p,i.Fp),s=Gu(t.n,i.Fn),n=["Gx","Gy","a","weierstrass"===e?"b":"d"];for(const o of n)if(!r.isValid(t[o]))throw new Error(`CURVE.${o} must be valid field element of CURVE.Fp`);return{Fp:r,Fn:s}}("weierstrass",e,t),{h:s,n:n}=e;yu(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:o}=t;if(o&&(!i.is0(e.a)||"bigint"!=typeof o.beta||"function"!=typeof o.splitScalar))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}const c=t.toBytes||function(e,t,r){const{x:s,y:n}=t.toAffine(),o=i.toBytes(s);if(nu("isCompressed",r),r){a();return Vc(wd(!i.isOdd(n)),o)}return Vc(Uint8Array.of(4),o,i.toBytes(n))},h=t.fromBytes||function(e){Ec(e);const t=i.BYTES,r=t+1,s=2*t+1,n=e.length,o=e[0],c=e.subarray(1);if(n!==r||2!==o&&3!==o){if(n===s&&4===o){const e=i.fromBytes(c.subarray(0*t,1*t)),r=i.fromBytes(c.subarray(1*t,2*t));if(!u(e,r))throw new Error("bad point: is not on curve");return{x:e,y:r}}throw new Error(`bad point: got length ${n}, expected compressed=${r} or uncompressed=${s}`)}{const e=i.fromBytes(c);if(!i.isValid(e))throw new Error("bad point: is not on curve, wrong x");const t=l(e);let r;try{r=i.sqrt(t)}catch(h){const e=h instanceof Error?": "+h.message:"";throw new Error("bad point: is not on curve, sqrt error"+e)}a();return!(1&~o)!==i.isOdd(r)&&(r=i.neg(r)),{x:e,y:r}}},l=function(e,t,i){return function(r){const s=e.sqr(r),n=e.mul(s,r);return e.add(e.add(n,e.mul(r,t)),i)}}(i,e.a,e.b);function u(e,t){const r=i.sqr(t),s=l(e);return i.eql(r,s)}if(!u(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const d=i.mul(i.pow(e.a,fd),pd),f=i.mul(i.sqr(e.b),BigInt(27));if(i.is0(i.add(d,f)))throw new Error("bad curve params: a or b");function p(e,t,r=!1){if(!i.isValid(t)||r&&i.is0(t))throw new Error(`bad point coordinate ${e}`);return t}function g(e){if(!(e instanceof b))throw new Error("ProjectivePoint expected")}const y=wu((e,t)=>{const{px:r,py:s,pz:n}=e;if(i.eql(n,i.ONE))return{x:r,y:s};const o=e.is0();null==t&&(t=o?i.ONE:i.inv(n));const a=i.mul(r,t),c=i.mul(s,t),h=i.mul(n,t);if(o)return{x:i.ZERO,y:i.ZERO};if(!i.eql(h,i.ONE))throw new Error("invZ was invalid");return{x:a,y:c}}),w=wu(e=>{if(e.is0()){if(t.allowInfinityPoint&&!i.is0(e.py))return;throw new Error("bad point: ZERO")}const{x:r,y:s}=e.toAffine();if(!i.isValid(r)||!i.isValid(s))throw new Error("bad point: x or y not field elements");if(!u(r,s))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function m(e,t,r,s,n){return r=new b(i.mul(r.px,e),r.py,r.pz),t=$u(s,t),r=$u(n,r),t.add(r)}class b{constructor(e,t,i){this.px=p("x",e),this.py=p("y",t,!0),this.pz=p("z",i),Object.freeze(this)}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!i.isValid(t)||!i.isValid(r))throw new Error("invalid affine point");if(e instanceof b)throw new Error("projective point not allowed");return i.is0(t)&&i.is0(r)?b.ZERO:new b(t,r,i.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){return function(e,t,i){const r="pz"===t?e=>e.pz:e=>e.ez,s=Uu(e.Fp,i.map(r));return i.map((e,t)=>e.toAffine(s[t])).map(e.fromAffine)}(b,"pz",e)}static fromBytes(e){return Ec(e),b.fromHex(e)}static fromHex(e){const t=b.fromAffine(h(du("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){const i=gd(r,t.allowedPrivateKeyLengths,t.wrapPrivateKey);return b.BASE.multiply(i(e))}static msm(e,t){return Wu(b,r,e,t)}precompute(e=8,t=!0){return E.setWindowSize(this,e),t||this.multiply(fd),this}_setWindowSize(e){this.precompute(e)}assertValidity(){w(this)}hasEvenY(){const{y:e}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd(e)}equals(e){g(e);const{px:t,py:r,pz:s}=this,{px:n,py:o,pz:a}=e,c=i.eql(i.mul(t,a),i.mul(n,s)),h=i.eql(i.mul(r,a),i.mul(o,s));return c&&h}negate(){return new b(this.px,i.neg(this.py),this.pz)}double(){const{a:t,b:r}=e,s=i.mul(r,fd),{px:n,py:o,pz:a}=this;let c=i.ZERO,h=i.ZERO,l=i.ZERO,u=i.mul(n,n),d=i.mul(o,o),f=i.mul(a,a),p=i.mul(n,o);return p=i.add(p,p),l=i.mul(n,a),l=i.add(l,l),c=i.mul(t,l),h=i.mul(s,f),h=i.add(c,h),c=i.sub(d,h),h=i.add(d,h),h=i.mul(c,h),c=i.mul(p,c),l=i.mul(s,l),f=i.mul(t,f),p=i.sub(u,f),p=i.mul(t,p),p=i.add(p,l),l=i.add(u,u),u=i.add(l,u),u=i.add(u,f),u=i.mul(u,p),h=i.add(h,u),f=i.mul(o,a),f=i.add(f,f),u=i.mul(f,p),c=i.sub(c,u),l=i.mul(f,d),l=i.add(l,l),l=i.add(l,l),new b(c,h,l)}add(t){g(t);const{px:r,py:s,pz:n}=this,{px:o,py:a,pz:c}=t;let h=i.ZERO,l=i.ZERO,u=i.ZERO;const d=e.a,f=i.mul(e.b,fd);let p=i.mul(r,o),y=i.mul(s,a),w=i.mul(n,c),m=i.add(r,s),v=i.add(o,a);m=i.mul(m,v),v=i.add(p,y),m=i.sub(m,v),v=i.add(r,n);let E=i.add(o,c);return v=i.mul(v,E),E=i.add(p,w),v=i.sub(v,E),E=i.add(s,n),h=i.add(a,c),E=i.mul(E,h),h=i.add(y,w),E=i.sub(E,h),u=i.mul(d,v),h=i.mul(f,w),u=i.add(h,u),h=i.sub(y,u),u=i.add(y,u),l=i.mul(h,u),y=i.add(p,p),y=i.add(y,p),w=i.mul(d,w),v=i.mul(f,v),y=i.add(y,w),w=i.sub(p,w),w=i.mul(d,w),v=i.add(v,w),p=i.mul(y,v),l=i.add(l,p),p=i.mul(E,v),h=i.mul(m,h),h=i.sub(h,p),p=i.mul(m,y),u=i.mul(E,u),u=i.add(u,p),new b(h,l,u)}subtract(e){return this.add(e.negate())}is0(){return this.equals(b.ZERO)}multiply(e){const{endo:i}=t;if(!r.isValidNot0(e))throw new Error("invalid scalar: out of range");let s,n;const o=e=>E.wNAFCached(this,e,b.normalizeZ);if(i){const{k1neg:t,k1:r,k2neg:a,k2:c}=i.splitScalar(e),{p:h,f:l}=o(r),{p:u,f:d}=o(c);n=l.add(d),s=m(i.beta,h,u,t,a)}else{const{p:t,f:i}=o(e);s=t,n=i}return b.normalizeZ([s,n])[0]}multiplyUnsafe(e){const{endo:i}=t,s=this;if(!r.isValid(e))throw new Error("invalid scalar: out of range");if(e===ld||s.is0())return b.ZERO;if(e===ud)return s;if(E.hasPrecomputes(this))return this.multiply(e);if(i){const{k1neg:t,k1:r,k2neg:n,k2:o}=i.splitScalar(e),{p1:a,p2:c}=function(e,t,i,r){let s=t,n=e.ZERO,o=e.ZERO;for(;i>Du||r>Du;)i&Lu&&(n=n.add(s)),r&Lu&&(o=o.add(s)),s=s.double(),i>>=Lu,r>>=Lu;return{p1:n,p2:o}}(b,s,r,o);return m(i.beta,a,c,t,n)}return E.wNAFCachedUnsafe(s,e)}multiplyAndAddUnsafe(e,t,i){const r=this.multiplyUnsafe(t).add(e.multiplyUnsafe(i));return r.is0()?void 0:r}toAffine(e){return y(this,e)}isTorsionFree(){const{isTorsionFree:e}=t;return s===ud||(e?e(b,this):E.wNAFCachedUnsafe(this,n).is0())}clearCofactor(){const{clearCofactor:e}=t;return s===ud?this:e?e(b,this):this.multiplyUnsafe(s)}toBytes(e=!0){return nu("isCompressed",e),this.assertValidity(),c(b,this,e)}toRawBytes(e=!0){return this.toBytes(e)}toHex(e=!0){return kc(this.toBytes(e))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}b.BASE=new b(e.Gx,e.Gy,i.ONE),b.ZERO=new b(i.ZERO,i.ONE,i.ZERO),b.Fp=i,b.Fn=r;const v=r.BITS,E=function(e,t){return{constTimeNegate:$u,hasPrecomputes:e=>1!==Vu(e),unsafeLadder(t,i,r=e.ZERO){let s=t;for(;i>Du;)i&Lu&&(r=r.add(s)),s=s.double(),i>>=Lu;return r},precomputeWindow(e,i){const{windows:r,windowSize:s}=qu(i,t),n=[];let o=e,a=o;for(let t=0;t<r;t++){a=o,n.push(a);for(let e=1;e<s;e++)a=a.add(o),n.push(a);o=a.double()}return n},wNAF(i,r,s){let n=e.ZERO,o=e.BASE;const a=qu(i,t);for(let e=0;e<a.windows;e++){const{nextN:t,offset:i,isZero:c,isNeg:h,isNegF:l,offsetF:u}=zu(s,e,a);s=t,c?o=o.add($u(l,r[u])):n=n.add($u(h,r[i]))}return Ku(s),{p:n,f:o}},wNAFUnsafe(i,r,s,n=e.ZERO){const o=qu(i,t);for(let e=0;e<o.windows&&s!==Du;e++){const{nextN:t,offset:i,isZero:a,isNeg:c}=zu(s,e,o);if(s=t,!a){const e=r[i];n=n.add(c?e.negate():e)}}return Ku(s),n},getPrecomputes(e,t,i){let r=Hu.get(t);return r||(r=this.precomputeWindow(t,e),1!==e&&("function"==typeof i&&(r=i(r)),Hu.set(t,r))),r},wNAFCached(e,t,i){const r=Vu(e);return this.wNAF(r,this.getPrecomputes(r,e,i),t)},wNAFCachedUnsafe(e,t,i,r){const s=Vu(e);return 1===s?this.unsafeLadder(e,t,r):this.wNAFUnsafe(s,this.getPrecomputes(s,e,i),t,r)},setWindowSize(e,i){Mu(i,t),Fu.set(e,i),Hu.delete(e)}}}(b,t.endo?Math.ceil(v/2):v);return b}function wd(e){return Uint8Array.of(e?2:3)}function md(e,t,i={}){yu(t,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=t.randomBytes||Gc,s=t.hmac||((e,...i)=>Ql(t.hash,e,Vc(...i))),{Fp:n,Fn:o}=e,{ORDER:a,BITS:c}=o;function h(e){return e>a>>ud}function l(e,t){if(!o.isValidNot0(t))throw new Error(`invalid signature ${e}: out of range 1..CURVE.n`)}class u{constructor(e,t,i){l("r",e),l("s",t),this.r=e,this.s=t,null!=i&&(this.recovery=i),Object.freeze(this)}static fromCompact(e){const t=o.BYTES,i=du("compactSignature",e,2*t);return new u(o.fromBytes(i.subarray(0,t)),o.fromBytes(i.subarray(t,2*t)))}static fromDER(e){const{r:t,s:i}=hd.toSig(du("DER",e));return new u(t,i)}assertValidity(){}addRecoveryBit(e){return new u(this.r,this.s,e)}recoverPublicKey(t){const i=n.ORDER,{r:r,s:s,recovery:c}=this;if(null==c||![0,1,2,3].includes(c))throw new Error("recovery id invalid");if(a*dd<i&&c>1)throw new Error("recovery id is ambiguous for h>1 curve");const h=2===c||3===c?r+a:r;if(!n.isValid(h))throw new Error("recovery id 2 or 3 invalid");const l=n.toBytes(h),u=e.fromHex(Vc(wd(!(1&c)),l)),d=o.inv(h),f=y(du("msgHash",t)),p=o.create(-f*d),g=o.create(s*d),w=e.BASE.multiplyUnsafe(p).add(u.multiplyUnsafe(g));if(w.is0())throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new u(this.r,o.neg(this.s),this.recovery):this}toBytes(e){if("compact"===e)return Vc(o.toBytes(this.r),o.toBytes(this.s));if("der"===e)return Hc(hd.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return kc(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return kc(this.toBytes("compact"))}}const d=gd(o,i.allowedPrivateKeyLengths,i.wrapPrivateKey),f={isValidPrivateKey(e){try{return d(e),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const e=a;return function(e,t,i=!1){const r=e.length,s=ku(t),n=ju(t);if(r<16||r<n||r>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+r);const o=Pu(i?hu(e):cu(e),t-bu)+bu;return i?uu(o,s):lu(o,s)}(r(ju(e)),e)},precompute:(t=8,i=e.BASE)=>i.precompute(t,!1)};function p(t){if("bigint"==typeof t)return!1;if(t instanceof e)return!0;const r=du("key",t).length,s=n.BYTES,a=s+1,c=2*s+1;return i.allowedPrivateKeyLengths||o.BYTES===a?void 0:r===a||r===c}const g=t.bits2int||function(e){if(e.length>8192)throw new Error("input is too large");const t=cu(e),i=8*e.length-c;return i>0?t>>BigInt(i):t},y=t.bits2int_modN||function(e){return o.create(g(e))},w=gu(c);function m(e){return pu("num < 2^"+c,e,ld,w),o.toBytes(e)}function b(i,s,a=v){if(["recovered","canonical"].some(e=>e in a))throw new Error("sign() legacy options not supported");const{hash:c}=t;let{lowS:l,prehash:f,extraEntropy:p}=a;null==l&&(l=!0),i=du("msgHash",i),ad(a),f&&(i=du("prehashed msgHash",c(i)));const w=y(i),b=d(s),E=[m(b),m(w)];if(null!=p&&!1!==p){const e=!0===p?r(n.BYTES):p;E.push(du("extraEntropy",e))}const I=Vc(...E),x=w;return{seed:I,k2sig:function(t){const i=g(t);if(!o.isValidNot0(i))return;const r=o.inv(i),s=e.BASE.multiply(i).toAffine(),n=o.create(s.x);if(n===ld)return;const a=o.create(r*o.create(x+n*b));if(a===ld)return;let c=(s.x===n?0:2)|Number(s.y&ud),d=a;return l&&h(a)&&(d=function(e){return h(e)?o.neg(e):e}(a),c^=1),new u(n,d,c)}}}const v={lowS:t.lowS,prehash:!1},E={lowS:t.lowS,prehash:!1};return e.BASE.precompute(8),Object.freeze({getPublicKey:function(t,i=!0){return e.fromPrivateKey(t).toBytes(i)},getSharedSecret:function(t,i,r=!0){if(!0===p(t))throw new Error("first arg must be private key");if(!1===p(i))throw new Error("second arg must be public key");return e.fromHex(i).multiply(d(t)).toBytes(r)},sign:function(e,i,r=v){const{seed:n,k2sig:a}=b(e,i,r);return function(e,t,i){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof i)throw new Error("hmacFn must be a function");const r=e=>new Uint8Array(e),s=e=>Uint8Array.of(e);let n=r(e),o=r(e),a=0;const c=()=>{n.fill(1),o.fill(0),a=0},h=(...e)=>i(o,n,...e),l=(e=r(0))=>{o=h(s(0),e),n=h(),0!==e.length&&(o=h(s(1),e),n=h())},u=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const i=[];for(;e<t;){n=h();const t=n.slice();i.push(t),e+=n.length}return Vc(...i)};return(e,t)=>{let i;for(c(),l(e);!(i=t(u()));)l();return c(),i}}(t.hash.outputLen,o.BYTES,s)(n,a)},verify:function(i,r,s,n=E){const a=i;r=du("msgHash",r),s=du("publicKey",s),ad(n);const{lowS:c,prehash:h,format:l}=n;if("strict"in n)throw new Error("options.strict was renamed to lowS");if(void 0!==l&&!["compact","der","js"].includes(l))throw new Error('format must be "compact", "der" or "js"');const d="string"==typeof a||bc(a),f=!d&&!l&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!d&&!f)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let p,g;try{if(f){if(void 0!==l&&"js"!==l)throw new Error("invalid format");p=new u(a.r,a.s)}if(d){try{"compact"!==l&&(p=u.fromDER(a))}catch(P){if(!(P instanceof hd.Err))throw P}!p&&"der"!==l&&(p=u.fromCompact(a))}g=e.fromHex(s)}catch{return!1}if(!p||c&&p.hasHighS())return!1;h&&(r=t.hash(r));const{r:w,s:m}=p,b=y(r),v=o.inv(m),I=o.create(b*v),x=o.create(w*v),S=e.BASE.multiplyUnsafe(I).add(g.multiplyUnsafe(x));return!S.is0()&&o.create(S.x)===w},utils:f,Point:e,Signature:u})}function bd(e){const{CURVE:t,curveOpts:i}=function(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy};return{CURVE:t,curveOpts:{Fp:e.Fp,Fn:Bu(t.n,e.nBitLength),allowedPrivateKeyLengths:e.allowedPrivateKeyLengths,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,wrapPrivateKey:e.wrapPrivateKey,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes}}}(e);return{CURVE:t,curveOpts:i,ecdsaOpts:{hash:e.hash,hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN}}}function vd(e){const{CURVE:t,curveOpts:i,ecdsaOpts:r}=bd(e);return function(e,t){return Object.assign({},t,{ProjectivePoint:t.Point,CURVE:e})}(e,md(yd(t,i),r,i))}function Ed(e,t){const i=t=>vd({...e,hash:t});return{...i(t),create:i}}const Id={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},xd={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Sd={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},Pd=Bu(Id.p),Od=Bu(xd.p),_d=Bu(Sd.p),Ad=Ed({...Id,Fp:Pd,lowS:!1},Uh);Ed({...xd,Fp:Od,lowS:!1},Bh),Ed({...Sd,Fp:_d,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},Rh);const Td=Ad,Cd="base10",Nd="base16",Ud="base64pad",Rd="base64url",Bd="utf8";function kd(){return To(Gc(32),Nd)}function jd(e){return To(iu(Ao(e,Nd)),Nd)}function Dd(e){return To(iu(Ao(e,Bd)),Nd)}function Ld(e){return Ao(`${e}`,Cd)}function $d(e){return Number(To(e,Cd))}function Md(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function qd(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),i=(4-t.length%4)%4;return t+"=".repeat(i)}function zd(e){if(2===$d(e.type))return To(Tn([e.type,e.sealed]),Ud);if(1===$d(e.type)){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return To(Tn([e.type,e.senderPublicKey,e.iv,e.sealed]),Ud)}return To(Tn([e.type,e.iv,e.sealed]),Ud)}function Hd(e){const t=Ao((e.encoding||Ud)===Rd?qd(e.encoded):e.encoded,Ud),i=t.slice(0,1);if(1===$d(i)){const e=33,r=e+12,s=t.slice(1,e),n=t.slice(e,r);return{type:i,sealed:t.slice(r),iv:n,senderPublicKey:s}}if(2===$d(i)){return{type:i,sealed:t.slice(1),iv:Gc(12)}}const r=t.slice(1,13);return{type:i,sealed:t.slice(13),iv:r}}function Fd(e){const t=(null==e?void 0:e.type)||0;if(1===t){if(typeof(null==e?void 0:e.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(null==e?void 0:e.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:null==e?void 0:e.senderPublicKey,receiverPublicKey:null==e?void 0:e.receiverPublicKey}}function Vd(e){return 1===e.type&&"string"==typeof e.senderPublicKey&&"string"==typeof e.receiverPublicKey}function Kd(e){return 2===e.type}function Wd(e,t){const[i,r,s]=e.split("."),n=Buffer.from(qd(s),"base64");if(64!==n.length)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=iu(`${i}.${r}`),h=function(e){const t=Buffer.from(e.x,"base64"),i=Buffer.from(e.y,"base64");return Tn([new Uint8Array([4]),t,i])}(t);if(!Td.verify(Tn([o,a]),c,h))throw new Error("Invalid signature");return Sn(e).payload}function Gd(e){return(null==e?void 0:e.relay)||{protocol:"irn"}}function Yd(e){const t=Co[e];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${e}`);return t}function Jd(e,t="-"){const i={},r="relay"+t;return Object.keys(e).forEach(t=>{if(t.startsWith(r)){const s=t.replace(r,""),n=e[t];i[s]=n}}),i}function Zd(e){if(!e.includes("wc:")){const t=Za(e);null!=t&&t.includes("wc:")&&(e=t)}const t=(e=(e=e.includes("wc://")?e.replace("wc://",""):e).includes("wc:")?e.replace("wc:",""):e).indexOf(":"),i=-1!==e.indexOf("?")?e.indexOf("?"):void 0,r=e.substring(0,t),s=e.substring(t+1,i).split("@"),n=typeof i<"u"?e.substring(i):"",o=new URLSearchParams(n),a={};o.forEach((e,t)=>{a[t]=e});const c="string"==typeof a.methods?a.methods.split(","):void 0;return{protocol:r,topic:Qd(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:Jd(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function Qd(e){return e.startsWith("//")?e.substring(2):e}function Xd(e){const t=new URLSearchParams,i=function(e,t="-"){const i={};return Object.keys(e).forEach(r=>{const s=r,n="relay"+t+s;e[s]&&(i[n]=e[s])}),i}(e.relay);Object.keys(i).sort().forEach(e=>{t.set(e,i[e])}),t.set("symKey",e.symKey),e.expiryTimestamp&&t.set("expiryTimestamp",e.expiryTimestamp.toString()),e.methods&&t.set("methods",e.methods.join(","));const r=t.toString();return`${e.protocol}:${e.topic}@${e.version}?${r}`}function ef(e,t,i){return`${e}?wc_ev=${i}&topic=${t}`}var tf=Object.defineProperty,rf=Object.defineProperties,sf=Object.getOwnPropertyDescriptors,nf=Object.getOwnPropertySymbols,of=Object.prototype.hasOwnProperty,af=Object.prototype.propertyIsEnumerable,cf=(e,t,i)=>t in e?tf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,hf=(e,t)=>{for(var i in t||(t={}))of.call(t,i)&&cf(e,i,t[i]);if(nf)for(var i of nf(t))af.call(t,i)&&cf(e,i,t[i]);return e},lf=(e,t)=>rf(e,sf(t));function uf(e){const t=[];return e.forEach(e=>{const[i,r]=e.split(":");t.push(`${i}:${r}`)}),t}function df(e){return e.includes(":")}function ff(e){return df(e)?e.split(":")[0]:e}function pf(e){var t,i,r;const s={};if(!Ef(e))return s;for(const[n,o]of Object.entries(e)){const e=df(n)?[n]:o.chains,a=o.methods||[],c=o.events||[],h=ff(n);s[h]=lf(hf({},s[h]),{chains:Ka(e,null==(t=s[h])?void 0:t.chains),methods:Ka(a,null==(i=s[h])?void 0:i.methods),events:Ka(c,null==(r=s[h])?void 0:r.events)})}return s}function gf(e,t){const i=function(e){const t={};return null==e||e.forEach(e=>{var i;const[r,s]=e.split(":");t[r]||(t[r]={accounts:[],chains:[],events:[],methods:[]}),t[r].accounts.push(e),null==(i=t[r].chains)||i.push(`${r}:${s}`)}),t}(t=t.map(e=>e.replace("did:pkh:","")));for(const[r,s]of Object.entries(i))s.methods?s.methods=Ka(s.methods,e):s.methods=e,s.events=["chainChanged","accountsChanged"];return i}const yf={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},wf={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function mf(e,t){const{message:i,code:r}=wf[e];return{message:t?`${i} ${t}`:i,code:r}}function bf(e,t){const{message:i,code:r}=yf[e];return{message:t?`${i} ${t}`:i,code:r}}function vf(e,t){return!!Array.isArray(e)&&(!(typeof t<"u"&&e.length)||e.every(t))}function Ef(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function If(e){return typeof e>"u"}function xf(e,t){return!(!t||!If(e))||"string"==typeof e&&!!e.trim().length}function Sf(e,t){return!(!t||!If(e))||"number"==typeof e&&!isNaN(e)}function Pf(e){return!(!xf(e,!1)||!e.includes(":"))&&2===e.split(":").length}function Of(e){let t=!0;return vf(e)?e.length&&(t=e.every(e=>xf(e,!1))):t=!1,t}function _f(e,t,i){let r=null;return Object.entries(e).forEach(([e,s])=>{if(r)return;const n=function(e,t,i){let r=null;return vf(t)&&t.length?t.forEach(e=>{r||Pf(e)||(r=bf("UNSUPPORTED_CHAINS",`${i}, chain ${e} should be a string and conform to "namespace:chainId" format`))}):Pf(e)||(r=bf("UNSUPPORTED_CHAINS",`${i}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}(e,da(e,s),`${t} ${i}`);n&&(r=n)}),r}function Af(e,t){let i=null;return vf(e)?e.forEach(e=>{i||function(e){if(xf(e,!1)&&e.includes(":")){const t=e.split(":");if(3===t.length){const e=t[0]+":"+t[1];return!!t[2]&&Pf(e)}}return!1}(e)||(i=bf("UNSUPPORTED_ACCOUNTS",`${t}, account ${e} should be a string and conform to "namespace:chainId:address" format`))}):i=bf("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),i}function Tf(e,t){let i=null;return Object.values(e).forEach(e=>{if(i)return;const r=function(e,t){let i=null;return Of(null==e?void 0:e.methods)?Of(null==e?void 0:e.events)||(i=bf("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):i=bf("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),i}(e,`${t}, namespace`);r&&(i=r)}),i}function Cf(e,t){let i=null;if(e&&Ef(e)){const r=Tf(e,t);r&&(i=r);const s=function(e,t){let i=null;return Object.values(e).forEach(e=>{if(i)return;const r=Af(null==e?void 0:e.accounts,`${t} namespace`);r&&(i=r)}),i}(e,t);s&&(i=s)}else i=mf("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return i}function Nf(e){return xf(e.protocol,!0)}function Uf(e){return typeof e<"u"&&null!==typeof e}function Rf(e,t){return!(!Pf(t)||!function(e){const t=[];return Object.values(e).forEach(e=>{t.push(...uf(e.accounts))}),t}(e).includes(t))}function Bf(e,t,i){return!!xf(i,!1)&&function(e,t){const i=[];return Object.values(e).forEach(e=>{uf(e.accounts).includes(t)&&i.push(...e.methods)}),i}(e,t).includes(i)}function kf(e,t,i){return!!xf(i,!1)&&function(e,t){const i=[];return Object.values(e).forEach(e=>{uf(e.accounts).includes(t)&&i.push(...e.events)}),i}(e,t).includes(i)}function jf(e,t,i){let r=null;const s=function(e){const t={};return Object.keys(e).forEach(i=>{var r;i.includes(":")?t[i]=e[i]:null==(r=e[i].chains)||r.forEach(r=>{t[r]={methods:e[i].methods,events:e[i].events}})}),t}(e),n=function(e){const t={};return Object.keys(e).forEach(i=>{if(i.includes(":"))t[i]=e[i];else{const r=uf(e[i].accounts);null==r||r.forEach(r=>{t[r]={accounts:e[i].accounts.filter(e=>e.includes(`${r}:`)),methods:e[i].methods,events:e[i].events}})}}),t}(t),o=Object.keys(s),a=Object.keys(n),c=Df(Object.keys(e)),h=Df(Object.keys(t)),l=c.filter(e=>!h.includes(e));return l.length&&(r=mf("NON_CONFORMING_NAMESPACES",`${i} namespaces keys don't satisfy requiredNamespaces.\n      Required: ${l.toString()}\n      Received: ${Object.keys(t).toString()}`)),ja(o,a)||(r=mf("NON_CONFORMING_NAMESPACES",`${i} namespaces chains don't satisfy required namespaces.\n      Required: ${o.toString()}\n      Approved: ${a.toString()}`)),Object.keys(t).forEach(e=>{if(!e.includes(":")||r)return;const s=uf(t[e].accounts);s.includes(e)||(r=mf("NON_CONFORMING_NAMESPACES",`${i} namespaces accounts don't satisfy namespace accounts for ${e}\n        Required: ${e}\n        Approved: ${s.toString()}`))}),o.forEach(e=>{r||(ja(s[e].methods,n[e].methods)?ja(s[e].events,n[e].events)||(r=mf("NON_CONFORMING_NAMESPACES",`${i} namespaces events don't satisfy namespace events for ${e}`)):r=mf("NON_CONFORMING_NAMESPACES",`${i} namespaces methods don't satisfy namespace methods for ${e}`))}),r}function Df(e){return[...new Set(e.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Lf(){const e=Ca();return new Promise(t=>{switch(e){case Sa:t(Ta()&&(null==navigator?void 0:navigator.onLine));break;case Ia:t(async function(){if(Aa()&&typeof global<"u"&&null!=global&&global.NetInfo){const e=await(null==global?void 0:global.NetInfo.fetch());return null==e?void 0:e.isConnected}return!0}());break;default:t(!0)}})}function $f(e){switch(Ca()){case Sa:!function(e){!Aa()&&Ta()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}(e);break;case Ia:!function(e){Aa()&&typeof global<"u"&&null!=global&&global.NetInfo&&(null==global||global.NetInfo.addEventListener(t=>e(null==t?void 0:t.isConnected)))}(e)}}const Mf={};class qf{static get(e){return Mf[e]}static set(e,t){Mf[e]=t}static delete(e){delete Mf[e]}}function zf({publicKey:e,signature:t,payload:i}){var r;const s=Hf(i.method),n=128|parseInt((null==(r=i.version)?void 0:r.toString())||"4"),o=function(e){const t=ut.decode(e)[0];return 42===t?0:60===t?2:1}(i.address),a="00"===i.era?new Uint8Array([0]):Hf(i.era);if(1!==a.length&&2!==a.length)throw new Error("Invalid era length");const c=parseInt(i.nonce,16),h=new Uint8Array([255&c,c>>8&255]),l=BigInt(`0x${function(e){return e.startsWith("0x")?e.slice(2):e}(i.tip)}`),u=function(e){if(e<BigInt(1)<<BigInt(6))return new Uint8Array([Number(e<<BigInt(2))]);if(e<BigInt(1)<<BigInt(14)){const t=e<<BigInt(2)|BigInt(1);return new Uint8Array([Number(t&BigInt(255)),Number(t>>BigInt(8)&BigInt(255))])}if(e<BigInt(1)<<BigInt(30)){const t=e<<BigInt(2)|BigInt(2);return new Uint8Array([Number(t&BigInt(255)),Number(t>>BigInt(8)&BigInt(255)),Number(t>>BigInt(16)&BigInt(255)),Number(t>>BigInt(24)&BigInt(255))])}throw new Error("BigInt compact encoding not supported > 2^30")}(l),d=new Uint8Array([0,...e,o,...t,...a,...h,...u,...s]),f=function(e){if(e<64)return new Uint8Array([e<<2]);if(e<16384){const t=e<<2|1;return new Uint8Array([255&t,t>>8&255])}if(e<1<<30){const t=e<<2|2;return new Uint8Array([255&t,t>>8&255,t>>16&255,t>>24&255])}throw new Error("Compact encoding > 2^30 not supported")}(d.length+1);return new Uint8Array([...f,n,...d])}function Hf(e){return new Uint8Array(e.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function Ff(e){const t=Uint8Array.from(Buffer.from(e.signature,"hex")),i=function(e){const t=ut.decode(e);if(t.length<33)throw new Error("Too short to contain a public key");return t.slice(1,33)}(e.transaction.address),r=zf({publicKey:i,signature:t,payload:e.transaction});return function(e){const t=Hf(e),i=ha.blake2b(t,void 0,32);return"0x"+Buffer.from(i).toString("hex")}(Buffer.from(r).toString("hex"))}class Vf{}let Kf=class extends Vf{constructor(e){super()}};const Wf=w.FIVE_SECONDS,Gf={pulse:"heartbeat_pulse"};let Yf=class e extends Kf{constructor(e){super(e),this.events=new s.EventEmitter,this.interval=Wf,this.interval=(null==e?void 0:e.interval)||Wf}static async init(t){const i=new e(t);return await i.init(),i}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),w.toMiliseconds(this.interval))}pulse(){this.events.emit(Gf.pulse)}};const Jf=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Zf=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Qf=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Xf(e,t){if(!("__proto__"===e||"constructor"===e&&t&&"object"==typeof t&&"prototype"in t))return t;!function(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}(e)}function ep(e,t={}){if("string"!=typeof e)return e;if('"'===e[0]&&'"'===e[e.length-1]&&-1===e.indexOf("\\"))return e.slice(1,-1);const i=e.trim();if(i.length<=9)switch(i.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Qf.test(e)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(Jf.test(e)||Zf.test(e)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,Xf)}return JSON.parse(e)}catch(r){if(t.strict)throw r;return e}}function tp(e,...t){try{return(i=e(...t))&&"function"==typeof i.then?i:Promise.resolve(i)}catch(r){return Promise.reject(r)}var i}function ip(e){if(function(e){const t=typeof e;return null===e||"object"!==t&&"function"!==t}(e))return String(e);if(function(e){const t=Object.getPrototypeOf(e);return!t||t.isPrototypeOf(Object)}(e)||Array.isArray(e))return JSON.stringify(e);if("function"==typeof e.toJSON)return ip(e.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const rp="base64:";function sp(e){return"string"==typeof e?e:rp+function(e){if(globalThis.Buffer)return Buffer.from(e).toString("base64");return globalThis.btoa(String.fromCodePoint(...e))}(e)}function np(e){return"string"!=typeof e?e:e.startsWith(rp)?function(e){if(globalThis.Buffer)return Buffer.from(e,"base64");return Uint8Array.from(globalThis.atob(e),e=>e.codePointAt(0))}(e.slice(7)):e}function op(e){var t;return e&&(null==(t=e.split("?")[0])?void 0:t.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function ap(...e){return op(e.join(":"))}function cp(e){return(e=op(e))?e+":":""}const hp=()=>{const e=new Map;return{name:"memory",getInstance:()=>e,hasItem:t=>e.has(t),getItem:t=>e.get(t)??null,getItemRaw:t=>e.get(t)??null,setItem(t,i){e.set(t,i)},setItemRaw(t,i){e.set(t,i)},removeItem(t){e.delete(t)},getKeys:()=>[...e.keys()],clear(){e.clear()},dispose(){e.clear()}}};function lp(e={}){const t={mounts:{"":e.driver||hp()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},i=e=>{for(const i of t.mountpoints)if(e.startsWith(i))return{base:i,relativeKey:e.slice(i.length),driver:t.mounts[i]};return{base:"",relativeKey:e,driver:t.mounts[""]}},r=(e,i)=>t.mountpoints.filter(t=>t.startsWith(e)||i&&e.startsWith(t)).map(i=>({relativeBase:e.length>i.length?e.slice(i.length):void 0,mountpoint:i,driver:t.mounts[i]})),s=(e,i)=>{if(t.watching){i=op(i);for(const r of t.watchListeners)r(e,i)}},n=async()=>{if(t.watching){for(const e in t.unwatch)await t.unwatch[e]();t.unwatch={},t.watching=!1}},o=(e,t,r)=>{const s=new Map,n=e=>{let t=s.get(e.base);return t||(t={driver:e.driver,base:e.base,items:[]},s.set(e.base,t)),t};for(const o of e){const e="string"==typeof o,r=op(e?o:o.key),s=e?void 0:o.value,a=e||!o.options?t:{...t,...o.options},c=i(r);n(c).items.push({key:r,value:s,relativeKey:c.relativeKey,options:a})}return Promise.all([...s.values()].map(e=>r(e))).then(e=>e.flat())},a={hasItem(e,t={}){e=op(e);const{relativeKey:r,driver:s}=i(e);return tp(s.hasItem,r,t)},getItem(e,t={}){e=op(e);const{relativeKey:r,driver:s}=i(e);return tp(s.getItem,r,t).then(e=>ep(e))},getItems:(e,t={})=>o(e,t,e=>e.driver.getItems?tp(e.driver.getItems,e.items.map(e=>({key:e.relativeKey,options:e.options})),t).then(t=>t.map(t=>({key:ap(e.base,t.key),value:ep(t.value)}))):Promise.all(e.items.map(t=>tp(e.driver.getItem,t.relativeKey,t.options).then(e=>({key:t.key,value:ep(e)}))))),getItemRaw(e,t={}){e=op(e);const{relativeKey:r,driver:s}=i(e);return s.getItemRaw?tp(s.getItemRaw,r,t):tp(s.getItem,r,t).then(e=>np(e))},async setItem(e,t,r={}){if(void 0===t)return a.removeItem(e);e=op(e);const{relativeKey:n,driver:o}=i(e);o.setItem&&(await tp(o.setItem,n,ip(t),r),o.watch||s("update",e))},async setItems(e,t){await o(e,t,async e=>{if(e.driver.setItems)return tp(e.driver.setItems,e.items.map(e=>({key:e.relativeKey,value:ip(e.value),options:e.options})),t);e.driver.setItem&&await Promise.all(e.items.map(t=>tp(e.driver.setItem,t.relativeKey,ip(t.value),t.options)))})},async setItemRaw(e,t,r={}){if(void 0===t)return a.removeItem(e,r);e=op(e);const{relativeKey:n,driver:o}=i(e);if(o.setItemRaw)await tp(o.setItemRaw,n,t,r);else{if(!o.setItem)return;await tp(o.setItem,n,sp(t),r)}o.watch||s("update",e)},async removeItem(e,t={}){"boolean"==typeof t&&(t={removeMeta:t}),e=op(e);const{relativeKey:r,driver:n}=i(e);n.removeItem&&(await tp(n.removeItem,r,t),(t.removeMeta||t.removeMata)&&await tp(n.removeItem,r+"$",t),n.watch||s("remove",e))},async getMeta(e,t={}){"boolean"==typeof t&&(t={nativeOnly:t}),e=op(e);const{relativeKey:r,driver:s}=i(e),n=Object.create(null);if(s.getMeta&&Object.assign(n,await tp(s.getMeta,r,t)),!t.nativeOnly){const e=await tp(s.getItem,r+"$",t).then(e=>ep(e));e&&"object"==typeof e&&("string"==typeof e.atime&&(e.atime=new Date(e.atime)),"string"==typeof e.mtime&&(e.mtime=new Date(e.mtime)),Object.assign(n,e))}return n},setMeta(e,t,i={}){return this.setItem(e+"$",t,i)},removeMeta(e,t={}){return this.removeItem(e+"$",t)},async getKeys(e,t={}){var i;e=cp(e);const s=r(e,!0);let n=[];const o=[];let a=!0;for(const r of s){(null==(i=r.driver.flags)?void 0:i.maxDepth)||(a=!1);const e=await tp(r.driver.getKeys,r.relativeBase,t);for(const t of e){const e=r.mountpoint+op(t);n.some(t=>e.startsWith(t))||o.push(e)}n=[r.mountpoint,...n.filter(e=>!e.startsWith(r.mountpoint))]}const c=void 0!==t.maxDepth&&!a;return o.filter(i=>(!c||function(e,t){if(void 0===t)return!0;let i=0,r=e.indexOf(":");for(;r>-1;)i++,r=e.indexOf(":",r+1);return i<=t}(i,t.maxDepth))&&function(e,t){return t?e.startsWith(t)&&"$"!==e[e.length-1]:"$"!==e[e.length-1]}(i,e))},async clear(e,t={}){e=cp(e),await Promise.all(r(e,!1).map(async e=>{if(e.driver.clear)return tp(e.driver.clear,e.relativeBase,t);if(e.driver.removeItem){const i=await e.driver.getKeys(e.relativeBase||"",t);return Promise.all(i.map(i=>e.driver.removeItem(i,t)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(e=>dp(e)))},watch:async e=>(await(async()=>{if(!t.watching){t.watching=!0;for(const e in t.mounts)t.unwatch[e]=await up(t.mounts[e],s,e)}})(),t.watchListeners.push(e),async()=>{t.watchListeners=t.watchListeners.filter(t=>t!==e),0===t.watchListeners.length&&await n()}),async unwatch(){t.watchListeners=[],await n()},mount(e,i){if((e=cp(e))&&t.mounts[e])throw new Error(`already mounted at ${e}`);return e&&(t.mountpoints.push(e),t.mountpoints.sort((e,t)=>t.length-e.length)),t.mounts[e]=i,t.watching&&Promise.resolve(up(i,s,e)).then(i=>{t.unwatch[e]=i}).catch(console.error),a},async unmount(e,i=!0){var r,s;(e=cp(e))&&t.mounts[e]&&(t.watching&&e in t.unwatch&&(null==(s=(r=t.unwatch)[e])||s.call(r),delete t.unwatch[e]),i&&await dp(t.mounts[e]),t.mountpoints=t.mountpoints.filter(t=>t!==e),delete t.mounts[e])},getMount(e=""){e=op(e)+":";const t=i(e);return{driver:t.driver,base:t.base}},getMounts(e="",t={}){e=op(e);return r(e,t.parents).map(e=>({driver:e.driver,base:e.mountpoint}))},keys:(e,t={})=>a.getKeys(e,t),get:(e,t={})=>a.getItem(e,t),set:(e,t,i={})=>a.setItem(e,t,i),has:(e,t={})=>a.hasItem(e,t),del:(e,t={})=>a.removeItem(e,t),remove:(e,t={})=>a.removeItem(e,t)};return a}function up(e,t,i){return e.watch?e.watch((e,r)=>t(e,i+r)):()=>{}}async function dp(e){"function"==typeof e.dispose&&await tp(e.dispose)}function fp(e){return new Promise((t,i)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>i(e.error)})}function pp(e,t){let i;return(r,s)=>(()=>{if(i)return i;const r=indexedDB.open(e);return r.onupgradeneeded=()=>r.result.createObjectStore(t),i=fp(r),i.then(e=>{e.onclose=()=>i=void 0},()=>{}),i})().then(e=>s(e.transaction(t,r).objectStore(t)))}let gp;function yp(){return gp||(gp=pp("keyval-store","keyval")),gp}function wp(e,t=yp()){return t("readonly",t=>fp(t.get(e)))}function mp(e=yp()){return e("readonly",e=>{if(e.getAllKeys)return fp(e.getAllKeys());const t=[];return function(e,t){return e.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},fp(e.transaction)}(e,e=>t.push(e.key)).then(()=>t)})}var bp=(e={})=>{const t=e.base&&e.base.length>0?`${e.base}:`:"",i=e=>t+e;let r;return e.dbName&&e.storeName&&(r=pp(e.dbName,e.storeName)),{name:"idb-keyval",options:e,hasItem:async e=>!(typeof(await wp(i(e),r))>"u"),getItem:async e=>await wp(i(e),r)??null,setItem:(e,t)=>function(e,t,i=yp()){return i("readwrite",i=>(i.put(t,e),fp(i.transaction)))}(i(e),t,r),removeItem:e=>function(e,t=yp()){return t("readwrite",t=>(t.delete(e),fp(t.transaction)))}(i(e),r),getKeys:()=>mp(r),clear:()=>function(e=yp()){return e("readwrite",e=>(e.clear(),fp(e.transaction)))}(r)}};let vp=class{constructor(){this.indexedDb=lp({driver:bp({dbName:"WALLET_CONNECT_V2_INDEXED_DB",storeName:"keyvaluestorage"})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(null!==t)return t}async setItem(e,t){await this.indexedDb.setItem(e,Xt(t))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Ep=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ip={exports:{}};function xp(e){var t;return[e[0],Qt(null!=(t=e[1])?t:"")]}!function(){let e;function t(){}e=t,e.prototype.getItem=function(e){return this.hasOwnProperty(e)?String(this[e]):null},e.prototype.setItem=function(e,t){this[e]=String(t)},e.prototype.removeItem=function(e){delete this[e]},e.prototype.clear=function(){const e=this;Object.keys(e).forEach(function(t){e[t]=void 0,delete e[t]})},e.prototype.key=function(e){return e=e||0,Object.keys(this)[e]},e.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Ep<"u"&&Ep.localStorage?Ip.exports=Ep.localStorage:typeof window<"u"&&window.localStorage?Ip.exports=window.localStorage:Ip.exports=new t}();let Sp=class{constructor(){this.localStorage=Ip.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(xp)}async getItem(e){const t=this.localStorage.getItem(e);if(null!==t)return Qt(t)}async setItem(e,t){this.localStorage.setItem(e,Xt(t))}async removeItem(e){this.localStorage.removeItem(e)}};const Pp=async(e,t)=>{t.length&&t.forEach(async t=>{await e.removeItem(t)})};let Op=class{constructor(){this.initialized=!1,this.setInitialized=e=>{this.storage=e,this.initialized=!0};const e=new Sp;this.storage=e;try{(async(e,t,i)=>{const r="wc_storage_version",s=await t.getItem(r);if(s&&s>=1)return void i(t);const n=await e.getKeys();if(!n.length)return void i(t);const o=[];for(;n.length;){const i=n.shift();if(!i)continue;const r=i.toLowerCase();if(r.includes("wc@")||r.includes("walletconnect")||r.includes("wc_")||r.includes("wallet_connect")){const r=await e.getItem(i);await t.setItem(i,r),o.push(i)}}await t.setItem(r,1),i(t),Pp(e,o)})(e,new vp,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};function _p(e){try{return JSON.stringify(e)}catch(dh){return'"[Circular]"'}}const Ap=function(e,t,i){var r=i&&i.stringify||_p;if("object"==typeof e&&null!==e){var s=t.length+1;if(1===s)return e;var n=new Array(s);n[0]=r(e);for(var o=1;o<s;o++)n[o]=r(t[o]);return n.join(" ")}if("string"!=typeof e)return e;var a=t.length;if(0===a)return e;for(var c="",h=0,l=-1,u=e&&e.length||0,d=0;d<u;){if(37===e.charCodeAt(d)&&d+1<u){switch(l=l>-1?l:0,e.charCodeAt(d+1)){case 100:case 102:if(h>=a)break;if(null==t[h])break;l<d&&(c+=e.slice(l,d)),c+=Number(t[h]),l=d+2,d++;break;case 105:if(h>=a)break;if(null==t[h])break;l<d&&(c+=e.slice(l,d)),c+=Math.floor(Number(t[h])),l=d+2,d++;break;case 79:case 111:case 106:if(h>=a)break;if(void 0===t[h])break;l<d&&(c+=e.slice(l,d));var f=typeof t[h];if("string"===f){c+="'"+t[h]+"'",l=d+2,d++;break}if("function"===f){c+=t[h].name||"<anonymous>",l=d+2,d++;break}c+=r(t[h]),l=d+2,d++;break;case 115:if(h>=a)break;l<d&&(c+=e.slice(l,d)),c+=String(t[h]),l=d+2,d++;break;case 37:l<d&&(c+=e.slice(l,d)),c+="%",l=d+2,d++,h--}++h}++d}if(-1===l)return e;l<u&&(c+=e.slice(l));return c};var Tp=Up;const Cp=function(){function e(e){return void 0!==e&&e}try{return"undefined"!=typeof globalThis||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(dh){return e(self)||e(window)||e(this)||{}}}().console||{},Np={mapHttpRequest:Lp,mapHttpResponse:Lp,wrapRequestSerializer:$p,wrapResponseSerializer:$p,wrapErrorSerializer:$p,req:Lp,res:Lp,err:function(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const i in e)void 0===t[i]&&(t[i]=e[i]);return t}};function Up(e){(e=e||{}).browser=e.browser||{};const t=e.browser.transmit;if(t&&"function"!=typeof t.send)throw Error("pino: transmit option must have a send function");const i=e.browser.write||Cp;e.browser.write&&(e.browser.asObject=!0);const r=e.serializers||{},s=function(e,t){if(Array.isArray(e))return e.filter(function(e){return"!stdSerializers.err"!==e});return!0===e&&Object.keys(t)}(e.browser.serialize,r);let n=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(n=!1);"function"==typeof i&&(i.error=i.fatal=i.warn=i.info=i.debug=i.trace=i),!1===e.enabled&&(e.level="silent");const o=e.level||"info",a=Object.create(i);a.log||(a.log=Mp),Object.defineProperty(a,"levelVal",{get:function(){return"silent"===this.level?1/0:this.levels.values[this.level]}}),Object.defineProperty(a,"level",{get:function(){return this._level},set:function(e){if("silent"!==e&&!this.levels.values[e])throw Error("unknown level "+e);this._level=e,Rp(c,a,"error","log"),Rp(c,a,"fatal","error"),Rp(c,a,"warn","error"),Rp(c,a,"info","log"),Rp(c,a,"debug","log"),Rp(c,a,"trace","log")}});const c={transmit:t,serialize:s,asObject:e.browser.asObject,levels:["error","fatal","warn","info","debug","trace"],timestamp:Dp(e)};return a.levels=Up.levels,a.level=o,a.setMaxListeners=a.getMaxListeners=a.emit=a.addListener=a.on=a.prependListener=a.once=a.prependOnceListener=a.removeListener=a.removeAllListeners=a.listeners=a.listenerCount=a.eventNames=a.write=a.flush=Mp,a.serializers=r,a._serialize=s,a._stdErrSerialize=n,a.child=function(i,n){if(!i)throw new Error("missing bindings for child Pino");n=n||{},s&&i.serializers&&(n.serializers=i.serializers);const o=n.serializers;if(s&&o){var a=Object.assign({},r,o),c=!0===e.browser.serialize?Object.keys(a):s;delete i.serializers,Bp([i],c,a,this._stdErrSerialize)}function h(e){this._childLevel=1+(0|e._childLevel),this.error=kp(e,i,"error"),this.fatal=kp(e,i,"fatal"),this.warn=kp(e,i,"warn"),this.info=kp(e,i,"info"),this.debug=kp(e,i,"debug"),this.trace=kp(e,i,"trace"),a&&(this.serializers=a,this._serialize=c),t&&(this._logEvent=jp([].concat(e._logEvent.bindings,i)))}return h.prototype=this,new h(this)},t&&(a._logEvent=jp()),a}function Rp(e,t,i,r){const s=Object.getPrototypeOf(t);t[i]=t.levelVal>t.levels.values[i]?Mp:s[i]?s[i]:Cp[i]||Cp[r]||Mp,function(e,t,i){if(!e.transmit&&t[i]===Mp)return;t[i]=(r=t[i],function(){const s=e.timestamp(),n=new Array(arguments.length),o=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Cp?Cp:this;for(var a=0;a<n.length;a++)n[a]=arguments[a];if(e.serialize&&!e.asObject&&Bp(n,this._serialize,this.serializers,this._stdErrSerialize),e.asObject?r.call(o,function(e,t,i,r){e._serialize&&Bp(i,e._serialize,e.serializers,e._stdErrSerialize);const s=i.slice();let n=s[0];const o={};r&&(o.time=r),o.level=Up.levels.values[t];let a=1+(0|e._childLevel);if(a<1&&(a=1),null!==n&&"object"==typeof n){for(;a--&&"object"==typeof s[0];)Object.assign(o,s.shift());n=s.length?Ap(s.shift(),s):void 0}else"string"==typeof n&&(n=Ap(s.shift(),s));return void 0!==n&&(o.msg=n),o}(this,i,n,s)):r.apply(o,n),e.transmit){const r=e.transmit.level||t.level,o=Up.levels.values[r],a=Up.levels.values[i];if(a<o)return;!function(e,t,i){const r=t.send,s=t.ts,n=t.methodLevel,o=t.methodValue,a=t.val,c=e._logEvent.bindings;Bp(i,e._serialize||Object.keys(e.serializers),e.serializers,void 0===e._stdErrSerialize||e._stdErrSerialize),e._logEvent.ts=s,e._logEvent.messages=i.filter(function(e){return-1===c.indexOf(e)}),e._logEvent.level.label=n,e._logEvent.level.value=o,r(n,e._logEvent,a),e._logEvent=jp(c)}(this,{ts:s,methodLevel:i,methodValue:a,transmitLevel:r,transmitValue:Up.levels.values[e.transmit.level||t.level],send:e.transmit.send,val:t.levelVal},n)}});var r}(e,t,i)}function Bp(e,t,i,r){for(const s in e)if(r&&e[s]instanceof Error)e[s]=Up.stdSerializers.err(e[s]);else if("object"==typeof e[s]&&!Array.isArray(e[s]))for(const r in e[s])t&&t.indexOf(r)>-1&&r in i&&(e[s][r]=i[r](e[s][r]))}function kp(e,t,i){return function(){const r=new Array(1+arguments.length);r[0]=t;for(var s=1;s<r.length;s++)r[s]=arguments[s-1];return e[i].apply(this,r)}}function jp(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function Dp(e){return"function"==typeof e.timestamp?e.timestamp:!1===e.timestamp?qp:zp}function Lp(){return{}}function $p(e){return e}function Mp(){}function qp(){return!1}function zp(){return Date.now()}Up.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},Up.stdSerializers=Np,Up.stdTimeFunctions=Object.assign({},{nullTime:qp,epochTime:zp,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}});const Hp=i(Tp),Fp="info",Vp="custom_context",Kp=1024e3;let Wp=class{constructor(e){this.nodeValue=e,this.sizeInBytes=(new TextEncoder).encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Gp=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new Wp(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;null!==t;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}},Yp=class{constructor(e,t=Kp){this.level=e??"error",this.levelValue=Tp.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new Gp(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===Tp.levels.values.error?console.error(e):t===Tp.levels.values.warn?console.warn(e):t===Tp.levels.values.debug?console.debug(e):t===Tp.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Xt({timestamp:(new Date).toISOString(),log:e}));const t="string"==typeof e?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new Gp(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push(Xt({extraMetadata:e})),new Blob(t,{type:"application/json"})}},Jp=class{constructor(e,t=Kp){this.baseChunkLogger=new Yp(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=t,i.download=`walletconnect-logs-${(new Date).toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}},Zp=class{constructor(e,t=Kp){this.baseChunkLogger=new Yp(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var Qp=Object.defineProperty,Xp=Object.defineProperties,eg=Object.getOwnPropertyDescriptors,tg=Object.getOwnPropertySymbols,ig=Object.prototype.hasOwnProperty,rg=Object.prototype.propertyIsEnumerable,sg=(e,t,i)=>t in e?Qp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ng=(e,t)=>{for(var i in t||(t={}))ig.call(t,i)&&sg(e,i,t[i]);if(tg)for(var i of tg(t))rg.call(t,i)&&sg(e,i,t[i]);return e},og=(e,t)=>Xp(e,eg(t));function ag(e){return og(ng({},e),{level:(null==e?void 0:e.level)||Fp})}function cg(e,t=Vp){let i="";return i=typeof e.bindings>"u"?function(e,t=Vp){return e[t]||""}(e,t):e.bindings().context||"",i}function hg(e,t,i=Vp){const r=function(e,t,i=Vp){const r=cg(e,i);return r.trim()?`${r}/${t}`:t}(e,t,i);return function(e,t,i=Vp){return e[i]=t,e}(e.child({context:r}),r,i)}function lg(e){return typeof e.loggerOverride<"u"&&"string"!=typeof e.loggerOverride?{logger:e.loggerOverride,chunkLoggerController:null}:typeof window<"u"?function(e){var t,i;const r=new Jp(null==(t=e.opts)?void 0:t.level,e.maxSizeInBytes);return{logger:Hp(og(ng({},e.opts),{level:"trace",browser:og(ng({},null==(i=e.opts)?void 0:i.browser),{write:e=>r.write(e)})})),chunkLoggerController:r}}(e):function(e){var t;const i=new Zp(null==(t=e.opts)?void 0:t.level,e.maxSizeInBytes);return{logger:Hp(og(ng({},e.opts),{level:"trace"}),i),chunkLoggerController:i}}(e)}var ug=Object.defineProperty,dg=(e,t,i)=>((e,t,i)=>t in e?ug(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let fg=class extends Vf{constructor(e){super(),this.opts=e,dg(this,"protocol","wc"),dg(this,"version",2)}};var pg=Object.defineProperty,gg=(e,t,i)=>((e,t,i)=>t in e?pg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let yg=class extends Vf{constructor(e,t){super(),this.core=e,this.logger=t,gg(this,"records",new Map)}},wg=class{constructor(e,t){this.logger=e,this.core=t}};class mg extends Vf{constructor(e,t){super(),this.relayer=e,this.logger=t}}let bg=class extends Vf{constructor(e){super()}},vg=class{constructor(e,t,i,r){this.core=e,this.logger=t,this.name=i}},Eg=class extends Vf{constructor(e,t){super(),this.relayer=e,this.logger=t}},Ig=class extends Vf{constructor(e,t){super(),this.core=e,this.logger=t}},xg=class{constructor(e,t,i){this.core=e,this.logger=t,this.store=i}},Sg=class{constructor(e,t){this.projectId=e,this.logger=t}},Pg=class{constructor(e,t,i){this.core=e,this.logger=t,this.telemetryEnabled=i}};var Og=Object.defineProperty,_g=(e,t,i)=>((e,t,i)=>t in e?Og(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let Ag=class{constructor(e){this.opts=e,_g(this,"protocol","wc"),_g(this,"version",2)}},Tg=class{constructor(e){this.client=e}};const Cg="PARSE_ERROR",Ng="INVALID_REQUEST",Ug="METHOD_NOT_FOUND",Rg="INVALID_PARAMS",Bg="INTERNAL_ERROR",kg="SERVER_ERROR",jg=[-32700,-32600,-32601,-32602,-32603],Dg={[Cg]:{code:-32700,message:"Parse error"},[Ng]:{code:-32600,message:"Invalid Request"},[Ug]:{code:-32601,message:"Method not found"},[Rg]:{code:-32602,message:"Invalid params"},[Bg]:{code:-32603,message:"Internal error"},[kg]:{code:-32e3,message:"Server error"}},Lg=kg;function $g(e){return Object.keys(Dg).includes(e)?Dg[e]:Dg[Lg]}function Mg(e,t,i){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${i} RPC url at ${t}`):e}var qg,zg={},Hg={};var Fg,Vg={};function Kg(e=3){return Date.now()*Math.pow(10,e)+Math.floor(Math.random()*Math.pow(10,e))}function Wg(e=6){return BigInt(Kg(e))}function Gg(e,t,i){return{id:i||Kg(),jsonrpc:"2.0",method:e,params:t}}function Yg(e,t){return{id:e,jsonrpc:"2.0",result:t}}function Jg(e,t,i){return{id:e,jsonrpc:"2.0",error:Zg(t,i)}}function Zg(e,t){return void 0===e?$g(Bg):("string"==typeof e&&(e=Object.assign(Object.assign({},$g(kg)),{message:e})),void 0!==t&&(e.data=t),i=e.code,jg.includes(i)&&(e=function(e){const t=Object.values(Dg).find(t=>t.code===e);return t||Dg[Lg]}(e.code)),e);var i}!function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=S;t.__exportStar(function(){if(qg)return Hg;function e(){return(null==r?void 0:r.crypto)||(null==r?void 0:r.msCrypto)||{}}function t(){const t=e();return t.subtle||t.webkitSubtle}return qg=1,Object.defineProperty(Hg,"__esModule",{value:!0}),Hg.isBrowserCryptoAvailable=Hg.getSubtleCrypto=Hg.getBrowerCrypto=void 0,Hg.getBrowerCrypto=e,Hg.getSubtleCrypto=t,Hg.isBrowserCryptoAvailable=function(){return!!e()&&!!t()},Hg}(),e),t.__exportStar(function(){if(Fg)return Vg;function e(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function t(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}return Fg=1,Object.defineProperty(Vg,"__esModule",{value:!0}),Vg.isBrowser=Vg.isNode=Vg.isReactNative=void 0,Vg.isReactNative=e,Vg.isNode=t,Vg.isBrowser=function(){return!e()&&!t()},Vg}(),e)}(zg);class Qg{}class Xg extends Qg{constructor(){super()}}class ey extends Xg{constructor(e){super()}}function ty(e,t){const i=function(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(t&&t.length)return t[0]}(e);return void 0!==i&&new RegExp(t).test(i)}function iy(e){return ty(e,"^https?:")}function ry(e){return ty(e,"^wss?:")}function sy(e){return"object"==typeof e&&"id"in e&&"jsonrpc"in e&&"2.0"===e.jsonrpc}function ny(e){return sy(e)&&"method"in e}function oy(e){return sy(e)&&(ay(e)||cy(e))}function ay(e){return"result"in e}function cy(e){return"error"in e}let hy=class extends ey{constructor(e){super(e),this.events=new s.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Gg(e.method,e.params||[],e.id||Wg().toString()),t)}async requestStrict(e,t){return new Promise(async(i,r)=>{if(!this.connection.connected)try{await this.open()}catch(fh){r(fh)}this.events.on(`${e.id}`,e=>{cy(e)?r(e.error):i(e.result)});try{await this.connection.send(e,t)}catch(fh){r(fh)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),oy(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&3e3===e.code&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),"string"==typeof e&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const ly=e=>e.split("?")[0],uy=typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws");let dy=class{constructor(e){if(this.url=e,this.events=new s.EventEmitter,this.registering=!1,!ry(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{typeof this.socket>"u"?t(new Error("Connection already closed")):(this.socket.onclose=t=>{this.onClose(t),e()},this.socket.close())})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Xt(e))}catch(uh){this.onError(e.id,uh)}}register(e=this.url){if(!ry(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const e=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=e||this.events.listenerCount("open")>=e)&&this.events.setMaxListeners(e+1),new Promise((e,t)=>{this.events.once("register_error",e=>{this.resetMaxListeners(),t(e)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return t(new Error("WebSocket connection is missing or invalid"));e(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{const r=zg.isReactNative()?void 0:{rejectUnauthorized:(n=e,!new RegExp("wss?://localhost(:d{2,5})?").test(n))},s=new uy(e,[],r);var n;typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u"?s.onerror=e=>{const t=e;i(this.emitError(t.error))}:s.on("error",e=>{i(this.emitError(e))}),s.onopen=()=>{this.onOpen(s),t(s)}})}onOpen(e){e.onmessage=e=>this.onPayload(e),e.onclose=e=>this.onClose(e),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t="string"==typeof e.data?Qt(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),r=Jg(e,i.message||i.toString());this.events.emit("payload",r)}parseError(e,t=this.url){return Mg(e,ly(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}emitError(e){const t=this.parseError(new Error((null==e?void 0:e.message)||`WebSocket connection failed for host: ${ly(this.url)}`));return this.events.emit("register_error",t),t}};const fy="core",py=`wc@2:${fy}:`,gy="error",yy={database:":memory:"},wy="client_ed25519_seed",my=w.ONE_DAY,by=w.SIX_HOURS,vy="wss://relay.walletconnect.org",Ey="relayer_message",Iy="relayer_message_ack",xy="relayer_connect",Sy="relayer_disconnect",Py="relayer_error",Oy="relayer_connection_stalled",_y="relayer_publish",Ay="payload",Ty="connect",Cy="disconnect",Ny="error",Uy="2.21.4",Ry={link_mode:"link_mode",relay:"relay"},By="inbound",ky="outbound",jy="WALLETCONNECT_LINK_MODE_APPS",Dy="subscription_created",Ly="subscription_deleted",$y="subscription_sync",My="subscription_resubscribed",qy={wc_pairingDelete:{req:{ttl:w.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:w.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:w.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:w.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:w.ONE_DAY,prompt:!1,tag:0},res:{ttl:w.ONE_DAY,prompt:!1,tag:0}}},zy="pairing_create",Hy="pairing_expire",Fy="pairing_delete",Vy="pairing_ping",Ky="history_created",Wy="history_updated",Gy="history_deleted",Yy="history_sync",Jy="expirer_created",Zy="expirer_deleted",Qy="expirer_expired",Xy="expirer_sync",ew="https://verify.walletconnect.org",tw=ew,iw=`${tw}/v3`,rw=["https://verify.walletconnect.com",ew],sw="pairing_started",nw="pairing_uri_validation_success",ow="pairing_uri_not_expired",aw="store_new_pairing",cw="subscribing_pairing_topic",hw="subscribe_pairing_topic_success",lw="existing_pairing",uw="pairing_not_expired",dw="emit_inactive_pairing",fw="emit_session_proposal",pw="no_internet_connection",gw="malformed_pairing_uri",yw="active_pairing_already_exists",ww="subscribe_pairing_topic_failure",mw="pairing_expired",bw="proposal_listener_not_found",vw="session_approve_started",Ew="session_namespaces_validation_success",Iw="subscribing_session_topic",xw="subscribe_session_topic_success",Sw="publishing_session_approve",Pw="session_approve_publish_success",Ow="store_session",_w="publishing_session_settle",Aw="session_settle_publish_success",Tw="no_internet_connection",Cw="proposal_expired",Nw="subscribe_session_topic_failure",Uw="session_approve_publish_failure",Rw="session_settle_publish_failure",Bw="session_approve_namespace_validation_failure",kw="proposal_not_found",jw="authenticated_session_approve_started",Dw="create_authenticated_session_topic",Lw="cacaos_verified",$w="store_authenticated_session",Mw="subscribing_authenticated_session_topic",qw="subscribe_authenticated_session_topic_success",zw="publishing_authenticated_session_approve",Hw="no_internet_connection",Fw="invalid_cacao",Vw="subscribe_authenticated_session_topic_failure",Kw="authenticated_session_approve_publish_failure",Ww="authenticated_session_pending_request_not_found";var Gw=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),r=0;r<i.length;r++)i[r]=255;for(var s=0;s<e.length;s++){var n=e.charAt(s),o=n.charCodeAt(0);if(255!==i[o])throw new TypeError(n+" is ambiguous");i[o]=s}var a=e.length,c=e.charAt(0),h=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function u(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,s=0;e[t]===c;)r++,t++;for(var n=(e.length-t)*h+1>>>0,o=new Uint8Array(n);e[t];){var l=i[e.charCodeAt(t)];if(255===l)return;for(var u=0,d=n-1;(0!==l||u<s)&&-1!==d;d--,u++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");s=u,t++}if(" "!==e[t]){for(var f=n-s;f!==n&&0===o[f];)f++;for(var p=new Uint8Array(r+(n-f)),g=r;f!==n;)p[g++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var i=0,r=0,s=0,n=t.length;s!==n&&0===t[s];)s++,i++;for(var o=(n-s)*l+1>>>0,h=new Uint8Array(o);s!==n;){for(var u=t[s],d=0,f=o-1;(0!==u||d<r)&&-1!==f;f--,d++)u+=256*h[f]>>>0,h[f]=u%a>>>0,u=u/a>>>0;if(0!==u)throw new Error("Non-zero carry");r=d,s++}for(var p=o-r;p!==o&&0===h[p];)p++;for(var g=c.repeat(i);p<o;++p)g+=e.charAt(h[p]);return g},decodeUnsafe:u,decode:function(e){var i=u(e);if(i)return i;throw new Error(`Non-${t} character`)}}},Yw=Gw;const Jw=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class Zw{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Qw{constructor(e,t,i){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return em(this,e)}}class Xw{constructor(e){this.decoders=e}or(e){return em(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const em=(e,t)=>new Xw({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class tm{constructor(e,t,i,r){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=r,this.encoder=new Zw(e,t,i),this.decoder=new Qw(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const im=({name:e,prefix:t,encode:i,decode:r})=>new tm(e,t,i,r),rm=({prefix:e,name:t,alphabet:i})=>{const{encode:r,decode:s}=Yw(i,t);return im({prefix:e,name:t,encode:r,decode:e=>Jw(s(e))})},sm=({name:e,prefix:t,bitsPerChar:i,alphabet:r})=>im({prefix:t,name:e,encode:e=>((e,t,i)=>{const r="="===t[t.length-1],s=(1<<i)-1;let n="",o=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],o+=8;o>i;)o-=i,n+=t[s&a>>o];if(o&&(n+=t[s&a<<i-o]),r)for(;n.length*i&7;)n+="=";return n})(e,r,i),decode:t=>((e,t,i,r)=>{const s={};for(let l=0;l<t.length;++l)s[t[l]]=l;let n=e.length;for(;"="===e[n-1];)--n;const o=new Uint8Array(n*i/8|0);let a=0,c=0,h=0;for(let l=0;l<n;++l){const t=s[e[l]];if(void 0===t)throw new SyntaxError(`Non-${r} character`);c=c<<i|t,a+=i,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=i||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(t,r,i,e)}),nm=im({prefix:"\0",name:"identity",encode:e=>(e=>(new TextDecoder).decode(e))(e),decode:e=>(e=>(new TextEncoder).encode(e))(e)});var om=Object.freeze({__proto__:null,identity:nm});const am=sm({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var cm=Object.freeze({__proto__:null,base2:am});const hm=sm({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var lm=Object.freeze({__proto__:null,base8:hm});const um=rm({prefix:"9",name:"base10",alphabet:"0123456789"});var dm=Object.freeze({__proto__:null,base10:um});const fm=sm({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),pm=sm({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var gm=Object.freeze({__proto__:null,base16:fm,base16upper:pm});const ym=sm({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),wm=sm({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),mm=sm({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),bm=sm({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),vm=sm({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Em=sm({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Im=sm({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),xm=sm({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Sm=sm({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Pm=Object.freeze({__proto__:null,base32:ym,base32upper:wm,base32pad:mm,base32padupper:bm,base32hex:vm,base32hexupper:Em,base32hexpad:Im,base32hexpadupper:xm,base32z:Sm});const Om=rm({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_m=rm({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Am=Object.freeze({__proto__:null,base36:Om,base36upper:_m});const Tm=rm({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Cm=rm({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Nm=Object.freeze({__proto__:null,base58btc:Tm,base58flickr:Cm});const Um=sm({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Rm=sm({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Bm=sm({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),km=sm({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var jm=Object.freeze({__proto__:null,base64:Um,base64pad:Rm,base64url:Bm,base64urlpad:km});const Dm=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Lm=Dm.reduce((e,t,i)=>(e[i]=t,e),[]),$m=Dm.reduce((e,t,i)=>(e[t.codePointAt(0)]=i,e),[]);const Mm=im({prefix:"🚀",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+=Lm[t],"")},decode:function(e){const t=[];for(const i of e){const e=$m[i.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${i}`);t.push(e)}return new Uint8Array(t)}});var qm=Object.freeze({__proto__:null,base256emoji:Mm}),zm=function e(t,i,r){i=i||[];for(var s=r=r||0;t>=Vm;)i[r++]=255&t|Hm,t/=128;for(;t&Fm;)i[r++]=255&t|Hm,t>>>=7;return i[r]=0|t,e.bytes=r-s+1,i},Hm=128,Fm=-128,Vm=Math.pow(2,31);var Km=function e(t,i){var r,s=0,n=0,o=i=i||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[o++],s+=n<28?(r&Gm)<<n:(r&Gm)*Math.pow(2,n),n+=7}while(r>=Wm);return e.bytes=o-i,s},Wm=128,Gm=127;var Ym=Math.pow(2,7),Jm=Math.pow(2,14),Zm=Math.pow(2,21),Qm=Math.pow(2,28),Xm=Math.pow(2,35),eb=Math.pow(2,42),tb=Math.pow(2,49),ib=Math.pow(2,56),rb=Math.pow(2,63),sb={encode:zm,decode:Km,encodingLength:function(e){return e<Ym?1:e<Jm?2:e<Zm?3:e<Qm?4:e<Xm?5:e<eb?6:e<tb?7:e<ib?8:e<rb?9:10}};const nb=(e,t,i=0)=>(sb.encode(e,t,i),t),ob=e=>sb.encodingLength(e),ab=(e,t)=>{const i=t.byteLength,r=ob(e),s=r+ob(i),n=new Uint8Array(s+i);return nb(e,n,0),nb(i,n,r),n.set(t,s),new cb(e,i,t,n)};class cb{constructor(e,t,i,r){this.code=e,this.size=t,this.digest=i,this.bytes=r}}const hb=({name:e,code:t,encode:i})=>new lb(e,t,i);class lb{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?ab(this.code,t):t.then(e=>ab(this.code,e))}throw Error("Unknown type, must be binary type")}}const ub=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),db=hb({name:"sha2-256",code:18,encode:ub("SHA-256")}),fb=hb({name:"sha2-512",code:19,encode:ub("SHA-512")});Object.freeze({__proto__:null,sha256:db,sha512:fb});const pb=Jw,gb={code:0,name:"identity",encode:pb,digest:e=>ab(0,pb(e))};Object.freeze({__proto__:null,identity:gb});new TextEncoder,new TextDecoder;const yb={...om,...cm,...lm,...dm,...gm,...Pm,...Am,...Nm,...jm,...qm};function wb(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function mb(e,t,i,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:i},decoder:{decode:r}}}const bb=mb("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>(new TextEncoder).encode(e.substring(1))),vb=mb("ascii","a",e=>{let t="a";for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},e=>{const t=function(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?wb(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}),Eb={utf8:bb,"utf-8":bb,hex:yb.base16,latin1:vb,ascii:vb,binary:vb,...yb};var Ib=Object.defineProperty,xb=(e,t,i)=>((e,t,i)=>t in e?Ib(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Sb{constructor(e,t){this.core=e,this.logger=t,xb(this,"keychain",new Map),xb(this,"name","keychain"),xb(this,"version","0.3"),xb(this,"initialized",!1),xb(this,"storagePrefix",py),xb(this,"init",async()=>{if(!this.initialized){const e=await this.getKeyChain();typeof e<"u"&&(this.keychain=e),this.initialized=!0}}),xb(this,"has",e=>(this.isInitialized(),this.keychain.has(e))),xb(this,"set",async(e,t)=>{this.isInitialized(),this.keychain.set(e,t),await this.persist()}),xb(this,"get",e=>{this.isInitialized();const t=this.keychain.get(e);if(typeof t>"u"){const{message:t}=mf("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(t)}return t}),xb(this,"del",async e=>{this.isInitialized(),this.keychain.delete(e),await this.persist()}),this.core=e,this.logger=hg(t,this.name)}get context(){return cg(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Da(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?La(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=mf("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Pb=Object.defineProperty,Ob=(e,t,i)=>((e,t,i)=>t in e?Pb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class _b{constructor(e,t,i){this.core=e,this.logger=t,Ob(this,"name","crypto"),Ob(this,"keychain"),Ob(this,"randomSessionIdentifier",kd()),Ob(this,"initialized",!1),Ob(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Ob(this,"hasKeys",e=>(this.isInitialized(),this.keychain.has(e))),Ob(this,"getClientId",async()=>{this.isInitialized();return In(Pn(await this.getClientSeed()).publicKey)}),Ob(this,"generateKeyPair",()=>{this.isInitialized();const e=function(){const e=od.utils.randomPrivateKey(),t=od.getPublicKey(e);return{privateKey:To(e,Nd),publicKey:To(t,Nd)}}();return this.setPrivateKey(e.publicKey,e.privateKey)}),Ob(this,"signJWT",async e=>{this.isInitialized();const t=Pn(await this.getClientSeed()),i=this.randomSessionIdentifier,r=my;return await On(i,e,r,t)}),Ob(this,"generateSharedKey",(e,t,i)=>{this.isInitialized();const r=function(e,t){const i=od.getSharedSecret(Ao(e,Nd),Ao(t,Nd));return To(tu(iu,i,void 0,void 0,32),Nd)}(this.getPrivateKey(e),t);return this.setSymKey(r,i)}),Ob(this,"setSymKey",async(e,t)=>{this.isInitialized();const i=t||jd(e);return await this.keychain.set(i,e),i}),Ob(this,"deleteKeyPair",async e=>{this.isInitialized(),await this.keychain.del(e)}),Ob(this,"deleteSymKey",async e=>{this.isInitialized(),await this.keychain.del(e)}),Ob(this,"encode",async(e,t,i)=>{this.isInitialized();const r=Fd(i),s=Xt(t);if(Kd(r))return function(e,t){const i=Ld(2),r=Gc(12),s=zd({type:i,sealed:Ao(e,Bd),iv:r});return t===Rd?Md(s):s}(s,null==i?void 0:i.encoding);if(Vd(r)){const t=r.senderPublicKey,i=r.receiverPublicKey;e=await this.generateSharedKey(t,i)}const n=this.getSymKey(e),{type:o,senderPublicKey:a}=r;return function(e){const t=Ld(typeof e.type<"u"?e.type:0);if(1===$d(t)&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const i=typeof e.senderPublicKey<"u"?Ao(e.senderPublicKey,Nd):void 0,r=typeof e.iv<"u"?Ao(e.iv,Nd):Gc(12),s=Ao(e.symKey,Nd),n=zd({type:t,sealed:Jl(s,r).encrypt(Ao(e.message,Bd)),iv:r,senderPublicKey:i});return e.encoding===Rd?Md(n):n}({type:o,symKey:n,message:s,senderPublicKey:a,encoding:null==i?void 0:i.encoding})}),Ob(this,"decode",async(e,t,i)=>{this.isInitialized();const r=function(e,t){const i=Hd({encoded:e,encoding:null==t?void 0:t.encoding});return Fd({type:$d(i.type),senderPublicKey:typeof i.senderPublicKey<"u"?To(i.senderPublicKey,Nd):void 0,receiverPublicKey:null==t?void 0:t.receiverPublicKey})}(t,i);if(Kd(r)){const e=function(e,t){const{sealed:i}=Hd({encoded:e,encoding:t});return To(i,Bd)}(t,null==i?void 0:i.encoding);return Qt(e)}if(Vd(r)){const t=r.receiverPublicKey,i=r.senderPublicKey;e=await this.generateSharedKey(t,i)}try{const r=function(e){const t=Ao(e.symKey,Nd),{sealed:i,iv:r}=Hd({encoded:e.encoded,encoding:e.encoding}),s=Jl(t,r).decrypt(i);if(null===s)throw new Error("Failed to decrypt");return To(s,Bd)}({symKey:this.getSymKey(e),encoded:t,encoding:null==i?void 0:i.encoding});return Qt(r)}catch(s){this.logger.error(`Failed to decode message from topic: '${e}', clientId: '${await this.getClientId()}'`),this.logger.error(s)}}),Ob(this,"getPayloadType",(e,t=Ud)=>$d(Hd({encoded:e,encoding:t}).type)),Ob(this,"getPayloadSenderPublicKey",(e,t=Ud)=>{const i=Hd({encoded:e,encoding:t});return i.senderPublicKey?To(i.senderPublicKey,Nd):void 0}),this.core=e,this.logger=hg(t,this.name),this.keychain=i||new Sb(this.core,this.logger)}get context(){return cg(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(wy)}catch{e=kd(),await this.keychain.set(wy,e)}return function(e,t="utf8"){const i=Eb[t];if(!i)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?i.decoder.decode(`${i.prefix}${e}`):wb(globalThis.Buffer.from(e,"utf-8"))}(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=mf("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Ab=Object.defineProperty,Tb=Object.defineProperties,Cb=Object.getOwnPropertyDescriptors,Nb=Object.getOwnPropertySymbols,Ub=Object.prototype.hasOwnProperty,Rb=Object.prototype.propertyIsEnumerable,Bb=(e,t,i)=>t in e?Ab(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,kb=(e,t,i)=>Bb(e,"symbol"!=typeof t?t+"":t,i);class jb extends wg{constructor(e,t){super(e,t),this.logger=e,this.core=t,kb(this,"messages",new Map),kb(this,"messagesWithoutClientAck",new Map),kb(this,"name","messages"),kb(this,"version","0.3"),kb(this,"initialized",!1),kb(this,"storagePrefix",py),kb(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const e=await this.getRelayerMessages();typeof e<"u"&&(this.messages=e);const t=await this.getRelayerMessagesWithoutClientAck();typeof t<"u"&&(this.messagesWithoutClientAck=t),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}finally{this.initialized=!0}}}),kb(this,"set",async(e,t,i)=>{this.isInitialized();const r=Dd(t);let s=this.messages.get(e);if(typeof s>"u"&&(s={}),typeof s[r]<"u")return r;if(s[r]=t,this.messages.set(e,s),i===By){const i=this.messagesWithoutClientAck.get(e)||{};this.messagesWithoutClientAck.set(e,((e,t)=>Tb(e,Cb(t)))(((e,t)=>{for(var i in t||(t={}))Ub.call(t,i)&&Bb(e,i,t[i]);if(Nb)for(var i of Nb(t))Rb.call(t,i)&&Bb(e,i,t[i]);return e})({},i),{[r]:t}))}return await this.persist(),r}),kb(this,"get",e=>{this.isInitialized();let t=this.messages.get(e);return typeof t>"u"&&(t={}),t}),kb(this,"getWithoutAck",e=>{this.isInitialized();const t={};for(const i of e){const e=this.messagesWithoutClientAck.get(i)||{};t[i]=Object.values(e)}return t}),kb(this,"has",(e,t)=>{this.isInitialized();return typeof this.get(e)[Dd(t)]<"u"}),kb(this,"ack",async(e,t)=>{this.isInitialized();const i=this.messagesWithoutClientAck.get(e);if(typeof i>"u")return;delete i[Dd(t)],0===Object.keys(i).length?this.messagesWithoutClientAck.delete(e):this.messagesWithoutClientAck.set(e,i),await this.persist()}),kb(this,"del",async e=>{this.isInitialized(),this.messages.delete(e),this.messagesWithoutClientAck.delete(e),await this.persist()}),this.logger=hg(e,this.name),this.core=t}get context(){return cg(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Da(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Da(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?La(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?La(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=mf("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Db=Object.defineProperty,Lb=Object.defineProperties,$b=Object.getOwnPropertyDescriptors,Mb=Object.getOwnPropertySymbols,qb=Object.prototype.hasOwnProperty,zb=Object.prototype.propertyIsEnumerable,Hb=(e,t,i)=>t in e?Db(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Fb=(e,t)=>{for(var i in t||(t={}))qb.call(t,i)&&Hb(e,i,t[i]);if(Mb)for(var i of Mb(t))zb.call(t,i)&&Hb(e,i,t[i]);return e},Vb=(e,t)=>Lb(e,$b(t)),Kb=(e,t,i)=>Hb(e,"symbol"!=typeof t?t+"":t,i);class Wb extends mg{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,Kb(this,"events",new s.EventEmitter),Kb(this,"name","publisher"),Kb(this,"queue",new Map),Kb(this,"publishTimeout",w.toMiliseconds(w.ONE_MINUTE)),Kb(this,"initialPublishTimeout",w.toMiliseconds(15*w.ONE_SECOND)),Kb(this,"needsTransportRestart",!1),Kb(this,"publish",async(e,t,i)=>{var r;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,message:t,opts:i}});const s=(null==i?void 0:i.ttl)||by,n=Gd(i),o=(null==i?void 0:i.prompt)||!1,a=(null==i?void 0:i.tag)||0,c=(null==i?void 0:i.id)||Wg().toString(),h={topic:e,message:t,opts:{ttl:s,relay:n,prompt:o,tag:a,id:c,attestation:null==i?void 0:i.attestation,tvf:null==i?void 0:i.tvf}},l=`Failed to publish payload, please try again. id:${c} tag:${a}`;try{const r=new Promise(async r=>{const n=({id:e})=>{h.opts.id===e&&(this.removeRequestFromQueue(e),this.relayer.events.removeListener(_y,n),r(h))};this.relayer.events.on(_y,n);const l=Ma(new Promise((r,n)=>{this.rpcPublish({topic:e,message:t,ttl:s,prompt:o,tag:a,id:c,attestation:null==i?void 0:i.attestation,tvf:null==i?void 0:i.tvf}).then(r).catch(e=>{this.logger.warn(e,null==e?void 0:e.message),n(e)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${c} tag:${a}`);try{await l,this.events.removeListener(_y,n)}catch(u){this.queue.set(c,Vb(Fb({},h),{attempt:1})),this.logger.warn(u,null==u?void 0:u.message)}});this.logger.trace({type:"method",method:"publish",params:{id:c,topic:e,message:t,opts:i}}),await Ma(r,this.publishTimeout,l)}catch(u){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(u),null!=(r=null==i?void 0:i.internal)&&r.throwOnFailedPublish)throw u}finally{this.queue.delete(c)}}),Kb(this,"on",(e,t)=>{this.events.on(e,t)}),Kb(this,"once",(e,t)=>{this.events.once(e,t)}),Kb(this,"off",(e,t)=>{this.events.off(e,t)}),Kb(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.relayer=e,this.logger=hg(t,this.name),this.registerEventListeners()}get context(){return cg(this.logger)}async rpcPublish(e){var t,i,r,s;const{topic:n,message:o,ttl:a=by,prompt:c,tag:h,id:l,attestation:u,tvf:d}=e,f={method:Yd(Gd().protocol).publish,params:Fb({topic:n,message:o,ttl:a,prompt:c,tag:h,attestation:u},d),id:l};If(null==(t=f.params)?void 0:t.prompt)&&(null==(i=f.params)||delete i.prompt),If(null==(r=f.params)?void 0:r.tag)&&(null==(s=f.params)||delete s.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:f});const p=await this.relayer.request(f);return this.relayer.events.emit(_y,e),this.logger.debug("Successfully Published Payload"),p}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{const i=e.attempt+1;this.queue.set(t,Vb(Fb({},e),{attempt:i}));const{topic:r,message:s,opts:n,attestation:o}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${i}`),await this.rpcPublish(Vb(Fb({},e),{topic:r,message:s,ttl:n.ttl,prompt:n.prompt,tag:n.tag,id:n.id,attestation:o,tvf:n.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Gf.pulse,()=>{if(this.needsTransportRestart)return this.needsTransportRestart=!1,void this.relayer.events.emit(Oy);this.checkQueue()}),this.relayer.on(Iy,e=>{this.removeRequestFromQueue(e.id.toString())})}}var Gb=Object.defineProperty,Yb=(e,t,i)=>((e,t,i)=>t in e?Gb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Jb{constructor(){Yb(this,"map",new Map),Yb(this,"set",(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),Yb(this,"get",e=>this.map.get(e)||[]),Yb(this,"exists",(e,t)=>this.get(e).includes(t)),Yb(this,"delete",(e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const r=i.filter(e=>e!==t);r.length?this.map.set(e,r):this.map.delete(e)}),Yb(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var Zb=Object.defineProperty,Qb=Object.defineProperties,Xb=Object.getOwnPropertyDescriptors,ev=Object.getOwnPropertySymbols,tv=Object.prototype.hasOwnProperty,iv=Object.prototype.propertyIsEnumerable,rv=(e,t,i)=>t in e?Zb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,sv=(e,t)=>{for(var i in t||(t={}))tv.call(t,i)&&rv(e,i,t[i]);if(ev)for(var i of ev(t))iv.call(t,i)&&rv(e,i,t[i]);return e},nv=(e,t)=>Qb(e,Xb(t)),ov=(e,t,i)=>rv(e,"symbol"!=typeof t?t+"":t,i);class av extends Eg{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,ov(this,"subscriptions",new Map),ov(this,"topicMap",new Jb),ov(this,"events",new s.EventEmitter),ov(this,"name","subscription"),ov(this,"version","0.3"),ov(this,"pending",new Map),ov(this,"cached",[]),ov(this,"initialized",!1),ov(this,"storagePrefix",py),ov(this,"subscribeTimeout",w.toMiliseconds(w.ONE_MINUTE)),ov(this,"initialSubscribeTimeout",w.toMiliseconds(15*w.ONE_SECOND)),ov(this,"clientId"),ov(this,"batchSubscribeTopicsLimit",500),ov(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ov(this,"subscribe",async(e,t)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}});try{const i=Gd(t),r={topic:e,relay:i,transportType:null==t?void 0:t.transportType};this.pending.set(e,r);const s=await this.rpcSubscribe(e,i,t);return"string"==typeof s&&(this.onSubscribe(s,r),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}})),s}catch(fh){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(fh),fh}}),ov(this,"unsubscribe",async(e,t)=>{this.isInitialized(),typeof(null==t?void 0:t.id)<"u"?await this.unsubscribeById(e,t.id,t):await this.unsubscribeByTopic(e,t)}),ov(this,"isSubscribed",e=>new Promise(t=>{t(this.topicMap.topics.includes(e))})),ov(this,"isKnownTopic",e=>new Promise(t=>{t(this.topicMap.topics.includes(e)||this.pending.has(e)||this.cached.some(t=>t.topic===e))})),ov(this,"on",(e,t)=>{this.events.on(e,t)}),ov(this,"once",(e,t)=>{this.events.once(e,t)}),ov(this,"off",(e,t)=>{this.events.off(e,t)}),ov(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),ov(this,"start",async()=>{await this.onConnect()}),ov(this,"stop",async()=>{await this.onDisconnect()}),ov(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ov(this,"checkPending",async()=>{if(!(0!==this.pending.size||this.initialized&&this.relayer.connected))return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}),ov(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Gf.pulse,async()=>{await this.checkPending()}),this.events.on(Dy,async e=>{const t=Dy;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(Ly,async e=>{const t=Ly;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}),this.relayer=e,this.logger=hg(t,this.name),this.clientId=""}get context(){return cg(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async i=>await this.unsubscribeById(e,i,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const r=Gd(i);await this.restartToComplete({topic:e,id:t,relay:r}),await this.rpcUnsubscribe(e,t,r);const s=bf("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(r){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(r),r}}async rpcSubscribe(e,t,i){var r;(!i||(null==i?void 0:i.transportType)===Ry.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const s={method:Yd(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});const n=null==(r=null==i?void 0:i.internal)?void 0:r.throwOnFailedPublish;try{const t=await this.getSubscriptionId(e);if((null==i?void 0:i.transportType)===Ry.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(s).catch(e=>this.logger.warn(e))},w.toMiliseconds(w.ONE_SECOND)),t;const r=new Promise(async t=>{const i=r=>{r.topic===e&&(this.events.removeListener(Dy,i),t(r.id))};this.events.on(Dy,i);try{const r=await Ma(new Promise((e,t)=>{this.relayer.request(s).catch(e=>{this.logger.warn(e,null==e?void 0:e.message),t(e)}).then(e)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Dy,i),t(r)}catch{}}),o=await Ma(r,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!o&&n)throw new Error(`Subscribing to ${e} failed, please try again`);return o?t:null}catch(o){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Oy),n)throw o}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t={method:Yd(e[0].relay.protocol).batchSubscribe,params:{topics:e.map(e=>e.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:t});try{await await Ma(new Promise(e=>{this.relayer.request(t).catch(e=>this.logger.warn(e)).then(e)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(Oy)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t={method:Yd(e[0].relay.protocol).batchFetchMessages,params:{topics:e.map(e=>e.topic)}};let i;this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:t});try{i=await await Ma(new Promise((e,i)=>{this.relayer.request(t).catch(e=>{this.logger.warn(e),i(e)}).then(e)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(Oy)}return i}rpcUnsubscribe(e,t,i){const r={method:Yd(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.request(r)}onSubscribe(e,t){this.setSubscription(e,nv(sv({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(e=>{this.setSubscription(e.id,sv({},e)),this.pending.delete(e.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,sv({},t)),this.topicMap.set(t.topic,e),this.events.emit(Dy,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:t}=mf("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(t)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Ly,nv(sv({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit($y)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){const t=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(t)}}this.events.emit(My)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:e}=mf("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(e)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(dh){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(dh)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async e=>nv(sv({},e),{id:await this.getSubscriptionId(e.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await function(e){return new Promise(t=>setTimeout(t,e))}(w.toMiliseconds(w.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=mf("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Dd(e+await this.getClientId())}}var cv=Object.defineProperty,hv=Object.getOwnPropertySymbols,lv=Object.prototype.hasOwnProperty,uv=Object.prototype.propertyIsEnumerable,dv=(e,t,i)=>t in e?cv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,fv=(e,t)=>{for(var i in t||(t={}))lv.call(t,i)&&dv(e,i,t[i]);if(hv)for(var i of hv(t))uv.call(t,i)&&dv(e,i,t[i]);return e},pv=(e,t,i)=>dv(e,"symbol"!=typeof t?t+"":t,i);class gv extends bg{constructor(e){super(e),pv(this,"protocol","wc"),pv(this,"version",2),pv(this,"core"),pv(this,"logger"),pv(this,"events",new s.EventEmitter),pv(this,"provider"),pv(this,"messages"),pv(this,"subscriber"),pv(this,"publisher"),pv(this,"name","relayer"),pv(this,"transportExplicitlyClosed",!1),pv(this,"initialized",!1),pv(this,"connectionAttemptInProgress",!1),pv(this,"relayUrl"),pv(this,"projectId"),pv(this,"packageName"),pv(this,"bundleId"),pv(this,"hasExperiencedNetworkDisruption",!1),pv(this,"pingTimeout"),pv(this,"heartBeatTimeout",w.toMiliseconds(w.THIRTY_SECONDS+w.FIVE_SECONDS)),pv(this,"reconnectTimeout"),pv(this,"connectPromise"),pv(this,"reconnectInProgress",!1),pv(this,"requestsInFlight",[]),pv(this,"connectTimeout",w.toMiliseconds(15*w.ONE_SECOND)),pv(this,"request",async e=>{var t,i;this.logger.debug("Publishing Request Payload");const r=e.id||Wg().toString();await this.toEstablishConnection();try{this.logger.trace({id:r,method:e.method,topic:null==(t=e.params)?void 0:t.topic},"relayer.request - publishing...");const s=`${r}:${(null==(i=e.params)?void 0:i.tag)||""}`;this.requestsInFlight.push(s);const n=await this.provider.request(e);return this.requestsInFlight=this.requestsInFlight.filter(e=>e!==s),n}catch(s){throw this.logger.debug(`Failed to Publish Request: ${r}`),s}}),pv(this,"resetPingTimeout",()=>{_a()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var e,t,i,r;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(r=null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.terminate)||r.call(i)}catch(s){this.logger.warn(s,null==s?void 0:s.message)}},this.heartBeatTimeout))}),pv(this,"onPayloadHandler",e=>{this.onProviderPayload(e),this.resetPingTimeout()}),pv(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(xy)}),pv(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),pv(this,"onProviderErrorHandler",e=>{this.logger.fatal(`Fatal socket error: ${e.message}`),this.events.emit(Py,e),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),pv(this,"registerProviderListeners",()=>{this.provider.on(Ay,this.onPayloadHandler),this.provider.on(Ty,this.onConnectHandler),this.provider.on(Cy,this.onDisconnectHandler),this.provider.on(Ny,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?hg(e.logger,this.name):Hp(ag({level:e.logger||"error"})),this.messages=new jb(this.logger,e.core),this.subscriber=new av(this,this.logger),this.publisher=new Wb(this,this.logger),this.relayUrl=(null==e?void 0:e.relayUrl)||vy,this.projectId=e.projectId,Aa()&&typeof global<"u"&&typeof(null==global?void 0:global.Platform)<"u"&&"android"===(null==global?void 0:global.Platform.OS)?this.packageName=Na():Aa()&&typeof global<"u"&&typeof(null==global?void 0:global.Platform)<"u"&&"ios"===(null==global?void 0:global.Platform.OS)&&(this.bundleId=Na()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,null==e?void 0:e.message))}get context(){return cg(this.logger)}get connected(){var e,t,i;return 1===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||!1}get connecting(){var e,t,i;return 0===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||void 0!==this.connectPromise||!1}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:Ry.relay},ky)}async subscribe(e,t){var i,r,s;this.isInitialized(),(null==t||!t.transportType||"relay"===(null==t?void 0:t.transportType))&&await this.toEstablishConnection();const n=typeof(null==(i=null==t?void 0:t.internal)?void 0:i.throwOnFailedPublish)>"u"||(null==(r=null==t?void 0:t.internal)?void 0:r.throwOnFailedPublish);let o,a=(null==(s=this.subscriber.topicMap.get(e))?void 0:s[0])||"";const c=t=>{t.topic===e&&(this.subscriber.off(Dy,c),o())};return await Promise.all([new Promise(e=>{o=e,this.subscriber.on(Dy,c)}),new Promise(async(i,r)=>{a=await this.subscriber.subscribe(e,fv({internal:{throwOnFailedPublish:n}},t)).catch(e=>{n&&r(e)})||a,i()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Ma(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(this.subscriber.hasAnyTopics){if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,i)=>{await this.connect(e).then(t).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}else this.logger.warn("Starting WS connection skipped because the client has no topics to work with.")}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!(await Lf()))throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(0===(null==e?void 0:e.length))return void this.logger.trace("Batch message events is empty. Ignoring...");const t=e.sort((e,t)=>e.publishedAt-t.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const r of t)try{await this.onMessageEvent(r)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+(null==i?void 0:i.message))}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:i}=e;if(!t.sessionExists){const e={topic:i,expiry:Ha(w.FIVE_MINUTES),relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,e)}this.events.emit(Ey,e),await this.recordMessageEvent(e,By)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(e,t)=>{const i=()=>{t(new Error("Connection interrupted while trying to connect"))};this.provider.once(Cy,i),await Ma(new Promise((e,t)=>{this.provider.connect().then(e).catch(t)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(e=>{t(e)}).finally(()=>{this.provider.off(Cy,i),clearTimeout(this.reconnectTimeout)}),await new Promise(async(e,i)=>{const r=()=>{t(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Cy,r),await this.subscriber.start().then(e).catch(i).finally(()=>{this.provider.off(Cy,r)})}),this.hasExperiencedNetworkDisruption=!1,e()})}catch(i){await this.subscriber.stop();const e=i;this.logger.warn({},e.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(e=>setTimeout(e,w.toMiliseconds(1*t))),t++}}startPingTimeout(){var e,t,i,r,s;if(_a())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(s=null==(r=null==(i=this.provider)?void 0:i.connection)?void 0:r.socket)||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(n){this.logger.warn(n,null==n?void 0:n.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new hy(new dy(ka({sdkVersion:Uy,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){const{topic:i,message:r}=e;await this.messages.set(i,r,t)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;if(!i||0===i.length)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!(await this.subscriber.isKnownTopic(t)))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;const r=this.messages.has(t,i);return r&&this.logger.warn(`Ignoring duplicate message: ${i}`),r}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),ny(e)){if(!e.method.endsWith("_subscription"))return;const t=e.params,{topic:i,message:r,publishedAt:s,attestation:n}=t.data,o={topic:i,message:r,publishedAt:s,transportType:Ry.relay,attestation:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(fv({type:"event",event:t.id},o)),this.events.emit(t.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}else oy(e)&&this.events.emit(Iy,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,By),this.events.emit(Ey,e))}async acknowledgePayload(e){const t=Yg(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(Ay,this.onPayloadHandler),this.provider.off(Ty,this.onConnectHandler),this.provider.off(Cy,this.onDisconnectHandler),this.provider.off(Ny,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Lf();$f(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(e=>this.logger.error(e,null==e?void 0:e.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Gf.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&function(){var e;return!Ta()||!Y()||"visible"===(null==(e=Y())?void 0:e.visibilityState)}())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(uh){this.logger.warn(uh,null==uh?void 0:uh.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Sy),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,null==e?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},w.toMiliseconds(.1)))))}isInitialized(){if(!this.initialized){const{message:e}=mf("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void(await this.connectPromise);await this.connect()}}}function yv(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function wv(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const mv="[object Arguments]",bv="[object Object]";function vv(){}function Ev(e){if(!e||"object"!=typeof e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&"[object Object]"===Object.prototype.toString.call(e)}function Iv(e,t,i,r,s,n,o){const a=o(e,t,i,r,s,n);if(void 0!==a)return a;if(typeof e==typeof t)switch(typeof e){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return e===t;case"number":return e===t||Object.is(e,t);case"object":return xv(e,t,n,o)}return xv(e,t,n,o)}function xv(e,t,i,r){if(Object.is(e,t))return!0;let s=wv(e),n=wv(t);if(s===mv&&(s=bv),n===mv&&(n=bv),s!==n)return!1;switch(s){case"[object String]":return e.toString()===t.toString();case"[object Number]":return function(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}(e.valueOf(),t.valueOf());case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(e.valueOf(),t.valueOf());case"[object RegExp]":return e.source===t.source&&e.flags===t.flags;case"[object Function]":return e===t}const o=(i=i??new Map).get(e),a=i.get(t);if(null!=o&&null!=a)return o===t;i.set(e,t),i.set(t,e);try{switch(s){case"[object Map]":if(e.size!==t.size)return!1;for(const[s,n]of e.entries())if(!t.has(s)||!Iv(n,t.get(s),s,e,t,i,r))return!1;return!0;case"[object Set]":{if(e.size!==t.size)return!1;const s=Array.from(e.values()),n=Array.from(t.values());for(let o=0;o<s.length;o++){const a=s[o],c=n.findIndex(s=>Iv(a,s,void 0,e,t,i,r));if(-1===c)return!1;n.splice(c,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if(typeof Buffer<"u"&&Buffer.isBuffer(e)!==Buffer.isBuffer(t)||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!Iv(e[s],t[s],s,e,t,i,r))return!1;return!0;case"[object ArrayBuffer]":return e.byteLength===t.byteLength&&xv(new Uint8Array(e),new Uint8Array(t),i,r);case"[object DataView]":return e.byteLength===t.byteLength&&e.byteOffset===t.byteOffset&&xv(new Uint8Array(e),new Uint8Array(t),i,r);case"[object Error]":return e.name===t.name&&e.message===t.message;case bv:{if(!(xv(e.constructor,t.constructor,i,r)||Ev(e)&&Ev(t)))return!1;const s=[...Object.keys(e),...yv(e)],n=[...Object.keys(t),...yv(t)];if(s.length!==n.length)return!1;for(let o=0;o<s.length;o++){const n=s[o],a=e[n];if(!Object.hasOwn(t,n))return!1;if(!Iv(a,t[n],n,e,t,i,r))return!1}return!0}default:return!1}}finally{i.delete(e),i.delete(t)}}function Sv(e,t){return function(e,t,i){return Iv(e,t,void 0,void 0,void 0,void 0,i)}(e,t,vv)}var Pv=Object.defineProperty,Ov=Object.getOwnPropertySymbols,_v=Object.prototype.hasOwnProperty,Av=Object.prototype.propertyIsEnumerable,Tv=(e,t,i)=>t in e?Pv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Cv=(e,t)=>{for(var i in t||(t={}))_v.call(t,i)&&Tv(e,i,t[i]);if(Ov)for(var i of Ov(t))Av.call(t,i)&&Tv(e,i,t[i]);return e},Nv=(e,t,i)=>Tv(e,"symbol"!=typeof t?t+"":t,i);class Uv extends vg{constructor(e,t,i,r=py,s=void 0){super(e,t,i,r),this.core=e,this.logger=t,this.name=i,Nv(this,"map",new Map),Nv(this,"version","0.3"),Nv(this,"cached",[]),Nv(this,"initialized",!1),Nv(this,"getKey"),Nv(this,"storagePrefix",py),Nv(this,"recentlyDeleted",[]),Nv(this,"recentlyDeletedLimit",200),Nv(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>{this.getKey&&null!==e&&!If(e)?this.map.set(this.getKey(e),e):function(e){var t;return null==(t=null==e?void 0:e.proposer)?void 0:t.publicKey}(e)?this.map.set(e.id,e):function(e){return null==e?void 0:e.topic}(e)&&this.map.set(e.topic,e)}),this.cached=[],this.initialized=!0)}),Nv(this,"set",async(e,t)=>{this.isInitialized(),this.map.has(e)?await this.update(e,t):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:e,value:t}),this.map.set(e,t),await this.persist())}),Nv(this,"get",e=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:e}),this.getData(e))),Nv(this,"getAll",e=>(this.isInitialized(),e?this.values.filter(t=>Object.keys(e).every(i=>Sv(t[i],e[i]))):this.values)),Nv(this,"update",async(e,t)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:e,update:t});const i=Cv(Cv({},this.getData(e)),t);this.map.set(e,i),await this.persist()}),Nv(this,"delete",async(e,t)=>{this.isInitialized(),this.map.has(e)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:e,reason:t}),this.map.delete(e),this.addToRecentlyDeleted(e),await this.persist())}),this.logger=hg(t,this.name),this.storagePrefix=r,this.getKey=s}get context(){return cg(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:t}=mf("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(t),new Error(t)}const{message:t}=mf("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(t),new Error(t)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:e}=mf("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(dh){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(dh)}}isInitialized(){if(!this.initialized){const{message:e}=mf("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Rv=Object.defineProperty,Bv=(e,t,i)=>((e,t,i)=>t in e?Rv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class kv{constructor(e,t){this.core=e,this.logger=t,Bv(this,"name","pairing"),Bv(this,"version","0.3"),Bv(this,"events",new n),Bv(this,"pairings"),Bv(this,"initialized",!1),Bv(this,"storagePrefix",py),Bv(this,"ignoredPayloadTypes",[1]),Bv(this,"registeredMethods",[]),Bv(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),Bv(this,"register",({methods:e})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...e])]}),Bv(this,"create",async e=>{this.isInitialized();const t=kd(),i=await this.core.crypto.setSymKey(t),r=Ha(w.FIVE_MINUTES),s={protocol:"irn"},n={topic:i,expiry:r,relay:s,active:!1,methods:null==e?void 0:e.methods},o=Xd({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:t,relay:s,expiryTimestamp:r,methods:null==e?void 0:e.methods});return this.events.emit(zy,n),this.core.expirer.set(i,r),await this.pairings.set(i,n),await this.core.relayer.subscribe(i,{transportType:null==e?void 0:e.transportType}),{topic:i,uri:o}}),Bv(this,"pair",async e=>{this.isInitialized();const t=this.core.eventClient.createEvent({properties:{topic:null==e?void 0:e.uri,trace:[sw]}});this.isValidPair(e,t);const{topic:i,symKey:r,relay:s,expiryTimestamp:n,methods:o}=Zd(e.uri);let a;if(t.props.properties.topic=i,t.addTrace(nw),t.addTrace(ow),this.pairings.keys.includes(i)){if(a=this.pairings.get(i),t.addTrace(lw),a.active)throw t.setError(yw),new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);t.addTrace(uw)}const c=n||Ha(w.FIVE_MINUTES),h={topic:i,relay:s,expiry:c,active:!1,methods:o};this.core.expirer.set(i,c),await this.pairings.set(i,h),t.addTrace(aw),e.activatePairing&&await this.activate({topic:i}),this.events.emit(zy,h),t.addTrace(dw),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(r,i),t.addTrace(cw);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{t.setError(pw)}try{await this.core.relayer.subscribe(i,{relay:s})}catch(l){throw t.setError(ww),l}return t.addTrace(hw),h}),Bv(this,"activate",async({topic:e})=>{this.isInitialized();const t=Ha(w.FIVE_MINUTES);this.core.expirer.set(e,t),await this.pairings.update(e,{active:!0,expiry:t})}),Bv(this,"ping",async e=>{this.isInitialized(),await this.isValidPing(e),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:t}=e;if(this.pairings.keys.includes(t)){const e=await this.sendRequest(t,"wc_pairingPing",{}),{done:i,resolve:r,reject:s}=$a();this.events.once(Va("pairing_ping",e),({error:e})=>{e?s(e):r()}),await i()}}),Bv(this,"updateExpiry",async({topic:e,expiry:t})=>{this.isInitialized(),await this.pairings.update(e,{expiry:t})}),Bv(this,"updateMetadata",async({topic:e,metadata:t})=>{this.isInitialized(),await this.pairings.update(e,{peerMetadata:t})}),Bv(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),Bv(this,"disconnect",async e=>{this.isInitialized(),await this.isValidDisconnect(e);const{topic:t}=e;this.pairings.keys.includes(t)&&(await this.sendRequest(t,"wc_pairingDelete",bf("USER_DISCONNECTED")),await this.deletePairing(t))}),Bv(this,"formatUriFromPairing",e=>{this.isInitialized();const{topic:t,relay:i,expiry:r,methods:s}=e,n=this.core.crypto.keychain.get(t);return Xd({protocol:this.core.protocol,version:this.core.version,topic:t,symKey:n,relay:i,expiryTimestamp:r,methods:s})}),Bv(this,"sendRequest",async(e,t,i)=>{const r=Gg(t,i),s=await this.core.crypto.encode(e,r),n=qy[t].req;return this.core.history.set(e,r),this.core.relayer.publish(e,s,n),r.id}),Bv(this,"sendResult",async(e,t,i)=>{const r=Yg(e,i),s=await this.core.crypto.encode(t,r),n=(await this.core.history.get(t,e)).request.method,o=qy[n].res;await this.core.relayer.publish(t,s,o),await this.core.history.resolve(r)}),Bv(this,"sendError",async(e,t,i)=>{const r=Jg(e,i),s=await this.core.crypto.encode(t,r),n=(await this.core.history.get(t,e)).request.method,o=qy[n]?qy[n].res:qy.unregistered_method.res;await this.core.relayer.publish(t,s,o),await this.core.history.resolve(r)}),Bv(this,"deletePairing",async(e,t)=>{await this.core.relayer.unsubscribe(e),await Promise.all([this.pairings.delete(e,bf("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(e),t?Promise.resolve():this.core.expirer.del(e)])}),Bv(this,"cleanup",async()=>{const e=this.pairings.getAll().filter(e=>Fa(e.expiry));await Promise.all(e.map(e=>this.deletePairing(e.topic)))}),Bv(this,"onRelayEventRequest",async e=>{const{topic:t,payload:i}=e;switch(i.method){case"wc_pairingPing":return await this.onPairingPingRequest(t,i);case"wc_pairingDelete":return await this.onPairingDeleteRequest(t,i);default:return await this.onUnknownRpcMethodRequest(t,i)}}),Bv(this,"onRelayEventResponse",async e=>{const{topic:t,payload:i}=e,r=(await this.core.history.get(t,i.id)).request.method;return"wc_pairingPing"===r?this.onPairingPingResponse(t,i):this.onUnknownRpcMethodResponse(r)}),Bv(this,"onPairingPingRequest",async(e,t)=>{const{id:i}=t;try{this.isValidPing({topic:e}),await this.sendResult(i,e,!0),this.events.emit(Vy,{id:i,topic:e})}catch(r){await this.sendError(i,e,r),this.logger.error(r)}}),Bv(this,"onPairingPingResponse",(e,t)=>{const{id:i}=t;setTimeout(()=>{ay(t)?this.events.emit(Va("pairing_ping",i),{}):cy(t)&&this.events.emit(Va("pairing_ping",i),{error:t.error})},500)}),Bv(this,"onPairingDeleteRequest",async(e,t)=>{const{id:i}=t;try{this.isValidDisconnect({topic:e}),await this.deletePairing(e),this.events.emit(Fy,{id:i,topic:e})}catch(r){await this.sendError(i,e,r),this.logger.error(r)}}),Bv(this,"onUnknownRpcMethodRequest",async(e,t)=>{const{id:i,method:r}=t;try{if(this.registeredMethods.includes(r))return;const t=bf("WC_METHOD_UNSUPPORTED",r);await this.sendError(i,e,t),this.logger.error(t)}catch(s){await this.sendError(i,e,s),this.logger.error(s)}}),Bv(this,"onUnknownRpcMethodResponse",e=>{this.registeredMethods.includes(e)||this.logger.error(bf("WC_METHOD_UNSUPPORTED",e))}),Bv(this,"isValidPair",(e,t)=>{var i;if(!Uf(e)){const{message:i}=mf("MISSING_OR_INVALID",`pair() params: ${e}`);throw t.setError(gw),new Error(i)}if(!function(e){function t(e){try{return typeof new URL(e)<"u"}catch{return!1}}try{if(xf(e,!1))return!!t(e)||t(Za(e))}catch{}return!1}(e.uri)){const{message:i}=mf("MISSING_OR_INVALID",`pair() uri: ${e.uri}`);throw t.setError(gw),new Error(i)}const r=Zd(null==e?void 0:e.uri);if(null==(i=null==r?void 0:r.relay)||!i.protocol){const{message:e}=mf("MISSING_OR_INVALID","pair() uri#relay-protocol");throw t.setError(gw),new Error(e)}if(null==r||!r.symKey){const{message:e}=mf("MISSING_OR_INVALID","pair() uri#symKey");throw t.setError(gw),new Error(e)}if(null!=r&&r.expiryTimestamp&&w.toMiliseconds(null==r?void 0:r.expiryTimestamp)<Date.now()){t.setError(mw);const{message:e}=mf("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(e)}}),Bv(this,"isValidPing",async e=>{if(!Uf(e)){const{message:t}=mf("MISSING_OR_INVALID",`ping() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidPairingTopic(t)}),Bv(this,"isValidDisconnect",async e=>{if(!Uf(e)){const{message:t}=mf("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidPairingTopic(t)}),Bv(this,"isValidPairingTopic",async e=>{if(!xf(e,!1)){const{message:t}=mf("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.pairings.keys.includes(e)){const{message:t}=mf("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Fa(this.pairings.get(e).expiry)){await this.deletePairing(e);const{message:t}=mf("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}),this.core=e,this.logger=hg(t,this.name),this.pairings=new Uv(this.core,this.logger,this.name,this.storagePrefix)}get context(){return cg(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=mf("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Ey,async e=>{const{topic:t,message:i,transportType:r}=e;if(this.pairings.keys.includes(t)&&r!==Ry.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const e=await this.core.crypto.decode(t,i);ny(e)?(this.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e})):oy(e)&&(await this.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e}),this.core.history.delete(t,e.id)),await this.core.relayer.messages.ack(t,i)}catch(fh){this.logger.error(fh)}})}registerExpirerEvents(){this.core.expirer.on(Qy,async e=>{const{topic:t}=za(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Hy,{topic:t}))})}}var jv=Object.defineProperty,Dv=(e,t,i)=>((e,t,i)=>t in e?jv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Lv extends yg{constructor(e,t){super(e,t),this.core=e,this.logger=t,Dv(this,"records",new Map),Dv(this,"events",new s.EventEmitter),Dv(this,"name","history"),Dv(this,"version","0.3"),Dv(this,"cached",[]),Dv(this,"initialized",!1),Dv(this,"storagePrefix",py),Dv(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.records.set(e.id,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Dv(this,"set",(e,t,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:i}),this.records.has(t.id))return;const r={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:i,expiry:Ha(w.THIRTY_DAYS)};this.records.set(r.id,r),this.persist(),this.events.emit(Ky,r)}),Dv(this,"resolve",async e=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:e}),!this.records.has(e.id))return;const t=await this.getRecord(e.id);typeof t.response>"u"&&(t.response=cy(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.persist(),this.events.emit(Wy,t))}),Dv(this,"get",async(e,t)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t}),await this.getRecord(t))),Dv(this,"delete",(e,t)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach(i=>{if(i.topic===e){if(typeof t<"u"&&i.id!==t)return;this.records.delete(i.id),this.events.emit(Gy,i)}}),this.persist()}),Dv(this,"exists",async(e,t)=>(this.isInitialized(),!!this.records.has(t)&&(await this.getRecord(t)).topic===e)),Dv(this,"on",(e,t)=>{this.events.on(e,t)}),Dv(this,"once",(e,t)=>{this.events.once(e,t)}),Dv(this,"off",(e,t)=>{this.events.off(e,t)}),Dv(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=hg(t,this.name)}get context(){return cg(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:Gg(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:t}=mf("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(t)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Yy)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:e}=mf("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(dh){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(dh)}}registerEventListeners(){this.events.on(Ky,e=>{const t=Ky;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Wy,e=>{const t=Wy;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Gy,e=>{const t=Gy;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(Gf.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{w.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(Gy,t,!1),e=!0)}),e&&this.persist()}catch(dh){this.logger.warn(dh)}}isInitialized(){if(!this.initialized){const{message:e}=mf("NOT_INITIALIZED",this.name);throw new Error(e)}}}var $v=Object.defineProperty,Mv=(e,t,i)=>((e,t,i)=>t in e?$v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class qv extends Ig{constructor(e,t){super(e,t),this.core=e,this.logger=t,Mv(this,"expirations",new Map),Mv(this,"events",new s.EventEmitter),Mv(this,"name","expirer"),Mv(this,"version","0.3"),Mv(this,"cached",[]),Mv(this,"initialized",!1),Mv(this,"storagePrefix",py),Mv(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.expirations.set(e.target,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Mv(this,"has",e=>{try{const t=this.formatTarget(e);return typeof this.getExpiration(t)<"u"}catch{return!1}}),Mv(this,"set",(e,t)=>{this.isInitialized();const i=this.formatTarget(e),r={target:i,expiry:t};this.expirations.set(i,r),this.checkExpiry(i,r),this.events.emit(Jy,{target:i,expiration:r})}),Mv(this,"get",e=>{this.isInitialized();const t=this.formatTarget(e);return this.getExpiration(t)}),Mv(this,"del",e=>{if(this.isInitialized(),this.has(e)){const t=this.formatTarget(e),i=this.getExpiration(t);this.expirations.delete(t),this.events.emit(Zy,{target:t,expiration:i})}}),Mv(this,"on",(e,t)=>{this.events.on(e,t)}),Mv(this,"once",(e,t)=>{this.events.once(e,t)}),Mv(this,"off",(e,t)=>{this.events.off(e,t)}),Mv(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=hg(t,this.name)}get context(){return cg(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return function(e){return qa("topic",e)}(e);if("number"==typeof e)return function(e){return qa("id",e)}(e);const{message:t}=mf("UNKNOWN_TYPE","Target type: "+typeof e);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Xy)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:e}=mf("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(dh){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(dh)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:t}=mf("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(t),new Error(t)}return t}checkExpiry(e,t){const{expiry:i}=t;w.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Qy,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Gf.pulse,()=>this.checkExpirations()),this.events.on(Jy,e=>{const t=Jy;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Qy,e=>{const t=Qy;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Zy,e=>{const t=Zy;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=mf("NOT_INITIALIZED",this.name);throw new Error(e)}}}var zv=Object.defineProperty,Hv=(e,t,i)=>((e,t,i)=>t in e?zv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Fv extends xg{constructor(e,t,i){super(e,t,i),this.core=e,this.logger=t,this.store=i,Hv(this,"name","verify-api"),Hv(this,"abortController"),Hv(this,"isDevEnv"),Hv(this,"verifyUrlV3",iw),Hv(this,"storagePrefix",py),Hv(this,"version",2),Hv(this,"publicKey"),Hv(this,"fetchPromise"),Hv(this,"init",async()=>{var e;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&w.toMiliseconds(null==(e=this.publicKey)?void 0:e.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Hv(this,"register",async e=>{if(!Ta()||this.isDevEnv)return;const t=window.location.origin,{id:i,decryptedId:r}=e,s=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${t}&id=${i}&decryptedId=${r}`;try{const e=Y(),t=this.startAbortTimer(5*w.ONE_SECOND),r=await new Promise((r,n)=>{const o=()=>{window.removeEventListener("message",c),e.body.removeChild(a),n("attestation aborted")};this.abortController.signal.addEventListener("abort",o);const a=e.createElement("iframe");a.src=s,a.style.display="none",a.addEventListener("error",o,{signal:this.abortController.signal});const c=s=>{if(s.data&&"string"==typeof s.data)try{const n=JSON.parse(s.data);if("verify_attestation"===n.type){if(Sn(n.attestation).payload.id!==i)return;clearInterval(t),e.body.removeChild(a),this.abortController.signal.removeEventListener("abort",o),window.removeEventListener("message",c),r(null===n.attestation?"":n.attestation)}}catch(n){this.logger.warn(n)}};e.body.appendChild(a),window.addEventListener("message",c,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",r),r}catch(n){this.logger.warn(n)}return""}),Hv(this,"resolve",async e=>{if(this.isDevEnv)return"";const{attestationId:t,hash:i,encryptedId:r}=e;if(""===t)return void this.logger.debug("resolve: attestationId is empty, skipping");if(t){if(Sn(t).payload.id!==r)return;const e=await this.isValidJwtAttestation(t);if(e)return e.isVerified?e:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!i)return;const s=this.getVerifyUrl(null==e?void 0:e.verifyUrl);return this.fetchAttestation(i,s)}),Hv(this,"fetchAttestation",async(e,t)=>{this.logger.debug(`resolving attestation: ${e} from url: ${t}`);const i=this.startAbortTimer(5*w.ONE_SECOND),r=await fetch(`${t}/attestation/${e}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(i),200===r.status?await r.json():void 0}),Hv(this,"getVerifyUrl",e=>{let t=e||tw;return rw.includes(t)||(this.logger.info(`verify url: ${t}, not included in trusted list, assigning default: ${tw}`),t=tw),t}),Hv(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const e=this.startAbortTimer(w.FIVE_SECONDS),t=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(e),await t.json()}catch(e){this.logger.warn(e)}}),Hv(this,"persistPublicKey",async e=>{this.logger.debug("persisting public key to local storage",e),await this.store.setItem(this.storeKey,e),this.publicKey=e}),Hv(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Hv(this,"isValidJwtAttestation",async e=>{const t=await this.getPublicKey();try{if(t)return this.validateAttestation(e,t)}catch(r){this.logger.error(r),this.logger.warn("error validating attestation")}const i=await this.fetchAndPersistPublicKey();try{if(i)return this.validateAttestation(e,i)}catch(r){this.logger.error(r),this.logger.warn("error validating attestation")}}),Hv(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Hv(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async e=>{const t=await this.fetchPublicKey();t&&(await this.persistPublicKey(t),e(t))});const e=await this.fetchPromise;return this.fetchPromise=void 0,e}),Hv(this,"validateAttestation",(e,t)=>{const i=Wd(e,t.publicKey),r={hasExpired:w.toMiliseconds(i.exp)<Date.now(),payload:i};if(r.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:r.payload.origin,isScam:r.payload.isScam,isVerified:r.payload.isVerified}}),this.logger=hg(t,this.name),this.abortController=new AbortController,this.isDevEnv=Ja(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return cg(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),w.toMiliseconds(e))}}var Vv=Object.defineProperty,Kv=(e,t,i)=>((e,t,i)=>t in e?Vv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Wv extends Sg{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,Kv(this,"context","echo"),Kv(this,"registerDeviceToken",async e=>{const{clientId:t,token:i,notificationType:r,enableEncrypted:s=!1}=e,n=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:t,type:r,token:i,always_raw:s})})}),this.logger=hg(t,this.context)}}var Gv=Object.defineProperty,Yv=Object.getOwnPropertySymbols,Jv=Object.prototype.hasOwnProperty,Zv=Object.prototype.propertyIsEnumerable,Qv=(e,t,i)=>t in e?Gv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Xv=(e,t)=>{for(var i in t||(t={}))Jv.call(t,i)&&Qv(e,i,t[i]);if(Yv)for(var i of Yv(t))Zv.call(t,i)&&Qv(e,i,t[i]);return e},eE=(e,t,i)=>Qv(e,"symbol"!=typeof t?t+"":t,i);class tE extends Pg{constructor(e,t,i=!0){super(e,t,i),this.core=e,this.logger=t,eE(this,"context","event-client"),eE(this,"storagePrefix",py),eE(this,"storageVersion",.1),eE(this,"events",new Map),eE(this,"shouldPersist",!1),eE(this,"init",async()=>{if(!Ja())try{const e={eventId:Ya(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Ba(this.core.relayer.protocol,this.core.relayer.version,Uy)}}};await this.sendEvent([e])}catch(e){this.logger.warn(e)}}),eE(this,"createEvent",e=>{const{event:t="ERROR",type:i="",properties:{topic:r,trace:s}}=e,n=Ya(),o=this.core.projectId||"",a=Date.now(),c=Xv({eventId:n,timestamp:a,props:{event:t,type:i,properties:{topic:r,trace:s}},bundleId:o,domain:this.getAppDomain()},this.setMethods(n));return this.telemetryEnabled&&(this.events.set(n,c),this.shouldPersist=!0),c}),eE(this,"getEvent",e=>{const{eventId:t,topic:i}=e;if(t)return this.events.get(t);const r=Array.from(this.events.values()).find(e=>e.props.properties.topic===i);return r?Xv(Xv({},r),this.setMethods(r.eventId)):void 0}),eE(this,"deleteEvent",e=>{const{eventId:t}=e;this.events.delete(t),this.shouldPersist=!0}),eE(this,"setEventListeners",()=>{this.core.heartbeat.on(Gf.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(e=>{w.fromMiliseconds(Date.now())-w.fromMiliseconds(e.timestamp)>86400&&(this.events.delete(e.eventId),this.shouldPersist=!0)})})}),eE(this,"setMethods",e=>({addTrace:t=>this.addTrace(e,t),setError:t=>this.setError(e,t)})),eE(this,"addTrace",(e,t)=>{const i=this.events.get(e);i&&(i.props.properties.trace.push(t),this.events.set(e,i),this.shouldPersist=!0)}),eE(this,"setError",(e,t)=>{const i=this.events.get(e);i&&(i.props.type=t,i.timestamp=Date.now(),this.events.set(e,i),this.shouldPersist=!0)}),eE(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),eE(this,"restore",async()=>{try{const e=await this.core.storage.getItem(this.storageKey)||[];if(!e.length)return;e.forEach(e=>{this.events.set(e.eventId,Xv(Xv({},e),this.setMethods(e.eventId)))})}catch(e){this.logger.warn(e)}}),eE(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;const e=[];for(const[t,i]of this.events)i.props.type&&e.push(i);if(0!==e.length)try{if((await this.sendEvent(e)).ok)for(const t of e)this.events.delete(t.eventId),this.shouldPersist=!0}catch(fh){this.logger.warn(fh)}}),eE(this,"sendEvent",async e=>{const t=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Uy}${t}`,{method:"POST",body:JSON.stringify(e)})}),eE(this,"getAppDomain",()=>Ra().url),this.logger=hg(t,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var iE=Object.defineProperty,rE=Object.getOwnPropertySymbols,sE=Object.prototype.hasOwnProperty,nE=Object.prototype.propertyIsEnumerable,oE=(e,t,i)=>t in e?iE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,aE=(e,t)=>{for(var i in t||(t={}))sE.call(t,i)&&oE(e,i,t[i]);if(rE)for(var i of rE(t))nE.call(t,i)&&oE(e,i,t[i]);return e},cE=(e,t,i)=>oE(e,"symbol"!=typeof t?t+"":t,i);const hE=class e extends fg{constructor(e){var t;super(e),cE(this,"protocol","wc"),cE(this,"version",2),cE(this,"name",fy),cE(this,"relayUrl"),cE(this,"projectId"),cE(this,"customStoragePrefix"),cE(this,"events",new s.EventEmitter),cE(this,"logger"),cE(this,"heartbeat"),cE(this,"relayer"),cE(this,"crypto"),cE(this,"storage"),cE(this,"history"),cE(this,"expirer"),cE(this,"pairing"),cE(this,"verify"),cE(this,"echoClient"),cE(this,"linkModeSupportedApps"),cE(this,"eventClient"),cE(this,"initialized",!1),cE(this,"logChunkController"),cE(this,"on",(e,t)=>this.events.on(e,t)),cE(this,"once",(e,t)=>this.events.once(e,t)),cE(this,"off",(e,t)=>this.events.off(e,t)),cE(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),cE(this,"dispatchEnvelope",({topic:e,message:t,sessionExists:i})=>{if(!e||!t)return;const r={topic:e,message:t,publishedAt:Date.now(),transportType:Ry.link_mode};this.relayer.onLinkMessageEvent(r,{sessionExists:i})});const i=this.getGlobalCore(null==e?void 0:e.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=null==e?void 0:e.projectId,this.relayUrl=(null==e?void 0:e.relayUrl)||vy,this.customStoragePrefix=null!=e&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=ag({level:"string"==typeof(null==e?void 0:e.logger)&&e.logger?e.logger:gy,name:fy}),{logger:n,chunkLoggerController:o}=lg({opts:r,maxSizeInBytes:null==e?void 0:e.maxLogBlobSizeInBytes,loggerOverride:null==e?void 0:e.logger});this.logChunkController=o,null!=(t=this.logChunkController)&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var e,t;null!=(e=this.logChunkController)&&e.downloadLogsBlobInBrowser&&(null==(t=this.logChunkController)||t.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=hg(n,this.name),this.heartbeat=new Yf,this.crypto=new _b(this,this.logger,null==e?void 0:e.keychain),this.history=new Lv(this,this.logger),this.expirer=new qv(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new Op(aE(aE({},yy),null==e?void 0:e.storageOptions)),this.relayer=new gv({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new kv(this,this.logger),this.verify=new Fv(this,this.logger,this.storage),this.echoClient=new Wv(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new tE(this,this.logger,null==e?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(t){const i=new e(t);await i.initialize();const r=await i.crypto.getClientId();return await i.storage.setItem("WALLETCONNECT_CLIENT_ID",r),i}get context(){return cg(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return null==(e=this.logChunkController)?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(jy,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(jy)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(dh){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,dh),this.logger.error(dh.message),dh}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,i=`${t}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[t]}catch(uh){return void console.warn("Failed to get global WalletConnect core",uh)}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${(null==(t=e.opts)?void 0:t.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&"true"==={}.DISABLE_GLOBAL_CORE}catch{return!0}}},lE="client",uE=`wc@2:${lE}:`,dE=lE,fE="error",pE="WALLETCONNECT_DEEPLINK_CHOICE",gE="Proposal expired",yE=w.SEVEN_DAYS,wE={wc_sessionPropose:{req:{ttl:w.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:w.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:w.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:w.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:w.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:w.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:w.ONE_DAY,prompt:!1,tag:1104},res:{ttl:w.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:w.ONE_DAY,prompt:!1,tag:1106},res:{ttl:w.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:w.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:w.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:w.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:w.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:w.ONE_DAY,prompt:!1,tag:1112},res:{ttl:w.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:w.ONE_DAY,prompt:!1,tag:1114},res:{ttl:w.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:w.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:w.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:w.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:w.FIVE_MINUTES,prompt:!1,tag:1119}}},mE={min:w.FIVE_MINUTES,max:w.SEVEN_DAYS},bE="IDLE",vE="ACTIVE",EE={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},IE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],xE="wc@1.5:auth:",SE=`${xE}:PUB_KEY`;var PE=Object.defineProperty,OE=Object.defineProperties,_E=Object.getOwnPropertyDescriptors,AE=Object.getOwnPropertySymbols,TE=Object.prototype.hasOwnProperty,CE=Object.prototype.propertyIsEnumerable,NE=(e,t,i)=>t in e?PE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,UE=(e,t)=>{for(var i in t||(t={}))TE.call(t,i)&&NE(e,i,t[i]);if(AE)for(var i of AE(t))CE.call(t,i)&&NE(e,i,t[i]);return e},RE=(e,t)=>OE(e,_E(t)),BE=(e,t,i)=>NE(e,"symbol"!=typeof t?t+"":t,i);class kE extends Tg{constructor(e){super(e),BE(this,"name","engine"),BE(this,"events",new n),BE(this,"initialized",!1),BE(this,"requestQueue",{state:bE,queue:[]}),BE(this,"sessionRequestQueue",{state:bE,queue:[]}),BE(this,"emittedSessionRequests",new Qa({limit:500})),BE(this,"requestQueueDelay",w.ONE_SECOND),BE(this,"expectedPairingMethodMap",new Map),BE(this,"recentlyDeletedMap",new Map),BE(this,"recentlyDeletedLimit",200),BE(this,"relayMessageCache",[]),BE(this,"pendingSessions",new Map),BE(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(wE)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},w.toMiliseconds(this.requestQueueDelay)))}),BE(this,"connect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const t=RE(UE({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(t),t.optionalNamespaces=function(e,t){var i,r,s,n,o,a;const c=pf(e),h=pf(t),l={},u=Object.keys(c).concat(Object.keys(h));for(const d of u)l[d]={chains:Ka(null==(i=c[d])?void 0:i.chains,null==(r=h[d])?void 0:r.chains),methods:Ka(null==(s=c[d])?void 0:s.methods,null==(n=h[d])?void 0:n.methods),events:Ka(null==(o=c[d])?void 0:o.events,null==(a=h[d])?void 0:a.events)};return l}(t.requiredNamespaces,t.optionalNamespaces),t.requiredNamespaces={};const{pairingTopic:i,requiredNamespaces:r,optionalNamespaces:s,sessionProperties:n,scopedProperties:o,relays:a}=t;let c,h=i,l=!1;try{if(h){const e=this.client.core.pairing.pairings.get(h);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),l=e.active}}catch(E){throw this.client.logger.error(`connect() -> pairing.get(${h}) failed`),E}if(!h||!l){const{topic:e,uri:t}=await this.client.core.pairing.create();h=e,c=t}if(!h){const{message:e}=mf("NO_MATCHING_KEY",`connect() pairing topic: ${h}`);throw new Error(e)}const u=await this.client.core.crypto.generateKeyPair(),d=wE.wc_sessionPropose.req.ttl||w.FIVE_MINUTES,f=Ha(d),p=RE(UE(UE({requiredNamespaces:r,optionalNamespaces:s,relays:a??[{protocol:"irn"}],proposer:{publicKey:u,metadata:this.client.metadata},expiryTimestamp:f,pairingTopic:h},n&&{sessionProperties:n}),o&&{scopedProperties:o}),{id:Kg()}),g=Va("session_connect",p.id),{reject:y,resolve:m,done:b}=$a(d,gE),v=({id:e})=>{e===p.id&&(this.client.events.off("proposal_expire",v),this.pendingSessions.delete(p.id),this.events.emit(g,{error:{message:gE,code:0}}))};return this.client.events.on("proposal_expire",v),this.events.once(g,({error:e,session:t})=>{this.client.events.off("proposal_expire",v),e?y(e):t&&m(t)}),await this.sendRequest({topic:h,method:"wc_sessionPropose",params:p,throwOnFailedPublish:!0,clientRpcId:p.id}),await this.setProposal(p.id,p),{uri:c,approval:b}}),BE(this,"pair",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(e)}catch(dh){throw this.client.logger.error("pair() failed"),dh}}),BE(this,"approve",async e=>{var t,i,r;const s=this.client.core.eventClient.createEvent({properties:{topic:null==(t=null==e?void 0:e.id)?void 0:t.toString(),trace:[vw]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(x){throw s.setError(Tw),x}try{await this.isValidProposalId(null==e?void 0:e.id)}catch(x){throw this.client.logger.error(`approve() -> proposal.get(${null==e?void 0:e.id}) failed`),s.setError(kw),x}try{await this.isValidApprove(e)}catch(x){throw this.client.logger.error("approve() -> isValidApprove() failed"),s.setError(Bw),x}const{id:n,relayProtocol:o,namespaces:a,sessionProperties:c,scopedProperties:h,sessionConfig:l}=e,u=this.client.proposal.get(n);this.client.core.eventClient.deleteEvent({eventId:s.eventId});const{pairingTopic:d,proposer:f,requiredNamespaces:p,optionalNamespaces:g}=u;let y=null==(i=this.client.core.eventClient)?void 0:i.getEvent({topic:d});y||(y=null==(r=this.client.core.eventClient)?void 0:r.createEvent({type:vw,properties:{topic:d,trace:[vw,Ew]}}));const w=await this.client.core.crypto.generateKeyPair(),m=f.publicKey,b=await this.client.core.crypto.generateSharedKey(w,m),v=UE(UE(UE({relay:{protocol:o??"irn"},namespaces:a,controller:{publicKey:w,metadata:this.client.metadata},expiry:Ha(yE)},c&&{sessionProperties:c}),h&&{scopedProperties:h}),l&&{sessionConfig:l}),E=Ry.relay;y.addTrace(Iw);try{await this.client.core.relayer.subscribe(b,{transportType:E})}catch(x){throw y.setError(Nw),x}y.addTrace(xw);const I=RE(UE({},v),{topic:b,requiredNamespaces:p,optionalNamespaces:g,pairingTopic:d,acknowledged:!1,self:v.controller,peer:{publicKey:f.publicKey,metadata:f.metadata},controller:w,transportType:Ry.relay});await this.client.session.set(b,I),y.addTrace(Ow);try{y.addTrace(_w),await this.sendRequest({topic:b,method:"wc_sessionSettle",params:v,throwOnFailedPublish:!0}).catch(e=>{throw null==y||y.setError(Rw),e}),y.addTrace(Aw),y.addTrace(Sw),await this.sendResult({id:n,topic:d,result:{relay:{protocol:o??"irn"},responderPublicKey:w},throwOnFailedPublish:!0}).catch(e=>{throw null==y||y.setError(Uw),e}),y.addTrace(Pw)}catch(x){throw this.client.logger.error(x),this.client.session.delete(b,bf("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(b),x}return this.client.core.eventClient.deleteEvent({eventId:y.eventId}),await this.client.core.pairing.updateMetadata({topic:d,metadata:f.metadata}),await this.deleteProposal(n),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(b,Ha(yE)),{topic:b,acknowledged:()=>Promise.resolve(this.client.session.get(b))}}),BE(this,"reject",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(e)}catch(s){throw this.client.logger.error("reject() -> isValidReject() failed"),s}const{id:t,reason:i}=e;let r;try{r=this.client.proposal.get(t).pairingTopic}catch(s){throw this.client.logger.error(`reject() -> proposal.get(${t}) failed`),s}r&&await this.sendError({id:t,topic:r,error:i,rpcOpts:wE.wc_sessionPropose.reject}),await this.deleteProposal(t)}),BE(this,"update",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(e)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:t,namespaces:i}=e,{done:r,resolve:s,reject:n}=$a(),o=Kg(),a=Wg().toString(),c=this.client.session.get(t).namespaces;return this.events.once(Va("session_update",o),({error:e})=>{e?n(e):s()}),await this.client.session.update(t,{namespaces:i}),await this.sendRequest({topic:t,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:o,relayRpcId:a}).catch(e=>{this.client.logger.error(e),this.client.session.update(t,{namespaces:c}),n(e)}),{acknowledged:r}}),BE(this,"extend",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(e)}catch(o){throw this.client.logger.error("extend() -> isValidExtend() failed"),o}const{topic:t}=e,i=Kg(),{done:r,resolve:s,reject:n}=$a();return this.events.once(Va("session_extend",i),({error:e})=>{e?n(e):s()}),await this.setExpiry(t,Ha(yE)),this.sendRequest({topic:t,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(e=>{n(e)}),{acknowledged:r}}),BE(this,"request",async e=>{this.isInitialized();try{await this.isValidRequest(e)}catch(p){throw this.client.logger.error("request() -> isValidRequest() failed"),p}const{chainId:t,request:i,topic:r,expiry:s=wE.wc_sessionRequest.req.ttl}=e,n=this.client.session.get(r);(null==n?void 0:n.transportType)===Ry.relay&&await this.confirmOnlineStateOrThrow();const o=Kg(),a=Wg().toString(),{done:c,resolve:h,reject:l}=$a(s,"Request expired. Please try again.");this.events.once(Va("session_request",o),({error:e,result:t})=>{e?l(e):h(t)});const u="wc_sessionRequest",d=this.getAppLinkIfEnabled(n.peer.metadata,n.transportType);if(d)return await this.sendRequest({clientRpcId:o,relayRpcId:a,topic:r,method:u,params:{request:RE(UE({},i),{expiryTimestamp:Ha(s)}),chainId:t},expiry:s,throwOnFailedPublish:!0,appLink:d}).catch(e=>l(e)),this.client.events.emit("session_request_sent",{topic:r,request:i,chainId:t,id:o}),await c();const f={request:RE(UE({},i),{expiryTimestamp:Ha(s)}),chainId:t};return await Promise.all([new Promise(async e=>{await this.sendRequest({clientRpcId:o,relayRpcId:a,topic:r,method:u,params:f,expiry:s,throwOnFailedPublish:!0,tvf:this.getTVFParams(o,f)}).catch(e=>l(e)),this.client.events.emit("session_request_sent",{topic:r,request:i,chainId:t,id:o}),e()}),new Promise(async e=>{var t;if(null==(t=n.sessionConfig)||!t.disableDeepLink){const e=await async function(e,t){let i="";try{if(Ta()&&(i=localStorage.getItem(t),i))return i;i=await e.getItem(t)}catch(s){console.error(s)}return i}(this.client.core.storage,pE);await Wa({id:o,topic:r,wcDeepLink:e})}e()}),c()]).then(e=>e[2])}),BE(this,"respond",async e=>{this.isInitialized(),await this.isValidRespond(e);const{topic:t,response:i}=e,{id:r}=i,s=this.client.session.get(t);s.transportType===Ry.relay&&await this.confirmOnlineStateOrThrow();const n=this.getAppLinkIfEnabled(s.peer.metadata,s.transportType);ay(i)?await this.sendResult({id:r,topic:t,result:i.result,throwOnFailedPublish:!0,appLink:n}):cy(i)&&await this.sendError({id:r,topic:t,error:i.error,appLink:n}),this.cleanupAfterResponse(e)}),BE(this,"ping",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(e)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:t}=e;if(this.client.session.keys.includes(t)){const e=Kg(),i=Wg().toString(),{done:r,resolve:s,reject:n}=$a();this.events.once(Va("session_ping",e),({error:e})=>{e?n(e):s()}),await Promise.all([this.sendRequest({topic:t,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:e,relayRpcId:i}),r()])}else this.client.core.pairing.pairings.keys.includes(t)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:t}))}),BE(this,"emit",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(e);const{topic:t,event:i,chainId:r}=e,s=Wg().toString(),n=Kg();await this.sendRequest({topic:t,method:"wc_sessionEvent",params:{event:i,chainId:r},throwOnFailedPublish:!0,relayRpcId:s,clientRpcId:n})}),BE(this,"disconnect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(e);const{topic:t}=e;if(this.client.session.keys.includes(t))await this.sendRequest({topic:t,method:"wc_sessionDelete",params:bf("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:t,emitEvent:!1});else{if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:e}=mf("MISMATCHED_TOPIC",`Session or pairing topic not found: ${t}`);throw new Error(e)}await this.client.core.pairing.disconnect({topic:t})}}),BE(this,"find",e=>(this.isInitialized(),this.client.session.getAll().filter(t=>function(e,t){const{requiredNamespaces:i}=t,r=Object.keys(e.namespaces),s=Object.keys(i);let n=!0;return!!ja(s,r)&&(r.forEach(t=>{const{accounts:r,methods:s,events:o}=e.namespaces[t],a=uf(r),c=i[t];ja(da(t,c),a)&&ja(c.methods,s)&&ja(c.events,o)||(n=!1)}),n)}(t,e)))),BE(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),BE(this,"authenticate",async(e,t)=>{var i;this.isInitialized(),this.isValidAuthenticate(e);const r=t&&this.client.core.linkModeSupportedApps.includes(t)&&(null==(i=this.client.metadata.redirect)?void 0:i.linkMode),s=r?Ry.link_mode:Ry.relay;s===Ry.relay&&await this.confirmOnlineStateOrThrow();const{chains:n,statement:o="",uri:a,domain:c,nonce:h,type:l,exp:u,nbf:d,methods:f=[],expiry:p}=e,g=[...e.resources||[]],{topic:y,uri:w}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:s});this.client.logger.info({message:"Generated new pairing",pairing:{topic:y,uri:w}});const m=await this.client.core.crypto.generateKeyPair(),b=jd(m);if(await Promise.all([this.client.auth.authKeys.set(SE,{responseTopic:b,publicKey:m}),this.client.auth.pairingTopics.set(b,{topic:b,pairingTopic:y})]),await this.client.core.relayer.subscribe(b,{transportType:s}),this.client.logger.info(`sending request to new pairing topic: ${y}`),f.length>0){const{namespace:e}=la(n[0]);let t=gl(e,"request",f);bl(g)&&(t=yl(t,g.pop())),g.push(t)}const v=p&&p>wE.wc_sessionAuthenticate.req.ttl?p:wE.wc_sessionAuthenticate.req.ttl,E={authPayload:{type:l??"caip122",chains:n,statement:o,aud:a,domain:c,version:"1",nonce:h,iat:(new Date).toISOString(),exp:u,nbf:d,resources:g},requester:{publicKey:m,metadata:this.client.metadata},expiryTimestamp:Ha(v)},I={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:n,methods:[...new Set(["personal_sign",...f])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:y,proposer:{publicKey:m,metadata:this.client.metadata},expiryTimestamp:Ha(wE.wc_sessionPropose.req.ttl),id:Kg()},{done:x,resolve:S,reject:P}=$a(v,"Request expired"),O=Kg(),_=Va("session_connect",I.id),A=Va("session_request",O),T=async({error:e,session:t})=>{this.events.off(A,C),e?P(e):t&&S({session:t})},C=async e=>{var i,r,n;if(await this.deletePendingAuthRequest(O,{message:"fulfilled",code:0}),e.error){const t=bf("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return e.error.code===t.code?void 0:(this.events.off(_,T),P(e.error.message))}await this.deleteProposal(I.id),this.events.off(_,T);const{cacaos:o,responder:a}=e.result,c=[],h=[];for(const t of o){await hl({cacao:t,projectId:this.client.core.projectId})||(this.client.logger.error(t,"Signature verification failed"),P(bf("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:e}=t,i=bl(e.resources),r=[al(e.iss)],s=cl(e.iss);if(i){const e=wl(i),t=ml(i);c.push(...e),r.push(...t)}for(const t of r)h.push(`${t}:${s}`)}const l=await this.client.core.crypto.generateSharedKey(m,a.publicKey);let u;c.length>0&&(u={topic:l,acknowledged:!0,self:{publicKey:m,metadata:this.client.metadata},peer:a,controller:a.publicKey,expiry:Ha(yE),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:y,namespaces:gf([...new Set(c)],[...new Set(h)]),transportType:s},await this.client.core.relayer.subscribe(l,{transportType:s}),await this.client.session.set(l,u),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:a.metadata}),u=this.client.session.get(l)),null!=(i=this.client.metadata.redirect)&&i.linkMode&&null!=(r=a.metadata.redirect)&&r.linkMode&&null!=(n=a.metadata.redirect)&&n.universal&&t&&(this.client.core.addLinkModeSupportedApp(a.metadata.redirect.universal),this.client.session.update(l,{transportType:Ry.link_mode})),S({auths:o,session:u})};let N;this.events.once(_,T),this.events.once(A,C);try{if(r){const e=Gg("wc_sessionAuthenticate",E,O);this.client.core.history.set(y,e);const i=await this.client.core.crypto.encode("",e,{type:2,encoding:Rd});N=ef(t,y,i)}else await Promise.all([this.sendRequest({topic:y,method:"wc_sessionAuthenticate",params:E,expiry:e.expiry,throwOnFailedPublish:!0,clientRpcId:O}),this.sendRequest({topic:y,method:"wc_sessionPropose",params:I,expiry:wE.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:I.id})])}catch(U){throw this.events.off(_,T),this.events.off(A,C),U}return await this.setProposal(I.id,I),await this.setAuthRequest(O,{request:RE(UE({},E),{verifyContext:{}}),pairingTopic:y,transportType:s}),{uri:N??w,response:x}}),BE(this,"approveSessionAuthenticate",async e=>{const{id:t,auths:i}=e,r=this.client.core.eventClient.createEvent({properties:{topic:t.toString(),trace:[jw]}});try{this.isInitialized()}catch(p){throw r.setError(Hw),p}const s=this.getPendingAuthRequest(t);if(!s)throw r.setError(Ww),new Error(`Could not find pending auth request with id ${t}`);const n=s.transportType||Ry.relay;n===Ry.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=jd(o),h={type:1,receiverPublicKey:o,senderPublicKey:a},l=[],u=[];for(const g of i){if(!(await hl({cacao:g,projectId:this.client.core.projectId}))){r.setError(Fw);const e=bf("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:t,topic:c,error:e,encodeOpts:h}),new Error(e.message)}r.addTrace(Lw);const{p:e}=g,i=bl(e.resources),s=[al(e.iss)],n=cl(e.iss);if(i){const e=wl(i),t=ml(i);l.push(...e),s.push(...t)}for(const t of s)u.push(`${t}:${n}`)}const d=await this.client.core.crypto.generateSharedKey(a,o);let f;if(r.addTrace(Dw),(null==l?void 0:l.length)>0){f={topic:d,acknowledged:!0,self:{publicKey:a,metadata:this.client.metadata},peer:{publicKey:o,metadata:s.requester.metadata},controller:o,expiry:Ha(yE),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:s.pairingTopic,namespaces:gf([...new Set(l)],[...new Set(u)]),transportType:n},r.addTrace(Mw);try{await this.client.core.relayer.subscribe(d,{transportType:n})}catch(p){throw r.setError(Vw),p}r.addTrace(qw),await this.client.session.set(d,f),r.addTrace($w),await this.client.core.pairing.updateMetadata({topic:s.pairingTopic,metadata:s.requester.metadata})}r.addTrace(zw);try{await this.sendResult({topic:c,id:t,result:{cacaos:i,responder:{publicKey:a,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(s.requester.metadata,n)})}catch(p){throw r.setError(Kw),p}return await this.client.auth.requests.delete(t,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:s.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:r.eventId}),{session:f}}),BE(this,"rejectSessionAuthenticate",async e=>{this.isInitialized();const{id:t,reason:i}=e,r=this.getPendingAuthRequest(t);if(!r)throw new Error(`Could not find pending auth request with id ${t}`);r.transportType===Ry.relay&&await this.confirmOnlineStateOrThrow();const s=r.requester.publicKey,n=await this.client.core.crypto.generateKeyPair(),o=jd(s),a={type:1,receiverPublicKey:s,senderPublicKey:n};await this.sendError({id:t,topic:o,error:i,encodeOpts:a,rpcOpts:wE.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(r.requester.metadata,r.transportType)}),await this.client.auth.requests.delete(t,{message:"rejected",code:0}),await this.deleteProposal(t)}),BE(this,"formatAuthMessage",e=>{this.isInitialized();const{request:t,iss:i}=e;return ll(t,i)}),BE(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{const e=this.relayMessageCache.shift();e&&await this.onRelayMessage(e)}catch(uh){this.client.logger.error(uh)}},50)}),BE(this,"cleanupDuplicatePairings",async e=>{if(e.pairingTopic)try{const t=this.client.core.pairing.pairings.get(e.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(i=>{var r,s;return(null==(r=i.peerMetadata)?void 0:r.url)&&(null==(s=i.peerMetadata)?void 0:s.url)===e.peer.metadata.url&&i.topic&&i.topic!==t.topic});if(0===i.length)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(e=>this.client.core.pairing.disconnect({topic:e.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(dh){this.client.logger.error(dh)}}),BE(this,"deleteSession",async e=>{var t;const{topic:i,expirerHasDeleted:r=!1,emitEvent:s=!0,id:n=0}=e,{self:o}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,bf("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),r||this.client.core.expirer.del(i),this.client.core.storage.removeItem(pE).catch(e=>this.client.logger.warn(e)),this.getPendingSessionRequests().forEach(e=>{e.topic===i&&this.deletePendingSessionRequest(e.id,bf("USER_DISCONNECTED"))}),i===(null==(t=this.sessionRequestQueue.queue[0])?void 0:t.topic)&&(this.sessionRequestQueue.state=bE),s&&this.client.events.emit("session_delete",{id:n,topic:i})}),BE(this,"deleteProposal",async(e,t)=>{if(t)try{const t=this.client.proposal.get(e),i=this.client.core.eventClient.getEvent({topic:t.pairingTopic});null==i||i.setError(Cw)}catch{}await Promise.all([this.client.proposal.delete(e,bf("USER_DISCONNECTED")),t?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"proposal")}),BE(this,"deletePendingSessionRequest",async(e,t,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,t),i?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(t=>t.id!==e),i&&(this.sessionRequestQueue.state=bE,this.client.events.emit("session_request_expire",{id:e}))}),BE(this,"deletePendingAuthRequest",async(e,t,i=!1)=>{await Promise.all([this.client.auth.requests.delete(e,t),i?Promise.resolve():this.client.core.expirer.del(e)])}),BE(this,"setExpiry",async(e,t)=>{this.client.session.keys.includes(e)&&(this.client.core.expirer.set(e,t),await this.client.session.update(e,{expiry:t}))}),BE(this,"setProposal",async(e,t)=>{this.client.core.expirer.set(e,Ha(wE.wc_sessionPropose.req.ttl)),await this.client.proposal.set(e,t)}),BE(this,"setAuthRequest",async(e,t)=>{const{request:i,pairingTopic:r,transportType:s=Ry.relay}=t;this.client.core.expirer.set(e,i.expiryTimestamp),await this.client.auth.requests.set(e,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:e,pairingTopic:r,verifyContext:i.verifyContext,transportType:s})}),BE(this,"setPendingSessionRequest",async e=>{const{id:t,topic:i,params:r,verifyContext:s}=e,n=r.request.expiryTimestamp||Ha(wE.wc_sessionRequest.req.ttl);this.client.core.expirer.set(t,n),await this.client.pendingRequest.set(t,{id:t,topic:i,params:r,verifyContext:s})}),BE(this,"sendRequest",async e=>{const{topic:t,method:i,params:r,expiry:s,relayRpcId:n,clientRpcId:o,throwOnFailedPublish:a,appLink:c,tvf:h}=e,l=Gg(i,r,o);let u;const d=!!c;try{const e=d?Rd:Ud;u=await this.client.core.crypto.encode(t,l,{encoding:e})}catch(g){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${t} failed`),g}let f;if(IE.includes(i)){const e=Dd(JSON.stringify(l)),t=Dd(u);f=await this.client.core.verify.register({id:t,decryptedId:e})}const p=wE[i].req;if(p.attestation=f,s&&(p.ttl=s),n&&(p.id=n),this.client.core.history.set(t,l),d){const e=ef(c,t,u);await global.Linking.openURL(e,this.client.name)}else{const e=wE[i].req;s&&(e.ttl=s),n&&(e.id=n),e.tvf=RE(UE({},h),{correlationId:l.id}),a?(e.internal=RE(UE({},e.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(t,u,e)):this.client.core.relayer.publish(t,u,e).catch(e=>this.client.logger.error(e))}return l.id}),BE(this,"sendResult",async e=>{const{id:t,topic:i,result:r,throwOnFailedPublish:s,encodeOpts:n,appLink:o}=e,a=Yg(t,r);let c;const h=o&&typeof(null==global?void 0:global.Linking)<"u";try{const e=h?Rd:Ud;c=await this.client.core.crypto.encode(i,a,RE(UE({},n||{}),{encoding:e}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),d}let l,u;try{l=await this.client.core.history.get(i,t);const e=l.request;try{u=this.getTVFParams(t,e.params,r)}catch(f){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${null==f?void 0:f.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${t}) failed`),d}if(h){const e=ef(o,i,c);await global.Linking.openURL(e,this.client.name)}else{const e=l.request.method,r=wE[e].res;r.tvf=RE(UE({},u),{correlationId:t}),s?(r.internal=RE(UE({},r.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,c,r)):this.client.core.relayer.publish(i,c,r).catch(e=>this.client.logger.error(e))}await this.client.core.history.resolve(a)}),BE(this,"sendError",async e=>{const{id:t,topic:i,error:r,encodeOpts:s,rpcOpts:n,appLink:o}=e,a=Jg(t,r);let c;const h=o&&typeof(null==global?void 0:global.Linking)<"u";try{const e=h?Rd:Ud;c=await this.client.core.crypto.encode(i,a,RE(UE({},s||{}),{encoding:e}))}catch(u){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),u}let l;try{l=await this.client.core.history.get(i,t)}catch(u){throw this.client.logger.error(`sendError() -> history.get(${i}, ${t}) failed`),u}if(h){const e=ef(o,i,c);await global.Linking.openURL(e,this.client.name)}else{const e=l.request.method,t=n||wE[e].res;this.client.core.relayer.publish(i,c,t)}await this.client.core.history.resolve(a)}),BE(this,"cleanup",async()=>{const e=[],t=[];this.client.session.getAll().forEach(t=>{let i=!1;Fa(t.expiry)&&(i=!0),this.client.core.crypto.keychain.has(t.topic)||(i=!0),i&&e.push(t.topic)}),this.client.proposal.getAll().forEach(e=>{Fa(e.expiryTimestamp)&&t.push(e.id)}),await Promise.all([...e.map(e=>this.deleteSession({topic:e})),...t.map(e=>this.deleteProposal(e))])}),BE(this,"onProviderMessageEvent",async e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):await this.onRelayMessage(e)}),BE(this,"onRelayEventRequest",async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()}),BE(this,"processRequestsQueue",async()=>{if(this.requestQueue.state!==vE){for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=vE;const e=this.requestQueue.queue.shift();if(e)try{await this.processRequest(e)}catch(dh){this.client.logger.warn(dh)}}this.requestQueue.state=bE}else this.client.logger.info("Request queue already active, skipping...")}),BE(this,"processRequest",async e=>{const{topic:t,payload:i,attestation:r,transportType:s,encryptedId:n}=e,o=i.method;if(!this.shouldIgnorePairingRequest({topic:t,requestMethod:o}))switch(o){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:t,payload:i,attestation:r,encryptedId:n});case"wc_sessionSettle":return await this.onSessionSettleRequest(t,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(t,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(t,i);case"wc_sessionPing":return await this.onSessionPingRequest(t,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(t,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:t,payload:i,attestation:r,encryptedId:n,transportType:s});case"wc_sessionEvent":return await this.onSessionEventRequest(t,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:t,payload:i,attestation:r,encryptedId:n,transportType:s});default:return this.client.logger.info(`Unsupported request method ${o}`)}}),BE(this,"onRelayEventResponse",async e=>{const{topic:t,payload:i,transportType:r}=e,s=(await this.client.core.history.get(t,i.id)).request.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeResponse(t,i,r);case"wc_sessionSettle":return this.onSessionSettleResponse(t,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(t,i);case"wc_sessionExtend":return this.onSessionExtendResponse(t,i);case"wc_sessionPing":return this.onSessionPingResponse(t,i);case"wc_sessionRequest":return this.onSessionRequestResponse(t,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(t,i);default:return this.client.logger.info(`Unsupported response method ${s}`)}}),BE(this,"onRelayEventUnknownPayload",e=>{const{topic:t}=e,{message:i}=mf("MISSING_OR_INVALID",`Decoded payload on topic ${t} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),BE(this,"shouldIgnorePairingRequest",e=>{const{topic:t,requestMethod:i}=e,r=this.expectedPairingMethodMap.get(t);return!(!r||r.includes(i))&&!!(r.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),BE(this,"onSessionProposeRequest",async e=>{const{topic:t,payload:i,attestation:r,encryptedId:s}=e,{params:n,id:o}=i;try{const e=this.client.core.eventClient.getEvent({topic:t});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),null==e||e.setError(bw)),this.isValidConnect(UE({},i.params));const a=n.expiryTimestamp||Ha(wE.wc_sessionPropose.req.ttl),c=UE({id:o,pairingTopic:t,expiryTimestamp:a,attestation:r,encryptedId:s},n);await this.setProposal(o,c);const h=await this.getVerifyContext({attestationId:r,hash:Dd(JSON.stringify(i)),encryptedId:s,metadata:c.proposer.metadata});null==e||e.addTrace(fw),this.client.events.emit("session_proposal",{id:o,params:c,verifyContext:h})}catch(a){await this.sendError({id:o,topic:t,error:a,rpcOpts:wE.wc_sessionPropose.autoReject}),this.client.logger.error(a)}}),BE(this,"onSessionProposeResponse",async(e,t,i)=>{const{id:r}=t;if(ay(t)){const{result:s}=t;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:s});const n=this.client.proposal.get(r);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:n});const o=n.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:o});const a=s.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:a});const c=await this.client.core.crypto.generateSharedKey(o,a);this.pendingSessions.set(r,{sessionTopic:c,pairingTopic:e,proposalId:r,publicKey:o});const h=await this.client.core.relayer.subscribe(c,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:e})}else if(cy(t)){await this.deleteProposal(r);const e=Va("session_connect",r);if(0===this.events.listenerCount(e))throw new Error(`emitting ${e} without any listeners, 954`);this.events.emit(e,{error:t.error})}}),BE(this,"onSessionSettleRequest",async(e,t)=>{const{id:i,params:r}=t;try{this.isValidSessionSettleRequest(r);const{relay:i,controller:s,expiry:n,namespaces:o,sessionProperties:a,scopedProperties:c,sessionConfig:h}=t.params,l=[...this.pendingSessions.values()].find(t=>t.sessionTopic===e);if(!l)return this.client.logger.error(`Pending session not found for topic ${e}`);const u=this.client.proposal.get(l.proposalId),d=RE(UE(UE(UE({topic:e,relay:i,expiry:n,namespaces:o,acknowledged:!0,pairingTopic:l.pairingTopic,requiredNamespaces:u.requiredNamespaces,optionalNamespaces:u.optionalNamespaces,controller:s.publicKey,self:{publicKey:l.publicKey,metadata:this.client.metadata},peer:{publicKey:s.publicKey,metadata:s.metadata}},a&&{sessionProperties:a}),c&&{scopedProperties:c}),h&&{sessionConfig:h}),{transportType:Ry.relay});await this.client.session.set(d.topic,d),await this.setExpiry(d.topic,d.expiry),await this.client.core.pairing.updateMetadata({topic:l.pairingTopic,metadata:d.peer.metadata}),this.client.events.emit("session_connect",{session:d}),this.events.emit(Va("session_connect",l.proposalId),{session:d}),this.pendingSessions.delete(l.proposalId),this.deleteProposal(l.proposalId,!1),this.cleanupDuplicatePairings(d),await this.sendResult({id:t.id,topic:e,result:!0})}catch(s){await this.sendError({id:i,topic:e,error:s}),this.client.logger.error(s)}}),BE(this,"onSessionSettleResponse",async(e,t)=>{const{id:i}=t;ay(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(Va("session_approve",i),{})):cy(t)&&(await this.client.session.delete(e,bf("USER_DISCONNECTED")),this.events.emit(Va("session_approve",i),{error:t.error}))}),BE(this,"onSessionUpdateRequest",async(e,t)=>{const{params:i,id:r}=t;try{const t=`${e}_session_update`,n=qf.get(t);if(n&&this.isRequestOutOfSync(n,r))return this.client.logger.warn(`Discarding out of sync request - ${r}`),void this.sendError({id:r,topic:e,error:bf("INVALID_UPDATE_REQUEST")});this.isValidUpdate(UE({topic:e},i));try{qf.set(t,r),await this.client.session.update(e,{namespaces:i.namespaces}),await this.sendResult({id:r,topic:e,result:!0})}catch(s){throw qf.delete(t),s}this.client.events.emit("session_update",{id:r,topic:e,params:i})}catch(n){await this.sendError({id:r,topic:e,error:n}),this.client.logger.error(n)}}),BE(this,"isRequestOutOfSync",(e,t)=>t.toString().slice(0,-3)<e.toString().slice(0,-3)),BE(this,"onSessionUpdateResponse",(e,t)=>{const{id:i}=t,r=Va("session_update",i);if(0===this.events.listenerCount(r))throw new Error(`emitting ${r} without any listeners`);ay(t)?this.events.emit(Va("session_update",i),{}):cy(t)&&this.events.emit(Va("session_update",i),{error:t.error})}),BE(this,"onSessionExtendRequest",async(e,t)=>{const{id:i}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,Ha(yE)),await this.sendResult({id:i,topic:e,result:!0}),this.client.events.emit("session_extend",{id:i,topic:e})}catch(r){await this.sendError({id:i,topic:e,error:r}),this.client.logger.error(r)}}),BE(this,"onSessionExtendResponse",(e,t)=>{const{id:i}=t,r=Va("session_extend",i);if(0===this.events.listenerCount(r))throw new Error(`emitting ${r} without any listeners`);ay(t)?this.events.emit(Va("session_extend",i),{}):cy(t)&&this.events.emit(Va("session_extend",i),{error:t.error})}),BE(this,"onSessionPingRequest",async(e,t)=>{const{id:i}=t;try{this.isValidPing({topic:e}),await this.sendResult({id:i,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:e})}catch(r){await this.sendError({id:i,topic:e,error:r}),this.client.logger.error(r)}}),BE(this,"onSessionPingResponse",(e,t)=>{const{id:i}=t,r=Va("session_ping",i);setTimeout(()=>{if(0===this.events.listenerCount(r))throw new Error(`emitting ${r} without any listeners 2176`);ay(t)?this.events.emit(Va("session_ping",i),{}):cy(t)&&this.events.emit(Va("session_ping",i),{error:t.error})},500)}),BE(this,"onSessionDeleteRequest",async(e,t)=>{const{id:i}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),Promise.all([new Promise(t=>{this.client.core.relayer.once(_y,async()=>{t(await this.deleteSession({topic:e,id:i}))})}),this.sendResult({id:i,topic:e,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:e,error:bf("USER_DISCONNECTED")})]).catch(e=>this.client.logger.error(e))}catch(r){this.client.logger.error(r)}}),BE(this,"onSessionRequest",async e=>{var t,i,r;const{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=e,{id:h,params:l}=n;try{await this.isValidRequest(UE({topic:s},l));const e=this.client.session.get(s),n={id:h,topic:s,params:l,verifyContext:await this.getVerifyContext({attestationId:o,hash:Dd(JSON.stringify(Gg("wc_sessionRequest",l,h))),encryptedId:a,metadata:e.peer.metadata,transportType:c})};await this.setPendingSessionRequest(n),c===Ry.link_mode&&null!=(t=e.peer.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(null==(i=e.peer.metadata.redirect)?void 0:i.universal),null!=(r=this.client.signConfig)&&r.disableRequestQueue?this.emitSessionRequest(n):(this.addSessionRequestToSessionRequestQueue(n),this.processSessionRequestQueue())}catch(u){await this.sendError({id:h,topic:s,error:u}),this.client.logger.error(u)}}),BE(this,"onSessionRequestResponse",(e,t)=>{const{id:i}=t,r=Va("session_request",i);if(0===this.events.listenerCount(r))throw new Error(`emitting ${r} without any listeners`);ay(t)?this.events.emit(Va("session_request",i),{result:t.result}):cy(t)&&this.events.emit(Va("session_request",i),{error:t.error})}),BE(this,"onSessionEventRequest",async(e,t)=>{const{id:i,params:r}=t;try{const t=`${e}_session_event_${r.event.name}`,s=qf.get(t);if(s&&this.isRequestOutOfSync(s,i))return void this.client.logger.info(`Discarding out of sync request - ${i}`);this.isValidEmit(UE({topic:e},r)),this.client.events.emit("session_event",{id:i,topic:e,params:r}),qf.set(t,i)}catch(s){await this.sendError({id:i,topic:e,error:s}),this.client.logger.error(s)}}),BE(this,"onSessionAuthenticateResponse",(e,t)=>{const{id:i}=t;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:e,payload:t}),ay(t)?this.events.emit(Va("session_request",i),{result:t.result}):cy(t)&&this.events.emit(Va("session_request",i),{error:t.error})}),BE(this,"onSessionAuthenticateRequest",async e=>{var t;const{topic:i,payload:r,attestation:s,encryptedId:n,transportType:o}=e;try{const{requester:e,authPayload:a,expiryTimestamp:c}=r.params,h=await this.getVerifyContext({attestationId:s,hash:Dd(JSON.stringify(r)),encryptedId:n,metadata:e.metadata,transportType:o}),l={requester:e,pairingTopic:i,id:r.id,authPayload:a,verifyContext:h,expiryTimestamp:c};await this.setAuthRequest(r.id,{request:l,pairingTopic:i,transportType:o}),o===Ry.link_mode&&null!=(t=e.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(e.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:r.params,id:r.id,verifyContext:h})}catch(a){this.client.logger.error(a);const e=r.params.requester.publicKey,t=await this.client.core.crypto.generateKeyPair(),s=this.getAppLinkIfEnabled(r.params.requester.metadata,o),n={type:1,receiverPublicKey:e,senderPublicKey:t};await this.sendError({id:r.id,topic:i,error:a,encodeOpts:n,rpcOpts:wE.wc_sessionAuthenticate.autoReject,appLink:s})}}),BE(this,"addSessionRequestToSessionRequestQueue",e=>{this.sessionRequestQueue.queue.push(e)}),BE(this,"cleanupAfterResponse",e=>{this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=bE,this.processSessionRequestQueue()},w.toMiliseconds(this.requestQueueDelay))}),BE(this,"cleanupPendingSentRequestsForTopic",({topic:e,error:t})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(t=>t.topic===e&&"wc_sessionRequest"===t.request.method).forEach(e=>{const i=Va("session_request",e.request.id);if(0===this.events.listenerCount(i))throw new Error(`emitting ${i} without any listeners`);this.events.emit(Va("session_request",e.request.id),{error:t})})}),BE(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===vE)return void this.client.logger.info("session request queue is already active.");const e=this.sessionRequestQueue.queue[0];if(e)try{this.emitSessionRequest(e)}catch(dh){this.client.logger.error(dh)}else this.client.logger.info("session request queue is empty.")}),BE(this,"emitSessionRequest",e=>{this.emittedSessionRequests.has(e.id)?this.client.logger.warn({id:e.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${e.id}`):(this.sessionRequestQueue.state=vE,this.emittedSessionRequests.add(e.id),this.client.events.emit("session_request",e))}),BE(this,"onPairingCreated",e=>{if(e.methods&&this.expectedPairingMethodMap.set(e.topic,e.methods),e.active)return;const t=this.client.proposal.getAll().find(t=>t.pairingTopic===e.topic);t&&this.onSessionProposeRequest({topic:e.topic,payload:Gg("wc_sessionPropose",RE(UE({},t),{requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces,relays:t.relays,proposer:t.proposer,sessionProperties:t.sessionProperties,scopedProperties:t.scopedProperties}),t.id),attestation:t.attestation,encryptedId:t.encryptedId})}),BE(this,"isValidConnect",async e=>{if(!Uf(e)){const{message:t}=mf("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(e)}`);throw new Error(t)}const{pairingTopic:t,requiredNamespaces:i,optionalNamespaces:r,sessionProperties:s,scopedProperties:n,relays:o}=e;if(If(t)||await this.isValidPairingTopic(t),!function(e,t){let i=!1;return t&&!e?i=!0:e&&vf(e)&&e.length&&e.forEach(e=>{i=Nf(e)}),i}(o,!0)){const{message:e}=mf("MISSING_OR_INVALID",`connect() relays: ${o}`);throw new Error(e)}if(!If(i)&&0!==Ef(i)){const e="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(e):this.client.logger.warn(e),this.validateNamespaces(i,"requiredNamespaces")}if(!If(r)&&0!==Ef(r)&&this.validateNamespaces(r,"optionalNamespaces"),If(s)||this.validateSessionProps(s,"sessionProperties"),!If(n)){this.validateSessionProps(n,"scopedProperties");const e=Object.keys(i||{}).concat(Object.keys(r||{}));if(!Object.keys(n).every(t=>e.includes(t.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(n)}, required/optional namespaces: ${JSON.stringify(e)}`)}}),BE(this,"validateNamespaces",(e,t)=>{const i=function(e,t,i){let r=null;if(e&&Ef(e)){const s=Tf(e,t);s&&(r=s);const n=_f(e,t,i);n&&(r=n)}else r=mf("MISSING_OR_INVALID",`${t}, ${i} should be an object with data`);return r}(e,"connect()",t);if(i)throw new Error(i.message)}),BE(this,"isValidApprove",async e=>{if(!Uf(e))throw new Error(mf("MISSING_OR_INVALID",`approve() params: ${e}`).message);const{id:t,namespaces:i,relayProtocol:r,sessionProperties:s,scopedProperties:n}=e;this.checkRecentlyDeleted(t),await this.isValidProposalId(t);const o=this.client.proposal.get(t),a=Cf(i,"approve()");if(a)throw new Error(a.message);const c=jf(o.requiredNamespaces,i,"approve()");if(c)throw new Error(c.message);if(!xf(r,!0)){const{message:e}=mf("MISSING_OR_INVALID",`approve() relayProtocol: ${r}`);throw new Error(e)}if(If(s)||this.validateSessionProps(s,"sessionProperties"),!If(n)){this.validateSessionProps(n,"scopedProperties");const e=new Set(Object.keys(i));if(!Object.keys(n).every(t=>e.has(t.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(n)}, approved namespaces: ${Array.from(e).join(", ")}`)}}),BE(this,"isValidReject",async e=>{if(!Uf(e)){const{message:t}=mf("MISSING_OR_INVALID",`reject() params: ${e}`);throw new Error(t)}const{id:t,reason:i}=e;if(this.checkRecentlyDeleted(t),await this.isValidProposalId(t),!function(e){return!!(e&&"object"==typeof e&&e.code&&Sf(e.code,!1)&&e.message&&xf(e.message,!1))}(i)){const{message:e}=mf("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(e)}}),BE(this,"isValidSessionSettleRequest",e=>{if(!Uf(e)){const{message:t}=mf("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${e}`);throw new Error(t)}const{relay:t,controller:i,namespaces:r,expiry:s}=e;if(!Nf(t)){const{message:e}=mf("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(e)}const n=function(e,t){let i=null;return xf(null==e?void 0:e.publicKey,!1)||(i=mf("MISSING_OR_INVALID",`${t} controller public key should be a string`)),i}(i,"onSessionSettleRequest()");if(n)throw new Error(n.message);const o=Cf(r,"onSessionSettleRequest()");if(o)throw new Error(o.message);if(Fa(s)){const{message:e}=mf("EXPIRED","onSessionSettleRequest()");throw new Error(e)}}),BE(this,"isValidUpdate",async e=>{if(!Uf(e)){const{message:t}=mf("MISSING_OR_INVALID",`update() params: ${e}`);throw new Error(t)}const{topic:t,namespaces:i}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);const r=this.client.session.get(t),s=Cf(i,"update()");if(s)throw new Error(s.message);const n=jf(r.requiredNamespaces,i,"update()");if(n)throw new Error(n.message)}),BE(this,"isValidExtend",async e=>{if(!Uf(e)){const{message:t}=mf("MISSING_OR_INVALID",`extend() params: ${e}`);throw new Error(t)}const{topic:t}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t)}),BE(this,"isValidRequest",async e=>{if(!Uf(e)){const{message:t}=mf("MISSING_OR_INVALID",`request() params: ${e}`);throw new Error(t)}const{topic:t,request:i,chainId:r,expiry:s}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);const{namespaces:n}=this.client.session.get(t);if(!Rf(n,r)){const{message:e}=mf("MISSING_OR_INVALID",`request() chainId: ${r}`);throw new Error(e)}if(!function(e){return!(If(e)||!xf(e.method,!1))}(i)){const{message:e}=mf("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(e)}if(!Bf(n,r,i.method)){const{message:e}=mf("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(e)}if(s&&!function(e,t){return Sf(e,!1)&&e<=t.max&&e>=t.min}(s,mE)){const{message:e}=mf("MISSING_OR_INVALID",`request() expiry: ${s}. Expiry must be a number (in seconds) between ${mE.min} and ${mE.max}`);throw new Error(e)}}),BE(this,"isValidRespond",async e=>{var t;if(!Uf(e)){const{message:t}=mf("MISSING_OR_INVALID",`respond() params: ${e}`);throw new Error(t)}const{topic:i,response:r}=e;try{await this.isValidSessionTopic(i)}catch(s){throw null!=(t=null==e?void 0:e.response)&&t.id&&this.cleanupAfterResponse(e),s}if(!function(e){return!(If(e)||If(e.result)&&If(e.error)||!Sf(e.id,!1)||!xf(e.jsonrpc,!1))}(r)){const{message:e}=mf("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(r)}`);throw new Error(e)}}),BE(this,"isValidPing",async e=>{if(!Uf(e)){const{message:t}=mf("MISSING_OR_INVALID",`ping() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),BE(this,"isValidEmit",async e=>{if(!Uf(e)){const{message:t}=mf("MISSING_OR_INVALID",`emit() params: ${e}`);throw new Error(t)}const{topic:t,event:i,chainId:r}=e;await this.isValidSessionTopic(t);const{namespaces:s}=this.client.session.get(t);if(!Rf(s,r)){const{message:e}=mf("MISSING_OR_INVALID",`emit() chainId: ${r}`);throw new Error(e)}if(!function(e){return!(If(e)||!xf(e.name,!1))}(i)){const{message:e}=mf("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(e)}if(!kf(s,r,i.name)){const{message:e}=mf("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(e)}}),BE(this,"isValidDisconnect",async e=>{if(!Uf(e)){const{message:t}=mf("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw new Error(t)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),BE(this,"isValidAuthenticate",e=>{const{chains:t,uri:i,domain:r,nonce:s}=e;if(!Array.isArray(t)||0===t.length)throw new Error("chains is required and must be a non-empty array");if(!xf(i,!1))throw new Error("uri is required parameter");if(!xf(r,!1))throw new Error("domain is required parameter");if(!xf(s,!1))throw new Error("nonce is required parameter");if([...new Set(t.map(e=>la(e).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:n}=la(t[0]);if("eip155"!==n)throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),BE(this,"getVerifyContext",async e=>{const{attestationId:t,hash:i,encryptedId:r,metadata:s,transportType:n}=e,o={verified:{verifyUrl:s.verifyUrl||tw,validation:"UNKNOWN",origin:s.url||""}};try{if(n===Ry.link_mode){const e=this.getAppLinkIfEnabled(s,n);return o.verified.validation=e&&new URL(e).origin===new URL(s.url).origin?"VALID":"INVALID",o}const e=await this.client.core.verify.resolve({attestationId:t,hash:i,encryptedId:r,verifyUrl:s.verifyUrl});e&&(o.verified.origin=e.origin,o.verified.isScam=e.isScam,o.verified.validation=e.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(a){this.client.logger.warn(a)}return this.client.logger.debug(`Verify context: ${JSON.stringify(o)}`),o}),BE(this,"validateSessionProps",(e,t)=>{Object.values(e).forEach((i,r)=>{if(null==i){const{message:s}=mf("MISSING_OR_INVALID",`${t} must contain an existing value for each key. Received: ${i} for key ${Object.keys(e)[r]}`);throw new Error(s)}})}),BE(this,"getPendingAuthRequest",e=>{const t=this.client.auth.requests.get(e);return"object"==typeof t?t:void 0}),BE(this,"addToRecentlyDeleted",(e,t)=>{if(this.recentlyDeletedMap.set(e,t),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let e=0;const t=this.recentlyDeletedLimit/2;for(const i of this.recentlyDeletedMap.keys()){if(e++>=t)break;this.recentlyDeletedMap.delete(i)}}}),BE(this,"checkRecentlyDeleted",e=>{const t=this.recentlyDeletedMap.get(e);if(t){const{message:i}=mf("MISSING_OR_INVALID",`Record was recently deleted - ${t}: ${e}`);throw new Error(i)}}),BE(this,"isLinkModeEnabled",(e,t)=>{var i,r,s,n,o,a,c,h,l;return!(!e||t!==Ry.link_mode)&&(!0===(null==(r=null==(i=this.client.metadata)?void 0:i.redirect)?void 0:r.linkMode)&&void 0!==(null==(n=null==(s=this.client.metadata)?void 0:s.redirect)?void 0:n.universal)&&""!==(null==(a=null==(o=this.client.metadata)?void 0:o.redirect)?void 0:a.universal)&&void 0!==(null==(c=null==e?void 0:e.redirect)?void 0:c.universal)&&""!==(null==(h=null==e?void 0:e.redirect)?void 0:h.universal)&&!0===(null==(l=null==e?void 0:e.redirect)?void 0:l.linkMode)&&this.client.core.linkModeSupportedApps.includes(e.redirect.universal)&&typeof(null==global?void 0:global.Linking)<"u")}),BE(this,"getAppLinkIfEnabled",(e,t)=>{var i;return this.isLinkModeEnabled(e,t)?null==(i=null==e?void 0:e.redirect)?void 0:i.universal:void 0}),BE(this,"handleLinkModeMessage",({url:e})=>{if(!e||!e.includes("wc_ev")||!e.includes("topic"))return;const t=Ga(e,"topic")||"",i=decodeURIComponent(Ga(e,"wc_ev")||""),r=this.client.session.keys.includes(t);r&&this.client.session.update(t,{transportType:Ry.link_mode}),this.client.core.dispatchEnvelope({topic:t,message:i,sessionExists:r})}),BE(this,"registerLinkModeListeners",async()=>{var e;if(Ja()||Aa()&&null!=(e=this.client.metadata.redirect)&&e.linkMode){const e=null==global?void 0:global.Linking;if(typeof e<"u"){e.addEventListener("url",this.handleLinkModeMessage,this.client.name);const t=await e.getInitialURL();t&&setTimeout(()=>{this.handleLinkModeMessage({url:t})},50)}}}),BE(this,"getTVFParams",(e,t,i)=>{var r,s,n;if(null==(r=t.request)||!r.method)return{};const o={correlationId:e,rpcMethods:[t.request.method],chainId:t.chainId};try{const e=this.extractTxHashesFromResult(t.request,i);o.txHashes=e,o.contractAddresses=this.isValidContractData(t.request.params)?[null==(n=null==(s=t.request.params)?void 0:s[0])?void 0:n.to]:[]}catch(a){this.client.logger.warn("Error getting TVF params",a)}return o}),BE(this,"isValidContractData",e=>{var t;if(!e)return!1;try{const i=(null==e?void 0:e.data)||(null==(t=null==e?void 0:e[0])?void 0:t.data);if(!i.startsWith("0x"))return!1;const r=i.slice(2);return!!/^[0-9a-fA-F]*$/.test(r)&&r.length%2==0}catch{}return!1}),BE(this,"extractTxHashesFromResult",(e,t)=>{var i;try{if(!t)return[];const r=e.method,s=EE[r];if("sui_signTransaction"===r)return[Gh(t.transactionBytes)];if("near_signTransaction"===r)return[Yh(t)];if("near_signTransactions"===r)return t.map(e=>Yh(e));if("xrpl_signTransactionFor"===r||"xrpl_signTransaction"===r)return[null==(i=t.tx_json)?void 0:i.hash];if("polkadot_signTransaction"===r)return[Ff({transaction:e.params.transactionPayload,signature:t.signature})];if("algo_signTxn"===r)return vf(t)?t.map(e=>Jh(e)):[Jh(t)];if("cosmos_signDirect"===r)return[Qh(t)];if("string"==typeof t)return[t];const n=t[s.key];if(vf(n))return"solana_signAllTransactions"===r?n.map(e=>function(e){const t=atob(e),i=new Uint8Array(t.length);for(let o=0;o<t.length;o++)i[o]=t.charCodeAt(o);const r=i[0];if(0===r)throw new Error("No signatures found");const s=1+64*r;if(i.length<s)throw new Error("Transaction data too short for claimed signature count");if(i.length<100)throw new Error("Transaction too short");const n=Buffer.from(e,"base64").slice(1,65);return ut.encode(n)}(e)):n;if("string"==typeof n)return[n]}catch(r){this.client.logger.warn("Error extracting tx hashes from result",r)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,r]of Object.entries(t))for(const e of r)try{await this.onProviderMessageEvent({topic:i,message:e,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${e}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=mf("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ey,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:t,message:i,attestation:r,transportType:s}=e,{publicKey:n}=this.client.auth.authKeys.keys.includes(SE)?this.client.auth.authKeys.get(SE):{responseTopic:void 0,publicKey:void 0};try{const e=await this.client.core.crypto.decode(t,i,{receiverPublicKey:n,encoding:s===Ry.link_mode?Rd:Ud});ny(e)?(this.client.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e,attestation:r,transportType:s,encryptedId:Dd(i)})):oy(e)?(await this.client.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e,transportType:s}),this.client.core.history.delete(t,e.id)):await this.onRelayEventUnknownPayload({topic:t,payload:e,transportType:s}),await this.client.core.relayer.messages.ack(t,i)}catch(fh){this.client.logger.error(fh)}}registerExpirerEvents(){this.client.core.expirer.on(Qy,async e=>{const{topic:t,id:i}=za(e.target);return i&&this.client.pendingRequest.keys.includes(i)?await this.deletePendingSessionRequest(i,mf("EXPIRED"),!0):i&&this.client.auth.requests.keys.includes(i)?await this.deletePendingAuthRequest(i,mf("EXPIRED"),!0):void(t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i})))})}registerPairingEvents(){this.client.core.pairing.events.on(zy,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Fy,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!xf(e,!1)){const{message:t}=mf("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=mf("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Fa(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=mf("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!xf(e,!1)){const{message:t}=mf("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=mf("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Fa(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=mf("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=mf("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else{if(!this.client.core.pairing.pairings.keys.includes(e)){if(xf(e,!1)){const{message:t}=mf("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}{const{message:t}=mf("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}this.isValidPairingTopic(e)}}async isValidProposalId(e){if(!function(e){return"number"==typeof e}(e)){const{message:t}=mf("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=mf("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Fa(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=mf("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class jE extends Uv{constructor(e,t){super(e,t,"proposal",uE),this.core=e,this.logger=t}}let DE=class extends Uv{constructor(e,t){super(e,t,"session",uE),this.core=e,this.logger=t}};class LE extends Uv{constructor(e,t){super(e,t,"request",uE,e=>e.id),this.core=e,this.logger=t}}class $E extends Uv{constructor(e,t){super(e,t,"authKeys",xE,()=>SE),this.core=e,this.logger=t}}class ME extends Uv{constructor(e,t){super(e,t,"pairingTopics",xE),this.core=e,this.logger=t}}class qE extends Uv{constructor(e,t){super(e,t,"requests",xE,e=>e.id),this.core=e,this.logger=t}}var zE=Object.defineProperty,HE=(e,t,i)=>((e,t,i)=>t in e?zE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class FE{constructor(e,t){this.core=e,this.logger=t,HE(this,"authKeys"),HE(this,"pairingTopics"),HE(this,"requests"),this.authKeys=new $E(this.core,this.logger),this.pairingTopics=new ME(this.core,this.logger),this.requests=new qE(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var VE=Object.defineProperty,KE=(e,t,i)=>((e,t,i)=>t in e?VE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let WE=class e extends Ag{constructor(e){super(e),KE(this,"protocol","wc"),KE(this,"version",2),KE(this,"name",dE),KE(this,"metadata"),KE(this,"core"),KE(this,"logger"),KE(this,"events",new s.EventEmitter),KE(this,"engine"),KE(this,"session"),KE(this,"proposal"),KE(this,"pendingRequest"),KE(this,"auth"),KE(this,"signConfig"),KE(this,"on",(e,t)=>this.events.on(e,t)),KE(this,"once",(e,t)=>this.events.once(e,t)),KE(this,"off",(e,t)=>this.events.off(e,t)),KE(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),KE(this,"removeAllListeners",e=>this.events.removeAllListeners(e)),KE(this,"connect",async e=>{try{return await this.engine.connect(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"pair",async e=>{try{return await this.engine.pair(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"approve",async e=>{try{return await this.engine.approve(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"reject",async e=>{try{return await this.engine.reject(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"update",async e=>{try{return await this.engine.update(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"extend",async e=>{try{return await this.engine.extend(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"request",async e=>{try{return await this.engine.request(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"respond",async e=>{try{return await this.engine.respond(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"ping",async e=>{try{return await this.engine.ping(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"emit",async e=>{try{return await this.engine.emit(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"disconnect",async e=>{try{return await this.engine.disconnect(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"find",e=>{try{return this.engine.find(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(dh){throw this.logger.error(dh.message),dh}}),KE(this,"authenticate",async(e,t)=>{try{return await this.engine.authenticate(e,t)}catch(i){throw this.logger.error(i.message),i}}),KE(this,"formatAuthMessage",e=>{try{return this.engine.formatAuthMessage(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"approveSessionAuthenticate",async e=>{try{return await this.engine.approveSessionAuthenticate(e)}catch(t){throw this.logger.error(t.message),t}}),KE(this,"rejectSessionAuthenticate",async e=>{try{return await this.engine.rejectSessionAuthenticate(e)}catch(t){throw this.logger.error(t.message),t}}),this.name=(null==e?void 0:e.name)||dE,this.metadata=Ua(null==e?void 0:e.metadata),this.signConfig=null==e?void 0:e.signConfig;const t=typeof(null==e?void 0:e.logger)<"u"&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:Hp(ag({level:(null==e?void 0:e.logger)||fE}));this.core=(null==e?void 0:e.core)||new hE(e),this.logger=hg(t,this.name),this.session=new DE(this.core,this.logger),this.proposal=new jE(this.core,this.logger),this.pendingRequest=new LE(this.core,this.logger),this.engine=new kE(this),this.auth=new FE(this.core,this.logger)}static async init(t){const i=new e(t);return await i.initialize(),i}get context(){return cg(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var GE={exports:{}};!function(e,t){var i,s="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==r&&r,n=function(){function e(){this.fetch=!1,this.DOMException=s.DOMException}return e.prototype=s,new e}();i=n,function(e){var t=void 0!==i&&i||"undefined"!=typeof self&&self||void 0!==r&&r||{},s="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,o="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(dh){return!1}}(),a="FormData"in t,c="ArrayBuffer"in t;if(c)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(e){return e&&h.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function d(e){return"string"!=typeof e&&(e=String(e)),e}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function p(e){this.map={},e instanceof p?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){if(2!=e.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function g(e){if(!e._noBody)return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function y(e){return new Promise(function(t,i){e.onload=function(){t(e.result)},e.onerror=function(){i(e.error)}})}function w(e){var t=new FileReader,i=y(t);return t.readAsArrayBuffer(e),i}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:o&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:a&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:s&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():c&&o&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=m(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c&&(ArrayBuffer.prototype.isPrototypeOf(e)||l(e))?this._bodyArrayBuffer=m(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):s&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=g(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=g(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(o)return this.blob().then(w);throw new Error("could not read as ArrayBuffer")},this.text=function(){var e,t,i,r,s,n=g(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,i=y(t),r=/charset=([A-Za-z0-9_-]+)/.exec(e.type),s=r?r[1]:"utf-8",t.readAsText(e,s),i;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),i=new Array(t.length),r=0;r<t.length;r++)i[r]=String.fromCharCode(t[r]);return i.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a&&(this.formData=function(){return this.text().then(I)}),this.json=function(){return this.text().then(JSON.parse)},this}p.prototype.append=function(e,t){e=u(e),t=d(t);var i=this.map[e];this.map[e]=i?i+", "+t:t},p.prototype.delete=function(e){delete this.map[u(e)]},p.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},p.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},p.prototype.set=function(e,t){this.map[u(e)]=d(t)},p.prototype.forEach=function(e,t){for(var i in this.map)this.map.hasOwnProperty(i)&&e.call(t,this.map[i],i,this)},p.prototype.keys=function(){var e=[];return this.forEach(function(t,i){e.push(i)}),f(e)},p.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),f(e)},p.prototype.entries=function(){var e=[];return this.forEach(function(t,i){e.push([i,t])}),f(e)},n&&(p.prototype[Symbol.iterator]=p.prototype.entries);var v=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function E(e,i){if(!(this instanceof E))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,s,n=(i=i||{}).body;if(e instanceof E){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,i.headers||(this.headers=new p(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=i.credentials||this.credentials||"same-origin",!i.headers&&this.headers||(this.headers=new p(i.headers)),this.method=(r=i.method||this.method||"GET",s=r.toUpperCase(),v.indexOf(s)>-1?s:r),this.mode=i.mode||this.mode||null,this.signal=i.signal||this.signal||function(){if("AbortController"in t)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==i.cache&&"no-cache"!==i.cache)){var o=/([?&])_=[^&]*/;o.test(this.url)?this.url=this.url.replace(o,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function I(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var i=e.split("="),r=i.shift().replace(/\+/g," "),s=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(s))}}),t}function x(e,t){if(!(this instanceof x))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new p(t.headers),this.url=t.url||"",this._initBody(e)}E.prototype.clone=function(){return new E(this,{body:this._bodyInit})},b.call(E.prototype),b.call(x.prototype),x.prototype.clone=function(){return new x(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},x.error=function(){var e=new x(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var S=[301,302,303,307,308];x.redirect=function(e,t){if(-1===S.indexOf(t))throw new RangeError("Invalid status code");return new x(null,{status:t,headers:{location:e}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(O){e.DOMException=function(e,t){this.message=e,this.name=t;var i=Error(e);this.stack=i.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function P(i,r){return new Promise(function(s,n){var a=new E(i,r);if(a.signal&&a.signal.aborted)return n(new e.DOMException("Aborted","AbortError"));var h=new XMLHttpRequest;function l(){h.abort()}if(h.onload=function(){var e,t,i={statusText:h.statusText,headers:(e=h.getAllResponseHeaders()||"",t=new p,e.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e}).forEach(function(e){var i=e.split(":"),r=i.shift().trim();if(r){var s=i.join(":").trim();try{t.append(r,s)}catch(n){console.warn("Response "+n.message)}}}),t)};0===a.url.indexOf("file://")&&(h.status<200||h.status>599)?i.status=200:i.status=h.status,i.url="responseURL"in h?h.responseURL:i.headers.get("X-Request-URL");var r="response"in h?h.response:h.responseText;setTimeout(function(){s(new x(r,i))},0)},h.onerror=function(){setTimeout(function(){n(new TypeError("Network request failed"))},0)},h.ontimeout=function(){setTimeout(function(){n(new TypeError("Network request timed out"))},0)},h.onabort=function(){setTimeout(function(){n(new e.DOMException("Aborted","AbortError"))},0)},h.open(a.method,function(e){try{return""===e&&t.location.href?t.location.href:e}catch(dh){return e}}(a.url),!0),"include"===a.credentials?h.withCredentials=!0:"omit"===a.credentials&&(h.withCredentials=!1),"responseType"in h&&(o?h.responseType="blob":c&&(h.responseType="arraybuffer")),r&&"object"==typeof r.headers&&!(r.headers instanceof p||t.Headers&&r.headers instanceof t.Headers)){var f=[];Object.getOwnPropertyNames(r.headers).forEach(function(e){f.push(u(e)),h.setRequestHeader(e,d(r.headers[e]))}),a.headers.forEach(function(e,t){-1===f.indexOf(t)&&h.setRequestHeader(t,e)})}else a.headers.forEach(function(e,t){h.setRequestHeader(t,e)});a.signal&&(a.signal.addEventListener("abort",l),h.onreadystatechange=function(){4===h.readyState&&a.signal.removeEventListener("abort",l)}),h.send(void 0===a._bodyInit?null:a._bodyInit)})}P.polyfill=!0,t.fetch||(t.fetch=P,t.Headers=p,t.Request=E,t.Response=x),e.Headers=p,e.Request=E,e.Response=x,e.fetch=P,Object.defineProperty(e,"__esModule",{value:!0})}({}),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var o=s.fetch?s:n;(t=o.fetch).default=o.fetch,t.fetch=o.fetch,t.Headers=o.Headers,t.Request=o.Request,t.Response=o.Response,e.exports=t}(GE,GE.exports);const YE=i(GE.exports);var JE=Object.defineProperty,ZE=Object.defineProperties,QE=Object.getOwnPropertyDescriptors,XE=Object.getOwnPropertySymbols,eI=Object.prototype.hasOwnProperty,tI=Object.prototype.propertyIsEnumerable,iI=(e,t,i)=>t in e?JE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,rI=(e,t)=>{for(var i in t||(t={}))eI.call(t,i)&&iI(e,i,t[i]);if(XE)for(var i of XE(t))tI.call(t,i)&&iI(e,i,t[i]);return e},sI=(e,t)=>ZE(e,QE(t));const nI={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST"};let oI=class{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new s.EventEmitter,this.isAvailable=!1,this.registering=!1,!iy(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const t=Xt(e),i=await(await YE(this.url,sI(rI({},nI),{body:t}))).json();this.onPayload({data:i})}catch(dh){this.onError(e.id,dh)}}async register(e=this.url){if(!iy(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const e=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=e||this.events.listenerCount("open")>=e)&&this.events.setMaxListeners(e+1),new Promise((e,t)=>{this.events.once("register_error",e=>{this.resetMaxListeners(),t(e)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return t(new Error("HTTP connection is missing or invalid"));e()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const t=Xt({id:1,jsonrpc:"2.0",method:"test",params:[]});await YE(e,sI(rI({},nI),{body:t}))}this.onOpen()}catch(dh){const t=this.parseError(dh);throw this.events.emit("register_error",t),this.onClose(),t}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t="string"==typeof e.data?Qt(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),r=Jg(e,i.message||i.toString());this.events.emit("payload",r)}parseError(e,t=this.url){return Mg(e,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}};const aI="error",cI="wc@2:universal_provider:",hI="https://rpc.walletconnect.org/v1/",lI="generic",uI=`${hI}bundler`,dI="default_chain_changed";function fI(e){return null==e||"object"!=typeof e&&"function"!=typeof e}function pI(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function gI(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const yI="[object RegExp]",wI="[object String]",mI="[object Number]",bI="[object Boolean]",vI="[object Arguments]",EI="[object Symbol]",II="[object Date]",xI="[object Map]",SI="[object Set]",PI="[object Array]",OI="[object ArrayBuffer]",_I="[object Object]",AI="[object DataView]",TI="[object Uint8Array]",CI="[object Uint8ClampedArray]",NI="[object Uint16Array]",UI="[object Uint32Array]",RI="[object Int8Array]",BI="[object Int16Array]",kI="[object Int32Array]",jI="[object Float32Array]",DI="[object Float64Array]";function LI(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function $I(e,t,i,r=new Map,s=void 0){const n=null==s?void 0:s(e,t,i,r);if(null!=n)return n;if(fI(e))return e;if(r.has(e))return r.get(e);if(Array.isArray(e)){const t=new Array(e.length);r.set(e,t);for(let n=0;n<e.length;n++)t[n]=$I(e[n],n,i,r,s);return Object.hasOwn(e,"index")&&(t.index=e.index),Object.hasOwn(e,"input")&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){const t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){const t=new Map;r.set(e,t);for(const[n,o]of e)t.set(n,$I(o,n,i,r,s));return t}if(e instanceof Set){const t=new Set;r.set(e,t);for(const n of e)t.add($I(n,void 0,i,r,s));return t}if(typeof Buffer<"u"&&Buffer.isBuffer(e))return e.subarray();if(LI(e)){const t=new(Object.getPrototypeOf(e).constructor)(e.length);r.set(e,t);for(let n=0;n<e.length;n++)t[n]=$I(e[n],n,i,r,s);return t}if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){const t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return r.set(e,t),MI(t,e,i,r,s),t}if(typeof File<"u"&&e instanceof File){const t=new File([e],e.name,{type:e.type});return r.set(e,t),MI(t,e,i,r,s),t}if(e instanceof Blob){const t=new Blob([e],{type:e.type});return r.set(e,t),MI(t,e,i,r,s),t}if(e instanceof Error){const t=new e.constructor;return r.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,MI(t,e,i,r,s),t}if("object"==typeof e&&function(e){switch(gI(e)){case vI:case PI:case OI:case AI:case bI:case II:case jI:case DI:case RI:case BI:case kI:case xI:case mI:case _I:case yI:case SI:case wI:case EI:case TI:case CI:case NI:case UI:return!0;default:return!1}}(e)){const t=Object.create(Object.getPrototypeOf(e));return r.set(e,t),MI(t,e,i,r,s),t}return e}function MI(e,t,i=e,r,s){const n=[...Object.keys(t),...pI(t)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(e,a);(null==c||c.writable)&&(e[a]=$I(t[a],a,i,r,s))}}function qI(e,t){return function(e,t){return $I(e,void 0,e,new Map,t)}(e,(i,r,s,n)=>{const o=null==t?void 0:t(i,r,s,n);if(null!=o)return o;if("object"==typeof e)switch(Object.prototype.toString.call(e)){case mI:case wI:case bI:{const t=new e.constructor(null==e?void 0:e.valueOf());return MI(t,e),t}case vI:{const t={};return MI(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}})}function zI(e){return qI(e)}function HI(e){return null!==e&&"object"==typeof e&&"[object Arguments]"===gI(e)}function FI(e){return"object"==typeof e&&null!==e}function VI(){}function KI(e){return LI(e)}function WI(e){var t;if("object"!=typeof e||null==e)return!1;if(null===Object.getPrototypeOf(e))return!0;if("[object Object]"!==Object.prototype.toString.call(e)){const i=e[Symbol.toStringTag];return!(null==i||!(null==(t=Object.getOwnPropertyDescriptor(e,Symbol.toStringTag))?void 0:t.writable))&&e.toString()===`[object ${i}]`}let i=e;for(;null!==Object.getPrototypeOf(i);)i=Object.getPrototypeOf(i);return Object.getPrototypeOf(e)===i}function GI(e,t,i,r){if(fI(e)&&(e=Object(e)),null==t||"object"!=typeof t)return e;if(r.has(t))return function(e){if(fI(e))return e;if(Array.isArray(e)||LI(e)||e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer)return e.slice(0);const t=Object.getPrototypeOf(e),i=t.constructor;if(e instanceof Date||e instanceof Map||e instanceof Set)return new i(e);if(e instanceof RegExp){const t=new i(e);return t.lastIndex=e.lastIndex,t}if(e instanceof DataView)return new i(e.buffer.slice(0));if(e instanceof Error){const t=new i(e.message);return t.stack=e.stack,t.name=e.name,t.cause=e.cause,t}if(typeof File<"u"&&e instanceof File)return new i([e],e.name,{type:e.type,lastModified:e.lastModified});if("object"==typeof e){const i=Object.create(t);return Object.assign(i,e)}return e}(r.get(t));if(r.set(t,e),Array.isArray(t)){t=t.slice();for(let e=0;e<t.length;e++)t[e]=t[e]??void 0}const s=[...Object.keys(t),...pI(t)];for(let n=0;n<s.length;n++){const o=s[n];let a=t[o],c=e[o];if(HI(a)&&(a={...a}),HI(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=zI(a)),Array.isArray(a))if("object"==typeof c&&null!=c){const e=[],t=Reflect.ownKeys(c);for(let i=0;i<t.length;i++){const r=t[i];e[r]=c[r]}c=e}else c=[];const h=i(c,a,o,e,t,r);null!=h?e[o]=h:Array.isArray(a)||FI(c)&&FI(a)?e[o]=GI(c,a,i,r):null==c&&WI(a)?e[o]=GI({},a,i,r):null==c&&KI(a)?e[o]=zI(a):(void 0===c||void 0!==a)&&(e[o]=a)}return e}function YI(e,...t){return function(e,...t){const i=t.slice(0,-1),r=t[t.length-1];let s=e;for(let n=0;n<i.length;n++)s=GI(s,i[n],r,new Map);return s}(e,...t,VI)}var JI=Object.defineProperty,ZI=Object.defineProperties,QI=Object.getOwnPropertyDescriptors,XI=Object.getOwnPropertySymbols,ex=Object.prototype.hasOwnProperty,tx=Object.prototype.propertyIsEnumerable,ix=(e,t,i)=>t in e?JI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,rx=(e,t)=>{for(var i in t||(t={}))ex.call(t,i)&&ix(e,i,t[i]);if(XI)for(var i of XI(t))tx.call(t,i)&&ix(e,i,t[i]);return e},sx=(e,t)=>ZI(e,QI(t));function nx(e,t,i){var r;const s=la(e);return(null==(r=t.rpcMap)?void 0:r[s.reference])||`${hI}?chainId=${s.namespace}:${s.reference}&projectId=${i}`}function ox(e){return e.includes(":")?e.split(":")[1]:e}function ax(e){return e.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function cx(e={},t={}){return YI(hx(e),hx(t))}function hx(e){var t,i,r,s,n;const o={};if(!Ef(e))return o;for(const[a,c]of Object.entries(e)){const e=df(a)?[a]:c.chains,h=c.methods||[],l=c.events||[],u=c.rpcMap||{},d=ff(a);o[d]=sx(rx(rx({},o[d]),c),{chains:Ka(e,null==(t=o[d])?void 0:t.chains),methods:Ka(h,null==(i=o[d])?void 0:i.methods),events:Ka(l,null==(r=o[d])?void 0:r.events)}),(Ef(u)||Ef((null==(s=o[d])?void 0:s.rpcMap)||{}))&&(o[d].rpcMap=rx(rx({},u),null==(n=o[d])?void 0:n.rpcMap))}return o}function lx(e){return e.includes(":")?e.split(":")[2]:e}function ux(e){const t={};for(const[i,r]of Object.entries(e)){const e=r.methods||[],s=r.events||[],n=r.accounts||[],o=df(i)?[i]:r.chains?r.chains:ax(r.accounts);t[i]={chains:o,methods:e,events:s,accounts:n}}return t}function dx(e){return"number"==typeof e?e:e.includes("0x")?parseInt(e,16):(e=e.includes(":")?e.split(":")[1]:e,isNaN(Number(e))?e:Number(e))}const fx={},px=e=>fx[e],gx=(e,t)=>{fx[e]=t};var yx=Object.defineProperty,wx=Object.getOwnPropertySymbols,mx=Object.prototype.hasOwnProperty,bx=Object.prototype.propertyIsEnumerable,vx=(e,t,i)=>t in e?yx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Ex=(e,t)=>{for(var i in t||(t={}))mx.call(t,i)&&vx(e,i,t[i]);if(wx)for(var i of wx(t))bx.call(t,i)&&vx(e,i,t[i]);return e};const Ix="eip155",xx=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],Sx=e=>e&&e.startsWith("0x")?BigInt(e).toString(10):e,Px=e=>e&&e.startsWith("0x")?e:`0x${BigInt(e).toString(16)}`,Ox=e=>Object.keys(e).filter(e=>xx.includes(e)).reduce((t,i)=>(t[i]=e[i],t),{});var _x=Object.defineProperty,Ax=(e,t,i)=>((e,t,i)=>t in e?_x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Tx{constructor(e){Ax(this,"name","polkadot"),Ax(this,"client"),Ax(this,"httpProviders"),Ax(this,"events"),Ax(this,"namespace"),Ax(this,"chainId"),this.namespace=e.namespace,this.events=px("events"),this.client=px("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(dI,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const r=ox(t);e[r]=this.createHttpProvider(r,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||nx(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new hy(new oI(i,px("disableProviderPing")))}}var Cx=Object.defineProperty,Nx=Object.defineProperties,Ux=Object.getOwnPropertyDescriptors,Rx=Object.getOwnPropertySymbols,Bx=Object.prototype.hasOwnProperty,kx=Object.prototype.propertyIsEnumerable,jx=(e,t,i)=>t in e?Cx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Dx=(e,t)=>{for(var i in t||(t={}))Bx.call(t,i)&&jx(e,i,t[i]);if(Rx)for(var i of Rx(t))kx.call(t,i)&&jx(e,i,t[i]);return e},Lx=(e,t)=>Nx(e,Ux(t)),$x=(e,t,i)=>jx(e,"symbol"!=typeof t?t+"":t,i);class Mx{constructor(e){$x(this,"name","eip155"),$x(this,"client"),$x(this,"chainId"),$x(this,"namespace"),$x(this,"httpProviders"),$x(this,"events"),this.namespace=e.namespace,this.events=px("events"),this.client=px("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(dI,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||nx(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new hy(new oI(i,px("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const r=parseInt(ox(t));e[r]=this.createHttpProvider(r,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,i;let r=e.request.params?null==(t=e.request.params[0])?void 0:t.chainId:"0x0";r=r.startsWith("0x")?r:`0x${r}`;const s=parseInt(r,16);if(this.isChainApproved(s))this.setDefaultChain(`${s}`);else{if(!this.namespace.methods.includes("wallet_switchEthereumChain"))throw new Error(`Failed to switch to chain 'eip155:${s}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:r}]},chainId:null==(i=this.namespace.chains)?void 0:i[0]}),this.setDefaultChain(`${s}`)}return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,i,r,s,n;const o=null==(i=null==(t=e.request)?void 0:t.params)?void 0:i[0],a=(null==(s=null==(r=e.request)?void 0:r.params)?void 0:s[1])||[];if(!o)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const c=this.client.session.get(e.topic),h=(null==(n=null==c?void 0:c.sessionProperties)?void 0:n.capabilities)||{},l=`${o}${a.join(",")}`,u=null==h?void 0:h[l];if(u)return u;let d;try{d=((e,t,i)=>{const{sessionProperties:r={},scopedProperties:s={}}=e,n={};if(!Ef(s)&&!Ef(r))return;const o=Ox(r);for(const a of i){const e=Sx(a);if(!e)continue;n[Px(e)]=o;const i=null==s?void 0:s[`${Ix}:${e}`];if(i){const r=null==i?void 0:i[`${Ix}:${e}:${t}`];n[Px(e)]=Ex(Ex({},n[Px(e)]),Ox(r||i))}}for(const[a,c]of Object.entries(n))0===Object.keys(c).length&&delete n[a];return Object.keys(n).length>0?n:void 0})(c,o,a)}catch(p){console.warn("Failed to extract capabilities from session",p)}if(d)return d;const f=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Lx(Dx({},c.sessionProperties||{}),{capabilities:Lx(Dx({},h||{}),{[l]:f})})})}catch(p){console.warn("Failed to update session with capabilities",p)}return f}async getCallStatus(e){var t,i;const r=this.client.session.get(e.topic),s=null==(t=r.sessionProperties)?void 0:t.bundler_name;if(s){const t=this.getBundlerUrl(e.chainId,s);try{return await this.getUserOperationReceipt(t,e)}catch(o){console.warn("Failed to fetch call status from bundler",o,t)}}const n=null==(i=r.sessionProperties)?void 0:i.bundler_url;if(n)try{return await this.getUserOperationReceipt(n,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,n)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const r=new URL(e),s=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Gg("eth_getUserOperationReceipt",[null==(i=t.request.params)?void 0:i[0]]))});if(!s.ok)throw new Error(`Failed to fetch user operation receipt - ${s.status}`);return await s.json()}getBundlerUrl(e,t){return`${uI}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}var qx=Object.defineProperty,zx=(e,t,i)=>((e,t,i)=>t in e?qx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Hx{constructor(e){zx(this,"name","solana"),zx(this,"client"),zx(this,"httpProviders"),zx(this,"events"),zx(this,"namespace"),zx(this,"chainId"),this.namespace=e.namespace,this.events=px("events"),this.client=px("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(dI,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const r=ox(t);e[r]=this.createHttpProvider(r,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||nx(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new hy(new oI(i,px("disableProviderPing")))}}var Fx=Object.defineProperty,Vx=(e,t,i)=>((e,t,i)=>t in e?Fx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Kx{constructor(e){Vx(this,"name","cosmos"),Vx(this,"client"),Vx(this,"httpProviders"),Vx(this,"events"),Vx(this,"namespace"),Vx(this,"chainId"),this.namespace=e.namespace,this.events=px("events"),this.client=px("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(dI,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const r=ox(t);e[r]=this.createHttpProvider(r,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||nx(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new hy(new oI(i,px("disableProviderPing")))}}var Wx=Object.defineProperty,Gx=(e,t,i)=>((e,t,i)=>t in e?Wx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Yx{constructor(e){Gx(this,"name","algorand"),Gx(this,"client"),Gx(this,"httpProviders"),Gx(this,"events"),Gx(this,"namespace"),Gx(this,"chainId"),this.namespace=e.namespace,this.events=px("events"),this.client=px("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||nx(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(dI,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||nx(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new hy(new oI(i,px("disableProviderPing")))}}var Jx=Object.defineProperty,Zx=(e,t,i)=>((e,t,i)=>t in e?Jx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Qx{constructor(e){Zx(this,"name","cip34"),Zx(this,"client"),Zx(this,"httpProviders"),Zx(this,"events"),Zx(this,"namespace"),Zx(this,"chainId"),this.namespace=e.namespace,this.events=px("events"),this.client=px("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(dI,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),r=ox(t);e[r]=this.createHttpProvider(r,i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new hy(new oI(i,px("disableProviderPing")))}}var Xx=Object.defineProperty,eS=(e,t,i)=>((e,t,i)=>t in e?Xx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class tS{constructor(e){eS(this,"name","elrond"),eS(this,"client"),eS(this,"httpProviders"),eS(this,"events"),eS(this,"namespace"),eS(this,"chainId"),this.namespace=e.namespace,this.events=px("events"),this.client=px("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(dI,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const r=ox(t);e[r]=this.createHttpProvider(r,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||nx(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new hy(new oI(i,px("disableProviderPing")))}}var iS=Object.defineProperty,rS=(e,t,i)=>((e,t,i)=>t in e?iS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class sS{constructor(e){rS(this,"name","multiversx"),rS(this,"client"),rS(this,"httpProviders"),rS(this,"events"),rS(this,"namespace"),rS(this,"chainId"),this.namespace=e.namespace,this.events=px("events"),this.client=px("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(dI,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const r=ox(t);e[r]=this.createHttpProvider(r,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||nx(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new hy(new oI(i,px("disableProviderPing")))}}var nS=Object.defineProperty,oS=(e,t,i)=>((e,t,i)=>t in e?nS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class aS{constructor(e){oS(this,"name","near"),oS(this,"client"),oS(this,"httpProviders"),oS(this,"events"),oS(this,"namespace"),oS(this,"chainId"),this.namespace=e.namespace,this.events=px("events"),this.client=px("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||nx(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(dI,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||nx(e,this.namespace);return typeof i>"u"?void 0:new hy(new oI(i,px("disableProviderPing")))}}var cS=Object.defineProperty,hS=(e,t,i)=>((e,t,i)=>t in e?cS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class lS{constructor(e){hS(this,"name","tezos"),hS(this,"client"),hS(this,"httpProviders"),hS(this,"events"),hS(this,"namespace"),hS(this,"chainId"),this.namespace=e.namespace,this.events=px("events"),this.client=px("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||nx(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit(dI,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||nx(e,this.namespace);return typeof i>"u"?void 0:new hy(new oI(i))}}var uS=Object.defineProperty,dS=(e,t,i)=>((e,t,i)=>t in e?uS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class fS{constructor(e){dS(this,"name",lI),dS(this,"client"),dS(this,"httpProviders"),dS(this,"events"),dS(this,"namespace"),dS(this,"chainId"),this.namespace=e.namespace,this.events=px("events"),this.client=px("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(dI,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return null==(t=null==(e=this.namespace)?void 0:e.accounts)||t.forEach(e=>{const t=la(e);i[`${t.namespace}:${t.reference}`]=this.createHttpProvider(e)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||nx(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new hy(new oI(i,px("disableProviderPing")))}}var pS=Object.defineProperty,gS=Object.defineProperties,yS=Object.getOwnPropertyDescriptors,wS=Object.getOwnPropertySymbols,mS=Object.prototype.hasOwnProperty,bS=Object.prototype.propertyIsEnumerable,vS=(e,t,i)=>t in e?pS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ES=(e,t)=>{for(var i in t||(t={}))mS.call(t,i)&&vS(e,i,t[i]);if(wS)for(var i of wS(t))bS.call(t,i)&&vS(e,i,t[i]);return e},IS=(e,t)=>gS(e,yS(t)),xS=(e,t,i)=>vS(e,"symbol"!=typeof t?t+"":t,i);const SS=class e{constructor(e){xS(this,"client"),xS(this,"namespaces"),xS(this,"optionalNamespaces"),xS(this,"sessionProperties"),xS(this,"scopedProperties"),xS(this,"events",new n),xS(this,"rpcProviders",{}),xS(this,"session"),xS(this,"providerOpts"),xS(this,"logger"),xS(this,"uri"),xS(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(null==e?void 0:e.logger)<"u"&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:Hp(ag({level:(null==e?void 0:e.logger)||aI})),this.disableProviderPing=(null==e?void 0:e.disableProviderPing)||!1}static async init(t){const i=new e(t);return await i.initialize(),i}async request(e,t,i){const[r,s]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(r).request({request:ES({},e),chainId:`${r}:${s}`,topic:this.session.topic,expiry:i})}sendAsync(e,t,i,r){const s=(new Date).getTime();this.request(e,i,r).then(e=>t(null,Yg(s,e))).catch(e=>t(e,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(e=this.session)?void 0:e.topic,reason:bf("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:r}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const s=await r();if(this.session=s.session,this.session){const e=ux(this.session.namespaces);this.namespaces=cx(this.namespaces,e),await this.persist("namespaces",this.namespaces),this.onConnect()}return s}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const r=await i();this.session=r;const s=ux(r.namespaces);return this.namespaces=cx(this.namespaces,s),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,r]=this.validateChain(e),s=this.getProvider(i);s.name===lI?s.setDefaultChain(`${i}:${r}`,t):s.setDefaultChain(r,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(vf(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await WE.init({core:this.providerOpts.core,logger:this.providerOpts.logger||aI,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error(`The provided session: ${null==(t=null==(e=this.providerOpts)?void 0:e.session)?void 0:t.topic} doesn't exist in the Sign client`)}else{const e=this.client.session.getAll();this.session=e[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(e=>ff(e)))];gx("client",this.client),gx("events",this.events),gx("disableProviderPing",this.disableProviderPing),e.forEach(e=>{if(!this.session)return;const t=function(e,t){const i=Object.keys(t.namespaces).filter(t=>t.includes(e));if(!i.length)return[];const r=[];return i.forEach(e=>{const i=t.namespaces[e].accounts;r.push(...i)}),r}(e,this.session),i=ax(t),r=cx(this.namespaces,this.optionalNamespaces),s=IS(ES({},r[e]),{accounts:t,chains:i});switch(e){case"eip155":this.rpcProviders[e]=new Mx({namespace:s});break;case"algorand":this.rpcProviders[e]=new Yx({namespace:s});break;case"solana":this.rpcProviders[e]=new Hx({namespace:s});break;case"cosmos":this.rpcProviders[e]=new Kx({namespace:s});break;case"polkadot":this.rpcProviders[e]=new Tx({namespace:s});break;case"cip34":this.rpcProviders[e]=new Qx({namespace:s});break;case"elrond":this.rpcProviders[e]=new tS({namespace:s});break;case"multiversx":this.rpcProviders[e]=new sS({namespace:s});break;case"near":this.rpcProviders[e]=new aS({namespace:s});break;case"tezos":this.rpcProviders[e]=new lS({namespace:s});break;default:this.rpcProviders[lI]?this.rpcProviders[lI].updateNamespace(s):this.rpcProviders[lI]=new fS({namespace:s})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;const{topic:i}=e;i===(null==(t=this.session)?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;const{params:i,topic:r}=e;if(r!==(null==(t=this.session)?void 0:t.topic))return;const{event:s}=i;if("accountsChanged"===s.name){const e=s.data;e&&vf(e)&&this.events.emit("accountsChanged",e.map(lx))}else if("chainChanged"===s.name){const e=i.chainId,t=i.event.data,r=ff(e),s=dx(e)!==dx(t)?`${r}:${dx(t)}`:e;this.onChainChanged(s)}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i,r;if(e!==(null==(i=this.session)?void 0:i.topic))return;const{namespaces:s}=t,n=null==(r=this.client)?void 0:r.session.get(e);this.session=IS(ES({},n),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===(null==(t=this.session)?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",IS(ES({},bf("USER_DISCONNECTED")),{data:e.topic})))}),this.on(dI,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[lI]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace(null==(t=this.session)?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t={},optionalNamespaces:i={},sessionProperties:r,scopedProperties:s}=e;this.optionalNamespaces=cx(t,i),this.sessionProperties=r,this.scopedProperties=s}validateChain(e){const[t,i]=(null==e?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(e=>ff(e)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&i)return[t,i];const r=ff(Object.keys(this.namespaces)[0]);return[r,this.rpcProviders[r].getDefaultChain()]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,t=!1){if(!this.namespaces)return;const[i,r]=this.validateChain(e);if(!r)return;this.updateNamespaceChain(i,r),this.events.emit("chainChanged",r);const s=this.getProvider(i).getDefaultChain();t||this.getProvider(i).setDefaultChain(r),this.emitAccountsChangedOnChainChange({namespace:i,previousChainId:s,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:t,newChainId:i}){var r,s;try{if(t===i)return;const n=null==(s=null==(r=this.session)?void 0:r.namespaces[e])?void 0:s.accounts;if(!n)return;const o=n.filter(e=>e.includes(`${i}:`)).map(lx);if(!vf(o))return;this.events.emit("accountsChanged",o)}catch(n){this.logger.warn("Failed to emit accountsChanged on chain change",n)}}updateNamespaceChain(e,t){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${t}`,r={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=t):this.namespaces[i]=r}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var i;const r=(null==(i=this.session)?void 0:i.topic)||"";await this.client.core.storage.setItem(`${cI}/${e}${r}`,t)}async getFromStore(e){var t;const i=(null==(t=this.session)?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${cI}/${e}${i}`)}async deleteFromStore(e){var t;const i=(null==(t=this.session)?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${cI}/${e}${i}`)}async cleanupStorage(){var e;try{if((null==(e=this.client)?void 0:e.session.length)>0)return;const t=await this.client.core.storage.getKeys();for(const e of t)e.startsWith(cI)&&await this.client.core.storage.removeItem(e)}catch(dh){this.logger.warn("Failed to cleanup storage",dh)}}},PS=["eth_sendTransaction","personal_sign"],OS=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],_S=["chainChanged","accountsChanged"],AS=["chainChanged","accountsChanged","message","disconnect","connect"];var TS=Object.defineProperty,CS=Object.defineProperties,NS=Object.getOwnPropertyDescriptors,US=Object.getOwnPropertySymbols,RS=Object.prototype.hasOwnProperty,BS=Object.prototype.propertyIsEnumerable,kS=(e,t,i)=>t in e?TS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,jS=(e,t)=>{for(var i in t||(t={}))RS.call(t,i)&&kS(e,i,t[i]);if(US)for(var i of US(t))BS.call(t,i)&&kS(e,i,t[i]);return e},DS=(e,t)=>CS(e,NS(t)),LS=(e,t,i)=>kS(e,"symbol"!=typeof t?t+"":t,i);function $S(e){return Number(e[0].split(":")[1])}function MS(e){return`0x${e.toString(16)}`}class qS{constructor(){LS(this,"events",new s.EventEmitter),LS(this,"namespace","eip155"),LS(this,"accounts",[]),LS(this,"signer"),LS(this,"chainId",1),LS(this,"modal"),LS(this,"rpc"),LS(this,"STORAGE_KEY","wc@2:ethereum_provider:"),LS(this,"on",(e,t)=>(this.events.on(e,t),this)),LS(this,"once",(e,t)=>(this.events.once(e,t),this)),LS(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),LS(this,"off",(e,t)=>(this.events.off(e,t),this)),LS(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const t=new qS;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,i){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),i)}get connected(){return!!this.signer.client&&this.signer.client.core.relayer.connected}get connecting(){return!!this.signer.client&&this.signer.client.core.relayer.connecting}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var t;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:i,optional:r}=function(e){const{chains:t,optionalChains:i,methods:r,optionalMethods:s,events:n,optionalEvents:o,rpcMap:a}=e;if(!vf(t))throw new Error("Invalid chains");const c={chains:t,methods:r||PS,events:n||_S,rpcMap:jS({},t.length?{[$S(t)]:a[$S(t)]}:{})},h=null==n?void 0:n.filter(e=>!_S.includes(e)),l=null==r?void 0:r.filter(e=>!PS.includes(e));if(!(i||o||s||null!=h&&h.length||null!=l&&l.length))return{required:t.length?c:void 0};const u=(null==h?void 0:h.length)&&(null==l?void 0:l.length)||!i,d={chains:[...new Set(u?c.chains.concat(i||[]):i)],methods:[...new Set(c.methods.concat(null!=s&&s.length?s:OS))],events:[...new Set(c.events.concat(null!=o&&o.length?o:AS))],rpcMap:a};return{required:t.length?c:void 0,optional:i.length?d:void 0}}(this.rpc);try{const t=await new Promise(async(t,s)=>{var n,o;this.rpc.showQrModal&&(null==(n=this.modal)||n.open(),null==(o=this.modal)||o.subscribeState(e=>{!e.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),s(new Error("Connection request reset. Please try again.")))}));const a=null!=e&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(DS(jS({namespaces:jS({},i&&{[this.namespace]:i})},r&&{optionalNamespaces:{[this.namespace]:r}}),{pairingTopic:null==e?void 0:e.pairingTopic,scopedProperties:a})).then(e=>{t(e)}).catch(e=>{var t;null==(t=this.modal)||t.showErrorMessage("Unable to connect"),s(new Error(e.message))})});if(!t)return;const s=ua(t.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:s),this.setAccounts(s),this.events.emit("connect",{chainId:MS(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{null==(t=this.modal)||t.close()}}async authenticate(e,t){var i;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:null==e?void 0:e.chains});try{const i=await new Promise(async(i,r)=>{var s,n;this.rpc.showQrModal&&(null==(s=this.modal)||s.open(),null==(n=this.modal)||n.subscribeState(e=>{!e.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),r(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(DS(jS({},e),{chains:this.rpc.chains}),t).then(e=>{i(e)}).catch(e=>{var t;null==(t=this.modal)||t.showErrorMessage("Unable to connect"),r(new Error(e.message))})}),r=i.session;if(r){const e=ua(r.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:e),this.setAccounts(e),this.events.emit("connect",{chainId:MS(this.chainId)})}return i}catch(r){throw this.signer.logger.error(r),r}finally{null==(i=this.modal)||i.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:i}=t;"accountsChanged"===i.name?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):"chainChanged"===i.name?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",MS(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",DS(jS({},bf("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return"string"==typeof e&&e.startsWith(`${this.namespace}:`)}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(e=>this.isCompatibleChainId(e)).map(e=>this.parseChainId(e));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",MS(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,i,r]=e.split(":");return{chainId:`${t}:${i}`,address:r}}setAccounts(e){this.accounts=e.filter(e=>this.parseChainId(this.parseAccountId(e).chainId)===this.chainId).map(e=>this.parseAccountId(e).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,i;const r=null!=(t=null==e?void 0:e.chains)?t:[],s=null!=(i=null==e?void 0:e.optionalChains)?i:[],n=r.concat(s);if(!n.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const o=r.length?(null==e?void 0:e.methods)||PS:[],a=r.length?(null==e?void 0:e.events)||_S:[],c=(null==e?void 0:e.optionalMethods)||[],h=(null==e?void 0:e.optionalEvents)||[],l=(null==e?void 0:e.rpcMap)||this.buildRpcMap(n,e.projectId),u=(null==e?void 0:e.qrModalOptions)||void 0;return{chains:null==r?void 0:r.map(e=>this.formatChainId(e)),optionalChains:s.map(e=>this.formatChainId(e)),methods:o,events:a,optionalMethods:c,optionalEvents:h,rpcMap:l,showQrModal:!(null==e||!e.showQrModal),qrModalOptions:u,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const i={};return e.forEach(e=>{i[e]=this.getRpcUrl(e,t)}),i}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?$S(this.rpc.chains):$S(this.rpc.optionalChains),this.signer=await SS.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let e;try{const i=await(async()=>{const{createAppKit:e}=await t(()=>import("./core-83c0d9fc.js").then(e=>e.X),["assets/core-83c0d9fc.js","assets/main-555f3dea.js","assets/global-38c848b6.css","assets/events-8de2f827.js"]);return e})(),{convertWCMToAppKitOptions:r}=await Promise.resolve().then(function(){return tP}),s=r(DS(jS({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!s.networks.length)throw new Error("No networks found for WalletConnect·");e=i(DS(jS({},s),{universalProvider:this.signer,manualWCControl:!0}))}catch(fh){throw console.warn(fh),new Error("To use QR modal, please install @reown/appkit package")}if(e)try{this.modal=e}catch(fh){throw this.signer.logger.error(fh),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:i,rpcMap:r}=e;t&&vf(t)&&(this.rpc.chains=t.map(e=>this.formatChainId(e)),t.forEach(e=>{this.rpc.rpcMap[e]=(null==r?void 0:r[e])||this.getRpcUrl(e)})),i&&vf(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=null==i?void 0:i.map(e=>this.formatChainId(e)),i.forEach(e=>{this.rpc.rpcMap[e]=(null==r?void 0:r[e])||this.getRpcUrl(e)}))}getRpcUrl(e,t){var i;return(null==(i=this.rpc.rpcMap)?void 0:i[e])||`https://rpc.walletconnect.org/v1/?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:null==t?void 0:t.accounts),this.setAccounts(null==t?void 0:t.accounts)}catch(uh){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(uh),await this.disconnect().catch(e=>this.signer.logger.warn(e))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return"string"==typeof e||e instanceof String?[this.parseAccount(e)]:e.map(e=>this.parseAccount(e))}}const zS=qS;var HS=Object.defineProperty,FS=Object.defineProperties,VS=Object.getOwnPropertyDescriptors,KS=Object.getOwnPropertySymbols,WS=Object.prototype.hasOwnProperty,GS=Object.prototype.propertyIsEnumerable,YS=(e,t,i)=>t in e?HS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,JS=(e,t)=>{for(var i in t||(t={}))WS.call(t,i)&&YS(e,i,t[i]);if(KS)for(var i of KS(t))GS.call(t,i)&&YS(e,i,t[i]);return e},ZS=(e,t)=>FS(e,VS(t));function QS(e){if(e)return{"--w3m-font-family":e["--wcm-font-family"],"--w3m-accent":e["--wcm-accent-color"],"--w3m-color-mix":e["--wcm-background-color"],"--w3m-z-index":e["--wcm-z-index"]?Number(e["--wcm-z-index"]):void 0,"--w3m-qr-color":e["--wcm-accent-color"],"--w3m-font-size-master":e["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":e["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const XS=e=>{const[t,i]=e.split(":");return eP({id:i,caipNetworkId:e,chainNamespace:t,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function eP(e){return JS({formatters:void 0,fees:void 0,serializers:void 0},e)}var tP=Object.freeze({__proto__:null,convertWCMToAppKitOptions:function(e){var t,i,r,s,n,o,a;const c=null==(t=e.chains)?void 0:t.map(XS).filter(Boolean);if(0===c.length)throw new Error("At least one chain must be specified");const h=c.find(t=>{var i;return t.id===(null==(i=e.defaultChain)?void 0:i.id)}),l={projectId:e.projectId,networks:c,themeMode:e.themeMode,themeVariables:QS(e.themeVariables),chainImages:e.chainImages,connectorImages:e.walletImages,defaultNetwork:h,metadata:ZS(JS({},e.metadata),{name:(null==(i=e.metadata)?void 0:i.name)||"WalletConnect",description:(null==(r=e.metadata)?void 0:r.description)||"Connect to WalletConnect-compatible wallets",url:(null==(s=e.metadata)?void 0:s.url)||"https://walletconnect.org",icons:(null==(n=e.metadata)?void 0:n.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:"NONE"===e.explorerRecommendedWalletIds?[]:Array.isArray(e.explorerRecommendedWalletIds)?e.explorerRecommendedWalletIds:[],excludeWalletIds:"ALL"===e.explorerExcludedWalletIds?[]:Array.isArray(e.explorerExcludedWalletIds)?e.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if(null!=(o=e.mobileWallets)&&o.length||null!=(a=e.desktopWallets)&&a.length){const t=[...(e.mobileWallets||[]).map(e=>({id:e.id,name:e.name,links:e.links})),...(e.desktopWallets||[]).map(e=>({id:e.id,name:e.name,links:{native:e.links.native,universal:e.links.universal}}))],i=[...l.featuredWalletIds||[],...l.excludeWalletIds||[]],r=t.filter(e=>!i.includes(e.id));r.length&&(l.customWallets=r)}return l},defineChain:eP});const iP=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:zS,OPTIONAL_EVENTS:AS,OPTIONAL_METHODS:OS,REQUIRED_EVENTS:_S,REQUIRED_METHODS:PS,default:qS},Symbol.toStringTag,{value:"Module"}));export{lg as A,cy as B,Co as C,Kg as D,hg as E,oI as F,Be as G,Me as H,Vf as I,Ne as J,Le as K,Te as L,Ue as M,Re as N,Hp as O,Pn as P,In as Q,qe as R,ke as S,Ce as T,Ae as U,$e as V,ze as W,iP as X,Y as a,xo as b,w as c,J as d,ut as e,g as f,X as g,Z as h,Yf as i,Op as j,ag as k,dy as l,ny as m,oy as n,hy as o,Yg as p,Gg as q,Gf as r,Sn as s,On as t,Xt as u,Qt as v,Wg as w,Jg as x,cg as y,ay as z};
