import"./multi-wallet-connector-0c891252.js";import"./user-store-6f34e326.js";import"./image-handler-91d970e9.js";class e{constructor(){this.walletConnection=window.walletConnection,this.userStore=window.userStore,this.currentUser=null,this.isEditing=!1,this.userProfile=null,this.init()}async init(){console.log("Initializing Enhanced Profile App..."),this.setupEventListeners(),this.checkWalletConnection(),console.log("Enhanced Profile App initialized")}setupEventListeners(){window.addEventListener("walletConnected",e=>{console.log("Wallet connected in profile:",e.detail.address),this.handleWalletConnected(e.detail.address)}),window.addEventListener("walletDisconnected",()=>{console.log("Wallet disconnected in profile"),this.handleWalletDisconnected()});const e=document.getElementById("mobileMenuToggle"),t=document.getElementById("mobileMenu");e&&t&&e.addEventListener("click",()=>{t.classList.toggle("active")});const i=document.getElementById("editProfileBtn"),s=document.getElementById("saveProfileBtn"),n=document.getElementById("cancelEditBtn");i&&i.addEventListener("click",()=>this.startEditing()),s&&s.addEventListener("click",()=>this.saveProfile()),n&&n.addEventListener("click",()=>this.cancelEditing()),document.addEventListener("click",e=>{e.target.classList.contains("tab-btn")&&this.switchTab(e.target.dataset.tab)});const o=document.getElementById("profileForm");o&&o.addEventListener("submit",e=>{e.preventDefault(),this.saveProfile()})}checkWalletConnection(){if(this.walletConnection&&this.walletConnection.getConnectionStatus()){const e=this.walletConnection.getWalletAddress();this.handleWalletConnected(e)}else this.showWelcomeSection()}showWelcomeSection(){const e=document.getElementById("welcomeSection"),t=document.getElementById("profileContent");e&&(e.style.display="block"),t&&(t.style.display="none")}handleWalletConnected(e){console.log("Handling wallet connection for:",e),this.currentUser=e,this.showProfileContent(),this.loadUserProfile(e),this.loadUserNFTs(e),this.checkArtistStatus(e)}handleWalletDisconnected(){this.currentUser=null,this.userProfile=null,this.showWelcomeSection()}showProfileContent(){const e=document.getElementById("welcomeSection"),t=document.getElementById("profileContent");e&&(e.style.display="none"),t&&(t.style.display="block"),this.updateAddressDisplay()}updateAddressDisplay(){var e,t;const i=document.getElementById("userAddress"),s=document.getElementById("userAddressDisplay"),n=document.getElementById("userInitials");if(this.currentUser){const o=this.formatAddress(this.currentUser);if(i&&(i.textContent=(null==(e=this.userProfile)?void 0:e.profileName)||o),s&&(s.textContent=this.currentUser),n){const e=(null==(t=this.userProfile)?void 0:t.profileName)?this.userProfile.profileName.substring(0,2).toUpperCase():this.currentUser.substring(2,4).toUpperCase();n.textContent=e}}}loadUserProfile(e){this.userProfile=this.userStore.getUserProfile(e)||{},this.displayProfileInfo(),this.populateEditForm()}displayProfileInfo(){const e={displayName:this.userProfile.profileName||"Not set",displayBio:this.userProfile.profileBio||"No bio provided",displayWebsite:this.userProfile.profileWebsite||"Not provided",displaySocial:this.userProfile.profileSocial||"Not provided",displayEmail:this.userProfile.profileEmail||"Not provided",displayLocation:this.userProfile.profileLocation||"Not provided"};Object.entries(e).forEach(([e,t])=>{const i=document.getElementById(e);if(i)if("displayWebsite"===e&&"Not provided"!==t)i.innerHTML=`<a href="${t}" target="_blank" rel="noopener">${t}</a>`;else if("displaySocial"===e&&"Not provided"!==t){const e=t.startsWith("http");i.innerHTML=e?`<a href="${t}" target="_blank" rel="noopener">${t}</a>`:t}else i.textContent=t})}populateEditForm(){const e={profileName:this.userProfile.profileName||"",profileBio:this.userProfile.profileBio||"",profileWebsite:this.userProfile.profileWebsite||"",profileSocial:this.userProfile.profileSocial||"",profileEmail:this.userProfile.profileEmail||"",profileLocation:this.userProfile.profileLocation||""};Object.entries(e).forEach(([e,t])=>{const i=document.getElementById(e);i&&(i.value=t)})}checkArtistStatus(e){const t=this.userStore.isArtistRegistered(e),i=document.getElementById("artistStatus"),s=document.getElementById("nonArtistStatus"),n=document.getElementById("artistInfo"),o=document.getElementById("createdTab");t?(i&&(i.style.display="block"),s&&(s.style.display="none"),n&&(n.style.display="block"),o&&(o.style.display="block"),this.loadArtistStats(e),this.loadCreatedNFTs(e)):(i&&(i.style.display="none"),s&&(s.style.display="block"),n&&(n.style.display="none"),o&&(o.style.display="none"))}loadArtistStats(e){const t=this.userStore.getArtist(e),i=this.userStore.getUserNFTs(e);if(t){const e=document.getElementById("totalNFTsCreated"),s=document.getElementById("totalSales"),n=document.getElementById("totalEarnings"),o=document.getElementById("registrationDate");if(e&&(e.textContent=i.length),s&&(s.textContent=t.totalSales||0),n&&(n.textContent=`${t.totalEarnings||"0"} ETH`),o&&t.registrationDate){const e=new Date(t.registrationDate);o.textContent=e.toLocaleDateString()}}}startEditing(){this.isEditing=!0;const e=document.getElementById("editProfileBtn"),t=document.getElementById("saveProfileBtn"),i=document.getElementById("cancelEditBtn"),s=document.getElementById("profileDisplay"),n=document.getElementById("profileEditForm");e&&(e.style.display="none"),t&&(t.style.display="inline-block"),i&&(i.style.display="inline-block"),s&&(s.style.display="none"),n&&(n.style.display="block")}cancelEditing(){this.isEditing=!1;const e=document.getElementById("editProfileBtn"),t=document.getElementById("saveProfileBtn"),i=document.getElementById("cancelEditBtn"),s=document.getElementById("profileDisplay"),n=document.getElementById("profileEditForm");e&&(e.style.display="inline-block"),t&&(t.style.display="none"),i&&(i.style.display="none"),s&&(s.style.display="block"),n&&(n.style.display="none"),this.populateEditForm()}saveProfile(){var e,t,i,s,n,o;if(!this.currentUser)return;const l={profileName:(null==(e=document.getElementById("profileName"))?void 0:e.value.trim())||"",profileBio:(null==(t=document.getElementById("profileBio"))?void 0:t.value.trim())||"",profileWebsite:(null==(i=document.getElementById("profileWebsite"))?void 0:i.value.trim())||"",profileSocial:(null==(s=document.getElementById("profileSocial"))?void 0:s.value.trim())||"",profileEmail:(null==(n=document.getElementById("profileEmail"))?void 0:n.value.trim())||"",profileLocation:(null==(o=document.getElementById("profileLocation"))?void 0:o.value.trim())||""};l.profileName?!l.profileWebsite||this.isValidUrl(l.profileWebsite)?!l.profileEmail||this.isValidEmail(l.profileEmail)?(this.userStore.saveUserProfile(this.currentUser,l),this.userProfile={...this.userProfile,...l},this.displayProfileInfo(),this.updateAddressDisplay(),this.showMessage("Profile saved successfully!","success"),this.cancelEditing()):this.showMessage("Please enter a valid email address","error"):this.showMessage("Please enter a valid website URL","error"):this.showMessage("Display name is required","error")}switchTab(e){document.querySelectorAll(".tab-btn").forEach(e=>{e.classList.remove("active")}),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),document.querySelectorAll(".tab-content").forEach(e=>{e.classList.remove("active"),e.style.display="none"});const t=document.getElementById(`${e}NFTs`);t&&(t.classList.add("active"),t.style.display="block")}loadUserNFTs(e){const t=this.userStore.getNFTs().filter(t=>t.owner===e);this.renderNFTGrid("userNFTGrid",t,"owned")}loadCreatedNFTs(e){const t=this.userStore.getUserNFTs(e);this.renderNFTGrid("artistNFTGrid",t,"created")}renderNFTGrid(e,t,i){const s=document.getElementById(e);if(s){if(0===t.length){const e="owned"===i?"You don't own any NFTs yet. Explore the gallery to start your collection!":"You haven't created any NFTs yet. Start your artistic journey!",t="owned"===i?'<a href="gallery.html" class="btn btn-primary">Browse Gallery</a>':'<a href="upload.html" class="btn btn-primary">Create NFT</a>';return void(s.innerHTML=`\n                <div class="empty-state">\n                    <h4>No NFTs ${"owned"===i?"Owned":"Created"}</h4>\n                    <p>${e}</p>\n                    ${t}\n                </div>\n            `)}s.innerHTML=t.map(e=>`\n            <div class="nft-item">\n                <img src="${this.getNFTImage(e)}" alt="${e.name}" loading="lazy">\n                <div class="nft-item-info">\n                    <div class="nft-item-title">${e.name}</div>\n                    <div class="nft-item-price">${e.price} ETH</div>\n                    <div class="nft-item-status ${this.getNFTStatusClass(e)}">\n                        ${this.getNFTStatusText(e)}\n                    </div>\n                    ${"created"===i?this.getCreatorActions(e):""}\n                </div>\n            </div>\n        `).join("")}}getNFTStatusClass(e){return e.sold?"sold":e.forSale?"for-sale":"not-for-sale"}getNFTStatusText(e){return e.sold?"Sold":e.forSale?"For Sale":"Not for Sale"}getCreatorActions(e){if(e.sold)return"";const t=e.forSale?"Remove from Sale":"Put on Sale";return`\n            <div class="action-buttons">\n                <button class="btn-toggle" onclick="profileApp.toggleNFTSale('${e.id}')">\n                    ${t}\n                </button>\n            </div>\n        `}toggleNFTSale(e){if(!this.currentUser)return;const t=this.userStore.toggleNFTSale(e,this.currentUser);if(t){const e=t.forSale?"NFT is now available for sale":"NFT removed from sale";this.showMessage(e,"success"),this.loadCreatedNFTs(this.currentUser)}else this.showMessage("Failed to update NFT status","error")}getNFTImage(e){if(e.image&&window.imageHandler){const t=window.imageHandler.getImage(e.image);if(t)return t.data}return this.generateNFTImage(e.id,e.name)}generateNFTImage(e,t){const i=document.createElement("canvas");i.width=300,i.height=300;const s=i.getContext("2d"),n=s.createLinearGradient(0,0,300,300);return n.addColorStop(0,"#6366f1"),n.addColorStop(1,"#ec4899"),s.fillStyle=n,s.fillRect(0,0,300,300),s.fillStyle="white",s.font="24px Arial",s.textAlign="center",s.fillText("ðŸŽ¨",150,130),s.font="16px Arial",s.fillText(t||"NFT",150,160),s.font="12px Arial",s.fillText(`ID: ${e}`,150,180),i.toDataURL()}isValidUrl(e){try{return new URL(e),!0}catch(t){return!1}}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}formatAddress(e){return e?`${e.substring(0,6)}...${e.substring(e.length-4)}`:""}showMessage(e,t="info"){this.walletConnection&&this.walletConnection.showMessage?this.walletConnection.showMessage(e,t):console.log(`[${t.toUpperCase()}] ${e}`)}}document.addEventListener("DOMContentLoaded",()=>{window.profileApp=new e}),window.ProfileApp=e;
